(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))c(f);new MutationObserver(f=>{for(const v of f)if(v.type==="childList")for(const _ of v.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&c(_)}).observe(document,{childList:!0,subtree:!0});function s(f){const v={};return f.integrity&&(v.integrity=f.integrity),f.referrerPolicy&&(v.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?v.credentials="include":f.crossOrigin==="anonymous"?v.credentials="omit":v.credentials="same-origin",v}function c(f){if(f.ep)return;f.ep=!0;const v=s(f);fetch(f.href,v)}})();var op={exports:{}};var ST=op.exports,S0;function MT(){return S0||(S0=1,(function(m,i){(function(s,c){m.exports=c()})(ST,(function(){var s={},c={};function f(_,o,M){if(c[_]=M,_==="index"){var C="var sharedModule = {}; ("+c.shared+")(sharedModule); ("+c.worker+")(sharedModule);",D={};return c.shared(D),c.index(s,D),typeof window<"u"&&s.setWorkerUrl(window.URL.createObjectURL(new Blob([C],{type:"text/javascript"}))),s}}f("shared",["exports"],(function(_){function o(r,e,n,l){return new(n||(n=Promise))((function(h,p){function g(E){try{T(l.next(E))}catch(P){p(P)}}function b(E){try{T(l.throw(E))}catch(P){p(P)}}function T(E){var P;E.done?h(E.value):(P=E.value,P instanceof n?P:new n((function(I){I(P)}))).then(g,b)}T((l=l.apply(r,e||[])).next())}))}function M(r,e){this.x=r,this.y=e}function C(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var D,F;typeof SuppressedError=="function"&&SuppressedError,M.prototype={clone(){return new M(this.x,this.y)},add(r){return this.clone()._add(r)},sub(r){return this.clone()._sub(r)},multByPoint(r){return this.clone()._multByPoint(r)},divByPoint(r){return this.clone()._divByPoint(r)},mult(r){return this.clone()._mult(r)},div(r){return this.clone()._div(r)},rotate(r){return this.clone()._rotate(r)},rotateAround(r,e){return this.clone()._rotateAround(r,e)},matMult(r){return this.clone()._matMult(r)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(r){return this.x===r.x&&this.y===r.y},dist(r){return Math.sqrt(this.distSqr(r))},distSqr(r){const e=r.x-this.x,n=r.y-this.y;return e*e+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith(r){return this.angleWithSep(r.x,r.y)},angleWithSep(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult(r){const e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add(r){return this.x+=r.x,this.y+=r.y,this},_sub(r){return this.x-=r.x,this.y-=r.y,this},_mult(r){return this.x*=r,this.y*=r,this},_div(r){return this.x/=r,this.y/=r,this},_multByPoint(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint(r){return this.x/=r.x,this.y/=r.y,this},_unit(){return this._div(this.mag()),this},_perp(){const r=this.y;return this.y=this.x,this.x=-r,this},_rotate(r){const e=Math.cos(r),n=Math.sin(r),l=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=l,this},_rotateAround(r,e){const n=Math.cos(r),l=Math.sin(r),h=e.y+l*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-l*(this.y-e.y),this.y=h,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:M},M.convert=function(r){if(r instanceof M)return r;if(Array.isArray(r))return new M(+r[0],+r[1]);if(r.x!==void 0&&r.y!==void 0)return new M(+r.x,+r.y);throw new Error("Expected [x, y] or {x, y} point format")};var O=(function(){if(F)return D;function r(e,n,l,h){this.cx=3*e,this.bx=3*(l-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(h-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=l,this.p2y=h}return F=1,D=r,r.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var l=e,h=0;h<8;h++){var p=this.sampleCurveX(l)-e;if(Math.abs(p)<n)return l;var g=this.sampleCurveDerivativeX(l);if(Math.abs(g)<1e-6)break;l-=p/g}var b=0,T=1;for(l=e,h=0;h<20&&(p=this.sampleCurveX(l),!(Math.abs(p-e)<n));h++)e>p?b=l:T=l,l=.5*(T-b)+b;return l},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},D})(),j=C(O);let K,J;function N(){return K==null&&(K=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),K}function W(){if(J==null&&(J=!1,N())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let l=0;l<25;l++){const h=4*l;e.fillStyle=`rgb(${h},${h+1},${h+2})`,e.fillRect(l%5,Math.floor(l/5),1,1)}const n=e.getImageData(0,0,5,5).data;for(let l=0;l<100;l++)if(l%4!=3&&n[l]!==l){J=!0;break}}}return J||!1}var ge=1e-6,de=typeof Float32Array<"u"?Float32Array:Array;function ve(){var r=new de(9);return de!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function Me(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function De(){var r=new de(3);return de!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Ie(r){var e=r[0],n=r[1],l=r[2];return Math.sqrt(e*e+n*n+l*l)}function $e(r,e,n){var l=new de(3);return l[0]=r,l[1]=e,l[2]=n,l}function re(r,e,n){return r[0]=e[0]+n[0],r[1]=e[1]+n[1],r[2]=e[2]+n[2],r}function fe(r,e,n){return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r}function Oe(r,e,n){var l=e[0],h=e[1],p=e[2],g=n[0],b=n[1],T=n[2];return r[0]=h*T-p*b,r[1]=p*g-l*T,r[2]=l*b-h*g,r}var tt,Qe=Ie;function pt(r,e,n){var l=e[0],h=e[1],p=e[2],g=e[3];return r[0]=n[0]*l+n[4]*h+n[8]*p+n[12]*g,r[1]=n[1]*l+n[5]*h+n[9]*p+n[13]*g,r[2]=n[2]*l+n[6]*h+n[10]*p+n[14]*g,r[3]=n[3]*l+n[7]*h+n[11]*p+n[15]*g,r}function ct(){var r=new de(4);return de!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function nt(r,e,n,l){var h=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",p=Math.PI/360;e*=p,l*=p,n*=p;var g=Math.sin(e),b=Math.cos(e),T=Math.sin(n),E=Math.cos(n),P=Math.sin(l),I=Math.cos(l);switch(h){case"xyz":r[0]=g*E*I+b*T*P,r[1]=b*T*I-g*E*P,r[2]=b*E*P+g*T*I,r[3]=b*E*I-g*T*P;break;case"xzy":r[0]=g*E*I-b*T*P,r[1]=b*T*I-g*E*P,r[2]=b*E*P+g*T*I,r[3]=b*E*I+g*T*P;break;case"yxz":r[0]=g*E*I+b*T*P,r[1]=b*T*I-g*E*P,r[2]=b*E*P-g*T*I,r[3]=b*E*I+g*T*P;break;case"yzx":r[0]=g*E*I+b*T*P,r[1]=b*T*I+g*E*P,r[2]=b*E*P-g*T*I,r[3]=b*E*I-g*T*P;break;case"zxy":r[0]=g*E*I-b*T*P,r[1]=b*T*I+g*E*P,r[2]=b*E*P+g*T*I,r[3]=b*E*I-g*T*P;break;case"zyx":r[0]=g*E*I-b*T*P,r[1]=b*T*I+g*E*P,r[2]=b*E*P-g*T*I,r[3]=b*E*I+g*T*P;break;default:throw new Error("Unknown angle order "+h)}return r}function Je(){var r=new de(2);return de!=Float32Array&&(r[0]=0,r[1]=0),r}function ut(r,e){var n=new de(2);return n[0]=r,n[1]=e,n}De(),tt=new de(4),de!=Float32Array&&(tt[0]=0,tt[1]=0,tt[2]=0,tt[3]=0),De(),$e(1,0,0),$e(0,1,0),ct(),ct(),ve(),Je();const xt=8192;function At(r,e,n){return e*(xt/(r.tileSize*Math.pow(2,n-r.tileID.overscaledZ)))}function Rt(r,e){return(r%e+e)%e}function oi(r,e,n){return r*(1-n)+e*n}function ti(r){if(r<=0)return 0;if(r>=1)return 1;const e=r*r,n=e*r;return 4*(r<.5?n:3*(r-e)+n-.75)}function Ii(r,e,n,l){const h=new j(r,e,n,l);return p=>h.solve(p)}const yi=Ii(.25,.1,.25,1);function ot(r,e,n){return Math.min(n,Math.max(e,r))}function mt(r,e,n){const l=n-e,h=((r-e)%l+l)%l+e;return h===e?n:h}function Dt(r,...e){for(const n of e)for(const l in n)r[l]=n[l];return r}let ni=1;function Gt(r,e,n){const l={};for(const h in r)l[h]=e.call(this,r[h],h,r);return l}function pi(r,e,n){const l={};for(const h in r)e.call(this,r[h],h,r)&&(l[h]=r[h]);return l}function Ti(r){return Array.isArray(r)?r.map(Ti):typeof r=="object"&&r?Gt(r,Ti):r}const xi={};function ci(r){xi[r]||(typeof console<"u"&&console.warn(r),xi[r]=!0)}function vi(r,e,n){return(n.y-r.y)*(e.x-r.x)>(e.y-r.y)*(n.x-r.x)}function ri(r){return typeof WorkerGlobalScope<"u"&&r!==void 0&&r instanceof WorkerGlobalScope}let ui=null;function Le(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const Ji="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Si(r,e,n,l,h){return o(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const p=new VideoFrame(r,{timestamp:0});try{const g=p?.format;if(!g||!g.startsWith("BGR")&&!g.startsWith("RGB"))throw new Error(`Unrecognized format ${g}`);const b=g.startsWith("BGR"),T=new Uint8ClampedArray(l*h*4);if(yield p.copyTo(T,(function(E,P,I,B,k){const q=4*Math.max(-P,0),X=(Math.max(0,I)-I)*B*4+q,Y=4*B,ne=Math.max(0,P),me=Math.max(0,I);return{rect:{x:ne,y:me,width:Math.min(E.width,P+B)-ne,height:Math.min(E.height,I+k)-me},layout:[{offset:X,stride:Y}]}})(r,e,n,l,h)),b)for(let E=0;E<T.length;E+=4){const P=T[E];T[E]=T[E+2],T[E+2]=P}return T}finally{p.close()}}))}let Ri,Vt;function xe(r,e,n,l){return r.addEventListener(e,n,l),{unsubscribe:()=>{r.removeEventListener(e,n,l)}}}function Q(r){return r*Math.PI/180}function ke(r){return r/Math.PI*180}const ht={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},yt={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},st="AbortError";class jt extends Error{constructor(e=st){super(e instanceof Error?e.message:e),this.name=st,e instanceof Error&&e.stack&&(this.stack=e.stack)}}function Et(r){return r.name===st}const be={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function H(r){return be.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))]}const U="global-dispatcher";class Z extends Error{constructor(e,n,l,h){super(`AJAXError: ${n} (${e}): ${l}`),this.status=e,this.statusText=n,this.url=l,this.body=h}}const ae=()=>ri(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,pe=function(r,e){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){const l=H(r.url);if(l)return l(r,e);if(ri(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,targetMapId:U},e)}if(!(/^file:/.test(n=r.url)||/^file:/.test(ae())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(l,h){return o(this,void 0,void 0,(function*(){const p=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,cache:l.cache,referrer:ae(),signal:h.signal});let g,b;l.type!=="json"||p.headers.has("Accept")||p.headers.set("Accept","application/json");try{g=yield fetch(p)}catch(E){throw Et(E)?E:new Z(0,E.message,l.url,new Blob)}if(!g.ok){const E=yield g.blob();throw new Z(g.status,g.statusText,l.url,E)}b=l.type==="arrayBuffer"||l.type==="image"?g.arrayBuffer():l.type==="json"?g.json():g.text();const T=yield b;return h.signal.throwIfAborted(),{data:T,cacheControl:g.headers.get("Cache-Control"),expires:g.headers.get("Expires")}}))})(r,e);if(ri(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,mustQueue:!0,targetMapId:U},e)}var n;return(function(l,h){return new Promise(((p,g)=>{var b;const T=new XMLHttpRequest;T.open(l.method||"GET",l.url,!0),l.type!=="arrayBuffer"&&l.type!=="image"||(T.responseType="arraybuffer");for(const E in l.headers)T.setRequestHeader(E,l.headers[E]);l.type==="json"&&(T.responseType="text",!((b=l.headers)===null||b===void 0)&&b.Accept||T.setRequestHeader("Accept","application/json")),T.withCredentials=l.credentials==="include",T.onerror=()=>{g(new Error(T.statusText))},T.onload=()=>{if(!h.signal.aborted)if((T.status>=200&&T.status<300||T.status===0)&&T.response!==null){let E=T.response;if(l.type==="json")try{E=JSON.parse(T.response)}catch(P){return void g(P)}p({data:E,cacheControl:T.getResponseHeader("Cache-Control"),expires:T.getResponseHeader("Expires")})}else{const E=new Blob([T.response],{type:T.getResponseHeader("Content-Type")});g(new Z(T.status,T.statusText,l.url,E))}},h.signal.addEventListener("abort",(()=>{T.abort(),g(new jt(h.signal.reason))})),T.send(l.body)}))})(r,e)};function Se(r){if(!r||r.indexOf("://")<=0||r.indexOf("data:image/")===0||r.indexOf("blob:")===0)return!0;const e=new URL(r),n=window.location;return e.protocol===n.protocol&&e.host===n.host}function Fe(r,e,n){n[r]&&n[r].indexOf(e)!==-1||(n[r]=n[r]||[],n[r].push(e))}function te(r,e,n){if(n&&n[r]){const l=n[r].indexOf(e);l!==-1&&n[r].splice(l,1)}}class Ce{constructor(e,n={}){Dt(this,n),this.type=e}}class Ne extends Ce{constructor(e,n={}){super("error",Dt({error:e},n))}}class ze{on(e,n){return this._listeners=this._listeners||{},Fe(e,n,this._listeners),{unsubscribe:()=>{this.off(e,n)}}}off(e,n){return te(e,n,this._listeners),te(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Fe(e,n,this._oneTimeListeners),this):new Promise((l=>this.once(e,l)))}fire(e,n){typeof e=="string"&&(e=new Ce(e,n||{}));const l=e.type;if(this.listens(l)){e.target=this;const h=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const b of h)b.call(this,e);const p=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const b of p)te(l,b,this._oneTimeListeners),b.call(this,e);const g=this._eventedParent;g&&(Dt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(e))}else e instanceof Ne&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var oe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number",length:2},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"filter"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},filter:{type:"boolean",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"expression_name",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}},interpolation:{type:"array",value:"interpolation_name",minimum:1},interpolation_name:{type:"enum",values:{linear:{syntax:{overloads:[{parameters:[],"output-type":"interpolation"}],parameters:[]}},exponential:{syntax:{overloads:[{parameters:["base"],"output-type":"interpolation"}],parameters:[{name:"base",type:"number literal"}]}},"cubic-bezier":{syntax:{overloads:[{parameters:["x1","y1","x2","y2"],"output-type":"interpolation"}],parameters:[{name:"x1",type:"number literal"},{name:"y1",type:"number literal"},{name:"x2",type:"number literal"},{name:"y2",type:"number literal"}]}}}}};const Ve=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function lt(r,e){const n={};for(const l in r)l!=="ref"&&(n[l]=r[l]);return Ve.forEach((l=>{l in e&&(n[l]=e[l])})),n}function vt(r,e){if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(!vt(r[n],e[n]))return!1;return!0}if(typeof r=="object"&&r!==null&&e!==null){if(typeof e!="object"||Object.keys(r).length!==Object.keys(e).length)return!1;for(const n in r)if(!vt(r[n],e[n]))return!1;return!0}return r===e}function It(r,e){r.push(e)}function Ct(r,e,n){It(n,{command:"addSource",args:[r,e[r]]})}function $t(r,e,n){It(e,{command:"removeSource",args:[r]}),n[r]=!0}function Di(r,e,n,l){$t(r,n,l),Ct(r,e,n)}function fn(r,e,n){let l;for(l in r[n])if(Object.prototype.hasOwnProperty.call(r[n],l)&&l!=="data"&&!vt(r[n][l],e[n][l]))return!1;for(l in e[n])if(Object.prototype.hasOwnProperty.call(e[n],l)&&l!=="data"&&!vt(r[n][l],e[n][l]))return!1;return!0}function rn(r,e,n,l,h,p){r=r||{},e=e||{};for(const g in r)Object.prototype.hasOwnProperty.call(r,g)&&(vt(r[g],e[g])||n.push({command:p,args:[l,g,e[g],h]}));for(const g in e)Object.prototype.hasOwnProperty.call(e,g)&&!Object.prototype.hasOwnProperty.call(r,g)&&(vt(r[g],e[g])||n.push({command:p,args:[l,g,e[g],h]}))}function Ln(r){return r.id}function on(r,e){return r[e.id]=e,r}class gt{constructor(e,n,l,h){this.message=(e?`${e}: `:"")+l,h&&(this.identifier=h),n!=null&&n.__line__&&(this.line=n.__line__)}}function Ci(r,...e){for(const n of e)for(const l in n)r[l]=n[l];return r}class zi extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class is{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[l,h]of n)this.bindings[l]=h}concat(e){return new is(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Un={kind:"null"},Tt={kind:"number"},Yt={kind:"string"},si={kind:"boolean"},Vn={kind:"color"},ba={kind:"projectionDefinition"},Hr={kind:"object"},li={kind:"value"},wa={kind:"collator"},Ta={kind:"formatted"},lo={kind:"padding"},Xs={kind:"colorArray"},Sa={kind:"numberArray"},se={kind:"resolvedImage"},Ue={kind:"variableAnchorOffsetCollection"};function Ke(r,e){return{kind:"array",itemType:r,N:e}}function Ge(r){if(r.kind==="array"){const e=Ge(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const qe=[Un,Tt,Yt,si,Vn,ba,Ta,Hr,Ke(li),lo,Sa,Xs,se,Ue];function Pt(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Pt(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const n of qe)if(!Pt(n,e))return null}}return`Expected ${Ge(r)} but found ${Ge(e)} instead.`}function kt(r,e){return e.some((n=>n.kind===r.kind))}function Lt(r,e){return e.some((n=>n==="null"?r===null:n==="array"?Array.isArray(r):n==="object"?r&&!Array.isArray(r)&&typeof r=="object":n===typeof r))}function Ot(r,e){return r.kind==="array"&&e.kind==="array"?r.itemType.kind===e.itemType.kind&&typeof r.N=="number":r.kind===e.kind}const Xt=.96422,Jt=.82521,Kt=4/29,Wt=6/29,Ui=3*Wt*Wt,ln=Wt*Wt*Wt,Wi=Math.PI/180,Gi=180/Math.PI;function Qt(r){return(r%=360)<0&&(r+=360),r}function ki([r,e,n,l]){let h,p;const g=Yn((.2225045*(r=Ei(r))+.7168786*(e=Ei(e))+.0606169*(n=Ei(n)))/1);r===e&&e===n?h=p=g:(h=Yn((.4360747*r+.3850649*e+.1430804*n)/Xt),p=Yn((.0139322*r+.0971045*e+.7141733*n)/Jt));const b=116*g-16;return[b<0?0:b,500*(h-g),200*(g-p),l]}function Ei(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Yn(r){return r>ln?Math.pow(r,1/3):r/Ui+Kt}function _s([r,e,n,l]){let h=(r+16)/116,p=isNaN(e)?h:h+e/500,g=isNaN(n)?h:h-n/200;return h=1*Is(h),p=Xt*Is(p),g=Jt*Is(g),[Kn(3.1338561*p-1.6168667*h-.4906146*g),Kn(-.9787684*p+1.9161415*h+.033454*g),Kn(.0719453*p-.2289914*h+1.4052427*g),l]}function Kn(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function Is(r){return r>Wt?r*r*r:Ui*(r-Kt)}const qi=Object.hasOwn||function(r,e){return Object.prototype.hasOwnProperty.call(r,e)};function Fn(r,e){return qi(r,e)?r[e]:void 0}function Jn(r){return parseInt(r.padEnd(2,r),16)/255}function Gn(r,e){return Pn(e?r/100:r,0,1)}function Pn(r,e,n){return Math.min(Math.max(e,r),n)}function Ma(r){return!r.some(Number.isNaN)}const Lr={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Zs(r,e,n){return r+n*(e-r)}function co(r,e,n){return r.map(((l,h)=>Zs(l,e[h],n)))}class mi{constructor(e,n,l,h=1,p=!0){this.r=e,this.g=n,this.b=l,this.a=h,p||(this.r*=h,this.g*=h,this.b*=h,h||this.overwriteGetter("rgb",[e,n,l,h]))}static parse(e){if(e instanceof mi)return e;if(typeof e!="string")return;const n=(function(l){if((l=l.toLowerCase().trim())==="transparent")return[0,0,0,0];const h=Fn(Lr,l);if(h){const[g,b,T]=h;return[g/255,b/255,T/255,1]}if(l.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(l)){const g=l.length<6?1:2;let b=1;return[Jn(l.slice(b,b+=g)),Jn(l.slice(b,b+=g)),Jn(l.slice(b,b+=g)),Jn(l.slice(b,b+g)||"ff")]}if(l.startsWith("rgb")){const g=l.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[b,T,E,P,I,B,k,q,X,Y,ne,me]=g,ie=[P||" ",k||" ",Y].join("");if(ie==="  "||ie==="  /"||ie===",,"||ie===",,,"){const le=[E,B,X].join(""),Te=le==="%%%"?100:le===""?255:0;if(Te){const Re=[Pn(+T/Te,0,1),Pn(+I/Te,0,1),Pn(+q/Te,0,1),ne?Gn(+ne,me):1];if(Ma(Re))return Re}}return}}const p=l.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[g,b,T,E,P,I,B,k,q]=p,X=[T||" ",P||" ",B].join("");if(X==="  "||X==="  /"||X===",,"||X===",,,"){const Y=[+b,Pn(+E,0,100),Pn(+I,0,100),k?Gn(+k,q):1];if(Ma(Y))return(function([ne,me,ie,le]){function Te(Re){const He=(Re+ne/30)%12,it=me*Math.min(ie,1-ie);return ie-it*Math.max(-1,Math.min(He-3,9-He,1))}return ne=Qt(ne),me/=100,ie/=100,[Te(0),Te(8),Te(4),le]})(Y)}}})(e);return n?new mi(...n,!1):void 0}get rgb(){const{r:e,g:n,b:l,a:h}=this,p=h||1/0;return this.overwriteGetter("rgb",[e/p,n/p,l/p,h])}get hcl(){return this.overwriteGetter("hcl",(function(e){const[n,l,h,p]=ki(e),g=Math.sqrt(l*l+h*h);return[Math.round(1e4*g)?Qt(Math.atan2(h,l)*Gi):NaN,g,n,p]})(this.rgb))}get lab(){return this.overwriteGetter("lab",ki(this.rgb))}overwriteGetter(e,n){return Object.defineProperty(this,e,{value:n}),n}toString(){const[e,n,l,h]=this.rgb;return`rgba(${[e,n,l].map((p=>Math.round(255*p))).join(",")},${h})`}static interpolate(e,n,l,h="rgb"){switch(h){case"rgb":{const[p,g,b,T]=co(e.rgb,n.rgb,l);return new mi(p,g,b,T,!1)}case"hcl":{const[p,g,b,T]=e.hcl,[E,P,I,B]=n.hcl;let k,q;if(isNaN(p)||isNaN(E))isNaN(p)?isNaN(E)?k=NaN:(k=E,b!==1&&b!==0||(q=P)):(k=p,I!==1&&I!==0||(q=g));else{let ie=E-p;E>p&&ie>180?ie-=360:E<p&&p-E>180&&(ie+=360),k=p+l*ie}const[X,Y,ne,me]=(function([ie,le,Te,Re]){return ie=isNaN(ie)?0:ie*Wi,_s([Te,Math.cos(ie)*le,Math.sin(ie)*le,Re])})([k,q??Zs(g,P,l),Zs(b,I,l),Zs(T,B,l)]);return new mi(X,Y,ne,me,!1)}case"lab":{const[p,g,b,T]=_s(co(e.lab,n.lab,l));return new mi(p,g,b,T,!1)}}}}mi.black=new mi(0,0,0,1),mi.white=new mi(1,1,1,1),mi.transparent=new mi(0,0,0,0),mi.red=new mi(1,0,0,1);class Pu{constructor(e,n,l){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Cp=["bottom","center","top"];class Iu{constructor(e,n,l,h,p,g){this.text=e,this.image=n,this.scale=l,this.fontStack=h,this.textColor=p,this.verticalAlign=g}}class Mr{constructor(e){this.sections=e}static fromString(e){return new Mr([new Iu(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||e.image&&e.image.name.length!==0))}static factory(e){return e instanceof Mr?e:Mr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}}class ar{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ar)return e;if(typeof e=="number")return new ar([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const n of e)if(typeof n!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new ar(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,l){return new ar(co(e.values,n.values,l))}}class pn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof pn)return e;if(typeof e=="number")return new pn([e]);if(Array.isArray(e)){for(const n of e)if(typeof n!="number")return;return new pn(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,l){return new pn(co(e.values,n.values,l))}}class ii{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ii)return e;if(typeof e=="string"){const l=mi.parse(e);return l?new ii([l]):void 0}if(!Array.isArray(e))return;const n=[];for(const l of e){if(typeof l!="string")return;const h=mi.parse(l);if(!h)return;n.push(h)}return new ii(n)}toString(){return JSON.stringify(this.values)}static interpolate(e,n,l,h="rgb"){const p=[];if(e.values.length!=n.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${n.values.length}), cannot interpolate.`);for(let g=0;g<e.values.length;g++)p.push(mi.interpolate(e.values[g],n.values[g],l,h));return new ii(p)}}class Xi extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const $s=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class gr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof gr)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let n=0;n<e.length;n+=2){const l=e[n],h=e[n+1];if(typeof l!="string"||!$s.has(l)||!Array.isArray(h)||h.length!==2||typeof h[0]!="number"||typeof h[1]!="number")return}return new gr(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,l){const h=e.values,p=n.values;if(h.length!==p.length)throw new Xi(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${n.toString()}`);const g=[];for(let b=0;b<h.length;b+=2){if(h[b]!==p[b])throw new Xi(`Cannot interpolate values containing mismatched anchors. from[${b}]: ${h[b]}, to[${b}]: ${p[b]}`);g.push(h[b]);const[T,E]=h[b+1],[P,I]=p[b+1];g.push([Zs(T,P,l),Zs(E,I,l)])}return new gr(g)}}class Fr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Fr({name:e,available:!1}):null}}class _r{constructor(e,n,l){this.from=e,this.to=n,this.transition=l}static interpolate(e,n,l){return new _r(e,n,l)}static parse(e){return e instanceof _r?e:Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number"?new _r(e[0],e[1],e[2]):typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number"?new _r(e.from,e.to,e.transition):typeof e=="string"?new _r(e,e,1):void 0}}function uo(r,e,n,l){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[r,e,n,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[r,e,n,l]:[r,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ys(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof _r||r instanceof mi||r instanceof Pu||r instanceof Mr||r instanceof ar||r instanceof pn||r instanceof ii||r instanceof gr||r instanceof Fr)return!0;if(Array.isArray(r)){for(const e of r)if(!Ys(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!Ys(r[e]))return!1;return!0}return!1}function Tn(r){if(r===null)return Un;if(typeof r=="string")return Yt;if(typeof r=="boolean")return si;if(typeof r=="number")return Tt;if(r instanceof mi)return Vn;if(r instanceof _r)return ba;if(r instanceof Pu)return wa;if(r instanceof Mr)return Ta;if(r instanceof ar)return lo;if(r instanceof pn)return Sa;if(r instanceof ii)return Xs;if(r instanceof gr)return Ue;if(r instanceof Fr)return se;if(Array.isArray(r)){const e=r.length;let n;for(const l of r){const h=Tn(l);if(n){if(n===h)continue;n=li;break}n=h}return Ke(n||li,e)}return Hr}function Ea(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof mi||r instanceof _r||r instanceof Mr||r instanceof ar||r instanceof pn||r instanceof ii||r instanceof gr||r instanceof Fr?r.toString():JSON.stringify(r)}class ys{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ys(e[1]))return n.error("invalid value");const l=e[1];let h=Tn(l);const p=n.expectedType;return h.kind!=="array"||h.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(h=p),new ys(h,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const $l={string:Yt,number:Tt,boolean:si,object:Hr};class Er{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let l,h=1;const p=e[0];if(p==="array"){let b,T;if(e.length>2){const E=e[1];if(typeof E!="string"||!(E in $l)||E==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);b=$l[E],h++}else b=li;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);T=e[2],h++}l=Ke(b,T)}else{if(!$l[p])throw new Error(`Types doesn't contain name = ${p}`);l=$l[p]}const g=[];for(;h<e.length;h++){const b=n.parse(e[h],h,li);if(!b)return null;g.push(b)}return new Er(l,g)}evaluate(e){for(let n=0;n<this.args.length;n++){const l=this.args[n].evaluate(e);if(!Pt(this.type,Tn(l)))return l;if(n===this.args.length-1)throw new Xi(`Expected value to be of type ${Ge(this.type)}, but found ${Ge(Tn(l))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const Aa={"to-boolean":si,"to-color":Vn,"to-number":Tt,"to-string":Yt};class Rs{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const l=e[0];if(!Aa[l])throw new Error(`Can't parse ${l} as it is not part of the known types`);if((l==="to-boolean"||l==="to-string")&&e.length!==2)return n.error("Expected one argument.");const h=Aa[l],p=[];for(let g=1;g<e.length;g++){const b=n.parse(e[g],g,li);if(!b)return null;p.push(b)}return new Rs(h,p)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let n,l;for(const h of this.args){if(n=h.evaluate(e),l=null,n instanceof mi)return n;if(typeof n=="string"){const p=e.parseColor(n);if(p)return p}else if(Array.isArray(n)&&(l=n.length<3||n.length>4?`Invalid rgba value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:uo(n[0],n[1],n[2],n[3]),!l))return new mi(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Xi(l||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const l of this.args){n=l.evaluate(e);const h=ar.parse(n);if(h)return h}throw new Xi(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"numberArray":{let n;for(const l of this.args){n=l.evaluate(e);const h=pn.parse(n);if(h)return h}throw new Xi(`Could not parse numberArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"colorArray":{let n;for(const l of this.args){n=l.evaluate(e);const h=ii.parse(n);if(h)return h}throw new Xi(`Could not parse colorArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const l of this.args){n=l.evaluate(e);const h=gr.parse(n);if(h)return h}throw new Xi(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const l of this.args){if(n=l.evaluate(e),n===null)return 0;const h=Number(n);if(!isNaN(h))return h}throw new Xi(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return Mr.fromString(Ea(this.args[0].evaluate(e)));case"resolvedImage":return Fr.fromString(Ea(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return Ea(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const dd=["Unknown","Point","LineString","Polygon"];class Ru{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?dd[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let n=this._parseColorCache.get(e);return n||(n=mi.parse(e),this._parseColorCache.set(e,n)),n}}class Ca{constructor(e,n,l=[],h,p=new is,g=[]){this.registry=e,this.path=l,this.key=l.map((b=>`[${b}]`)).join(""),this.scope=p,this.errors=g,this.expectedType=h,this._isConstant=n}parse(e,n,l,h,p={}){return n?this.concat(n,l,h)._parse(e,p):this._parse(e,p)}_parse(e,n){function l(h,p,g){return g==="assert"?new Er(p,[h]):g==="coerce"?new Rs(p,[h]):h}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=e[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[h];if(p){let g=p.parse(e,this);if(!g)return null;if(this.expectedType){const b=this.expectedType,T=g.type;if(b.kind!=="string"&&b.kind!=="number"&&b.kind!=="boolean"&&b.kind!=="object"&&b.kind!=="array"||T.kind!=="value"){if(b.kind==="projectionDefinition"&&["string","array"].includes(T.kind)||["color","formatted","resolvedImage"].includes(b.kind)&&["value","string"].includes(T.kind)||["padding","numberArray"].includes(b.kind)&&["value","number","array"].includes(T.kind)||b.kind==="colorArray"&&["value","string","array"].includes(T.kind)||b.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(T.kind))g=l(g,b,n.typeAnnotation||"coerce");else if(this.checkSubtype(b,T))return null}else g=l(g,b,n.typeAnnotation||"assert")}if(!(g instanceof ys)&&g.type.kind!=="resolvedImage"&&this._isConstant(g)){const b=new Ru;try{g=new ys(g.type,g.evaluate(b))}catch(T){return this.error(T.message),null}}return g}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,l){const h=typeof e=="number"?this.path.concat(e):this.path,p=l?this.scope.concat(l):this.scope;return new Ca(this.registry,this._isConstant,h,n||null,p,this.errors)}error(e,...n){const l=`${this.key}${n.map((h=>`[${h}]`)).join("")}`;this.errors.push(new zi(l,e))}checkSubtype(e,n){const l=Pt(e,n);return l&&this.error(l),l}}class Zi{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let p=1;p<e.length-1;p+=2){const g=e[p];if(typeof g!="string")return n.error(`Expected string, but found ${typeof g} instead.`,p);if(/[^a-zA-Z0-9_]/.test(g))return n.error("Variable names must contain only alphanumeric characters or '_'.",p);const b=n.parse(e[p+1],p+1);if(!b)return null;l.push([g,b])}const h=n.parse(e[e.length-1],e.length-1,n.expectedType,l);return h?new Zi(l,h):null}outputDefined(){return this.result.outputDefined()}}class ho{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const l=e[1];return n.scope.has(l)?new ho(l,n.scope.get(l)):n.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Ai{constructor(e,n,l){this.type=e,this.index=n,this.input=l}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,Tt),h=n.parse(e[2],2,Ke(n.expectedType||li));return l&&h?new Ai(h.type.itemType,l,h):null}evaluate(e){const n=this.index.evaluate(e),l=this.input.evaluate(e);if(n<0)throw new Xi(`Array index out of bounds: ${n} < 0.`);if(n>=l.length)throw new Xi(`Array index out of bounds: ${n} > ${l.length-1}.`);if(n!==Math.floor(n))throw new Xi(`Array index must be an integer, but found ${n} instead.`);return l[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class di{constructor(e,n){this.type=si,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,li),h=n.parse(e[2],2,li);return l&&h?kt(l.type,[si,Yt,Tt,Un,li])?new di(l,h):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ge(l.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!l)return!1;if(!Lt(n,["boolean","string","number","null"]))throw new Xi(`Expected first argument to be of type boolean, string, number or null, but found ${Ge(Tn(n))} instead.`);if(!Lt(l,["string","array"]))throw new Xi(`Expected second argument to be of type array or string, but found ${Ge(Tn(l))} instead.`);return l.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class fo{constructor(e,n,l){this.type=Tt,this.needle=e,this.haystack=n,this.fromIndex=l}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,li),h=n.parse(e[2],2,li);if(!l||!h)return null;if(!kt(l.type,[si,Yt,Tt,Un,li]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ge(l.type)} instead`);if(e.length===4){const p=n.parse(e[3],3,Tt);return p?new fo(l,h,p):null}return new fo(l,h)}evaluate(e){const n=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!Lt(n,["boolean","string","number","null"]))throw new Xi(`Expected first argument to be of type boolean, string, number or null, but found ${Ge(Tn(n))} instead.`);let h;if(this.fromIndex&&(h=this.fromIndex.evaluate(e)),Lt(l,["string"])){const p=l.indexOf(n,h);return p===-1?-1:[...l.slice(0,p)].length}if(Lt(l,["array"]))return l.indexOf(n,h);throw new Xi(`Expected second argument to be of type array or string, but found ${Ge(Tn(l))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Pi{constructor(e,n,l,h,p,g){this.inputType=e,this.type=n,this.input=l,this.cases=h,this.outputs=p,this.otherwise=g}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let l,h;n.expectedType&&n.expectedType.kind!=="value"&&(h=n.expectedType);const p={},g=[];for(let E=2;E<e.length-1;E+=2){let P=e[E];const I=e[E+1];Array.isArray(P)||(P=[P]);const B=n.concat(E);if(P.length===0)return B.error("Expected at least one branch label.");for(const q of P){if(typeof q!="number"&&typeof q!="string")return B.error("Branch labels must be numbers or strings.");if(typeof q=="number"&&Math.abs(q)>Number.MAX_SAFE_INTEGER)return B.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof q=="number"&&Math.floor(q)!==q)return B.error("Numeric branch labels must be integer values.");if(l){if(B.checkSubtype(l,Tn(q)))return null}else l=Tn(q);if(p[String(q)]!==void 0)return B.error("Branch labels must be unique.");p[String(q)]=g.length}const k=n.parse(I,E,h);if(!k)return null;h=h||k.type,g.push(k)}const b=n.parse(e[1],1,li);if(!b)return null;const T=n.parse(e[e.length-1],e.length-1,h);return T?b.type.kind!=="value"&&n.concat(1).checkSubtype(l,b.type)?null:new Pi(l,h,b,p,g,T):null}evaluate(e){const n=this.input.evaluate(e);return(Tn(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}}class Yo{constructor(e,n,l){this.type=e,this.branches=n,this.otherwise=l}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let l;n.expectedType&&n.expectedType.kind!=="value"&&(l=n.expectedType);const h=[];for(let g=1;g<e.length-1;g+=2){const b=n.parse(e[g],g,si);if(!b)return null;const T=n.parse(e[g+1],g+1,l);if(!T)return null;h.push([b,T]),l=l||T.type}const p=n.parse(e[e.length-1],e.length-1,l);if(!p)return null;if(!l)throw new Error("Can't infer output type");return new Yo(l,h,p)}evaluate(e){for(const[n,l]of this.branches)if(n.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,l]of this.branches)e(n),e(l);e(this.otherwise)}outputDefined(){return this.branches.every((([e,n])=>n.outputDefined()))&&this.otherwise.outputDefined()}}class jr{constructor(e,n,l,h){this.type=e,this.input=n,this.beginIndex=l,this.endIndex=h}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,li),h=n.parse(e[2],2,Tt);if(!l||!h)return null;if(!kt(l.type,[Ke(li),Yt,li]))return n.error(`Expected first argument to be of type array or string, but found ${Ge(l.type)} instead`);if(e.length===4){const p=n.parse(e[3],3,Tt);return p?new jr(l.type,l,h,p):null}return new jr(l.type,l,h)}evaluate(e){const n=this.input.evaluate(e),l=this.beginIndex.evaluate(e);let h;if(this.endIndex&&(h=this.endIndex.evaluate(e)),Lt(n,["string"]))return[...n].slice(l,h).join("");if(Lt(n,["array"]))return n.slice(l,h);throw new Xi(`Expected first argument to be of type array or string, but found ${Ge(Tn(n))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function po(r,e){const n=r.length-1;let l,h,p=0,g=n,b=0;for(;p<=g;)if(b=Math.floor((p+g)/2),l=r[b],h=r[b+1],l<=e){if(b===n||e<h)return b;p=b+1}else{if(!(l>e))throw new Xi("Input is not a number.");g=b-1}return 0}class Ks{constructor(e,n,l){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[h,p]of l)this.labels.push(h),this.outputs.push(p)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const l=n.parse(e[1],1,Tt);if(!l)return null;const h=[];let p=null;n.expectedType&&n.expectedType.kind!=="value"&&(p=n.expectedType);for(let g=1;g<e.length;g+=2){const b=g===1?-1/0:e[g],T=e[g+1],E=g,P=g+1;if(typeof b!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(h.length&&h[h.length-1][0]>=b)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const I=n.parse(T,P,p);if(!I)return null;p=p||I.type,h.push([b,I])}return new Ks(p,l,h)}evaluate(e){const n=this.labels,l=this.outputs;if(n.length===1)return l[0].evaluate(e);const h=this.input.evaluate(e);if(h<=n[0])return l[0].evaluate(e);const p=n.length;return h>=n[p-1]?l[p-1].evaluate(e):l[po(n,h)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function fd(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Ko,Du,Pp=(function(){if(Du)return Ko;function r(e,n,l,h){this.cx=3*e,this.bx=3*(l-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(h-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=l,this.p2y=h}return Du=1,Ko=r,r.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var l=e,h=0;h<8;h++){var p=this.sampleCurveX(l)-e;if(Math.abs(p)<n)return l;var g=this.sampleCurveDerivativeX(l);if(Math.abs(g)<1e-6)break;l-=p/g}var b=0,T=1;for(l=e,h=0;h<20&&(p=this.sampleCurveX(l),!(Math.abs(p-e)<n));h++)e>p?b=l:T=l,l=.5*(T-b)+b;return l},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},Ko})(),pd=fd(Pp);class yr{constructor(e,n,l,h,p){this.type=e,this.operator=n,this.interpolation=l,this.input=h,this.labels=[],this.outputs=[];for(const[g,b]of p)this.labels.push(g),this.outputs.push(b)}static interpolationFactor(e,n,l,h){let p=0;if(e.name==="exponential")p=xs(n,e.base,l,h);else if(e.name==="linear")p=xs(n,1,l,h);else if(e.name==="cubic-bezier"){const g=e.controlPoints;p=new pd(g[0],g[1],g[2],g[3]).solve(xs(n,1,l,h))}return p}static parse(e,n){let[l,h,p,...g]=e;if(!Array.isArray(h)||h.length===0)return n.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const E=h[1];if(typeof E!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:E}}else{if(h[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const E=h.slice(1);if(E.length!==4||E.some((P=>typeof P!="number"||P<0||P>1)))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:E}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(p=n.parse(p,2,Tt),!p)return null;const b=[];let T=null;l!=="interpolate-hcl"&&l!=="interpolate-lab"||n.expectedType==Xs?n.expectedType&&n.expectedType.kind!=="value"&&(T=n.expectedType):T=Vn;for(let E=0;E<g.length;E+=2){const P=g[E],I=g[E+1],B=E+3,k=E+4;if(typeof P!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(b.length&&b[b.length-1][0]>=P)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',B);const q=n.parse(I,k,T);if(!q)return null;T=T||q.type,b.push([P,q])}return Ot(T,Tt)||Ot(T,ba)||Ot(T,Vn)||Ot(T,lo)||Ot(T,Sa)||Ot(T,Xs)||Ot(T,Ue)||Ot(T,Ke(Tt))?new yr(T,l,h,p,b):n.error(`Type ${Ge(T)} is not interpolatable.`)}evaluate(e){const n=this.labels,l=this.outputs;if(n.length===1)return l[0].evaluate(e);const h=this.input.evaluate(e);if(h<=n[0])return l[0].evaluate(e);const p=n.length;if(h>=n[p-1])return l[p-1].evaluate(e);const g=po(n,h),b=yr.interpolationFactor(this.interpolation,h,n[g],n[g+1]),T=l[g].evaluate(e),E=l[g+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Zs(T,E,b);case"color":return mi.interpolate(T,E,b);case"padding":return ar.interpolate(T,E,b);case"colorArray":return ii.interpolate(T,E,b);case"numberArray":return pn.interpolate(T,E,b);case"variableAnchorOffsetCollection":return gr.interpolate(T,E,b);case"array":return co(T,E,b);case"projectionDefinition":return _r.interpolate(T,E,b)}case"interpolate-hcl":switch(this.type.kind){case"color":return mi.interpolate(T,E,b,"hcl");case"colorArray":return ii.interpolate(T,E,b,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return mi.interpolate(T,E,b,"lab");case"colorArray":return ii.interpolate(T,E,b,"lab")}}}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function xs(r,e,n,l){const h=l-n,p=r-n;return h===0?0:e===1?p/h:(Math.pow(e,p)-1)/(Math.pow(e,h)-1)}const cn={color:mi.interpolate,number:Zs,padding:ar.interpolate,numberArray:pn.interpolate,colorArray:ii.interpolate,variableAnchorOffsetCollection:gr.interpolate,array:co};class Pa{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let l=null;const h=n.expectedType;h&&h.kind!=="value"&&(l=h);const p=[];for(const b of e.slice(1)){const T=n.parse(b,1+p.length,l,void 0,{typeAnnotation:"omit"});if(!T)return null;l=l||T.type,p.push(T)}if(!l)throw new Error("No output type");const g=h&&p.some((b=>Pt(h,b.type)));return new Pa(g?li:l,p)}evaluate(e){let n,l=null,h=0;for(const p of this.args)if(h++,l=p.evaluate(e),l&&l instanceof Fr&&!l.available&&(n||(n=l.name),l=null,h===this.args.length&&(l=n)),l!==null)break;return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}function Lu(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Jo(r,e,n,l){return l.compare(e,n)===0}function _n(r,e,n){const l=r!=="=="&&r!=="!=";return class Xv{constructor(p,g,b){this.type=si,this.lhs=p,this.rhs=g,this.collator=b,this.hasUntypedArgument=p.type.kind==="value"||g.type.kind==="value"}static parse(p,g){if(p.length!==3&&p.length!==4)return g.error("Expected two or three arguments.");const b=p[0];let T=g.parse(p[1],1,li);if(!T)return null;if(!Lu(b,T.type))return g.concat(1).error(`"${b}" comparisons are not supported for type '${Ge(T.type)}'.`);let E=g.parse(p[2],2,li);if(!E)return null;if(!Lu(b,E.type))return g.concat(2).error(`"${b}" comparisons are not supported for type '${Ge(E.type)}'.`);if(T.type.kind!==E.type.kind&&T.type.kind!=="value"&&E.type.kind!=="value")return g.error(`Cannot compare types '${Ge(T.type)}' and '${Ge(E.type)}'.`);l&&(T.type.kind==="value"&&E.type.kind!=="value"?T=new Er(E.type,[T]):T.type.kind!=="value"&&E.type.kind==="value"&&(E=new Er(T.type,[E])));let P=null;if(p.length===4){if(T.type.kind!=="string"&&E.type.kind!=="string"&&T.type.kind!=="value"&&E.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(P=g.parse(p[3],3,wa),!P)return null}return new Xv(T,E,P)}evaluate(p){const g=this.lhs.evaluate(p),b=this.rhs.evaluate(p);if(l&&this.hasUntypedArgument){const T=Tn(g),E=Tn(b);if(T.kind!==E.kind||T.kind!=="string"&&T.kind!=="number")throw new Xi(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${T.kind}, ${E.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const T=Tn(g),E=Tn(b);if(T.kind!=="string"||E.kind!=="string")return e(p,g,b)}return this.collator?n(p,g,b,this.collator.evaluate(p)):e(p,g,b)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}}}const md=_n("==",(function(r,e,n){return e===n}),Jo),Fu=_n("!=",(function(r,e,n){return e!==n}),(function(r,e,n,l){return!Jo(0,e,n,l)})),gd=_n("<",(function(r,e,n){return e<n}),(function(r,e,n,l){return l.compare(e,n)<0})),Ip=_n(">",(function(r,e,n){return e>n}),(function(r,e,n,l){return l.compare(e,n)>0})),mo=_n("<=",(function(r,e,n){return e<=n}),(function(r,e,n,l){return l.compare(e,n)<=0})),Yl=_n(">=",(function(r,e,n){return e>=n}),(function(r,e,n,l){return l.compare(e,n)>=0}));class go{constructor(e,n,l){this.type=wa,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const l=e[1];if(typeof l!="object"||Array.isArray(l))return n.error("Collator options argument must be an object.");const h=n.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,si);if(!h)return null;const p=n.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,si);if(!p)return null;let g=null;return l.locale&&(g=n.parse(l.locale,1,Yt),!g)?null:new go(h,p,g)}evaluate(e){return new Pu(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class zu{constructor(e,n,l,h,p){this.type=Yt,this.number=e,this.locale=n,this.currency=l,this.minFractionDigits=h,this.maxFractionDigits=p}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const l=n.parse(e[1],1,Tt);if(!l)return null;const h=e[2];if(typeof h!="object"||Array.isArray(h))return n.error("NumberFormat options argument must be an object.");let p=null;if(h.locale&&(p=n.parse(h.locale,1,Yt),!p))return null;let g=null;if(h.currency&&(g=n.parse(h.currency,1,Yt),!g))return null;let b=null;if(h["min-fraction-digits"]&&(b=n.parse(h["min-fraction-digits"],1,Tt),!b))return null;let T=null;return h["max-fraction-digits"]&&(T=n.parse(h["max-fraction-digits"],1,Tt),!T)?null:new zu(l,p,g,b,T)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Qo{constructor(e){this.type=Ta,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&typeof l=="object")return n.error("First argument must be an image or text section.");const h=[];let p=!1;for(let g=1;g<=e.length-1;++g){const b=e[g];if(p&&typeof b=="object"&&!Array.isArray(b)){p=!1;let T=null;if(b["font-scale"]&&(T=n.parse(b["font-scale"],1,Tt),!T))return null;let E=null;if(b["text-font"]&&(E=n.parse(b["text-font"],1,Ke(Yt)),!E))return null;let P=null;if(b["text-color"]&&(P=n.parse(b["text-color"],1,Vn),!P))return null;let I=null;if(b["vertical-align"]){if(typeof b["vertical-align"]=="string"&&!Cp.includes(b["vertical-align"]))return n.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${b["vertical-align"]}' instead.`);if(I=n.parse(b["vertical-align"],1,Yt),!I)return null}const B=h[h.length-1];B.scale=T,B.font=E,B.textColor=P,B.verticalAlign=I}else{const T=n.parse(e[g],1,li);if(!T)return null;const E=T.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,h.push({content:T,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Qo(h)}evaluate(e){return new Mr(this.sections.map((n=>{const l=n.content.evaluate(e);return Tn(l)===se?new Iu("",l,null,null,null,n.verticalAlign?n.verticalAlign.evaluate(e):null):new Iu(Ea(l),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null,n.verticalAlign?n.verticalAlign.evaluate(e):null)})))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor),n.verticalAlign&&e(n.verticalAlign)}outputDefined(){return!1}}class _o{constructor(e){this.type=se,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const l=n.parse(e[1],1,Yt);return l?new _o(l):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),l=Fr.fromString(n);return l&&e.availableImages&&(l.available=e.availableImages.indexOf(n)>-1),l}eachChild(e){e(this.input)}outputDefined(){return!1}}class yo{constructor(e){this.type=Tt,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=n.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Ge(l.type)} instead.`):new yo(l):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new Xi(`Expected value to be of type string or array, but found ${Ge(Tn(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const zn=8192;function _d(r,e){const n=(180+r[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(n*h*zn),Math.round(l*h*zn)]}function xo(r,e){const n=Math.pow(2,e.z);return[(h=(r[0]/zn+e.x)/n,360*h-180),(l=(r[1]/zn+e.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90)];var l,h}function el(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function Ia(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function Rp(r,e,n){const l=r[0]-e[0],h=r[1]-e[1],p=r[0]-n[0],g=r[1]-n[1];return l*g-p*h==0&&l*p<=0&&h*g<=0}function Kl(r,e,n,l){return(h=[l[0]-n[0],l[1]-n[1]])[0]*(p=[e[0]-r[0],e[1]-r[1]])[1]-h[1]*p[0]!=0&&!(!Ou(r,e,n,l)||!Ou(n,l,r,e));var h,p}function Dp(r,e,n){for(const l of n)for(let h=0;h<l.length-1;++h)if(Kl(r,e,l[h],l[h+1]))return!0;return!1}function vo(r,e,n=!1){let l=!1;for(const b of e)for(let T=0;T<b.length-1;T++){if(Rp(r,b[T],b[T+1]))return n;(p=b[T])[1]>(h=r)[1]!=(g=b[T+1])[1]>h[1]&&h[0]<(g[0]-p[0])*(h[1]-p[1])/(g[1]-p[1])+p[0]&&(l=!l)}var h,p,g;return l}function Jl(r,e){for(const n of e)if(vo(r,n))return!0;return!1}function yd(r,e){for(const n of r)if(!vo(n,e))return!1;for(let n=0;n<r.length-1;++n)if(Dp(r[n],r[n+1],e))return!1;return!0}function xd(r,e){for(const n of e)if(yd(r,n))return!0;return!1}function Ou(r,e,n,l){const h=l[0]-n[0],p=l[1]-n[1],g=(r[0]-n[0])*p-h*(r[1]-n[1]),b=(e[0]-n[0])*p-h*(e[1]-n[1]);return g>0&&b<0||g<0&&b>0}function Nu(r,e,n){const l=[];for(let h=0;h<r.length;h++){const p=[];for(let g=0;g<r[h].length;g++){const b=_d(r[h][g],n);el(e,b),p.push(b)}l.push(p)}return l}function Bu(r,e,n){const l=[];for(let h=0;h<r.length;h++){const p=Nu(r[h],e,n);l.push(p)}return l}function vd(r,e,n,l){if(r[0]<n[0]||r[0]>n[2]){const h=.5*l;let p=r[0]-n[0]>h?-l:n[0]-r[0]>h?l:0;p===0&&(p=r[0]-n[2]>h?-l:n[2]-r[0]>h?l:0),r[0]+=p}el(e,r)}function bd(r,e,n,l){const h=Math.pow(2,l.z)*zn,p=[l.x*zn,l.y*zn],g=[];for(const b of r)for(const T of b){const E=[T.x+p[0],T.y+p[1]];vd(E,e,n,h),g.push(E)}return g}function wd(r,e,n,l){const h=Math.pow(2,l.z)*zn,p=[l.x*zn,l.y*zn],g=[];for(const T of r){const E=[];for(const P of T){const I=[P.x+p[0],P.y+p[1]];el(e,I),E.push(I)}g.push(E)}if(e[2]-e[0]<=h/2){(b=e)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const T of g)for(const E of T)vd(E,e,n,h)}var b;return g}class Ra{constructor(e,n){this.type=si,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ys(e[1])){const l=e[1];if(l.type==="FeatureCollection"){const h=[];for(const p of l.features){const{type:g,coordinates:b}=p.geometry;g==="Polygon"&&h.push(b),g==="MultiPolygon"&&h.push(...b)}if(h.length)return new Ra(l,{type:"MultiPolygon",coordinates:h})}else if(l.type==="Feature"){const h=l.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Ra(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new Ra(l,l)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(n,l){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(l.type==="Polygon"){const b=Nu(l.coordinates,p,g),T=bd(n.geometry(),h,p,g);if(!Ia(h,p))return!1;for(const E of T)if(!vo(E,b))return!1}if(l.type==="MultiPolygon"){const b=Bu(l.coordinates,p,g),T=bd(n.geometry(),h,p,g);if(!Ia(h,p))return!1;for(const E of T)if(!Jl(E,b))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(n,l){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(l.type==="Polygon"){const b=Nu(l.coordinates,p,g),T=wd(n.geometry(),h,p,g);if(!Ia(h,p))return!1;for(const E of T)if(!yd(E,b))return!1}if(l.type==="MultiPolygon"){const b=Bu(l.coordinates,p,g),T=wd(n.geometry(),h,p,g);if(!Ia(h,p))return!1;for(const E of T)if(!xd(E,b))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Td=class{constructor(r=[],e=(n,l)=>n<l?-1:n>l?1:0){if(this.data=r,this.length=this.data.length,this.compare=e,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:e,compare:n}=this,l=e[r];for(;r>0;){const h=r-1>>1,p=e[h];if(n(l,p)>=0)break;e[r]=p,r=h}e[r]=l}_down(r){const{data:e,compare:n}=this,l=this.length>>1,h=e[r];for(;r<l;){let p=1+(r<<1);const g=p+1;if(g<this.length&&n(e[g],e[p])<0&&(p=g),n(e[p],h)>=0)break;e[r]=e[p],r=p}e[r]=h}};function ku(r,e,n=0,l=r.length-1,h=Sd){for(;l>n;){if(l-n>600){const T=l-n+1,E=e-n+1,P=Math.log(T),I=.5*Math.exp(2*P/3),B=.5*Math.sqrt(P*I*(T-I)/T)*(E-T/2<0?-1:1);ku(r,e,Math.max(n,Math.floor(e-E*I/T+B)),Math.min(l,Math.floor(e+(T-E)*I/T+B)),h)}const p=r[e];let g=n,b=l;for(bo(r,n,e),h(r[l],p)>0&&bo(r,n,l);g<b;){for(bo(r,g,b),g++,b--;h(r[g],p)<0;)g++;for(;h(r[b],p)>0;)b--}h(r[n],p)===0?bo(r,n,b):(b++,bo(r,b,l)),b<=e&&(n=b+1),e<=b&&(l=b-1)}}function bo(r,e,n){const l=r[e];r[e]=r[n],r[n]=l}function Sd(r,e){return r<e?-1:r>e?1:0}function Ql(r,e){if(r.length<=1)return[r];const n=[];let l,h;for(const p of r){const g=Fp(p);g!==0&&(p.area=Math.abs(g),h===void 0&&(h=g<0),h===g<0?(l&&n.push(l),l=[p]):l.push(p))}if(l&&n.push(l),e>1)for(let p=0;p<n.length;p++)n[p].length<=e||(ku(n[p],e,1,n[p].length-1,Lp),n[p]=n[p].slice(0,e));return n}function Lp(r,e){return e.area-r.area}function Fp(r){let e=0;for(let n,l,h=0,p=r.length,g=p-1;h<p;g=h++)n=r[h],l=r[g],e+=(l.x-n.x)*(n.y+l.y);return e}const Md=1/298.257223563,tl=Md*(2-Md),Ed=Math.PI/180;class Uu{constructor(e){const n=6378.137*Ed*1e3,l=Math.cos(e*Ed),h=1/(1-tl*(1-l*l)),p=Math.sqrt(h);this.kx=n*p*l,this.ky=n*p*h*(1-tl)}distance(e,n){const l=this.wrap(e[0]-n[0])*this.kx,h=(e[1]-n[1])*this.ky;return Math.sqrt(l*l+h*h)}pointOnLine(e,n){let l,h,p,g,b=1/0;for(let T=0;T<e.length-1;T++){let E=e[T][0],P=e[T][1],I=this.wrap(e[T+1][0]-E)*this.kx,B=(e[T+1][1]-P)*this.ky,k=0;I===0&&B===0||(k=(this.wrap(n[0]-E)*this.kx*I+(n[1]-P)*this.ky*B)/(I*I+B*B),k>1?(E=e[T+1][0],P=e[T+1][1]):k>0&&(E+=I/this.kx*k,P+=B/this.ky*k)),I=this.wrap(n[0]-E)*this.kx,B=(n[1]-P)*this.ky;const q=I*I+B*B;q<b&&(b=q,l=E,h=P,p=T,g=k)}return{point:[l,h],index:p,t:Math.max(0,Math.min(1,g))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function Ad(r,e){return e[0]-r[0]}function ec(r){return r[1]-r[0]+1}function ns(r,e){return r[1]>=r[0]&&r[1]<e}function tc(r,e){if(r[0]>r[1])return[null,null];const n=ec(r);if(e){if(n===2)return[r,null];const h=Math.floor(n/2);return[[r[0],r[0]+h],[r[0]+h,r[1]]]}if(n===1)return[r,null];const l=Math.floor(n/2)-1;return[[r[0],r[0]+l],[r[0]+l+1,r[1]]]}function Vu(r,e){if(!ns(e,r.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let l=e[0];l<=e[1];++l)el(n,r[l]);return n}function Gu(r){const e=[1/0,1/0,-1/0,-1/0];for(const n of r)for(const l of n)el(e,l);return e}function Hu(r){return r[0]!==-1/0&&r[1]!==-1/0&&r[2]!==1/0&&r[3]!==1/0}function ic(r,e,n){if(!Hu(r)||!Hu(e))return NaN;let l=0,h=0;return r[2]<e[0]&&(l=e[0]-r[2]),r[0]>e[2]&&(l=r[0]-e[2]),r[1]>e[3]&&(h=r[1]-e[3]),r[3]<e[1]&&(h=e[1]-r[3]),n.distance([0,0],[l,h])}function Da(r,e,n){const l=n.pointOnLine(e,r);return n.distance(r,l.point)}function ju(r,e,n,l,h){const p=Math.min(Da(r,[n,l],h),Da(e,[n,l],h)),g=Math.min(Da(n,[r,e],h),Da(l,[r,e],h));return Math.min(p,g)}function zp(r,e,n,l,h){if(!ns(e,r.length)||!ns(l,n.length))return 1/0;let p=1/0;for(let g=e[0];g<e[1];++g){const b=r[g],T=r[g+1];for(let E=l[0];E<l[1];++E){const P=n[E],I=n[E+1];if(Kl(b,T,P,I))return 0;p=Math.min(p,ju(b,T,P,I,h))}}return p}function Cd(r,e,n,l,h){if(!ns(e,r.length)||!ns(l,n.length))return NaN;let p=1/0;for(let g=e[0];g<=e[1];++g)for(let b=l[0];b<=l[1];++b)if(p=Math.min(p,h.distance(r[g],n[b])),p===0)return p;return p}function Op(r,e,n){if(vo(r,e,!0))return 0;let l=1/0;for(const h of e){const p=h[0],g=h[h.length-1];if(p!==g&&(l=Math.min(l,Da(r,[g,p],n)),l===0))return l;const b=n.pointOnLine(h,r);if(l=Math.min(l,n.distance(r,b.point)),l===0)return l}return l}function Np(r,e,n,l){if(!ns(e,r.length))return NaN;for(let p=e[0];p<=e[1];++p)if(vo(r[p],n,!0))return 0;let h=1/0;for(let p=e[0];p<e[1];++p){const g=r[p],b=r[p+1];for(const T of n)for(let E=0,P=T.length,I=P-1;E<P;I=E++){const B=T[I],k=T[E];if(Kl(g,b,B,k))return 0;h=Math.min(h,ju(g,b,B,k,l))}}return h}function Pd(r,e){for(const n of r)for(const l of n)if(vo(l,e,!0))return!0;return!1}function Bp(r,e,n,l=1/0){const h=Gu(r),p=Gu(e);if(l!==1/0&&ic(h,p,n)>=l)return l;if(Ia(h,p)){if(Pd(r,e))return 0}else if(Pd(e,r))return 0;let g=1/0;for(const b of r)for(let T=0,E=b.length,P=E-1;T<E;P=T++){const I=b[P],B=b[T];for(const k of e)for(let q=0,X=k.length,Y=X-1;q<X;Y=q++){const ne=k[Y],me=k[q];if(Kl(I,B,ne,me))return 0;g=Math.min(g,ju(I,B,ne,me,n))}}return g}function Oi(r,e,n,l,h,p){if(!p)return;const g=ic(Vu(l,p),h,n);g<e&&r.push([g,p,[0,0]])}function nc(r,e,n,l,h,p,g){if(!p||!g)return;const b=ic(Vu(l,p),Vu(h,g),n);b<e&&r.push([b,p,g])}function rc(r,e,n,l,h=1/0){let p=Math.min(l.distance(r[0],n[0][0]),h);if(p===0)return p;const g=new Td([[0,[0,r.length-1],[0,0]]],Ad),b=Gu(n);for(;g.length>0;){const T=g.pop();if(T[0]>=p)continue;const E=T[1],P=e?50:100;if(ec(E)<=P){if(!ns(E,r.length))return NaN;if(e){const I=Np(r,E,n,l);if(isNaN(I)||I===0)return I;p=Math.min(p,I)}else for(let I=E[0];I<=E[1];++I){const B=Op(r[I],n,l);if(p=Math.min(p,B),p===0)return 0}}else{const I=tc(E,e);Oi(g,p,l,r,b,I[0]),Oi(g,p,l,r,b,I[1])}}return p}function sc(r,e,n,l,h,p=1/0){let g=Math.min(p,h.distance(r[0],n[0]));if(g===0)return g;const b=new Td([[0,[0,r.length-1],[0,n.length-1]]],Ad);for(;b.length>0;){const T=b.pop();if(T[0]>=g)continue;const E=T[1],P=T[2],I=e?50:100,B=l?50:100;if(ec(E)<=I&&ec(P)<=B){if(!ns(E,r.length)&&ns(P,n.length))return NaN;let k;if(e&&l)k=zp(r,E,n,P,h),g=Math.min(g,k);else if(e&&!l){const q=r.slice(E[0],E[1]+1);for(let X=P[0];X<=P[1];++X)if(k=Da(n[X],q,h),g=Math.min(g,k),g===0)return g}else if(!e&&l){const q=n.slice(P[0],P[1]+1);for(let X=E[0];X<=E[1];++X)if(k=Da(r[X],q,h),g=Math.min(g,k),g===0)return g}else k=Cd(r,E,n,P,h),g=Math.min(g,k)}else{const k=tc(E,e),q=tc(P,l);nc(b,g,h,r,n,k[0],q[0]),nc(b,g,h,r,n,k[0],q[1]),nc(b,g,h,r,n,k[1],q[0]),nc(b,g,h,r,n,k[1],q[1])}}return g}function Wu(r){return r.type==="MultiPolygon"?r.coordinates.map((e=>({type:"Polygon",coordinates:e}))):r.type==="MultiLineString"?r.coordinates.map((e=>({type:"LineString",coordinates:e}))):r.type==="MultiPoint"?r.coordinates.map((e=>({type:"Point",coordinates:e}))):[r]}class La{constructor(e,n){this.type=Tt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ys(e[1])){const l=e[1];if(l.type==="FeatureCollection")return new La(l,l.features.map((h=>Wu(h.geometry))).flat());if(l.type==="Feature")return new La(l,Wu(l.geometry));if("type"in l&&"coordinates"in l)return new La(l,Wu(l))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(n,l){const h=n.geometry(),p=h.flat().map((T=>xo([T.x,T.y],n.canonical)));if(h.length===0)return NaN;const g=new Uu(p[0][1]);let b=1/0;for(const T of l){switch(T.type){case"Point":b=Math.min(b,sc(p,!1,[T.coordinates],!1,g,b));break;case"LineString":b=Math.min(b,sc(p,!1,T.coordinates,!0,g,b));break;case"Polygon":b=Math.min(b,rc(p,!1,T.coordinates,g,b))}if(b===0)return b}return b})(e,this.geometries);if(e.geometryType()==="LineString")return(function(n,l){const h=n.geometry(),p=h.flat().map((T=>xo([T.x,T.y],n.canonical)));if(h.length===0)return NaN;const g=new Uu(p[0][1]);let b=1/0;for(const T of l){switch(T.type){case"Point":b=Math.min(b,sc(p,!0,[T.coordinates],!1,g,b));break;case"LineString":b=Math.min(b,sc(p,!0,T.coordinates,!0,g,b));break;case"Polygon":b=Math.min(b,rc(p,!0,T.coordinates,g,b))}if(b===0)return b}return b})(e,this.geometries);if(e.geometryType()==="Polygon")return(function(n,l){const h=n.geometry();if(h.length===0||h[0].length===0)return NaN;const p=Ql(h,0).map((T=>T.map((E=>E.map((P=>xo([P.x,P.y],n.canonical))))))),g=new Uu(p[0][0][0][1]);let b=1/0;for(const T of l)for(const E of p){switch(T.type){case"Point":b=Math.min(b,rc([T.coordinates],!1,E,g,b));break;case"LineString":b=Math.min(b,rc(T.coordinates,!0,E,g,b));break;case"Polygon":b=Math.min(b,Bp(E,T.coordinates,g,b))}if(b===0)return b}return b})(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class il{constructor(e){this.type=li,this.key=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=e[1];return l==null?n.error("Global state property must be defined."):typeof l!="string"?n.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new il(l)}evaluate(e){var n;const l=(n=e.globals)===null||n===void 0?void 0:n.globalState;return l&&Object.keys(l).length!==0?Fn(l,this.key):null}eachChild(){}outputDefined(){return!1}}const wo={"==":md,"!=":Fu,">":Ip,"<":gd,">=":Yl,"<=":mo,array:Er,at:Ai,boolean:Er,case:Yo,coalesce:Pa,collator:go,format:Qo,image:_o,in:di,"index-of":fo,interpolate:yr,"interpolate-hcl":yr,"interpolate-lab":yr,length:yo,let:Zi,literal:ys,match:Pi,number:Er,"number-format":zu,object:Er,slice:jr,step:Ks,string:Er,"to-boolean":Rs,"to-color":Rs,"to-number":Rs,"to-string":Rs,var:ho,within:Ra,distance:La,"global-state":il};class Wr{constructor(e,n,l,h){this.name=e,this.type=n,this._evaluate=l,this.args=h}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,n){const l=e[0],h=Wr.definitions[l];if(!h)return n.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(h)?h[0]:h.type,g=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,b=g.filter((([E])=>!Array.isArray(E)||E.length===e.length-1));let T=null;for(const[E,P]of b){T=new Ca(n.registry,ac,n.path,null,n.scope);const I=[];let B=!1;for(let k=1;k<e.length;k++){const q=e[k],X=Array.isArray(E)?E[k-1]:E.type,Y=T.parse(q,1+I.length,X);if(!Y){B=!0;break}I.push(Y)}if(!B)if(Array.isArray(E)&&E.length!==I.length)T.error(`Expected ${E.length} arguments, but found ${I.length} instead.`);else{for(let k=0;k<I.length;k++){const q=Array.isArray(E)?E[k]:E.type,X=I[k];T.concat(k+1).checkSubtype(q,X.type)}if(T.errors.length===0)return new Wr(l,p,P,I)}}if(b.length===1)n.errors.push(...T.errors);else{const E=(b.length?b:g).map((([I])=>{return B=I,Array.isArray(B)?`(${B.map(Ge).join(", ")})`:`(${Ge(B.type)}...)`;var B})).join(" | "),P=[];for(let I=1;I<e.length;I++){const B=n.parse(e[I],1+P.length);if(!B)return null;P.push(Ge(B.type))}n.error(`Expected arguments of type ${E}, but found (${P.join(", ")}) instead.`)}return null}static register(e,n){Wr.definitions=n;for(const l in n)e[l]=Wr}}function Id(r,[e,n,l,h]){e=e.evaluate(r),n=n.evaluate(r),l=l.evaluate(r);const p=h?h.evaluate(r):1,g=uo(e,n,l,p);if(g)throw new Xi(g);return new mi(e/255,n/255,l/255,p,!1)}function Rd(r,e){return r in e}function qu(r,e){const n=e[r];return n===void 0?null:n}function Fa(r){return{type:r}}function ac(r){if(r instanceof ho)return ac(r.boundExpression);if(r instanceof Wr&&r.name==="error"||r instanceof go||r instanceof Ra||r instanceof La||r instanceof il)return!1;const e=r instanceof Rs||r instanceof Er;let n=!0;return r.eachChild((l=>{n=e?n&&ac(l):n&&l instanceof ys})),!!n&&oc(r)&&lc(r,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function oc(r){if(r instanceof Wr&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof Ra||r instanceof La)return!1;let e=!0;return r.eachChild((n=>{e&&!oc(n)&&(e=!1)})),e}function nl(r){if(r instanceof Wr&&r.name==="feature-state")return!1;let e=!0;return r.eachChild((n=>{e&&!nl(n)&&(e=!1)})),e}function lc(r,e){if(r instanceof Wr&&e.indexOf(r.name)>=0)return!1;let n=!0;return r.eachChild((l=>{n&&!lc(l,e)&&(n=!1)})),n}function Dd(r){return{result:"success",value:r}}function To(r){return{result:"error",value:r}}function So(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function Ld(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function Xu(r){return!!r.expression&&r.expression.interpolated}function _i(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function cc(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)&&Tn(r)===Hr}function kp(r){return r}function Fd(r,e){const n=r.stops&&typeof r.stops[0][0]=="object",l=n||!(n||r.property!==void 0),h=r.type||(Xu(e)?"exponential":"interval"),p=(function(P){switch(P.type){case"color":return mi.parse;case"padding":return ar.parse;case"numberArray":return pn.parse;case"colorArray":return ii.parse;default:return null}})(e);if(p&&((r=Ci({},r)).stops&&(r.stops=r.stops.map((P=>[P[0],p(P[1])]))),r.default=p(r.default?r.default:e.default)),r.colorSpace&&(g=r.colorSpace)!=="rgb"&&g!=="hcl"&&g!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var g;const b=(function(P){switch(P){case"exponential":return zd;case"interval":return Vp;case"categorical":return Up;case"identity":return Gp;default:throw new Error(`Unknown function type "${P}"`)}})(h);let T,E;if(h==="categorical"){T=Object.create(null);for(const P of r.stops)T[P[0]]=P[1];E=typeof r.stops[0][0]}if(n){const P={},I=[];for(let q=0;q<r.stops.length;q++){const X=r.stops[q],Y=X[0].zoom;P[Y]===void 0&&(P[Y]={zoom:Y,type:r.type,property:r.property,default:r.default,stops:[]},I.push(Y)),P[Y].stops.push([X[0].value,X[1]])}const B=[];for(const q of I)B.push([P[q].zoom,Fd(P[q],e)]);const k={name:"linear"};return{kind:"composite",interpolationType:k,interpolationFactor:yr.interpolationFactor.bind(void 0,k),zoomStops:B.map((q=>q[0])),evaluate:({zoom:q},X)=>zd({stops:B,base:r.base},e,q).evaluate(q,X)}}if(l){const P=h==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:yr.interpolationFactor.bind(void 0,P),zoomStops:r.stops.map((I=>I[0])),evaluate:({zoom:I})=>b(r,e,I,T,E)}}return{kind:"source",evaluate(P,I){const B=I&&I.properties?I.properties[r.property]:void 0;return B===void 0?rl(r.default,e.default):b(r,e,B,T,E)}}}function rl(r,e,n){return r!==void 0?r:e!==void 0?e:n!==void 0?n:void 0}function Up(r,e,n,l,h){return rl(typeof n===h?l[n]:void 0,r.default,e.default)}function Vp(r,e,n){if(_i(n)!=="number")return rl(r.default,e.default);const l=r.stops.length;if(l===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[l-1][0])return r.stops[l-1][1];const h=po(r.stops.map((p=>p[0])),n);return r.stops[h][1]}function zd(r,e,n){const l=r.base!==void 0?r.base:1;if(_i(n)!=="number")return rl(r.default,e.default);const h=r.stops.length;if(h===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[h-1][0])return r.stops[h-1][1];const p=po(r.stops.map((P=>P[0])),n),g=(function(P,I,B,k){const q=k-B,X=P-B;return q===0?0:I===1?X/q:(Math.pow(I,X)-1)/(Math.pow(I,q)-1)})(n,l,r.stops[p][0],r.stops[p+1][0]),b=r.stops[p][1],T=r.stops[p+1][1],E=cn[e.type]||kp;return typeof b.evaluate=="function"?{evaluate(...P){const I=b.evaluate.apply(void 0,P),B=T.evaluate.apply(void 0,P);if(I!==void 0&&B!==void 0)return E(I,B,g,r.colorSpace)}}:E(b,T,g,r.colorSpace)}function Gp(r,e,n){switch(e.type){case"color":n=mi.parse(n);break;case"formatted":n=Mr.fromString(n.toString());break;case"resolvedImage":n=Fr.fromString(n.toString());break;case"padding":n=ar.parse(n);break;case"colorArray":n=ii.parse(n);break;case"numberArray":n=pn.parse(n);break;default:_i(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0)}return rl(n,r.default,e.default)}Wr.register(wo,{error:[{kind:"error"},[Yt],(r,[e])=>{throw new Xi(e.evaluate(r))}],typeof:[Yt,[li],(r,[e])=>Ge(Tn(e.evaluate(r)))],"to-rgba":[Ke(Tt,4),[Vn],(r,[e])=>{const[n,l,h,p]=e.evaluate(r).rgb;return[255*n,255*l,255*h,p]}],rgb:[Vn,[Tt,Tt,Tt],Id],rgba:[Vn,[Tt,Tt,Tt,Tt],Id],has:{type:si,overloads:[[[Yt],(r,[e])=>Rd(e.evaluate(r),r.properties())],[[Yt,Hr],(r,[e,n])=>Rd(e.evaluate(r),n.evaluate(r))]]},get:{type:li,overloads:[[[Yt],(r,[e])=>qu(e.evaluate(r),r.properties())],[[Yt,Hr],(r,[e,n])=>qu(e.evaluate(r),n.evaluate(r))]]},"feature-state":[li,[Yt],(r,[e])=>qu(e.evaluate(r),r.featureState||{})],properties:[Hr,[],r=>r.properties()],"geometry-type":[Yt,[],r=>r.geometryType()],id:[li,[],r=>r.id()],zoom:[Tt,[],r=>r.globals.zoom],"heatmap-density":[Tt,[],r=>r.globals.heatmapDensity||0],elevation:[Tt,[],r=>r.globals.elevation||0],"line-progress":[Tt,[],r=>r.globals.lineProgress||0],accumulated:[li,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[Tt,Fa(Tt),(r,e)=>{let n=0;for(const l of e)n+=l.evaluate(r);return n}],"*":[Tt,Fa(Tt),(r,e)=>{let n=1;for(const l of e)n*=l.evaluate(r);return n}],"-":{type:Tt,overloads:[[[Tt,Tt],(r,[e,n])=>e.evaluate(r)-n.evaluate(r)],[[Tt],(r,[e])=>-e.evaluate(r)]]},"/":[Tt,[Tt,Tt],(r,[e,n])=>e.evaluate(r)/n.evaluate(r)],"%":[Tt,[Tt,Tt],(r,[e,n])=>e.evaluate(r)%n.evaluate(r)],ln2:[Tt,[],()=>Math.LN2],pi:[Tt,[],()=>Math.PI],e:[Tt,[],()=>Math.E],"^":[Tt,[Tt,Tt],(r,[e,n])=>Math.pow(e.evaluate(r),n.evaluate(r))],sqrt:[Tt,[Tt],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[Tt,[Tt],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[Tt,[Tt],(r,[e])=>Math.log(e.evaluate(r))],log2:[Tt,[Tt],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[Tt,[Tt],(r,[e])=>Math.sin(e.evaluate(r))],cos:[Tt,[Tt],(r,[e])=>Math.cos(e.evaluate(r))],tan:[Tt,[Tt],(r,[e])=>Math.tan(e.evaluate(r))],asin:[Tt,[Tt],(r,[e])=>Math.asin(e.evaluate(r))],acos:[Tt,[Tt],(r,[e])=>Math.acos(e.evaluate(r))],atan:[Tt,[Tt],(r,[e])=>Math.atan(e.evaluate(r))],min:[Tt,Fa(Tt),(r,e)=>Math.min(...e.map((n=>n.evaluate(r))))],max:[Tt,Fa(Tt),(r,e)=>Math.max(...e.map((n=>n.evaluate(r))))],abs:[Tt,[Tt],(r,[e])=>Math.abs(e.evaluate(r))],round:[Tt,[Tt],(r,[e])=>{const n=e.evaluate(r);return n<0?-Math.round(-n):Math.round(n)}],floor:[Tt,[Tt],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[Tt,[Tt],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[si,[Yt,li],(r,[e,n])=>r.properties()[e.value]===n.value],"filter-id-==":[si,[li],(r,[e])=>r.id()===e.value],"filter-type-==":[si,[Yt],(r,[e])=>r.geometryType()===e.value],"filter-<":[si,[Yt,li],(r,[e,n])=>{const l=r.properties()[e.value],h=n.value;return typeof l==typeof h&&l<h}],"filter-id-<":[si,[li],(r,[e])=>{const n=r.id(),l=e.value;return typeof n==typeof l&&n<l}],"filter->":[si,[Yt,li],(r,[e,n])=>{const l=r.properties()[e.value],h=n.value;return typeof l==typeof h&&l>h}],"filter-id->":[si,[li],(r,[e])=>{const n=r.id(),l=e.value;return typeof n==typeof l&&n>l}],"filter-<=":[si,[Yt,li],(r,[e,n])=>{const l=r.properties()[e.value],h=n.value;return typeof l==typeof h&&l<=h}],"filter-id-<=":[si,[li],(r,[e])=>{const n=r.id(),l=e.value;return typeof n==typeof l&&n<=l}],"filter->=":[si,[Yt,li],(r,[e,n])=>{const l=r.properties()[e.value],h=n.value;return typeof l==typeof h&&l>=h}],"filter-id->=":[si,[li],(r,[e])=>{const n=r.id(),l=e.value;return typeof n==typeof l&&n>=l}],"filter-has":[si,[li],(r,[e])=>e.value in r.properties()],"filter-has-id":[si,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[si,[Ke(Yt)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[si,[Ke(li)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[si,[Yt,Ke(li)],(r,[e,n])=>n.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[si,[Yt,Ke(li)],(r,[e,n])=>(function(l,h,p,g){for(;p<=g;){const b=p+g>>1;if(h[b]===l)return!0;h[b]>l?g=b-1:p=b+1}return!1})(r.properties()[e.value],n.value,0,n.value.length-1)],all:{type:si,overloads:[[[si,si],(r,[e,n])=>e.evaluate(r)&&n.evaluate(r)],[Fa(si),(r,e)=>{for(const n of e)if(!n.evaluate(r))return!1;return!0}]]},any:{type:si,overloads:[[[si,si],(r,[e,n])=>e.evaluate(r)||n.evaluate(r)],[Fa(si),(r,e)=>{for(const n of e)if(n.evaluate(r))return!0;return!1}]]},"!":[si,[si],(r,[e])=>!e.evaluate(r)],"is-supported-script":[si,[Yt],(r,[e])=>{const n=r.globals&&r.globals.isSupportedScript;return!n||n(e.evaluate(r))}],upcase:[Yt,[Yt],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[Yt,[Yt],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[Yt,Fa(li),(r,e)=>e.map((n=>Ea(n.evaluate(r)))).join("")],"resolved-locale":[Yt,[wa],(r,[e])=>e.evaluate(r).resolvedLocale()]});class Zu{constructor(e,n,l){this.expression=e,this._warningHistory={},this._evaluator=new Ru,this._defaultValue=n?(function(h){if(h.type==="color"&&cc(h.default))return new mi(0,0,0,0);switch(h.type){case"color":return mi.parse(h.default)||null;case"padding":return ar.parse(h.default)||null;case"numberArray":return pn.parse(h.default)||null;case"colorArray":return ii.parse(h.default)||null;case"variableAnchorOffsetCollection":return gr.parse(h.default)||null;case"projectionDefinition":return _r.parse(h.default)||null;default:return h.default===void 0?null:h.default}})(n):null,this._enumValues=n&&n.type==="enum"?n.values:null,this._globalState=l}evaluateWithoutErrorHandling(e,n,l,h,p,g){return this._globalState&&(e=za(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=l,this._evaluator.canonical=h,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)}evaluate(e,n,l,h,p,g){this._globalState&&(e=za(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=l||null,this._evaluator.canonical=h,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g||null;try{const b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new Xi(`Expected value to be one of ${Object.keys(this._enumValues).map((T=>JSON.stringify(T))).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function Mo(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in wo}function sl(r,e,n){const l=new Ca(wo,ac,[],e?(function(p){const g={color:Vn,string:Yt,number:Tt,enum:Yt,boolean:si,formatted:Ta,padding:lo,numberArray:Sa,colorArray:Xs,projectionDefinition:ba,resolvedImage:se,variableAnchorOffsetCollection:Ue};return p.type==="array"?Ke(g[p.value]||li,p.length):g[p.type]})(e):void 0),h=l.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Dd(new Zu(h,e,n)):To(l.errors)}class uc{constructor(e,n,l){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!nl(n.expression),this.globalStateRefs=Js(n.expression),this._globalState=l}evaluateWithoutErrorHandling(e,n,l,h,p,g){return this._globalState&&(e=za(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,n,l,h,p,g)}evaluate(e,n,l,h,p,g){return this._globalState&&(e=za(e,this._globalState)),this._styleExpression.evaluate(e,n,l,h,p,g)}}class $u{constructor(e,n,l,h,p){this.kind=e,this.zoomStops=l,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!nl(n.expression),this.globalStateRefs=Js(n.expression),this.interpolationType=h,this._globalState=p}evaluateWithoutErrorHandling(e,n,l,h,p,g){return this._globalState&&(e=za(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,n,l,h,p,g)}evaluate(e,n,l,h,p,g){return this._globalState&&(e=za(e,this._globalState)),this._styleExpression.evaluate(e,n,l,h,p,g)}interpolationFactor(e,n,l){return this.interpolationType?yr.interpolationFactor(this.interpolationType,e,n,l):0}}function Yu(r,e,n){const l=sl(r,e,n);if(l.result==="error")return l;const h=l.value.expression,p=oc(h);if(!p&&!So(e))return To([new zi("","data expressions not supported")]);const g=lc(h,["zoom"]);if(!g&&!Ld(e))return To([new zi("","zoom expressions not supported")]);const b=dc(h);return b||g?b instanceof zi?To([b]):b instanceof yr&&!Xu(e)?To([new zi("",'"interpolate" expressions cannot be used with this property')]):Dd(b?new $u(p?"camera":"composite",l.value,b.labels,b instanceof yr?b.interpolation:void 0,n):new uc(p?"constant":"source",l.value,n)):To([new zi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class hc{constructor(e,n){this._parameters=e,this._specification=n,Ci(this,Fd(this._parameters,this._specification))}static deserialize(e){return new hc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function dc(r){let e=null;if(r instanceof Zi)e=dc(r.result);else if(r instanceof Pa){for(const n of r.args)if(e=dc(n),e)break}else(r instanceof Ks||r instanceof yr)&&r.input instanceof Wr&&r.input.name==="zoom"&&(e=r);return e instanceof zi||r.eachChild((n=>{const l=dc(n);l instanceof zi?e=l:!e&&l?e=new zi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&l&&e!==l&&(e=new zi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function Js(r,e=new Set){return r instanceof il&&e.add(r.key),r.eachChild((n=>{Js(n,e)})),e}function za(r,e){const{zoom:n,heatmapDensity:l,elevation:h,lineProgress:p,isSupportedScript:g,accumulated:b}=r??{};return{zoom:n,heatmapDensity:l,elevation:h,lineProgress:p,isSupportedScript:g,accumulated:b,globalState:e}}function Ku(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!Ku(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const Hp={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function al(r,e){if(r==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Ku(r)||(r=ol(r));const n=sl(r,Hp,e);if(n.result==="error")throw new Error(n.value.map((l=>`${l.key}: ${l.message}`)).join(", "));return{filter:(l,h,p)=>n.value.evaluate(l,h,{},p),needGeometry:Od(r),getGlobalStateRefs:()=>Js(n.value.expression)}}function jp(r,e){return r<e?-1:r>e?1:0}function Od(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let e=1;e<r.length;e++)if(Od(r[e]))return!0;return!1}function ol(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?fc(r[1],r[2],"=="):e==="!="?ll(fc(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?fc(r[1],r[2],e):e==="any"?(n=r.slice(1),["any"].concat(n.map(ol))):e==="all"?["all"].concat(r.slice(1).map(ol)):e==="none"?["all"].concat(r.slice(1).map(ol).map(ll)):e==="in"?Nd(r[1],r.slice(2)):e==="!in"?ll(Nd(r[1],r.slice(2))):e==="has"?Bd(r[1]):e!=="!has"||ll(Bd(r[1]));var n}function fc(r,e,n){switch(r){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,r,e]}}function Nd(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((n=>typeof n!=typeof e[0]))?["filter-in-large",r,["literal",e.sort(jp)]]:["filter-in-small",r,["literal",e]]}}function Bd(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function ll(r){return["!",r]}function pc(r){const e=typeof r;if(e==="number"||e==="boolean"||e==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let h="[";for(const p of r)h+=`${pc(p)},`;return`${h}]`}const n=Object.keys(r).sort();let l="{";for(let h=0;h<n.length;h++)l+=`${JSON.stringify(n[h])}:${pc(r[n[h]])},`;return`${l}}`}function kd(r){let e="";for(const n of Ve)e+=`/${pc(r[n])}`;return e}function Ud(r){const e=r.value;return e?[new gt(r.key,e,"constants have been deprecated as of v8")]:[]}function Sn(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Oa(r){if(Array.isArray(r))return r.map(Oa);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const n in r)e[n]=Oa(r[n]);return e}return Sn(r)}function zr(r){const e=r.key,n=r.value,l=r.valueSpec||{},h=r.objectElementValidators||{},p=r.style,g=r.styleSpec,b=r.validateSpec;let T=[];const E=_i(n);if(E!=="object")return[new gt(e,n,`object expected, ${E} found`)];for(const P in n){const I=P.split(".")[0],B=Fn(l,I)||l["*"];let k;if(Fn(h,I))k=h[I];else if(Fn(l,I)){if(n[P]===void 0)continue;k=b}else if(h["*"])k=h["*"];else{if(!l["*"]){T.push(new gt(e,n[P],`unknown property "${P}"`));continue}k=b}T=T.concat(k({key:(e&&`${e}.`)+P,value:n[P],valueSpec:B,style:p,styleSpec:g,object:n,objectKey:P,validateSpec:b},n))}for(const P in l)h[P]||l[P].required&&l[P].default===void 0&&n[P]===void 0&&T.push(new gt(e,n,`missing required property "${P}"`));return T}function mc(r){const e=r.value,n=r.valueSpec,l=r.style,h=r.styleSpec,p=r.key,g=r.arrayElementValidator||r.validateSpec;if(_i(e)!=="array")return[new gt(p,e,`array expected, ${_i(e)} found`)];if(n.length&&e.length!==n.length)return[new gt(p,e,`array length ${n.length} expected, length ${e.length} found`)];let b={type:n.value,values:n.values};h.$version<7&&(b.function=n.function),_i(n.value)==="object"&&(b=n.value);let T=[];for(let E=0;E<e.length;E++)T=T.concat(g({array:e,arrayIndex:E,value:e[E],valueSpec:b,validateSpec:r.validateSpec,style:l,styleSpec:h,key:`${p}[${E}]`}));return T}function cl(r){const e=r.key,n=r.value,l=r.valueSpec;let h=_i(n);return h==="number"&&n!=n&&(h="NaN"),h!=="number"?[new gt(e,n,`number expected, ${h} found`)]:"minimum"in l&&n<l.minimum?[new gt(e,n,`${n} is less than the minimum value ${l.minimum}`)]:"maximum"in l&&n>l.maximum?[new gt(e,n,`${n} is greater than the maximum value ${l.maximum}`)]:[]}function gc(r){const e=r.valueSpec,n=Sn(r.value.type);let l,h,p,g={};const b=n!=="categorical"&&r.value.property===void 0,T=!b,E=_i(r.value.stops)==="array"&&_i(r.value.stops[0])==="array"&&_i(r.value.stops[0][0])==="object",P=zr({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(k){if(n==="identity")return[new gt(k.key,k.value,'identity function may not have a "stops" property')];let q=[];const X=k.value;return q=q.concat(mc({key:k.key,value:X,valueSpec:k.valueSpec,validateSpec:k.validateSpec,style:k.style,styleSpec:k.styleSpec,arrayElementValidator:I})),_i(X)==="array"&&X.length===0&&q.push(new gt(k.key,X,"array must have at least one stop")),q},default:function(k){return k.validateSpec({key:k.key,value:k.value,valueSpec:e,validateSpec:k.validateSpec,style:k.style,styleSpec:k.styleSpec})}}});return n==="identity"&&b&&P.push(new gt(r.key,r.value,'missing required property "property"')),n==="identity"||r.value.stops||P.push(new gt(r.key,r.value,'missing required property "stops"')),n==="exponential"&&r.valueSpec.expression&&!Xu(r.valueSpec)&&P.push(new gt(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(T&&!So(r.valueSpec)?P.push(new gt(r.key,r.value,"property functions not supported")):b&&!Ld(r.valueSpec)&&P.push(new gt(r.key,r.value,"zoom functions not supported"))),n!=="categorical"&&!E||r.value.property!==void 0||P.push(new gt(r.key,r.value,'"property" property is required')),P;function I(k){let q=[];const X=k.value,Y=k.key;if(_i(X)!=="array")return[new gt(Y,X,`array expected, ${_i(X)} found`)];if(X.length!==2)return[new gt(Y,X,`array length 2 expected, length ${X.length} found`)];if(E){if(_i(X[0])!=="object")return[new gt(Y,X,`object expected, ${_i(X[0])} found`)];if(X[0].zoom===void 0)return[new gt(Y,X,"object stop key must have zoom")];if(X[0].value===void 0)return[new gt(Y,X,"object stop key must have value")];if(p&&p>Sn(X[0].zoom))return[new gt(Y,X[0].zoom,"stop zoom values must appear in ascending order")];Sn(X[0].zoom)!==p&&(p=Sn(X[0].zoom),h=void 0,g={}),q=q.concat(zr({key:`${Y}[0]`,value:X[0],valueSpec:{zoom:{}},validateSpec:k.validateSpec,style:k.style,styleSpec:k.styleSpec,objectElementValidators:{zoom:cl,value:B}}))}else q=q.concat(B({key:`${Y}[0]`,value:X[0],validateSpec:k.validateSpec,style:k.style,styleSpec:k.styleSpec},X));return Mo(Oa(X[1]))?q.concat([new gt(`${Y}[1]`,X[1],"expressions are not allowed in function stops.")]):q.concat(k.validateSpec({key:`${Y}[1]`,value:X[1],valueSpec:e,validateSpec:k.validateSpec,style:k.style,styleSpec:k.styleSpec}))}function B(k,q){const X=_i(k.value),Y=Sn(k.value),ne=k.value!==null?k.value:q;if(l){if(X!==l)return[new gt(k.key,ne,`${X} stop domain type must match previous stop domain type ${l}`)]}else l=X;if(X!=="number"&&X!=="string"&&X!=="boolean")return[new gt(k.key,ne,"stop domain value must be a number, string, or boolean")];if(X!=="number"&&n!=="categorical"){let me=`number expected, ${X} found`;return So(e)&&n===void 0&&(me+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new gt(k.key,ne,me)]}return n!=="categorical"||X!=="number"||isFinite(Y)&&Math.floor(Y)===Y?n!=="categorical"&&X==="number"&&h!==void 0&&Y<h?[new gt(k.key,ne,"stop domain values must appear in ascending order")]:(h=Y,n==="categorical"&&Y in g?[new gt(k.key,ne,"stop domain values must be unique")]:(g[Y]=!0,[])):[new gt(k.key,ne,`integer expected, found ${Y}`)]}}function Qs(r){const e=(r.expressionContext==="property"?Yu:sl)(Oa(r.value),r.valueSpec);if(e.result==="error")return e.value.map((l=>new gt(`${r.key}${l.key}`,r.value,l.message)));const n=e.value.expression||e.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!n.outputDefined())return[new gt(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!nl(n))return[new gt(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!nl(n))return[new gt(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!lc(n,["zoom","feature-state"]))return[new gt(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!oc(n))return[new gt(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ul(r){const e=r.key,n=r.value,l=_i(n);return l!=="string"?[new gt(e,n,`color expected, ${l} found`)]:mi.parse(String(n))?[]:[new gt(e,n,`color expected, "${n}" found`)]}function Na(r){const e=r.key,n=r.value,l=r.valueSpec,h=[];return Array.isArray(l.values)?l.values.indexOf(Sn(n))===-1&&h.push(new gt(e,n,`expected one of [${l.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(l.values).indexOf(Sn(n))===-1&&h.push(new gt(e,n,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(n)} found`)),h}function Eo(r){return Ku(Oa(r.value))?Qs(Ci({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Vd(r)}function Vd(r){const e=r.value,n=r.key;if(_i(e)!=="array")return[new gt(n,e,`array expected, ${_i(e)} found`)];const l=r.styleSpec;let h,p=[];if(e.length<1)return[new gt(n,e,"filter array must have at least 1 element")];switch(p=p.concat(Na({key:`${n}[0]`,value:e[0],valueSpec:l.filter_operator,style:r.style,styleSpec:r.styleSpec})),Sn(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Sn(e[1])==="$type"&&p.push(new gt(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&p.push(new gt(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(h=_i(e[1]),h!=="string"&&p.push(new gt(`${n}[1]`,e[1],`string expected, ${h} found`)));for(let g=2;g<e.length;g++)h=_i(e[g]),Sn(e[1])==="$type"?p=p.concat(Na({key:`${n}[${g}]`,value:e[g],valueSpec:l.geometry_type,style:r.style,styleSpec:r.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&p.push(new gt(`${n}[${g}]`,e[g],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let g=1;g<e.length;g++)p=p.concat(Vd({key:`${n}[${g}]`,value:e[g],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":h=_i(e[1]),e.length!==2?p.push(new gt(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):h!=="string"&&p.push(new gt(`${n}[1]`,e[1],`string expected, ${h} found`))}return p}function Gd(r,e){const n=r.key,l=r.validateSpec,h=r.style,p=r.styleSpec,g=r.value,b=r.objectKey,T=p[`${e}_${r.layerType}`];if(!T)return[];const E=b.match(/^(.*)-transition$/);if(e==="paint"&&E&&T[E[1]]&&T[E[1]].transition)return l({key:n,value:g,valueSpec:p.transition,style:h,styleSpec:p});const P=r.valueSpec||T[b];if(!P)return[new gt(n,g,`unknown property "${b}"`)];let I;if(_i(g)==="string"&&So(P)&&!P.tokens&&(I=/^{([^}]+)}$/.exec(g)))return[new gt(n,g,`"${b}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(I[1])} }\`.`)];const B=[];return r.layerType==="symbol"&&b==="text-font"&&cc(Oa(g))&&Sn(g.type)==="identity"&&B.push(new gt(n,g,'"text-font" does not support identity functions')),B.concat(l({key:r.key,value:g,valueSpec:P,style:h,styleSpec:p,expressionContext:"property",propertyType:e,propertyKey:b}))}function Hd(r){return Gd(r,"paint")}function jd(r){return Gd(r,"layout")}function Wd(r){let e=[];const n=r.value,l=r.key,h=r.style,p=r.styleSpec;if(_i(n)!=="object")return[new gt(l,n,`object expected, ${_i(n)} found`)];n.type||n.ref||e.push(new gt(l,n,'either "type" or "ref" is required'));let g=Sn(n.type);const b=Sn(n.ref);if(n.id){const T=Sn(n.id);for(let E=0;E<r.arrayIndex;E++){const P=h.layers[E];Sn(P.id)===T&&e.push(new gt(l,n.id,`duplicate layer id "${n.id}", previously used at line ${P.id.__line__}`))}}if("ref"in n){let T;["type","source","source-layer","filter","layout"].forEach((E=>{E in n&&e.push(new gt(l,n[E],`"${E}" is prohibited for ref layers`))})),h.layers.forEach((E=>{Sn(E.id)===b&&(T=E)})),T?T.ref?e.push(new gt(l,n.ref,"ref cannot reference another ref layer")):g=Sn(T.type):e.push(new gt(l,n.ref,`ref layer "${b}" not found`))}else if(g!=="background")if(n.source){const T=h.sources&&h.sources[n.source],E=T&&Sn(T.type);T?E==="vector"&&g==="raster"?e.push(new gt(l,n.source,`layer "${n.id}" requires a raster source`)):E!=="raster-dem"&&g==="hillshade"||E!=="raster-dem"&&g==="color-relief"?e.push(new gt(l,n.source,`layer "${n.id}" requires a raster-dem source`)):E==="raster"&&g!=="raster"?e.push(new gt(l,n.source,`layer "${n.id}" requires a vector source`)):E!=="vector"||n["source-layer"]?E==="raster-dem"&&g!=="hillshade"&&g!=="color-relief"?e.push(new gt(l,n.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):g!=="line"||!n.paint||!n.paint["line-gradient"]||E==="geojson"&&T.lineMetrics||e.push(new gt(l,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new gt(l,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new gt(l,n.source,`source "${n.source}" not found`))}else e.push(new gt(l,n,'missing required property "source"'));return e=e.concat(zr({key:l,value:n,valueSpec:p.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${l}.type`,value:n.type,valueSpec:p.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:n,objectKey:"type"}),filter:Eo,layout:T=>zr({layer:n,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":E=>jd(Ci({layerType:g},E))}}),paint:T=>zr({layer:n,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":E=>Hd(Ci({layerType:g},E))}})}})),e}function ea(r){const e=r.value,n=r.key,l=_i(e);return l!=="string"?[new gt(n,e,`string expected, ${l} found`)]:[]}const Ju={promoteId:function({key:r,value:e}){if(_i(e)==="string")return ea({key:r,value:e});{const n=[];for(const l in e)n.push(...ea({key:`${r}.${l}`,value:e[l]}));return n}}};function Qu(r){const e=r.value,n=r.key,l=r.styleSpec,h=r.style,p=r.validateSpec;if(!e.type)return[new gt(n,e,'"type" is required')];const g=Sn(e.type);let b;switch(g){case"vector":case"raster":return b=zr({key:n,value:e,valueSpec:l[`source_${g.replace("-","_")}`],style:r.style,styleSpec:l,objectElementValidators:Ju,validateSpec:p}),b;case"raster-dem":return b=(function(T){var E;const P=(E=T.sourceName)!==null&&E!==void 0?E:"",I=T.value,B=T.styleSpec,k=B.source_raster_dem,q=T.style;let X=[];const Y=_i(I);if(I===void 0)return X;if(Y!=="object")return X.push(new gt("source_raster_dem",I,`object expected, ${Y} found`)),X;const ne=Sn(I.encoding)==="custom",me=["redFactor","greenFactor","blueFactor","baseShift"],ie=T.value.encoding?`"${T.value.encoding}"`:"Default";for(const le in I)!ne&&me.includes(le)?X.push(new gt(le,I[le],`In "${P}": "${le}" is only valid when "encoding" is set to "custom". ${ie} encoding found`)):k[le]?X=X.concat(T.validateSpec({key:le,value:I[le],valueSpec:k[le],validateSpec:T.validateSpec,style:q,styleSpec:B})):X.push(new gt(le,I[le],`unknown property "${le}"`));return X})({sourceName:n,value:e,style:r.style,styleSpec:l,validateSpec:p}),b;case"geojson":if(b=zr({key:n,value:e,valueSpec:l.source_geojson,style:h,styleSpec:l,validateSpec:p,objectElementValidators:Ju}),e.cluster)for(const T in e.clusterProperties){const[E,P]=e.clusterProperties[T],I=typeof E=="string"?[E,["accumulated"],["get",T]]:E;b.push(...Qs({key:`${n}.${T}.map`,value:P,expressionContext:"cluster-map"})),b.push(...Qs({key:`${n}.${T}.reduce`,value:I,expressionContext:"cluster-reduce"}))}return b;case"video":return zr({key:n,value:e,valueSpec:l.source_video,style:h,validateSpec:p,styleSpec:l});case"image":return zr({key:n,value:e,valueSpec:l.source_image,style:h,validateSpec:p,styleSpec:l});case"canvas":return[new gt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Na({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function hl(r){const e=r.value,n=r.styleSpec,l=n.light,h=r.style;let p=[];const g=_i(e);if(e===void 0)return p;if(g!=="object")return p=p.concat([new gt("light",e,`object expected, ${g} found`)]),p;for(const b in e){const T=b.match(/^(.*)-transition$/);p=p.concat(T&&l[T[1]]&&l[T[1]].transition?r.validateSpec({key:b,value:e[b],valueSpec:n.transition,validateSpec:r.validateSpec,style:h,styleSpec:n}):l[b]?r.validateSpec({key:b,value:e[b],valueSpec:l[b],validateSpec:r.validateSpec,style:h,styleSpec:n}):[new gt(b,e[b],`unknown property "${b}"`)])}return p}function qd(r){const e=r.value,n=r.styleSpec,l=n.sky,h=r.style,p=_i(e);if(e===void 0)return[];if(p!=="object")return[new gt("sky",e,`object expected, ${p} found`)];let g=[];for(const b in e)g=g.concat(l[b]?r.validateSpec({key:b,value:e[b],valueSpec:l[b],style:h,styleSpec:n}):[new gt(b,e[b],`unknown property "${b}"`)]);return g}function eh(r){const e=r.value,n=r.styleSpec,l=n.terrain,h=r.style;let p=[];const g=_i(e);if(e===void 0)return p;if(g!=="object")return p=p.concat([new gt("terrain",e,`object expected, ${g} found`)]),p;for(const b in e)p=p.concat(l[b]?r.validateSpec({key:b,value:e[b],valueSpec:l[b],validateSpec:r.validateSpec,style:h,styleSpec:n}):[new gt(b,e[b],`unknown property "${b}"`)]);return p}function th(r){let e=[];const n=r.value,l=r.key;if(Array.isArray(n)){const h=[],p=[];for(const g in n)n[g].id&&h.includes(n[g].id)&&e.push(new gt(l,n,`all the sprites' ids must be unique, but ${n[g].id} is duplicated`)),h.push(n[g].id),n[g].url&&p.includes(n[g].url)&&e.push(new gt(l,n,`all the sprites' URLs must be unique, but ${n[g].url} is duplicated`)),p.push(n[g].url),e=e.concat(zr({key:`${l}[${g}]`,value:n[g],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return e}return ea({key:l,value:n})}function Xd(r){return!!r&&r.constructor===Object}function ih(r){return Xd(r.value)?[]:[new gt(r.key,r.value,`object expected, ${_i(r.value)} found`)]}const nh={"*":()=>[],array:mc,boolean:function(r){const e=r.value,n=r.key,l=_i(e);return l!=="boolean"?[new gt(n,e,`boolean expected, ${l} found`)]:[]},number:cl,color:ul,constants:Ud,enum:Na,filter:Eo,function:gc,layer:Wd,object:zr,source:Qu,light:hl,sky:qd,terrain:eh,projection:function(r){const e=r.value,n=r.styleSpec,l=n.projection,h=r.style,p=_i(e);if(e===void 0)return[];if(p!=="object")return[new gt("projection",e,`object expected, ${p} found`)];let g=[];for(const b in e)g=g.concat(l[b]?r.validateSpec({key:b,value:e[b],valueSpec:l[b],style:h,styleSpec:n}):[new gt(b,e[b],`unknown property "${b}"`)]);return g},projectionDefinition:function(r){const e=r.key;let n=r.value;n=n instanceof String?n.valueOf():n;const l=_i(n);return l!=="array"||(function(h){return Array.isArray(h)&&h.length===3&&typeof h[0]=="string"&&typeof h[1]=="string"&&typeof h[2]=="number"})(n)||(function(h){return!!["interpolate","step","literal"].includes(h[0])})(n)?["array","string"].includes(l)?[]:[new gt(e,n,`projection expected, invalid type "${l}" found`)]:[new gt(e,n,`projection expected, invalid array ${JSON.stringify(n)} found`)]},string:ea,formatted:function(r){return ea(r).length===0?[]:Qs(r)},resolvedImage:function(r){return ea(r).length===0?[]:Qs(r)},padding:function(r){const e=r.key,n=r.value;if(_i(n)==="array"){if(n.length<1||n.length>4)return[new gt(e,n,`padding requires 1 to 4 values; ${n.length} values found`)];const l={type:"number"};let h=[];for(let p=0;p<n.length;p++)h=h.concat(r.validateSpec({key:`${e}[${p}]`,value:n[p],validateSpec:r.validateSpec,valueSpec:l}));return h}return cl({key:e,value:n,valueSpec:{}})},numberArray:function(r){const e=r.key,n=r.value;if(_i(n)==="array"){const l={type:"number"};if(n.length<1)return[new gt(e,n,"array length at least 1 expected, length 0 found")];let h=[];for(let p=0;p<n.length;p++)h=h.concat(r.validateSpec({key:`${e}[${p}]`,value:n[p],validateSpec:r.validateSpec,valueSpec:l}));return h}return cl({key:e,value:n,valueSpec:{}})},colorArray:function(r){const e=r.key,n=r.value;if(_i(n)==="array"){if(n.length<1)return[new gt(e,n,"array length at least 1 expected, length 0 found")];let l=[];for(let h=0;h<n.length;h++)l=l.concat(ul({key:`${e}[${h}]`,value:n[h]}));return l}return ul({key:e,value:n})},variableAnchorOffsetCollection:function(r){const e=r.key,n=r.value,l=_i(n),h=r.styleSpec;if(l!=="array"||n.length<1||n.length%2!=0)return[new gt(e,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let p=[];for(let g=0;g<n.length;g+=2)p=p.concat(Na({key:`${e}[${g}]`,value:n[g],valueSpec:h.layout_symbol["text-anchor"]})),p=p.concat(mc({key:`${e}[${g+1}]`,value:n[g+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:h}));return p},sprite:th,state:ih,fontFaces:function(r){const e=r.key,n=r.value,l=r.validateSpec,h=r.styleSpec,p=r.style;if(!Xd(n))return[new gt(e,n,`object expected, ${_i(n)} found`)];const g=[];for(const b in n){const T=n[b],E=_i(T);if(E==="string")g.push(...ea({key:`${e}.${b}`,value:T}));else if(E==="array"){const P={url:{type:"string",required:!0},"unicode-range":{type:"array",value:"string"}};for(const[I,B]of T.entries())g.push(...zr({key:`${e}.${b}[${I}]`,value:B,valueSpec:P,styleSpec:h,style:p,validateSpec:l}))}else g.push(new gt(`${e}.${b}`,T,`string or array expected, ${E} found`))}return g}};function ta(r){const e=r.value,n=r.valueSpec,l=r.styleSpec;return r.validateSpec=ta,n.expression&&cc(Sn(e))?gc(r):n.expression&&Mo(Oa(e))?Qs(r):n.type&&nh[n.type]?nh[n.type](r):zr(Ci({},r,{valueSpec:n.type?l[n.type]:n}))}function Zd(r){const e=r.value,n=r.key,l=ea(r);return l.length||(e.indexOf("{fontstack}")===-1&&l.push(new gt(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&l.push(new gt(n,e,'"glyphs" url must include a "{range}" token'))),l}function qr(r,e=oe){let n=[];return n=n.concat(ta({key:"",value:r,valueSpec:e.$root,styleSpec:e,style:r,validateSpec:ta,objectElementValidators:{glyphs:Zd,"*":()=>[]}})),r.constants&&(n=n.concat(Ud({key:"constants",value:r.constants}))),$d(n)}function rs(r){return function(e){return r(Object.assign({},e,{validateSpec:ta}))}}function $d(r){return[].concat(r).sort(((e,n)=>e.line-n.line))}function ss(r){return function(...e){return $d(r.apply(this,e))}}qr.source=ss(rs(Qu)),qr.sprite=ss(rs(th)),qr.glyphs=ss(rs(Zd)),qr.light=ss(rs(hl)),qr.sky=ss(rs(qd)),qr.terrain=ss(rs(eh)),qr.state=ss(rs(ih)),qr.layer=ss(rs(Wd)),qr.filter=ss(rs(Eo)),qr.paintProperty=ss(rs(Hd)),qr.layoutProperty=ss(rs(jd));const Wp={type:"enum","property-type":"data-constant",expression:{interpolated:!1,parameters:["global-state"]},values:{visible:{},none:{}},transition:!1,default:"visible"};class dl{constructor(e,n){this._globalState=n,this.setValue(e)}evaluate(){var e;return(e=this._literalValue)!==null&&e!==void 0?e:this._compiledValue.evaluate({})}setValue(e){if(e==null||e==="visible"||e==="none")return this._literalValue=e==="none"?"none":"visible",this._compiledValue=void 0,void(this._globalStateRefs=new Set);const n=sl(e,Wp,this._globalState);if(n.result==="error")throw this._literalValue="visible",this._compiledValue=void 0,new Error(n.value.map((l=>`${l.key}: ${l.message}`)).join(", "));this._literalValue=void 0,this._compiledValue=n.value,this._globalStateRefs=Js(n.value.expression)}getGlobalStateRefs(){return this._globalStateRefs}}const fl=oe,Hn=qr,pl=Hn.light,Yd=Hn.sky,qp=Hn.paintProperty,Xp=Hn.layoutProperty;function Ao(r,e){let n=!1;if(e&&e.length)for(const l of e)r.fire(new Ne(new Error(l.message))),n=!0;return n}class Co{constructor(e,n,l){const h=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const g=new Int32Array(this.arrayBuffer);e=g[0],this.d=(n=g[1])+2*(l=g[2]);for(let T=0;T<this.d*this.d;T++){const E=g[3+T],P=g[3+T+1];h.push(E===P?null:g.subarray(E,P))}const b=g[3+h.length+1];this.keys=g.subarray(g[3+h.length],b),this.bboxes=g.subarray(b),this.insert=this._insertReadonly}else{this.d=n+2*l;for(let g=0;g<this.d*this.d;g++)h.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=e,this.padding=l,this.scale=n/e,this.uid=0;const p=l/n*e;this.min=-p,this.max=e+p}insert(e,n,l,h,p){this._forEachCell(n,l,h,p,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(n),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(p)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,n,l,h,p,g){this.cells[p].push(g)}query(e,n,l,h,p){const g=this.min,b=this.max;if(e<=g&&n<=g&&b<=l&&b<=h&&!p)return Array.prototype.slice.call(this.keys);{const T=[];return this._forEachCell(e,n,l,h,this._queryCell,T,{},p),T}}_queryCell(e,n,l,h,p,g,b,T){const E=this.cells[p];if(E!==null){const P=this.keys,I=this.bboxes;for(let B=0;B<E.length;B++){const k=E[B];if(b[k]===void 0){const q=4*k;(T?T(I[q+0],I[q+1],I[q+2],I[q+3]):e<=I[q+2]&&n<=I[q+3]&&l>=I[q+0]&&h>=I[q+1])?(b[k]=!0,g.push(P[k])):b[k]=!1}}}}_forEachCell(e,n,l,h,p,g,b,T){const E=this._convertToCellCoord(e),P=this._convertToCellCoord(n),I=this._convertToCellCoord(l),B=this._convertToCellCoord(h);for(let k=E;k<=I;k++)for(let q=P;q<=B;q++){const X=this.d*q+k;if((!T||T(this._convertFromCellCoord(k),this._convertFromCellCoord(q),this._convertFromCellCoord(k+1),this._convertFromCellCoord(q+1)))&&p.call(this,e,n,l,h,X,g,b,T))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,n=3+this.cells.length+1+1;let l=0;for(let g=0;g<this.cells.length;g++)l+=this.cells[g].length;const h=new Int32Array(n+l+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;let p=n;for(let g=0;g<e.length;g++){const b=e[g];h[3+g]=p,h.set(b,p),p+=b.length}return h[3+e.length]=p,h.set(this.keys,p),p+=this.keys.length,h[3+e.length+1]=p,h.set(this.bboxes,p),p+=this.bboxes.length,h.buffer}static serialize(e,n){const l=e.toArrayBuffer();return n&&n.push(l),{buffer:l}}static deserialize(e){return new Co(e.buffer)}}const as={};function Ft(r,e,n={}){if(as[r])throw new Error(`${r} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:r,writeable:!1}),as[r]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}Ft("Object",Object),Ft("Set",Set),Ft("TransferableGridIndex",Co),Ft("Color",mi),Ft("Error",Error),Ft("AJAXError",Z),Ft("ResolvedImage",Fr),Ft("StylePropertyFunction",hc),Ft("StyleExpression",Zu,{omit:["_evaluator"]}),Ft("ZoomDependentExpression",$u),Ft("ZoomConstantExpression",uc),Ft("CompoundExpression",Wr,{omit:["_evaluate"]});for(const r in wo)wo[r]._classRegistryKey||Ft(`Expression_${r}`,wo[r]);function _c(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function rh(r){return r.$name||r.constructor._classRegistryKey}function Po(r){return!(function(e){if(e===null||typeof e!="object")return!1;const n=rh(e);return!(!n||n==="Object")})(r)&&(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||r instanceof Error||_c(r)||Le(r)||ArrayBuffer.isView(r)||r instanceof ImageData)}function ml(r,e){if(Po(r))return(_c(r)||Le(r))&&e&&e.push(r),ArrayBuffer.isView(r)&&e&&e.push(r.buffer),r instanceof ImageData&&e&&e.push(r.data.buffer),r;if(Array.isArray(r)){const p=[];for(const g of r)p.push(ml(g,e));return p}if(typeof r!="object")throw new Error("can't serialize object of type "+typeof r);const n=rh(r);if(!n)throw new Error(`can't serialize object of unregistered class ${r.constructor.name}`);if(!as[n])throw new Error(`${n} is not registered.`);const{klass:l}=as[n],h=l.serialize?l.serialize(r,e):{};if(l.serialize){if(e&&h===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const p in r){if(!r.hasOwnProperty(p)||as[n].omit.indexOf(p)>=0)continue;const g=r[p];h[p]=as[n].shallow.indexOf(p)>=0?g:ml(g,e)}r instanceof Error&&(h.message=r.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(h.$name=n),h}function gl(r){if(Po(r))return r;if(Array.isArray(r))return r.map(gl);if(typeof r!="object")throw new Error("can't deserialize object of type "+typeof r);const e=rh(r)||"Object";if(!as[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:n}=as[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(r);const l=Object.create(n.prototype);for(const h of Object.keys(r)){if(h==="$name")continue;const p=r[h];l[h]=as[e].shallow.indexOf(h)>=0?p:gl(p)}return l}class sh{constructor(){this.first=!0}update(e,n){const l=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=n),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=l,!0))}}function _l(r){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(r))}function ah(r){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(r))}function Kd(r){return/\s/u.test(String.fromCodePoint(r))}function Io(r){for(const e of r)if(ah(e.codePointAt(0)))return!0;return!1}function Zp(r){for(const e of r)if(!Jd(e.codePointAt(0)))return!1;return!0}function yc(r){const e=r.map((n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}})).filter((n=>n));return new RegExp(e.join("|"),"u")}const xc=yc(["Arab","Dupl","Mong","Ougr","Syrc"]);function Jd(r){return!xc.test(String.fromCodePoint(r))}function oh(r){return!(ah(r)||(e=r,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(e))));var e}const Qd=yc(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function lh(r){return Qd.test(String.fromCodePoint(r))}function ch(r,e){return!(!e&&lh(r)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(r)))}function ef(r){for(const e of r)if(lh(e.codePointAt(0)))return!0;return!1}const ia=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(r){this.pluginStatus=r.pluginStatus,this.pluginURL=r.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(r){if(ia.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=r.applyArabicShaping,this.processBidirectionalText=r.processBidirectionalText,this.processStyledBidirectionalText=r.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(r,e){return o(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(r.pluginStatus!=="loading")return this.setState(r),r;const n=r.pluginURL,l=new Promise((p=>{this.loadScriptResolve=p}));e(n);const h=new Promise((p=>setTimeout((()=>p()),this.TIMEOUT)));if(yield Promise.race([l,h]),this.isParsed()){const p={pluginStatus:"loaded",pluginURL:n};return this.setState(p),p}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${n}`)}))}};class ji{constructor(e,n){this.isSupportedScript=$p,this.zoom=e,n?(this.now=n.now||0,this.fadeDuration=n.fadeDuration||0,this.zoomHistory=n.zoomHistory||new sh,this.transition=n.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new sh,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,n=e-Math.floor(e),l=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*n}}}function $p(r){return(function(e,n){for(const l of e)if(!ch(l.codePointAt(0),n))return!1;return!0})(r,ia.getRTLTextPluginStatus()==="loaded")}const yl="-transition";class vc{constructor(e,n,l){this.property=e,this.value=n,this.expression=(function(h,p,g){if(cc(h))return new hc(h,p);if(Mo(h)){const b=Yu(h,p,g);if(b.result==="error")throw new Error(b.value.map((T=>`${T.key}: ${T.message}`)).join(", "));return b.value}{let b=h;return p.type==="color"&&typeof h=="string"?b=mi.parse(h):p.type!=="padding"||typeof h!="number"&&!Array.isArray(h)?p.type!=="numberArray"||typeof h!="number"&&!Array.isArray(h)?p.type!=="colorArray"||typeof h!="string"&&!Array.isArray(h)?p.type==="variableAnchorOffsetCollection"&&Array.isArray(h)?b=gr.parse(h):p.type==="projectionDefinition"&&typeof h=="string"&&(b=_r.parse(h)):b=ii.parse(h):b=pn.parse(h):b=ar.parse(h),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>b}}})(n===void 0?e.specification.default:n,e.specification,l)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,n,l){return this.property.possiblyEvaluate(this,e,n,l)}}class bc{constructor(e,n){this.property=e,this.value=new vc(e,void 0,n)}transitioned(e,n){return new tf(this.property,this.value,n,Dt({},e.transition,this.transition),e.now)}untransitioned(){return new tf(this.property,this.value,null,{},0)}}class uh{constructor(e,n){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._globalState=n}getValue(e){return Ti(this._values[e].value.value)}setValue(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new bc(this._values[e].property,this._globalState)),this._values[e].value=new vc(this._values[e].property,n===null?void 0:Ti(n),this._globalState)}getTransition(e){return Ti(this._values[e].transition)}setTransition(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new bc(this._values[e].property,this._globalState)),this._values[e].transition=Ti(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const l=this.getValue(n);l!==void 0&&(e[n]=l);const h=this.getTransition(n);h!==void 0&&(e[`${n}${yl}`]=h)}return e}transitioned(e,n){const l=new nf(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].transitioned(e,n._values[h]);return l}untransitioned(){const e=new nf(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class tf{constructor(e,n,l,h,p){this.property=e,this.value=n,this.begin=p+h.delay||0,this.end=this.begin+h.duration||0,e.specification.transition&&(h.delay||h.duration)&&(this.prior=l)}possiblyEvaluate(e,n,l){const h=e.now||0,p=this.value.possiblyEvaluate(e,n,l),g=this.prior;if(g){if(h>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(h<this.begin)return g.possiblyEvaluate(e,n,l);{const b=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,n,l),p,ti(b))}}return p}}class nf{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,l){const h=new xl(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(e,n,l);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class rf{constructor(e,n){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._globalState=n}hasValue(e){return this._values[e].value!==void 0}getValue(e){return Ti(this._values[e].value)}setValue(e,n){this._values[e]=new vc(this._values[e].property,n===null?void 0:Ti(n),this._globalState)}serialize(){const e={};for(const n of Object.keys(this._values)){const l=this.getValue(n);l!==void 0&&(e[n]=l)}return e}possiblyEvaluate(e,n,l){const h=new xl(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(e,n,l);return h}}class os{constructor(e,n,l){this.property=e,this.value=n,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,l,h){return this.property.evaluate(this.value,this.parameters,e,n,l,h)}}class xl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ht{constructor(e){this.specification=e}possiblyEvaluate(e,n){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(n)}interpolate(e,n,l){const h=cn[this.specification.type];return h?h(e,n,l):e}}class Zt{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,l,h){return new os(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},l,h)}:e.expression,n)}interpolate(e,n,l){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new os(this,{kind:"constant",value:void 0},e.parameters);const h=cn[this.specification.type];if(h){const p=h(e.value.value,n.value.value,l);return new os(this,{kind:"constant",value:p},e.parameters)}return e}evaluate(e,n,l,h,p,g){return e.kind==="constant"?e.value:e.evaluate(n,l,h,p,g)}}class vl extends Zt{possiblyEvaluate(e,n,l,h){if(e.value===void 0)return new os(this,{kind:"constant",value:void 0},n);if(e.expression.kind==="constant"){const p=e.expression.evaluate(n,null,{},l,h),g=e.property.specification.type==="resolvedImage"&&typeof p!="string"?p.name:p,b=this._calculate(g,g,g,n);return new os(this,{kind:"constant",value:b},n)}if(e.expression.kind==="camera"){const p=this._calculate(e.expression.evaluate({zoom:n.zoom-1}),e.expression.evaluate({zoom:n.zoom}),e.expression.evaluate({zoom:n.zoom+1}),n);return new os(this,{kind:"constant",value:p},n)}return new os(this,e.expression,n)}evaluate(e,n,l,h,p,g){if(e.kind==="source"){const b=e.evaluate(n,l,h,p,g);return this._calculate(b,b,b,n)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(n.zoom)-1},l,h),e.evaluate({zoom:Math.floor(n.zoom)},l,h),e.evaluate({zoom:Math.floor(n.zoom)+1},l,h),n):e.value}_calculate(e,n,l,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:l,to:n}}interpolate(e){return e}}class wc{constructor(e){this.specification=e}possiblyEvaluate(e,n,l,h){if(e.value!==void 0){if(e.expression.kind==="constant"){const p=e.expression.evaluate(n,null,{},l,h);return this._calculate(p,p,p,n)}return this._calculate(e.expression.evaluate(new ji(Math.floor(n.zoom-1),n)),e.expression.evaluate(new ji(Math.floor(n.zoom),n)),e.expression.evaluate(new ji(Math.floor(n.zoom+1),n)),n)}}_calculate(e,n,l,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:l,to:n}}interpolate(e){return e}}class Tc{constructor(e){this.specification=e}possiblyEvaluate(e,n,l,h){return!!e.expression.evaluate(n,null,{},l,h)}interpolate(){return!1}}class xr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in e){const l=e[n];l.specification.overridable&&this.overridableProperties.push(n);const h=this.defaultPropertyValues[n]=new vc(l,void 0,void 0),p=this.defaultTransitionablePropertyValues[n]=new bc(l,void 0);this.defaultTransitioningPropertyValues[n]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=h.possiblyEvaluate({})}}}Ft("DataDrivenProperty",Zt),Ft("DataConstantProperty",Ht),Ft("CrossFadedDataDrivenProperty",vl),Ft("CrossFadedProperty",wc),Ft("ColorRampProperty",Tc);class Xr extends ze{constructor(e,n,l){if(super(),this.id=e.id,this.type=e.type,this._globalState=l,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},this._visibilityExpression=(function(h,p){return new dl(h,p)})(this.visibility,l),e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=al(e.filter,l)),n.layout&&(this._unevaluatedLayout=new rf(n.layout,l)),n.paint)){this._transitionablePaint=new uh(n.paint,l);for(const h in e.paint)this.setPaintProperty(h,e.paint[h],{validate:!1});for(const h in e.layout)this.setLayoutProperty(h,e.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new xl(n.paint)}}setFilter(e){this.filter=e,this._featureFilter=al(e,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;for(const n of this._visibilityExpression.getGlobalStateRefs())e.add(n);if(this._unevaluatedLayout)for(const n in this._unevaluatedLayout._values){const l=this._unevaluatedLayout._values[n];for(const h of l.getGlobalStateRefs())e.add(h)}for(const n of this._featureFilter.getGlobalStateRefs())e.add(n);return e}getPaintAffectingGlobalStateRefs(){var e;const n=new globalThis.Map;if(this._transitionablePaint)for(const l in this._transitionablePaint._values){const h=this._transitionablePaint._values[l].value;for(const p of h.getGlobalStateRefs()){const g=(e=n.get(p))!==null&&e!==void 0?e:[];g.push({name:l,value:h.value}),n.set(p,g)}}return n}getVisibilityAffectingGlobalStateRefs(){return this._visibilityExpression.getGlobalStateRefs()}setLayoutProperty(e,n,l={}){if(n==null||!this._validate(Xp,`layers.${this.id}.layout.${e}`,e,n,l))return e==="visibility"?(this.visibility=n,this._visibilityExpression.setValue(n),void this.recalculateVisibility()):void this._unevaluatedLayout.setValue(e,n)}getPaintProperty(e){return e.endsWith(yl)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,l={}){if(n!=null&&this._validate(qp,`layers.${this.id}.paint.${e}`,e,n,l))return!1;if(e.endsWith(yl))return this._transitionablePaint.setTransition(e.slice(0,-11),n||void 0),!1;{const h=this._transitionablePaint._values[e],p=h.property.specification["property-type"]==="cross-faded-data-driven",g=h.value.isDataDriven(),b=h.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const T=this._transitionablePaint._values[e].value;return T.isDataDriven()||g||p||this._handleOverridablePaintPropertyUpdate(e,b,T)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,n,l){return!1}isHidden(e=this.minzoom,n=!1){return!!(this.minzoom&&e<(n?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&e>=this.maxzoom)||this._evaluatedVisibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculateVisibility(){this._evaluatedVisibility=this._visibilityExpression.evaluate()}recalculate(e,n){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),pi(e,((n,l)=>!(n===void 0||l==="layout"&&!Object.keys(n).length||l==="paint"&&!Object.keys(n).length)))}_validate(e,n,l,h,p={}){return(!p||p.validate!==!1)&&Ao(this,e.call(Hn,{key:n,layerType:this.type,objectKey:l,value:h,styleSpec:oe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof os&&So(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}let hh;var sf={get paint(){return hh=hh||new xr({"raster-opacity":new Ht(oe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ht(oe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ht(oe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ht(oe.paint_raster["raster-brightness-max"]),"raster-saturation":new Ht(oe.paint_raster["raster-saturation"]),"raster-contrast":new Ht(oe.paint_raster["raster-contrast"]),"raster-resampling":new Ht(oe.paint_raster["raster-resampling"]),"raster-fade-duration":new Ht(oe.paint_raster["raster-fade-duration"])})}};class Yp extends Xr{constructor(e,n){super(e,sf,n)}}const Kp={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class bl{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class mn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Mn(r,e=1){let n=0,l=0;return{members:r.map((h=>{const p=Kp[h.type].BYTES_PER_ELEMENT,g=n=Ba(n,Math.max(e,p)),b=h.components||1;return l=Math.max(l,p),n+=p*b,{name:h.name,type:h.type,components:b,offset:g}})),size:Ba(n,Math.max(l,e)),alignment:e}}function Ba(r,e){return Math.ceil(r/e)*e}class wl extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){const h=2*e;return this.int16[h+0]=n,this.int16[h+1]=l,e}}wl.prototype.bytesPerElement=4,Ft("StructArrayLayout2i4",wl);class Sc extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,l)}emplace(e,n,l,h){const p=3*e;return this.int16[p+0]=n,this.int16[p+1]=l,this.int16[p+2]=h,e}}Sc.prototype.bytesPerElement=6,Ft("StructArrayLayout3i6",Sc);class dh extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,l,h)}emplace(e,n,l,h,p){const g=4*e;return this.int16[g+0]=n,this.int16[g+1]=l,this.int16[g+2]=h,this.int16[g+3]=p,e}}dh.prototype.bytesPerElement=8,Ft("StructArrayLayout4i8",dh);class Mc extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,h,p,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,l,h,p,g)}emplace(e,n,l,h,p,g,b){const T=6*e;return this.int16[T+0]=n,this.int16[T+1]=l,this.int16[T+2]=h,this.int16[T+3]=p,this.int16[T+4]=g,this.int16[T+5]=b,e}}Mc.prototype.bytesPerElement=12,Ft("StructArrayLayout2i4i12",Mc);class fh extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,h,p,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,l,h,p,g)}emplace(e,n,l,h,p,g,b){const T=4*e,E=8*e;return this.int16[T+0]=n,this.int16[T+1]=l,this.uint8[E+4]=h,this.uint8[E+5]=p,this.uint8[E+6]=g,this.uint8[E+7]=b,e}}fh.prototype.bytesPerElement=8,Ft("StructArrayLayout2i4ub8",fh);class Tl extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){const h=2*e;return this.float32[h+0]=n,this.float32[h+1]=l,e}}Tl.prototype.bytesPerElement=8,Ft("StructArrayLayout2f8",Tl);class Ds extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,h,p,g,b,T,E,P){const I=this.length;return this.resize(I+1),this.emplace(I,e,n,l,h,p,g,b,T,E,P)}emplace(e,n,l,h,p,g,b,T,E,P,I){const B=10*e;return this.uint16[B+0]=n,this.uint16[B+1]=l,this.uint16[B+2]=h,this.uint16[B+3]=p,this.uint16[B+4]=g,this.uint16[B+5]=b,this.uint16[B+6]=T,this.uint16[B+7]=E,this.uint16[B+8]=P,this.uint16[B+9]=I,e}}Ds.prototype.bytesPerElement=20,Ft("StructArrayLayout10ui20",Ds);class Ec extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,h,p,g,b,T){const E=this.length;return this.resize(E+1),this.emplace(E,e,n,l,h,p,g,b,T)}emplace(e,n,l,h,p,g,b,T,E){const P=8*e;return this.uint16[P+0]=n,this.uint16[P+1]=l,this.uint16[P+2]=h,this.uint16[P+3]=p,this.uint16[P+4]=g,this.uint16[P+5]=b,this.uint16[P+6]=T,this.uint16[P+7]=E,e}}Ec.prototype.bytesPerElement=16,Ft("StructArrayLayout8ui16",Ec);class Sl extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,h,p,g,b,T,E,P,I,B){const k=this.length;return this.resize(k+1),this.emplace(k,e,n,l,h,p,g,b,T,E,P,I,B)}emplace(e,n,l,h,p,g,b,T,E,P,I,B,k){const q=12*e;return this.int16[q+0]=n,this.int16[q+1]=l,this.int16[q+2]=h,this.int16[q+3]=p,this.uint16[q+4]=g,this.uint16[q+5]=b,this.uint16[q+6]=T,this.uint16[q+7]=E,this.int16[q+8]=P,this.int16[q+9]=I,this.int16[q+10]=B,this.int16[q+11]=k,e}}Sl.prototype.bytesPerElement=24,Ft("StructArrayLayout4i4ui4i24",Sl);class Ac extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,l)}emplace(e,n,l,h){const p=3*e;return this.float32[p+0]=n,this.float32[p+1]=l,this.float32[p+2]=h,e}}Ac.prototype.bytesPerElement=12,Ft("StructArrayLayout3f12",Ac);class Ml extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}Ml.prototype.bytesPerElement=4,Ft("StructArrayLayout1ul4",Ml);class ph extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,h,p,g,b,T,E){const P=this.length;return this.resize(P+1),this.emplace(P,e,n,l,h,p,g,b,T,E)}emplace(e,n,l,h,p,g,b,T,E,P){const I=10*e,B=5*e;return this.int16[I+0]=n,this.int16[I+1]=l,this.int16[I+2]=h,this.int16[I+3]=p,this.int16[I+4]=g,this.int16[I+5]=b,this.uint32[B+3]=T,this.uint16[I+8]=E,this.uint16[I+9]=P,e}}ph.prototype.bytesPerElement=20,Ft("StructArrayLayout6i1ul2ui20",ph);class Ro extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,h,p,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,l,h,p,g)}emplace(e,n,l,h,p,g,b){const T=6*e;return this.int16[T+0]=n,this.int16[T+1]=l,this.int16[T+2]=h,this.int16[T+3]=p,this.int16[T+4]=g,this.int16[T+5]=b,e}}Ro.prototype.bytesPerElement=12,Ft("StructArrayLayout2i2i2i12",Ro);class ka extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,l,h,p)}emplace(e,n,l,h,p,g){const b=4*e,T=8*e;return this.float32[b+0]=n,this.float32[b+1]=l,this.float32[b+2]=h,this.int16[T+6]=p,this.int16[T+7]=g,e}}ka.prototype.bytesPerElement=16,Ft("StructArrayLayout2f1f2i16",ka);class mh extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,h,p,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,l,h,p,g)}emplace(e,n,l,h,p,g,b){const T=16*e,E=4*e,P=8*e;return this.uint8[T+0]=n,this.uint8[T+1]=l,this.float32[E+1]=h,this.float32[E+2]=p,this.int16[P+6]=g,this.int16[P+7]=b,e}}mh.prototype.bytesPerElement=16,Ft("StructArrayLayout2ub2f2i16",mh);class El extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,l)}emplace(e,n,l,h){const p=3*e;return this.uint16[p+0]=n,this.uint16[p+1]=l,this.uint16[p+2]=h,e}}El.prototype.bytesPerElement=6,Ft("StructArrayLayout3ui6",El);class Ua extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,h,p,g,b,T,E,P,I,B,k,q,X,Y,ne){const me=this.length;return this.resize(me+1),this.emplace(me,e,n,l,h,p,g,b,T,E,P,I,B,k,q,X,Y,ne)}emplace(e,n,l,h,p,g,b,T,E,P,I,B,k,q,X,Y,ne,me){const ie=24*e,le=12*e,Te=48*e;return this.int16[ie+0]=n,this.int16[ie+1]=l,this.uint16[ie+2]=h,this.uint16[ie+3]=p,this.uint32[le+2]=g,this.uint32[le+3]=b,this.uint32[le+4]=T,this.uint16[ie+10]=E,this.uint16[ie+11]=P,this.uint16[ie+12]=I,this.float32[le+7]=B,this.float32[le+8]=k,this.uint8[Te+36]=q,this.uint8[Te+37]=X,this.uint8[Te+38]=Y,this.uint32[le+10]=ne,this.int16[ie+22]=me,e}}Ua.prototype.bytesPerElement=48,Ft("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Ua);class gh extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,h,p,g,b,T,E,P,I,B,k,q,X,Y,ne,me,ie,le,Te,Re,He,it,rt,ft,St,_t){const at=this.length;return this.resize(at+1),this.emplace(at,e,n,l,h,p,g,b,T,E,P,I,B,k,q,X,Y,ne,me,ie,le,Te,Re,He,it,rt,ft,St,_t)}emplace(e,n,l,h,p,g,b,T,E,P,I,B,k,q,X,Y,ne,me,ie,le,Te,Re,He,it,rt,ft,St,_t,at){const et=32*e,zt=16*e;return this.int16[et+0]=n,this.int16[et+1]=l,this.int16[et+2]=h,this.int16[et+3]=p,this.int16[et+4]=g,this.int16[et+5]=b,this.int16[et+6]=T,this.int16[et+7]=E,this.uint16[et+8]=P,this.uint16[et+9]=I,this.uint16[et+10]=B,this.uint16[et+11]=k,this.uint16[et+12]=q,this.uint16[et+13]=X,this.uint16[et+14]=Y,this.uint16[et+15]=ne,this.uint16[et+16]=me,this.uint16[et+17]=ie,this.uint16[et+18]=le,this.uint16[et+19]=Te,this.uint16[et+20]=Re,this.uint16[et+21]=He,this.uint16[et+22]=it,this.uint32[zt+12]=rt,this.float32[zt+13]=ft,this.float32[zt+14]=St,this.uint16[et+30]=_t,this.uint16[et+31]=at,e}}gh.prototype.bytesPerElement=64,Ft("StructArrayLayout8i15ui1ul2f2ui64",gh);class Cc extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Cc.prototype.bytesPerElement=4,Ft("StructArrayLayout1f4",Cc);class Pc extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,l)}emplace(e,n,l,h){const p=3*e;return this.uint16[6*e+0]=n,this.float32[p+1]=l,this.float32[p+2]=h,e}}Pc.prototype.bytesPerElement=12,Ft("StructArrayLayout1ui2f12",Pc);class _h extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,l)}emplace(e,n,l,h){const p=4*e;return this.uint32[2*e+0]=n,this.uint16[p+2]=l,this.uint16[p+3]=h,e}}_h.prototype.bytesPerElement=8,Ft("StructArrayLayout1ul2ui8",_h);class y extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){const h=2*e;return this.uint16[h+0]=n,this.uint16[h+1]=l,e}}y.prototype.bytesPerElement=4,Ft("StructArrayLayout2ui4",y);class t extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}t.prototype.bytesPerElement=2,Ft("StructArrayLayout1ui2",t);class a extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,l,h)}emplace(e,n,l,h,p){const g=4*e;return this.float32[g+0]=n,this.float32[g+1]=l,this.float32[g+2]=h,this.float32[g+3]=p,e}}a.prototype.bytesPerElement=16,Ft("StructArrayLayout4f16",a);class u extends bl{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new M(this.anchorPointX,this.anchorPointY)}}u.prototype.size=20;class d extends ph{get(e){return new u(this,e)}}Ft("CollisionBoxArray",d);class x extends bl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}x.prototype.size=48;class w extends Ua{get(e){return new x(this,e)}}Ft("PlacedSymbolArray",w);class S extends bl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}S.prototype.size=64;class A extends gh{get(e){return new S(this,e)}}Ft("SymbolInstanceArray",A);class R extends Cc{getoffsetX(e){return this.float32[1*e+0]}}Ft("GlyphOffsetArray",R);class z extends Sc{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Ft("SymbolLineVertexArray",z);class G extends bl{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}G.prototype.size=12;class V extends Pc{get(e){return new G(this,e)}}Ft("TextAnchorOffsetArray",V);class $ extends bl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}$.prototype.size=8;class ee extends _h{get(e){return new $(this,e)}}Ft("FeatureIndexArray",ee);class ce extends wl{}class he extends wl{}class ue extends wl{}class ye extends Mc{}class Ae extends fh{}class _e extends Tl{}class Ee extends Ds{}class Pe extends Ec{}class we extends Sl{}class Be extends Ac{}class Ye extends Ml{}class je extends Ro{}class Xe extends mh{}class Ze extends El{}class bt extends y{}const wt=Mn([{name:"a_pos",components:2,type:"Int16"}],4),{members:dt}=wt;class Mt{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,n,l,h){const p=this.segments[this.segments.length-1];return e>Mt.MAX_VERTEX_ARRAY_LENGTH&&ci(`Max vertices per segment is ${Mt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Mt.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!p||p.vertexLength+e>Mt.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==h?this.createNewSegment(n,l,h):p}createNewSegment(e,n,l){const h={vertexOffset:e.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0,vaos:{}};return l!==void 0&&(h.sortKey=l),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(h),h}getOrCreateLatestSegment(e,n,l){return this.prepareSegment(0,e,n,l)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,l,h){return new Mt([{vertexOffset:e,primitiveOffset:n,vertexLength:l,primitiveLength:h,vaos:{},sortKey:0}])}}function ai(r,e){return 256*(r=ot(Math.floor(r),0,255))+ot(Math.floor(e),0,255)}Mt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ft("SegmentVector",Mt);const Vi=Mn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),sn=Mn([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var $i,un,Yi,yn={exports:{}},hn={exports:{}},jn={exports:{}},In=(function(){if(Yi)return yn.exports;Yi=1;var r=($i||($i=1,hn.exports=function(n,l){var h,p,g,b,T,E,P,I;for(p=n.length-(h=3&n.length),g=l,T=3432918353,E=461845907,I=0;I<p;)P=255&n.charCodeAt(I)|(255&n.charCodeAt(++I))<<8|(255&n.charCodeAt(++I))<<16|(255&n.charCodeAt(++I))<<24,++I,g=27492+(65535&(b=5*(65535&(g=(g^=P=(65535&(P=(P=(65535&P)*T+(((P>>>16)*T&65535)<<16)&4294967295)<<15|P>>>17))*E+(((P>>>16)*E&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(P=0,h){case 3:P^=(255&n.charCodeAt(I+2))<<16;case 2:P^=(255&n.charCodeAt(I+1))<<8;case 1:g^=P=(65535&(P=(P=(65535&(P^=255&n.charCodeAt(I)))*T+(((P>>>16)*T&65535)<<16)&4294967295)<<15|P>>>17))*E+(((P>>>16)*E&65535)<<16)&4294967295}return g^=n.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}),hn.exports),e=(un||(un=1,jn.exports=function(n,l){for(var h,p=n.length,g=l^p,b=0;p>=4;)h=1540483477*(65535&(h=255&n.charCodeAt(b)|(255&n.charCodeAt(++b))<<8|(255&n.charCodeAt(++b))<<16|(255&n.charCodeAt(++b))<<24))+((1540483477*(h>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),p-=4,++b;switch(p){case 3:g^=(255&n.charCodeAt(b+2))<<16;case 2:g^=(255&n.charCodeAt(b+1))<<8;case 1:g=1540483477*(65535&(g^=255&n.charCodeAt(b)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}),jn.exports);return yn.exports=r,yn.exports.murmur3=r,yn.exports.murmur2=e,yn.exports})(),En=C(In);class Qn{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,l,h){this.ids.push(na(e)),this.positions.push(n,l,h)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=na(e);let l=0,h=this.ids.length-1;for(;l<h;){const g=l+h>>1;this.ids[g]>=n?h=g:l=g+1}const p=[];for(;this.ids[l]===n;)p.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return p}static serialize(e,n){const l=new Float64Array(e.ids),h=new Uint32Array(e.positions);return Ls(l,h,0,l.length-1),n&&n.push(l.buffer,h.buffer),{ids:l,positions:h}}static deserialize(e){const n=new Qn;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function na(r){const e=+r;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:En(String(r))}function Ls(r,e,n,l){for(;n<l;){const h=r[n+l>>1];let p=n-1,g=l+1;for(;;){do p++;while(r[p]<h);do g--;while(r[g]>h);if(p>=g)break;vs(r,p,g),vs(e,3*p,3*g),vs(e,3*p+1,3*g+1),vs(e,3*p+2,3*g+2)}g-n<l-g?(Ls(r,e,n,g),n=g+1):(Ls(r,e,g+1,l),l=g)}}function vs(r,e,n){const l=r[e];r[e]=r[n],r[n]=l}Ft("FeaturePositionMap",Qn);class Ar{constructor(e,n){this.gl=e.gl,this.location=n}}class Va extends Ar{constructor(e,n){super(e,n),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Al extends Ar{constructor(e,n){super(e,n),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Ga extends Ar{constructor(e,n){super(e,n),this.current=mi.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Zr=new Float32Array(16);function bs(r){return[ai(255*r.r,255*r.g),ai(255*r.b,255*r.a)]}class ls{constructor(e,n,l){this.value=e,this.uniformNames=n.map((h=>`u_${h}`)),this.type=l}setUniform(e,n,l){e.set(l.constantOr(this.value))}getBinding(e,n,l){return this.type==="color"?new Ga(e,n):new Va(e,n)}}class cs{constructor(e,n){this.uniformNames=n.map((l=>`u_${l}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=e.tlbr}setConstantDashPositions(e,n){this.dashTo=[0,e.y,e.height,e.width],this.dashFrom=[0,n.y,n.height,n.width]}setUniform(e,n,l,h){let p=null;h==="u_pattern_to"?p=this.patternTo:h==="u_pattern_from"?p=this.patternFrom:h==="u_dasharray_to"?p=this.dashTo:h==="u_dasharray_from"?p=this.dashFrom:h==="u_pixel_ratio_to"?p=this.pixelRatioTo:h==="u_pixel_ratio_from"&&(p=this.pixelRatioFrom),p!==null&&e.set(p)}getBinding(e,n,l){return l.substr(0,9)==="u_pattern"||l.substr(0,12)==="u_dasharray_"?new Al(e,n):new Va(e,n)}}class Qi{constructor(e,n,l,h){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=n.map((p=>({name:`a_${p}`,type:"Float32",components:l==="color"?2:1,offset:0}))),this.paintVertexArray=new h}populatePaintArray(e,n,l){const h=this.paintVertexArray.length,p=this.expression.evaluate(new ji(0,l),n,{},l.canonical,[],l.formattedSection);this.paintVertexArray.resize(e),this._setPaintValue(h,e,p)}updatePaintArray(e,n,l,h,p){const g=this.expression.evaluate(new ji(0,p),l,h);this._setPaintValue(e,n,g)}_setPaintValue(e,n,l){if(this.type==="color"){const h=bs(l);for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,h[0],h[1])}else{for(let h=e;h<n;h++)this.paintVertexArray.emplace(h,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ki{constructor(e,n,l,h,p,g){this.expression=e,this.uniformNames=n.map((b=>`u_${b}_t`)),this.type=l,this.useIntegerZoom=h,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=n.map((b=>({name:`a_${b}`,type:"Float32",components:l==="color"?4:2,offset:0}))),this.paintVertexArray=new g}populatePaintArray(e,n,l){const h=this.expression.evaluate(new ji(this.zoom,l),n,{},l.canonical,[],l.formattedSection),p=this.expression.evaluate(new ji(this.zoom+1,l),n,{},l.canonical,[],l.formattedSection),g=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(g,e,h,p)}updatePaintArray(e,n,l,h,p){const g=this.expression.evaluate(new ji(this.zoom,p),l,h),b=this.expression.evaluate(new ji(this.zoom+1,p),l,h);this._setPaintValue(e,n,g,b)}_setPaintValue(e,n,l,h){if(this.type==="color"){const p=bs(l),g=bs(h);for(let b=e;b<n;b++)this.paintVertexArray.emplace(b,p[0],p[1],g[0],g[1])}else{for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,l,h);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n){const l=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,h=ot(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);e.set(h)}getBinding(e,n,l){return new Va(e,n)}}class Bn{constructor(e,n,l,h,p,g){this.expression=e,this.type=n,this.useIntegerZoom=l,this.zoom=h,this.layerId=g,this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(e,n,l){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(h,e,this.getPositionIds(n),l)}updatePaintArray(e,n,l,h,p){this._setPaintValues(e,n,this.getPositionIds(l),p)}_setPaintValues(e,n,l,h){const p=this.getPositions(h);if(!p||!l)return;const g=p[l.min],b=p[l.mid],T=p[l.max];if(g&&b&&T)for(let E=e;E<n;E++)this.emplace(this.zoomInPaintVertexArray,E,b,g),this.emplace(this.zoomOutPaintVertexArray,E,b,T)}upload(e){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const n=this.getVertexAttributes();this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,n,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,n,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class kn extends Bn{getPositions(e){return e.imagePositions}getPositionIds(e){return e.patterns&&e.patterns[this.layerId]}getVertexAttributes(){return Vi.members}emplace(e,n,l,h){e.emplace(n,l.tlbr[0],l.tlbr[1],l.tlbr[2],l.tlbr[3],h.tlbr[0],h.tlbr[1],h.tlbr[2],h.tlbr[3],l.pixelRatio,h.pixelRatio)}}class af extends Bn{getPositions(e){return e.dashPositions}getPositionIds(e){return e.dashes&&e.dashes[this.layerId]}getVertexAttributes(){return sn.members}emplace(e,n,l,h){e.emplace(n,0,l.y,l.height,l.width,0,h.y,h.height,h.width)}}class of{constructor(e,n,l){this.binders={},this._buffers=[];const h=[];for(const p in e.paint._values){if(!l(p))continue;const g=e.paint.get(p);if(!(g instanceof os&&So(g.property.specification)))continue;const b=Jp(p,e.type),T=g.value,E=g.property.specification.type,P=g.property.useIntegerZoom,I=g.property.specification["property-type"],B=I==="cross-faded"||I==="cross-faded-data-driven";if(T.kind==="constant")this.binders[p]=B?new cs(T.value,b):new ls(T.value,b,E),h.push(`/u_${p}`);else if(T.kind==="source"||B){const k=lf(p,E,"source");this.binders[p]=B?p==="line-dasharray"?new af(T,E,P,n,k,e.id):new kn(T,E,P,n,k,e.id):new Qi(T,b,E,k),h.push(`/a_${p}`)}else{const k=lf(p,E,"composite");this.binders[p]=new Ki(T,b,E,P,n,k),h.push(`/z_${p}`)}}this.cacheKey=h.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof Qi||n instanceof Ki?n.maxValue:0}populatePaintArrays(e,n,l){for(const h in this.binders){const p=this.binders[h];(p instanceof Qi||p instanceof Ki||p instanceof Bn)&&p.populatePaintArray(e,n,l)}}setConstantPatternPositions(e,n){for(const l in this.binders){const h=this.binders[l];h instanceof cs&&h.setConstantPatternPositions(e,n)}}setConstantDashPositions(e,n){for(const l in this.binders){const h=this.binders[l];h instanceof cs&&h.setConstantDashPositions(e,n)}}updatePaintArrays(e,n,l,h,p){let g=!1;for(const b in e){const T=n.getPositions(b);for(const E of T){const P=l.feature(E.index);for(const I in this.binders){const B=this.binders[I];if((B instanceof Qi||B instanceof Ki||B instanceof Bn)&&B.expression.isStateDependent===!0){const k=h.paint.get(I);B.expression=k.value,B.updatePaintArray(E.start,E.end,P,e[b],p),g=!0}}}}return g}defines(){const e=[];for(const n in this.binders){const l=this.binders[n];(l instanceof ls||l instanceof cs)&&e.push(...l.uniformNames.map((h=>`#define HAS_UNIFORM_${h}`)))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const l=this.binders[n];if(l instanceof Qi||l instanceof Ki)for(let h=0;h<l.paintVertexAttributes.length;h++)e.push(l.paintVertexAttributes[h].name);else if(l instanceof Bn){const h=l.getVertexAttributes();for(const p of h)e.push(p.name)}}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const l=this.binders[n];if(l instanceof ls||l instanceof cs||l instanceof Ki)for(const h of l.uniformNames)e.push(h)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,n){const l=[];for(const h in this.binders){const p=this.binders[h];if(p instanceof ls||p instanceof cs||p instanceof Ki){for(const g of p.uniformNames)if(n[g]){const b=p.getBinding(e,n[g],g);l.push({name:g,property:h,binding:b})}}}return l}setUniforms(e,n,l,h){for(const{name:p,property:g,binding:b}of n)this.binders[g].setUniform(b,h,l.get(g),p)}updatePaintBuffers(e){this._buffers=[];for(const n in this.binders){const l=this.binders[n];if(e&&l instanceof Bn){const h=e.fromScale===2?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(l instanceof Qi||l instanceof Ki)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(e){for(const n in this.binders){const l=this.binders[n];(l instanceof Qi||l instanceof Ki||l instanceof Bn)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof Qi||n instanceof Ki||n instanceof Bn)&&n.destroy()}}}class Ha{constructor(e,n,l=()=>!0){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new of(h,n,l);this.needsUpload=!1,this._featureMap=new Qn,this._bufferOffset=0}populatePaintArrays(e,n,l,h){for(const p in this.programConfigurations)this.programConfigurations[p].populatePaintArrays(e,n,h);n.id!==void 0&&this._featureMap.add(n.id,l,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,l,h){for(const p of l)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(e,this._featureMap,n,p,h)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Jp(r,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}function lf(r,e,n){const l={color:{source:Tl,composite:a},number:{source:Cc,composite:Tl}},h=(function(p){return{"line-pattern":{source:Ee,composite:Ee},"fill-pattern":{source:Ee,composite:Ee},"fill-extrusion-pattern":{source:Ee,composite:Ee},"line-dasharray":{source:Pe,composite:Pe}}[p]})(r);return h&&h[n]||l[e][n]}Ft("ConstantBinder",ls),Ft("CrossFadedConstantBinder",cs),Ft("SourceExpressionBinder",Qi),Ft("CrossFadedPatternBinder",kn),Ft("CrossFadedDasharrayBinder",af),Ft("CompositeExpressionBinder",Ki),Ft("ProgramConfiguration",of,{omit:["_buffers"]}),Ft("ProgramConfigurationSet",Ha);const yh=Math.pow(2,14)-1,ra=-yh-1;function sa(r){const e=xt/r.extent,n=r.loadGeometry();for(let l=0;l<n.length;l++){const h=n[l];for(let p=0;p<h.length;p++){const g=h[p],b=Math.round(g.x*e),T=Math.round(g.y*e);g.x=ot(b,ra,yh),g.y=ot(T,ra,yh),(b<g.x||b>g.x+1||T<g.y||T>g.y+1)&&ci("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function aa(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?sa(r):[]}}const xh=-32768;function vh(r,e,n,l,h){r.emplaceBack(xh+8*e+l,xh+8*n+h)}class Ic{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new he,this.indexArray=new Ze,this.segments=new Mt,this.programConfigurations=new Ha(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,l){const h=this.layers[0],p=[];let g=null,b=!1,T=h.type==="heatmap";if(h.type==="circle"){const P=h;g=P.layout.get("circle-sort-key"),b=!g.isConstant(),T=T||P.paint.get("circle-pitch-alignment")==="map"}const E=T?n.subdivisionGranularity.circle:1;for(const{feature:P,id:I,index:B,sourceLayerIndex:k}of e){const q=this.layers[0]._featureFilter.needGeometry,X=aa(P,q);if(!this.layers[0]._featureFilter.filter(new ji(this.zoom),X,l))continue;const Y=b?g.evaluate(X,{},l):void 0,ne={id:I,properties:P.properties,type:P.type,sourceLayerIndex:k,index:B,geometry:q?X.geometry:sa(P),patterns:{},sortKey:Y};p.push(ne)}b&&p.sort(((P,I)=>P.sortKey-I.sortKey));for(const P of p){const{geometry:I,index:B,sourceLayerIndex:k}=P,q=e[B].feature;this.addFeature(P,I,B,l,E),n.featureIndex.insert(q,I,B,k,this.index)}}update(e,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:l})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,dt),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,l,h,p=1){let g;switch(p){case 1:g=[0,7];break;case 3:g=[0,2,5,7];break;case 5:g=[0,1,3,4,6,7];break;case 7:g=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${p}; valid values are 1, 3, 5, 7.`)}const b=g.length;for(const T of n)for(const E of T){const P=E.x,I=E.y;if(P<0||P>=xt||I<0||I>=xt)continue;const B=this.segments.prepareSegment(b*b,this.layoutVertexArray,this.indexArray,e.sortKey),k=B.vertexLength;for(let q=0;q<b;q++)for(let X=0;X<b;X++)vh(this.layoutVertexArray,P,I,g[X],g[q]);for(let q=0;q<b-1;q++)for(let X=0;X<b-1;X++){const Y=k+q*b+X,ne=k+(q+1)*b+X;this.indexArray.emplaceBack(Y,ne+1,Y+1),this.indexArray.emplaceBack(Y,ne,ne+1)}B.vertexLength+=b*b,B.primitiveLength+=(b-1)*(b-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:{},canonical:h})}}function Rc(r,e){for(let n=0;n<r.length;n++)if(Dc(e,r[n]))return!0;for(let n=0;n<e.length;n++)if(Dc(r,e[n]))return!0;return!!Qp(r,e)}function cf(r,e,n){return!!Dc(r,e)||!!em(e,r,n)}function fy(r,e){if(r.length===1)return my(e,r[0]);for(let n=0;n<e.length;n++){const l=e[n];for(let h=0;h<l.length;h++)if(Dc(r,l[h]))return!0}for(let n=0;n<r.length;n++)if(my(e,r[n]))return!0;for(let n=0;n<e.length;n++)if(Qp(r,e[n]))return!0;return!1}function ew(r,e,n){if(r.length>1){if(Qp(r,e))return!0;for(let l=0;l<e.length;l++)if(em(e[l],r,n))return!0}for(let l=0;l<r.length;l++)if(em(r[l],e,n))return!0;return!1}function Qp(r,e){if(r.length===0||e.length===0)return!1;for(let n=0;n<r.length-1;n++){const l=r[n],h=r[n+1];for(let p=0;p<e.length-1;p++)if(tw(l,h,e[p],e[p+1]))return!0}return!1}function tw(r,e,n,l){return vi(r,n,l)!==vi(e,n,l)&&vi(r,e,n)!==vi(r,e,l)}function em(r,e,n){const l=n*n;if(e.length===1)return r.distSqr(e[0])<l;for(let h=1;h<e.length;h++)if(py(r,e[h-1],e[h])<l)return!0;return!1}function py(r,e,n){const l=e.distSqr(n);if(l===0)return r.distSqr(e);const h=((r.x-e.x)*(n.x-e.x)+(r.y-e.y)*(n.y-e.y))/l;return r.distSqr(h<0?e:h>1?n:n.sub(e)._mult(h)._add(e))}function my(r,e){let n,l,h,p=!1;for(let g=0;g<r.length;g++){n=r[g];for(let b=0,T=n.length-1;b<n.length;T=b++)l=n[b],h=n[T],l.y>e.y!=h.y>e.y&&e.x<(h.x-l.x)*(e.y-l.y)/(h.y-l.y)+l.x&&(p=!p)}return p}function Dc(r,e){let n=!1;for(let l=0,h=r.length-1;l<r.length;h=l++){const p=r[l],g=r[h];p.y>e.y!=g.y>e.y&&e.x<(g.x-p.x)*(e.y-p.y)/(g.y-p.y)+p.x&&(n=!n)}return n}function iw(r,e,n){const l=n[0],h=n[2];if(r.x<l.x&&e.x<l.x||r.x>h.x&&e.x>h.x||r.y<l.y&&e.y<l.y||r.y>h.y&&e.y>h.y)return!1;const p=vi(r,e,n[0]);return p!==vi(r,e,n[1])||p!==vi(r,e,n[2])||p!==vi(r,e,n[3])}function Lc(r,e,n){const l=e.paint.get(r).value;return l.kind==="constant"?l.value:n.programConfigurations.get(e.id).getMaxValue(r)}function uf(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function hf(r,e,n,l,h){if(!e[0]&&!e[1])return r;const p=M.convert(e)._mult(h);n==="viewport"&&p._rotate(-l);const g=[];for(let b=0;b<r.length;b++)g.push(r[b].sub(p));return g}function nw(r){const e=[];for(let n=0;n<r.length;n++){const l=r[n],h=e.at(-1);(n===0||h&&!l.equals(h))&&e.push(l)}return e}function rw({queryGeometry:r,size:e},n){return cf(r,n,e)}function sw({queryGeometry:r,size:e,transform:n,unwrappedTileID:l,getElevation:h},p){return cf(r,p,e*(n.projectTileCoordinates(p.x,p.y,l,h).signedDistanceFromCamera/n.cameraToCenterDistance))}function aw({queryGeometry:r,size:e,transform:n,unwrappedTileID:l,getElevation:h},p){const g=n.projectTileCoordinates(p.x,p.y,l,h).signedDistanceFromCamera,b=e*(n.cameraToCenterDistance/g);return cf(r,tm(p,n,l,h),b)}function ow({queryGeometry:r,size:e,transform:n,unwrappedTileID:l,getElevation:h},p){return cf(r,tm(p,n,l,h),e)}function gy({queryGeometry:r,size:e,transform:n,unwrappedTileID:l,getElevation:h,pitchAlignment:p="map",pitchScale:g="map"},b){const T=p==="map"?g==="map"?rw:sw:g==="map"?aw:ow,E={queryGeometry:r,size:e,transform:n,unwrappedTileID:l,getElevation:h};for(const P of b)for(const I of P)if(T(E,I))return!0;return!1}function tm(r,e,n,l){const h=e.projectTileCoordinates(r.x,r.y,n,l).point;return new M((.5*h.x+.5)*e.width,(.5*-h.y+.5)*e.height)}let _y,yy;Ft("CircleBucket",Ic,{omit:["layers"]});var lw={get paint(){return yy=yy||new xr({"circle-radius":new Zt(oe.paint_circle["circle-radius"]),"circle-color":new Zt(oe.paint_circle["circle-color"]),"circle-blur":new Zt(oe.paint_circle["circle-blur"]),"circle-opacity":new Zt(oe.paint_circle["circle-opacity"]),"circle-translate":new Ht(oe.paint_circle["circle-translate"]),"circle-translate-anchor":new Ht(oe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ht(oe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ht(oe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Zt(oe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Zt(oe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Zt(oe.paint_circle["circle-stroke-opacity"])})},get layout(){return _y=_y||new xr({"circle-sort-key":new Zt(oe.layout_circle["circle-sort-key"])})}};class cw extends Xr{constructor(e,n){super(e,lw,n)}createBucket(e){return new Ic(e)}queryRadius(e){const n=e;return Lc("circle-radius",this,n)+Lc("circle-stroke-width",this,n)+uf(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:l,geometry:h,transform:p,pixelsToTileUnits:g,unwrappedTileID:b,getElevation:T}){const E=hf(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-p.bearingInRadians,g),P=this.paint.get("circle-radius").evaluate(n,l)+this.paint.get("circle-stroke-width").evaluate(n,l),I=this.paint.get("circle-pitch-scale"),B=this.paint.get("circle-pitch-alignment");let k,q;return B==="map"?(k=E,q=P*g):(k=(function(X,Y,ne,me){return X.map((ie=>tm(ie,Y,ne,me)))})(E,p,b,T),q=P),gy({queryGeometry:k,size:q,transform:p,unwrappedTileID:b,getElevation:T,pitchAlignment:B,pitchScale:I},h)}}class xy extends Ic{}let vy;Ft("HeatmapBucket",xy,{omit:["layers"]});var uw={get paint(){return vy=vy||new xr({"heatmap-radius":new Zt(oe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Zt(oe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ht(oe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Tc(oe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ht(oe.paint_heatmap["heatmap-opacity"])})}};function im(r,{width:e,height:n},l,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*n*l)throw new RangeError(`mismatched image size. expected: ${h.length} but got: ${e*n*l}`)}else h=new Uint8Array(e*n*l);return r.width=e,r.height=n,r.data=h,r}function by(r,{width:e,height:n},l){if(e===r.width&&n===r.height)return;const h=im({},{width:e,height:n},l);nm(r,h,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,e),height:Math.min(r.height,n)},l),r.width=e,r.height=n,r.data=h.data}function nm(r,e,n,l,h,p){if(h.width===0||h.height===0)return e;if(h.width>r.width||h.height>r.height||n.x>r.width-h.width||n.y>r.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||l.x>e.width-h.width||l.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const g=r.data,b=e.data;if(g===b)throw new Error("srcData equals dstData, so image is already copied");for(let T=0;T<h.height;T++){const E=((n.y+T)*r.width+n.x)*p,P=((l.y+T)*e.width+l.x)*p;for(let I=0;I<h.width*p;I++)b[P+I]=g[E+I]}return e}class bh{constructor(e,n){im(this,e,1,n)}resize(e){by(this,e,1)}clone(){return new bh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,l,h,p){nm(e,n,l,h,p,1)}}class Or{constructor(e,n){im(this,e,4,n)}resize(e){by(this,e,4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Or({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,l,h,p){nm(e,n,l,h,p,4)}setPixel(e,n,l){const h=4*(e*this.width+n);this.data[h+0]=Math.round(255*l.r/l.a),this.data[h+1]=Math.round(255*l.g/l.a),this.data[h+2]=Math.round(255*l.b/l.a),this.data[h+3]=Math.round(255*l.a)}}function wy(r){const e={},n=r.resolution||256,l=r.clips?r.clips.length:1,h=r.image||new Or({width:n,height:l});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const p=(g,b,T)=>{e[r.evaluationKey]=T;const E=r.expression.evaluate(e);h.setPixel(g/4/n,b/4,E)};if(r.clips)for(let g=0,b=0;g<l;++g,b+=4*n)for(let T=0,E=0;T<n;T++,E+=4){const P=T/(n-1),{start:I,end:B}=r.clips[g];p(b,E,I*(1-P)+B*P)}else for(let g=0,b=0;g<n;g++,b+=4)p(0,b,g/(n-1));return h}Ft("AlphaImage",bh),Ft("RGBAImage",Or);const rm="big-fb";class hw extends Xr{createBucket(e){return new xy(e)}constructor(e,n){super(e,uw,n),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=wy({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(rm)&&this.heatmapFbos.delete(rm)}queryRadius(e){return Lc("heatmap-radius",this,e)}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:l,geometry:h,transform:p,pixelsToTileUnits:g,unwrappedTileID:b,getElevation:T}){return gy({queryGeometry:e,size:this.paint.get("heatmap-radius").evaluate(n,l)*g,transform:p,unwrappedTileID:b,getElevation:T},h)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&!this.isHidden()}}let Ty;var dw={get paint(){return Ty=Ty||new xr({"hillshade-illumination-direction":new Ht(oe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Ht(oe.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Ht(oe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ht(oe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ht(oe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ht(oe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ht(oe.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Ht(oe.paint_hillshade["hillshade-method"])})}};class fw extends Xr{constructor(e,n){super(e,dw,n),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,n=this.paint.get("hillshade-illumination-altitude").values,l=this.paint.get("hillshade-highlight-color").values,h=this.paint.get("hillshade-shadow-color").values;const p=Math.max(e.length,n.length,l.length,h.length);e=e.concat(Array(p-e.length).fill(e.at(-1))),n=n.concat(Array(p-n.length).fill(n.at(-1))),l=l.concat(Array(p-l.length).fill(l.at(-1))),h=h.concat(Array(p-h.length).fill(h.at(-1)));const g=n.map(Q);return{directionRadians:e.map(Q),altitudeRadians:g,shadowColor:h,highlightColor:l}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&!this.isHidden()}}let Sy;var pw={get paint(){return Sy=Sy||new xr({"color-relief-opacity":new Ht(oe["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Tc(oe["paint_color-relief"]["color-relief-color"])})}};class sm{constructor(e,n,l,h){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(n,h)}update(e,n,l){const{width:h,height:p}=e,g=!(this.size&&this.size[0]===h&&this.size[1]===p||l),{context:b}=this,{gl:T}=b;if(this.useMipmap=!!(n&&n.useMipmap),T.bindTexture(T.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!n||n.premultiply!==!1)),g)this.size=[h,p],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Le(e)?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,e):T.texImage2D(T.TEXTURE_2D,0,this.format,h,p,0,this.format,T.UNSIGNED_BYTE,e.data);else{const{x:E,y:P}=l||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Le(e)?T.texSubImage2D(T.TEXTURE_2D,0,E,P,T.RGBA,T.UNSIGNED_BYTE,e):T.texSubImage2D(T.TEXTURE_2D,0,E,P,h,p,T.RGBA,T.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&T.generateMipmap(T.TEXTURE_2D),b.pixelStoreUnpackFlipY.setDefault(),b.pixelStoreUnpack.setDefault(),b.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,n,l){const{context:h}=this,{gl:p}=h;p.bindTexture(p.TEXTURE_2D,this.texture),l!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=p.LINEAR),e!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,l||e),this.filter=e),n!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,n),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class My{constructor(e,n,l,h=1,p=1,g=1,b=0){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(l&&!["mapbox","terrarium","custom"].includes(l))return void ci(`"${l}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const T=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),l){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=h,this.greenFactor=p,this.blueFactor=g,this.baseShift=b;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let E=0;E<T;E++)this.data[this._idx(-1,E)]=this.data[this._idx(0,E)],this.data[this._idx(T,E)]=this.data[this._idx(T-1,E)],this.data[this._idx(E,-1)]=this.data[this._idx(E,0)],this.data[this._idx(E,T)]=this.data[this._idx(E,T-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(T,-1)]=this.data[this._idx(T-1,0)],this.data[this._idx(-1,T)]=this.data[this._idx(0,T-1)],this.data[this._idx(T,T)]=this.data[this._idx(T-1,T-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let E=0;E<T;E++)for(let P=0;P<T;P++){const I=this.get(E,P);I>this.max&&(this.max=I),I<this.min&&(this.min=I)}}get(e,n){const l=new Uint8Array(this.data.buffer),h=4*this._idx(e,n);return this.unpack(l[h],l[h+1],l[h+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError(`Out of range source coordinates for DEM data. x: ${e}, y: ${n}, dim: ${this.dim}`);return(n+1)*this.stride+(e+1)}unpack(e,n,l){return e*this.redFactor+n*this.greenFactor+l*this.blueFactor-this.baseShift}pack(e){return Ey(e,this.getUnpackVector())}getPixels(){return new Or({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,n,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=n*this.dim,p=n*this.dim+this.dim,g=l*this.dim,b=l*this.dim+this.dim;switch(n){case-1:h=p-1;break;case 1:p=h+1}switch(l){case-1:g=b-1;break;case 1:b=g+1}const T=-n*this.dim,E=-l*this.dim;for(let P=g;P<b;P++)for(let I=h;I<p;I++)this.data[this._idx(I,P)]=e.data[this._idx(I+T,P+E)]}}function Ey(r,e){const n=e[0],l=e[1],h=e[2],p=e[3],g=Math.min(n,l,h),b=Math.round((r+p)/g);return{r:Math.floor(b*g/n)%256,g:Math.floor(b*g/l)%256,b:Math.floor(b*g/h)%256}}Ft("DEMData",My);class mw extends Xr{constructor(e,n){super(e,pw,n)}_createColorRamp(e){const n={elevationStops:[],colorStops:[]},l=this._transitionablePaint._values["color-relief-color"].value.expression;if(l instanceof uc&&l._styleExpression.expression instanceof yr){this.colorRampExpression=l;const g=l._styleExpression.expression;n.elevationStops=g.labels,n.colorStops=[];for(const b of n.elevationStops)n.colorStops.push(g.evaluate({globals:{elevation:b}}))}if(n.elevationStops.length<1&&(n.elevationStops=[0],n.colorStops=[mi.transparent]),n.elevationStops.length<2&&(n.elevationStops.push(n.elevationStops[0]+1),n.colorStops.push(n.colorStops[0])),n.elevationStops.length<=e)return n;const h={elevationStops:[],colorStops:[]},p=(n.elevationStops.length-1)/(e-1);for(let g=0;g<n.elevationStops.length-.5;g+=p)h.elevationStops.push(n.elevationStops[Math.round(g)]),h.colorStops.push(n.colorStops[Math.round(g)]);return ci(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${e}, provided: ${n.elevationStops.length}`),h}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,n,l){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const h=this._createColorRamp(n),p=new Or({width:h.colorStops.length,height:1}),g=new Or({width:h.colorStops.length,height:1});for(let b=0;b<h.elevationStops.length;b++){const T=Ey(h.elevationStops[b],l);g.setPixel(0,b,new mi(T.r/255,T.g/255,T.b/255,1)),p.setPixel(0,b,h.colorStops[b])}return this.colorRampTextures={elevationTexture:new sm(e,g,e.gl.RGBA),colorTexture:new sm(e,p,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return!this.isHidden()&&!!this.colorRampTextures}}const gw=Mn([{name:"a_pos",components:2,type:"Int16"}],4),{members:_w}=gw;function df(r,e,n){const l=n.patternDependencies;let h=!1;for(const p of e){const g=p.paint.get(`${r}-pattern`);g.isConstant()||(h=!0);const b=g.constantOr(null);b&&(h=!0,l[b.to]=!0,l[b.from]=!0)}return h}function am(r,e,n,l,h){const{zoom:p}=l,g=h.patternDependencies;for(const b of e){const T=b.paint.get(`${r}-pattern`).value;if(T.kind!=="constant"){let E=T.evaluate({zoom:p-1},n,{},h.availableImages),P=T.evaluate({zoom:p},n,{},h.availableImages),I=T.evaluate({zoom:p+1},n,{},h.availableImages);E=E&&E.name?E.name:E,P=P&&P.name?P.name:P,I=I&&I.name?I.name:I,g[E]=!0,g[P]=!0,g[I]=!0,n.patterns[b.id]={min:E,mid:P,max:I}}}return n}function Ay(r,e,n,l,h){let p;if(h===(function(g,b,T,E){let P=0;for(let I=b,B=T-E;I<T;I+=E)P+=(g[B]-g[I])*(g[I+1]+g[B+1]),B=I;return P})(r,e,n,l)>0)for(let g=e;g<n;g+=l)p=Ry(g/l|0,r[g],r[g+1],p);else for(let g=n-l;g>=e;g-=l)p=Ry(g/l|0,r[g],r[g+1],p);return p&&Fc(p,p.next)&&(Mh(p),p=p.next),p}function Cl(r,e){if(!r)return r;e||(e=r);let n,l=r;do if(n=!1,l.steiner||!Fc(l,l.next)&&Rn(l.prev,l,l.next)!==0)l=l.next;else{if(Mh(l),l=e=l.prev,l===l.next)break;n=!0}while(n||l!==e);return e}function wh(r,e,n,l,h,p,g){if(!r)return;!g&&p&&(function(T,E,P,I){let B=T;do B.z===0&&(B.z=om(B.x,B.y,E,P,I)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==T);B.prevZ.nextZ=null,B.prevZ=null,(function(k){let q,X=1;do{let Y,ne=k;k=null;let me=null;for(q=0;ne;){q++;let ie=ne,le=0;for(let Re=0;Re<X&&(le++,ie=ie.nextZ,ie);Re++);let Te=X;for(;le>0||Te>0&&ie;)le!==0&&(Te===0||!ie||ne.z<=ie.z)?(Y=ne,ne=ne.nextZ,le--):(Y=ie,ie=ie.nextZ,Te--),me?me.nextZ=Y:k=Y,Y.prevZ=me,me=Y;ne=ie}me.nextZ=null,X*=2}while(q>1)})(B)})(r,l,h,p);let b=r;for(;r.prev!==r.next;){const T=r.prev,E=r.next;if(p?xw(r,l,h,p):yw(r))e.push(T.i,r.i,E.i),Mh(r),r=E.next,b=E.next;else if((r=E)===b){g?g===1?wh(r=vw(Cl(r),e),e,n,l,h,p,2):g===2&&bw(r,e,n,l,h,p):wh(Cl(r),e,n,l,h,p,1);break}}}function yw(r){const e=r.prev,n=r,l=r.next;if(Rn(e,n,l)>=0)return!1;const h=e.x,p=n.x,g=l.x,b=e.y,T=n.y,E=l.y,P=Math.min(h,p,g),I=Math.min(b,T,E),B=Math.max(h,p,g),k=Math.max(b,T,E);let q=l.next;for(;q!==e;){if(q.x>=P&&q.x<=B&&q.y>=I&&q.y<=k&&Th(h,b,p,T,g,E,q.x,q.y)&&Rn(q.prev,q,q.next)>=0)return!1;q=q.next}return!0}function xw(r,e,n,l){const h=r.prev,p=r,g=r.next;if(Rn(h,p,g)>=0)return!1;const b=h.x,T=p.x,E=g.x,P=h.y,I=p.y,B=g.y,k=Math.min(b,T,E),q=Math.min(P,I,B),X=Math.max(b,T,E),Y=Math.max(P,I,B),ne=om(k,q,e,n,l),me=om(X,Y,e,n,l);let ie=r.prevZ,le=r.nextZ;for(;ie&&ie.z>=ne&&le&&le.z<=me;){if(ie.x>=k&&ie.x<=X&&ie.y>=q&&ie.y<=Y&&ie!==h&&ie!==g&&Th(b,P,T,I,E,B,ie.x,ie.y)&&Rn(ie.prev,ie,ie.next)>=0||(ie=ie.prevZ,le.x>=k&&le.x<=X&&le.y>=q&&le.y<=Y&&le!==h&&le!==g&&Th(b,P,T,I,E,B,le.x,le.y)&&Rn(le.prev,le,le.next)>=0))return!1;le=le.nextZ}for(;ie&&ie.z>=ne;){if(ie.x>=k&&ie.x<=X&&ie.y>=q&&ie.y<=Y&&ie!==h&&ie!==g&&Th(b,P,T,I,E,B,ie.x,ie.y)&&Rn(ie.prev,ie,ie.next)>=0)return!1;ie=ie.prevZ}for(;le&&le.z<=me;){if(le.x>=k&&le.x<=X&&le.y>=q&&le.y<=Y&&le!==h&&le!==g&&Th(b,P,T,I,E,B,le.x,le.y)&&Rn(le.prev,le,le.next)>=0)return!1;le=le.nextZ}return!0}function vw(r,e){let n=r;do{const l=n.prev,h=n.next.next;!Fc(l,h)&&Py(l,n,n.next,h)&&Sh(l,h)&&Sh(h,l)&&(e.push(l.i,n.i,h.i),Mh(n),Mh(n.next),n=r=h),n=n.next}while(n!==r);return Cl(n)}function bw(r,e,n,l,h,p){let g=r;do{let b=g.next.next;for(;b!==g.prev;){if(g.i!==b.i&&Ew(g,b)){let T=Iy(g,b);return g=Cl(g,g.next),T=Cl(T,T.next),wh(g,e,n,l,h,p,0),void wh(T,e,n,l,h,p,0)}b=b.next}g=g.next}while(g!==r)}function ww(r,e){let n=r.x-e.x;return n===0&&(n=r.y-e.y,n===0)&&(n=(r.next.y-r.y)/(r.next.x-r.x)-(e.next.y-e.y)/(e.next.x-e.x)),n}function Tw(r,e){const n=(function(h,p){let g=p;const b=h.x,T=h.y;let E,P=-1/0;if(Fc(h,g))return g;do{if(Fc(h,g.next))return g.next;if(T<=g.y&&T>=g.next.y&&g.next.y!==g.y){const X=g.x+(T-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(X<=b&&X>P&&(P=X,E=g.x<g.next.x?g:g.next,X===b))return E}g=g.next}while(g!==p);if(!E)return null;const I=E,B=E.x,k=E.y;let q=1/0;g=E;do{if(b>=g.x&&g.x>=B&&b!==g.x&&Cy(T<k?b:P,T,B,k,T<k?P:b,T,g.x,g.y)){const X=Math.abs(T-g.y)/(b-g.x);Sh(g,h)&&(X<q||X===q&&(g.x>E.x||g.x===E.x&&Sw(E,g)))&&(E=g,q=X)}g=g.next}while(g!==I);return E})(r,e);if(!n)return e;const l=Iy(n,r);return Cl(l,l.next),Cl(n,n.next)}function Sw(r,e){return Rn(r.prev,r,e.prev)<0&&Rn(e.next,r,r.next)<0}function om(r,e,n,l,h){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-n)*h|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Mw(r){let e=r,n=r;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==r);return n}function Cy(r,e,n,l,h,p,g,b){return(h-g)*(e-b)>=(r-g)*(p-b)&&(r-g)*(l-b)>=(n-g)*(e-b)&&(n-g)*(p-b)>=(h-g)*(l-b)}function Th(r,e,n,l,h,p,g,b){return!(r===g&&e===b)&&Cy(r,e,n,l,h,p,g,b)}function Ew(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!(function(n,l){let h=n;do{if(h.i!==n.i&&h.next.i!==n.i&&h.i!==l.i&&h.next.i!==l.i&&Py(h,h.next,n,l))return!0;h=h.next}while(h!==n);return!1})(r,e)&&(Sh(r,e)&&Sh(e,r)&&(function(n,l){let h=n,p=!1;const g=(n.x+l.x)/2,b=(n.y+l.y)/2;do h.y>b!=h.next.y>b&&h.next.y!==h.y&&g<(h.next.x-h.x)*(b-h.y)/(h.next.y-h.y)+h.x&&(p=!p),h=h.next;while(h!==n);return p})(r,e)&&(Rn(r.prev,r,e.prev)||Rn(r,e.prev,e))||Fc(r,e)&&Rn(r.prev,r,r.next)>0&&Rn(e.prev,e,e.next)>0)}function Rn(r,e,n){return(e.y-r.y)*(n.x-e.x)-(e.x-r.x)*(n.y-e.y)}function Fc(r,e){return r.x===e.x&&r.y===e.y}function Py(r,e,n,l){const h=pf(Rn(r,e,n)),p=pf(Rn(r,e,l)),g=pf(Rn(n,l,r)),b=pf(Rn(n,l,e));return h!==p&&g!==b||!(h!==0||!ff(r,n,e))||!(p!==0||!ff(r,l,e))||!(g!==0||!ff(n,r,l))||!(b!==0||!ff(n,e,l))}function ff(r,e,n){return e.x<=Math.max(r.x,n.x)&&e.x>=Math.min(r.x,n.x)&&e.y<=Math.max(r.y,n.y)&&e.y>=Math.min(r.y,n.y)}function pf(r){return r>0?1:r<0?-1:0}function Sh(r,e){return Rn(r.prev,r,r.next)<0?Rn(r,e,r.next)>=0&&Rn(r,r.prev,e)>=0:Rn(r,e,r.prev)<0||Rn(r,r.next,e)<0}function Iy(r,e){const n=lm(r.i,r.x,r.y),l=lm(e.i,e.x,e.y),h=r.next,p=e.prev;return r.next=e,e.prev=r,n.next=h,h.prev=n,l.next=n,n.prev=l,p.next=l,l.prev=p,l}function Ry(r,e,n,l){const h=lm(r,e,n);return l?(h.next=l.next,h.prev=l,l.next.prev=h,l.next=h):(h.prev=h,h.next=h),h}function Mh(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function lm(r,e,n){return{i:r,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class zc{constructor(e,n){if(n>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=n}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class mf{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}mf.noSubdivision=new mf({fill:new zc(0,0),line:new zc(0,0),tile:new zc(0,0),stencil:new zc(0,0),circle:1}),Ft("SubdivisionGranularityExpression",zc),Ft("SubdivisionGranularitySetting",mf);const Oc=-32768,Eh=32767;class Aw{constructor(e,n){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=xt/e,this._canonical=n}_getKey(e,n){return(e+=32768)<<16|n+32768}_vertexToIndex(e,n){if(e<-32768||n<-32768||e>32767||n>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const l=0|Math.round(e),h=0|Math.round(n),p=this._getKey(l,h);if(this._vertexDictionary.has(p))return this._vertexDictionary.get(p);const g=this._vertexBuffer.length/2;return this._vertexDictionary.set(p,g),this._vertexBuffer.push(l,h),g}_subdivideTrianglesScanline(e){if(this._granularity<2)return(function(h,p){const g=[];for(let b=0;b<p.length;b+=3){const T=p[b],E=p[b+1],P=p[b+2],I=h[2*T],B=h[2*T+1];(h[2*E]-I)*(h[2*P+1]-B)-(h[2*E+1]-B)*(h[2*P]-I)>0?(g.push(T),g.push(P),g.push(E)):(g.push(T),g.push(E),g.push(P))}return g})(this._vertexBuffer,e);const n=[],l=e.length;for(let h=0;h<l;h+=3){const p=[e[h+0],e[h+1],e[h+2]],g=[this._vertexBuffer[2*e[h+0]+0],this._vertexBuffer[2*e[h+0]+1],this._vertexBuffer[2*e[h+1]+0],this._vertexBuffer[2*e[h+1]+1],this._vertexBuffer[2*e[h+2]+0],this._vertexBuffer[2*e[h+2]+1]];let b=1/0,T=1/0,E=-1/0,P=-1/0;for(let X=0;X<3;X++){const Y=g[2*X],ne=g[2*X+1];b=Math.min(b,Y),E=Math.max(E,Y),T=Math.min(T,ne),P=Math.max(P,ne)}if(b===E||T===P)continue;const I=Math.floor(b/this._granularityCellSize),B=Math.ceil(E/this._granularityCellSize),k=Math.floor(T/this._granularityCellSize),q=Math.ceil(P/this._granularityCellSize);if(I!==B||k!==q)for(let X=k;X<q;X++){const Y=this._scanlineGenerateVertexRingForCellRow(X,g,p);Cw(this._vertexBuffer,Y,n)}else n.push(...p)}return n}_scanlineGenerateVertexRingForCellRow(e,n,l){const h=e*this._granularityCellSize,p=h+this._granularityCellSize,g=[];for(let b=0;b<3;b++){const T=n[2*b],E=n[2*b+1],P=n[2*(b+1)%6],I=n[(2*(b+1)+1)%6],B=n[2*(b+2)%6],k=n[(2*(b+2)+1)%6],q=P-T,X=I-E,Y=q===0,ne=X===0,me=(h-E)/X,ie=(p-E)/X,le=Math.min(me,ie),Te=Math.max(me,ie);if(!ne&&(le>=1||Te<=0)||ne&&(E<h||E>p)){I>=h&&I<=p&&g.push(l[(b+1)%3]);continue}!ne&&le>0&&g.push(this._vertexToIndex(T+q*le,E+X*le));const Re=T+q*Math.max(le,0),He=T+q*Math.min(Te,1);Y||this._generateIntraEdgeVertices(g,T,E,P,I,Re,He),!ne&&Te<1&&g.push(this._vertexToIndex(T+q*Te,E+X*Te)),(ne||I>=h&&I<=p)&&g.push(l[(b+1)%3]),!ne&&(I<=h||I>=p)&&this._generateInterEdgeVertices(g,T,E,P,I,B,k,He,h,p)}return g}_generateIntraEdgeVertices(e,n,l,h,p,g,b){const T=h-n,E=p-l,P=E===0,I=P?Math.min(n,h):Math.min(g,b),B=P?Math.max(n,h):Math.max(g,b),k=Math.floor(I/this._granularityCellSize)+1,q=Math.ceil(B/this._granularityCellSize)-1;if(P?n<h:g<b)for(let X=k;X<=q;X++){const Y=X*this._granularityCellSize;e.push(this._vertexToIndex(Y,l+E*(Y-n)/T))}else for(let X=q;X>=k;X--){const Y=X*this._granularityCellSize;e.push(this._vertexToIndex(Y,l+E*(Y-n)/T))}}_generateInterEdgeVertices(e,n,l,h,p,g,b,T,E,P){const I=p-l,B=g-h,k=b-p,q=(E-p)/k,X=(P-p)/k,Y=Math.min(q,X),ne=Math.max(q,X),me=h+B*Y;let ie=Math.floor(Math.min(me,T)/this._granularityCellSize)+1,le=Math.ceil(Math.max(me,T)/this._granularityCellSize)-1,Te=T<me;const Re=k===0;if(Re&&(b===E||b===P))return;if(Re||Y>=1||ne<=0){const it=l-b,rt=g+(n-g)*Math.min((E-b)/it,(P-b)/it);ie=Math.floor(Math.min(rt,T)/this._granularityCellSize)+1,le=Math.ceil(Math.max(rt,T)/this._granularityCellSize)-1,Te=T<rt}const He=I>0?P:E;if(Te)for(let it=ie;it<=le;it++)e.push(this._vertexToIndex(it*this._granularityCellSize,He));else for(let it=le;it>=ie;it--)e.push(this._vertexToIndex(it*this._granularityCellSize,He))}_generateOutline(e){const n=[];for(const l of e){const h=Pl(l,this._granularity,!0),p=this._pointArrayToIndices(h),g=[];for(let b=1;b<p.length;b++)g.push(p[b-1]),g.push(p[b]);n.push(g)}return n}_handlePoles(e){let n=!1,l=!1;this._canonical&&(this._canonical.y===0&&(n=!0),this._canonical.y===(1<<this._canonical.z)-1&&(l=!0)),(n||l)&&this._fillPoles(e,n,l)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let n=0;n<e.length;n+=2){const l=e[n+1];l===Oc&&(e[n+1]=-32767),l===Eh&&(e[n+1]=32766)}}_generatePoleQuad(e,n,l,h,p,g){h>p!=(g===Oc)?(e.push(n),e.push(l),e.push(this._vertexToIndex(h,g)),e.push(l),e.push(this._vertexToIndex(p,g)),e.push(this._vertexToIndex(h,g))):(e.push(l),e.push(n),e.push(this._vertexToIndex(h,g)),e.push(this._vertexToIndex(p,g)),e.push(l),e.push(this._vertexToIndex(h,g)))}_fillPoles(e,n,l){const h=this._vertexBuffer,p=xt,g=e.length;for(let b=2;b<g;b+=3){const T=e[b-2],E=e[b-1],P=e[b],I=h[2*T],B=h[2*T+1],k=h[2*E],q=h[2*E+1],X=h[2*P],Y=h[2*P+1];n&&(B===0&&q===0&&this._generatePoleQuad(e,T,E,I,k,Oc),q===0&&Y===0&&this._generatePoleQuad(e,E,P,k,X,Oc),Y===0&&B===0&&this._generatePoleQuad(e,P,T,X,I,Oc)),l&&(B===p&&q===p&&this._generatePoleQuad(e,T,E,I,k,Eh),q===p&&Y===p&&this._generatePoleQuad(e,E,P,k,X,Eh),Y===p&&B===p&&this._generatePoleQuad(e,P,T,X,I,Eh))}}_initializeVertices(e){for(let n=0;n<e.length;n+=2)this._vertexToIndex(e[n],e[n+1])}subdividePolygonInternal(e,n){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:l,holeIndices:h}=(function(b){const T=[],E=[];for(const P of b)if(P.length!==0){P!==b[0]&&T.push(E.length/2);for(let I=0;I<P.length;I++)E.push(P[I].x),E.push(P[I].y)}return{flattened:E,holeIndices:T}})(e);let p;this._initializeVertices(l);try{const b=(function(E,P,I=2){const B=P&&P.length,k=B?P[0]*I:E.length;let q=Ay(E,0,k,I,!0);const X=[];if(!q||q.next===q.prev)return X;let Y,ne,me;if(B&&(q=(function(ie,le,Te,Re){const He=[];for(let it=0,rt=le.length;it<rt;it++){const ft=Ay(ie,le[it]*Re,it<rt-1?le[it+1]*Re:ie.length,Re,!1);ft===ft.next&&(ft.steiner=!0),He.push(Mw(ft))}He.sort(ww);for(let it=0;it<He.length;it++)Te=Tw(He[it],Te);return Te})(E,P,q,I)),E.length>80*I){Y=E[0],ne=E[1];let ie=Y,le=ne;for(let Te=I;Te<k;Te+=I){const Re=E[Te],He=E[Te+1];Re<Y&&(Y=Re),He<ne&&(ne=He),Re>ie&&(ie=Re),He>le&&(le=He)}me=Math.max(ie-Y,le-ne),me=me!==0?32767/me:0}return wh(q,X,I,Y,ne,me,0),X})(l,h),T=this._convertIndices(l,b);p=this._subdivideTrianglesScanline(T)}catch(b){console.error(b)}let g=[];return n&&(g=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(p),{verticesFlattened:this._vertexBuffer,indicesTriangles:p,indicesLineList:g}}_convertIndices(e,n){const l=[];for(let h=0;h<n.length;h++)l.push(this._vertexToIndex(e[2*n[h]],e[2*n[h]+1]));return l}_pointArrayToIndices(e){const n=[];for(let l=0;l<e.length;l++){const h=e[l];n.push(this._vertexToIndex(h.x,h.y))}return n}}function Dy(r,e,n,l=!0){return new Aw(n,e).subdividePolygonInternal(r,l)}function Pl(r,e,n=!1){if(!r||r.length<1)return[];if(r.length<2)return[];const l=r[0],h=r[r.length-1],p=n&&(l.x!==h.x||l.y!==h.y);if(e<2)return p?[...r,r[0]]:[...r];const g=Math.floor(xt/e),b=[];b.push(new M(r[0].x,r[0].y));const T=r.length,E=p?T:T-1;for(let P=0;P<E;P++){const I=r[P],B=P<T-1?r[P+1]:r[0],k=I.x,q=I.y,X=B.x,Y=B.y,ne=k!==X,me=q!==Y;if(!ne&&!me)continue;const ie=X-k,le=Y-q,Te=Math.abs(ie),Re=Math.abs(le);let He=k,it=q;for(;;){const ft=ie>0?(Math.floor(He/g)+1)*g:(Math.ceil(He/g)-1)*g,St=le>0?(Math.floor(it/g)+1)*g:(Math.ceil(it/g)-1)*g,_t=Math.abs(He-ft),at=Math.abs(it-St),et=Math.abs(He-X),zt=Math.abs(it-Y),Nt=ne?_t/Te:Number.POSITIVE_INFINITY,qt=me?at/Re:Number.POSITIVE_INFINITY;if((et<=_t||!ne)&&(zt<=at||!me))break;if(Nt<qt&&ne||!me){He=ft,it+=le*Nt;const Ut=new M(He,Math.round(it));b[b.length-1].x===Ut.x&&b[b.length-1].y===Ut.y||b.push(Ut)}else{He+=ie*qt,it=St;const Ut=new M(Math.round(He),it);b[b.length-1].x===Ut.x&&b[b.length-1].y===Ut.y||b.push(Ut)}}const rt=new M(X,Y);b[b.length-1].x===rt.x&&b[b.length-1].y===rt.y||b.push(rt)}return b}function Cw(r,e,n){if(e.length===0)throw new Error("Subdivision vertex ring is empty.");let l=0,h=r[2*e[0]];for(let T=1;T<e.length;T++){const E=r[2*e[T]];E<h&&(h=E,l=T)}const p=e.length;let g=l,b=(g+1)%p;for(;;){const T=g-1>=0?g-1:p-1,E=(b+1)%p,P=r[2*e[T]],I=r[2*e[E]],B=r[2*e[g]],k=r[2*e[g]+1],q=r[2*e[b]+1];let X=!1;if(P<I)X=!0;else if(P>I)X=!1;else{const Y=q-k,ne=-(r[2*e[b]]-B),me=k<q?1:-1;((P-B)*Y+(r[2*e[T]+1]-k)*ne)*me>((I-B)*Y+(r[2*e[E]+1]-k)*ne)*me&&(X=!0)}if(X){const Y=e[T],ne=e[g],me=e[b];Y!==ne&&Y!==me&&ne!==me&&n.push(me,ne,Y),g--,g<0&&(g=p-1)}else{const Y=e[E],ne=e[g],me=e[b];Y!==ne&&Y!==me&&ne!==me&&n.push(me,ne,Y),b++,b>=p&&(b=0)}if(T===E)break}}function Ly(r,e,n,l,h,p,g,b,T){const E=h.length/2,P=g&&b&&T;if(E<Mt.MAX_VERTEX_ARRAY_LENGTH){const I=e.prepareSegment(E,n,l),B=I.vertexLength;for(let X=0;X<p.length;X+=3)l.emplaceBack(B+p[X],B+p[X+1],B+p[X+2]);let k,q;I.vertexLength+=E,I.primitiveLength+=p.length/3,P&&(q=g.prepareSegment(E,n,b),k=q.vertexLength,q.vertexLength+=E);for(let X=0;X<h.length;X+=2)r(h[X],h[X+1]);if(P)for(let X=0;X<T.length;X++){const Y=T[X];for(let ne=1;ne<Y.length;ne+=2)b.emplaceBack(k+Y[ne-1],k+Y[ne]);q.primitiveLength+=Y.length/2}}else(function(I,B,k,q,X,Y){const ne=[];for(let Re=0;Re<q.length/2;Re++)ne.push(-1);const me={count:0};let ie=0,le=I.getOrCreateLatestSegment(B,k),Te=le.vertexLength;for(let Re=2;Re<X.length;Re+=3){const He=X[Re-2],it=X[Re-1],rt=X[Re];let ft=ne[He]<ie,St=ne[it]<ie,_t=ne[rt]<ie;le.vertexLength+((ft?1:0)+(St?1:0)+(_t?1:0))>Mt.MAX_VERTEX_ARRAY_LENGTH&&(le=I.createNewSegment(B,k),ie=me.count,ft=!0,St=!0,_t=!0,Te=0);const at=Ah(ne,q,Y,me,He,ft,le),et=Ah(ne,q,Y,me,it,St,le),zt=Ah(ne,q,Y,me,rt,_t,le);k.emplaceBack(Te+at-ie,Te+et-ie,Te+zt-ie),le.primitiveLength++}})(e,n,l,h,p,r),P&&(function(I,B,k,q,X,Y){const ne=[];for(let Re=0;Re<q.length/2;Re++)ne.push(-1);const me={count:0};let ie=0,le=I.getOrCreateLatestSegment(B,k),Te=le.vertexLength;for(let Re=0;Re<X.length;Re++){const He=X[Re];for(let it=1;it<X[Re].length;it+=2){const rt=He[it-1],ft=He[it];let St=ne[rt]<ie,_t=ne[ft]<ie;le.vertexLength+((St?1:0)+(_t?1:0))>Mt.MAX_VERTEX_ARRAY_LENGTH&&(le=I.createNewSegment(B,k),ie=me.count,St=!0,_t=!0,Te=0);const at=Ah(ne,q,Y,me,rt,St,le),et=Ah(ne,q,Y,me,ft,_t,le);k.emplaceBack(Te+at-ie,Te+et-ie),le.primitiveLength++}}})(g,n,b,h,T,r),e.forceNewSegmentOnNextPrepare(),g?.forceNewSegmentOnNextPrepare()}function Ah(r,e,n,l,h,p,g){if(p){const b=l.count;return n(e[2*h],e[2*h+1]),r[h]=l.count,l.count++,g.vertexLength++,b}return r[h]}class cm{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new ue,this.indexArray=new Ze,this.indexArray2=new bt,this.programConfigurations=new Ha(e.layers,e.zoom),this.segments=new Mt,this.segments2=new Mt,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,l){this.hasDependencies=df("fill",this.layers,n);const h=this.layers[0].layout.get("fill-sort-key"),p=!h.isConstant(),g=[];for(const{feature:b,id:T,index:E,sourceLayerIndex:P}of e){const I=this.layers[0]._featureFilter.needGeometry,B=aa(b,I);if(!this.layers[0]._featureFilter.filter(new ji(this.zoom),B,l))continue;const k=p?h.evaluate(B,{},l,n.availableImages):void 0,q={id:T,properties:b.properties,type:b.type,sourceLayerIndex:P,index:E,geometry:I?B.geometry:sa(b),patterns:{},sortKey:k};g.push(q)}p&&g.sort(((b,T)=>b.sortKey-T.sortKey));for(const b of g){const{geometry:T,index:E,sourceLayerIndex:P}=b;if(this.hasDependencies){const I=am("fill",this.layers,b,{zoom:this.zoom},n);this.patternFeatures.push(I)}else this.addFeature(b,T,E,l,{},n.subdivisionGranularity);n.featureIndex.insert(e[E].feature,T,E,P,this.index)}}update(e,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:l})}addFeatures(e,n,l){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,n,l,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,_w),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,l,h,p,g){for(const b of Ql(n,500)){const T=Dy(b,h,g.fill.getGranularityForZoomLevel(h.z)),E=this.layoutVertexArray;Ly(((P,I)=>{E.emplaceBack(P,I)}),this.segments,this.layoutVertexArray,this.indexArray,T.verticesFlattened,T.indicesTriangles,this.segments2,this.indexArray2,T.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:p,canonical:h})}}let Fy,zy;Ft("FillBucket",cm,{omit:["layers","patternFeatures"]});var Pw={get paint(){return zy=zy||new xr({"fill-antialias":new Ht(oe.paint_fill["fill-antialias"]),"fill-opacity":new Zt(oe.paint_fill["fill-opacity"]),"fill-color":new Zt(oe.paint_fill["fill-color"]),"fill-outline-color":new Zt(oe.paint_fill["fill-outline-color"]),"fill-translate":new Ht(oe.paint_fill["fill-translate"]),"fill-translate-anchor":new Ht(oe.paint_fill["fill-translate-anchor"]),"fill-pattern":new vl(oe.paint_fill["fill-pattern"])})},get layout(){return Fy=Fy||new xr({"fill-sort-key":new Zt(oe.layout_fill["fill-sort-key"])})}};class Iw extends Xr{constructor(e,n){super(e,Pw,n)}recalculate(e,n){super.recalculate(e,n);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new cm(e)}queryRadius(){return uf(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:n,transform:l,pixelsToTileUnits:h}){return fy(hf(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-l.bearingInRadians,h),n)}isTileClipped(){return!0}}const Rw=Mn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Dw=Mn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Lw}=Rw;class Ch{constructor(e,n,l,h,p){this.properties={},this.extent=l,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=h,this._values=p,e.readFields(Fw,this,n)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos,l=[];let h,p=1,g=0,b=0,T=0;for(;e.pos<n;){if(g<=0){const E=e.readVarint();p=7&E,g=E>>3}if(g--,p===1||p===2)b+=e.readSVarint(),T+=e.readSVarint(),p===1&&(h&&l.push(h),h=[]),h&&h.push(new M(b,T));else{if(p!==7)throw new Error(`unknown command ${p}`);h&&h.push(h[0].clone())}}return h&&l.push(h),l}bbox(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos;let l=1,h=0,p=0,g=0,b=1/0,T=-1/0,E=1/0,P=-1/0;for(;e.pos<n;){if(h<=0){const I=e.readVarint();l=7&I,h=I>>3}if(h--,l===1||l===2)p+=e.readSVarint(),g+=e.readSVarint(),p<b&&(b=p),p>T&&(T=p),g<E&&(E=g),g>P&&(P=g);else if(l!==7)throw new Error(`unknown command ${l}`)}return[b,E,T,P]}toGeoJSON(e,n,l){const h=this.extent*Math.pow(2,l),p=this.extent*e,g=this.extent*n,b=this.loadGeometry();function T(B){return[360*(B.x+p)/h-180,360/Math.PI*Math.atan(Math.exp((1-2*(B.y+g)/h)*Math.PI))-90]}function E(B){return B.map(T)}let P;if(this.type===1){const B=[];for(const q of b)B.push(q[0]);const k=E(B);P=B.length===1?{type:"Point",coordinates:k[0]}:{type:"MultiPoint",coordinates:k}}else if(this.type===2){const B=b.map(E);P=B.length===1?{type:"LineString",coordinates:B[0]}:{type:"MultiLineString",coordinates:B}}else{if(this.type!==3)throw new Error("unknown feature type");{const B=Oy(b),k=[];for(const q of B)k.push(q.map(E));P=k.length===1?{type:"Polygon",coordinates:k[0]}:{type:"MultiPolygon",coordinates:k}}}const I={type:"Feature",geometry:P,properties:this.properties};return this.id!=null&&(I.id=this.id),I}}function Fw(r,e,n){r===1?e.id=n.readVarint():r===2?(function(l,h){const p=l.readVarint()+l.pos;for(;l.pos<p;){const g=h._keys[l.readVarint()],b=h._values[l.readVarint()];h.properties[g]=b}})(n,e):r===3?e.type=n.readVarint():r===4&&(e._geometry=n.pos)}function Oy(r){const e=r.length;if(e<=1)return[r];const n=[];let l,h;for(let p=0;p<e;p++){const g=zw(r[p]);g!==0&&(h===void 0&&(h=g<0),h===g<0?(l&&n.push(l),l=[r[p]]):l&&l.push(r[p]))}return l&&n.push(l),n}function zw(r){let e=0;for(let n,l,h=0,p=r.length,g=p-1;h<p;g=h++)n=r[h],l=r[g],e+=(l.x-n.x)*(n.y+l.y);return e}Ch.types=["Unknown","Point","LineString","Polygon"];class Ow{constructor(e,n){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Nw,this,n),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const n=this._pbf.readVarint()+this._pbf.pos;return new Ch(this._pbf,n,this.extent,this._keys,this._values)}}function Nw(r,e,n){r===15?e.version=n.readVarint():r===1?e.name=n.readString():r===5?e.extent=n.readVarint():r===2?e._features.push(n.pos):r===3?e._keys.push(n.readString()):r===4&&e._values.push((function(l){let h=null;const p=l.readVarint()+l.pos;for(;l.pos<p;){const g=l.readVarint()>>3;h=g===1?l.readString():g===2?l.readFloat():g===3?l.readDouble():g===4?l.readVarint64():g===5?l.readVarint():g===6?l.readSVarint():g===7?l.readBoolean():null}if(h==null)throw new Error("unknown feature value");return h})(n))}class Ny{constructor(e,n){this.layers=e.readFields(Bw,{},n)}}function Bw(r,e,n){if(r===3){const l=new Ow(n,n.readVarint()+n.pos);l.length&&(e[l.name]=l)}}const um=Math.pow(2,13);function Ph(r,e,n,l,h,p,g,b){r.emplaceBack(e,n,2*Math.floor(l*um)+g,h*um*2,p*um*2,Math.round(b))}class hm{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new ye,this.centroidVertexArray=new ce,this.indexArray=new Ze,this.programConfigurations=new Ha(e.layers,e.zoom),this.segments=new Mt,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,l){this.features=[],this.hasDependencies=df("fill-extrusion",this.layers,n);for(const{feature:h,id:p,index:g,sourceLayerIndex:b}of e){const T=this.layers[0]._featureFilter.needGeometry,E=aa(h,T);if(!this.layers[0]._featureFilter.filter(new ji(this.zoom),E,l))continue;const P={id:p,sourceLayerIndex:b,index:g,geometry:T?E.geometry:sa(h),properties:h.properties,type:h.type,patterns:{}};this.hasDependencies?this.features.push(am("fill-extrusion",this.layers,P,{zoom:this.zoom},n)):this.addFeature(P,P.geometry,g,l,{},n.subdivisionGranularity),n.featureIndex.insert(h,P.geometry,g,b,this.index,!0)}}addFeatures(e,n,l){for(const h of this.features){const{geometry:p}=h;this.addFeature(h,p,h.index,n,l,e.subdivisionGranularity)}}update(e,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:l})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Lw),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Dw.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,n,l,h,p,g){for(const b of Ql(n,500)){const T={x:0,y:0,sampleCount:0},E=this.layoutVertexArray.length;this.processPolygon(T,h,e,b,g);const P=this.layoutVertexArray.length-E,I=Math.floor(T.x/T.sampleCount),B=Math.floor(T.y/T.sampleCount);for(let k=0;k<P;k++)this.centroidVertexArray.emplaceBack(I,B)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:p,canonical:h})}processPolygon(e,n,l,h,p){if(h.length<1||By(h[0]))return;for(const I of h)I.length!==0&&kw(e,I);const g={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},b=p.fill.getGranularityForZoomLevel(n.z),T=Ch.types[l.type]==="Polygon";for(const I of h){if(I.length===0||By(I))continue;const B=Pl(I,b,T);this._generateSideFaces(B,g)}if(!T)return;const E=Dy(h,n,b,!1),P=this.layoutVertexArray;Ly(((I,B)=>{Ph(P,I,B,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,E.verticesFlattened,E.indicesTriangles)}_generateSideFaces(e,n){let l=0;for(let h=1;h<e.length;h++){const p=e[h],g=e[h-1];if(Uw(p,g))continue;n.segment.vertexLength+4>Mt.MAX_VERTEX_ARRAY_LENGTH&&(n.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const b=p.sub(g)._perp()._unit(),T=g.dist(p);l+T>32768&&(l=0),Ph(this.layoutVertexArray,p.x,p.y,b.x,b.y,0,0,l),Ph(this.layoutVertexArray,p.x,p.y,b.x,b.y,0,1,l),l+=T,Ph(this.layoutVertexArray,g.x,g.y,b.x,b.y,0,0,l),Ph(this.layoutVertexArray,g.x,g.y,b.x,b.y,0,1,l);const E=n.segment.vertexLength;this.indexArray.emplaceBack(E,E+2,E+1),this.indexArray.emplaceBack(E+1,E+2,E+3),n.segment.vertexLength+=4,n.segment.primitiveLength+=2}}}function kw(r,e){for(let n=0;n<e.length;n++){const l=e[n];n===e.length-1&&e[0].x===l.x&&e[0].y===l.y||(r.x+=l.x,r.y+=l.y,r.sampleCount++)}}function Uw(r,e){return r.x===e.x&&(r.x<0||r.x>xt)||r.y===e.y&&(r.y<0||r.y>xt)}function By(r){return r.every((e=>e.x<0))||r.every((e=>e.x>xt))||r.every((e=>e.y<0))||r.every((e=>e.y>xt))}let ky;Ft("FillExtrusionBucket",hm,{omit:["layers","features"]});var Vw={get paint(){return ky=ky||new xr({"fill-extrusion-opacity":new Ht(oe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Zt(oe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ht(oe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ht(oe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new vl(oe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Zt(oe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Zt(oe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ht(oe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Gw extends Xr{constructor(e,n){super(e,Vw,n)}createBucket(e){return new hm(e)}queryRadius(){return uf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:l,geometry:h,transform:p,pixelsToTileUnits:g,pixelPosMatrix:b}){const T=hf(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-p.bearingInRadians,g),E=this.paint.get("fill-extrusion-height").evaluate(n,l),P=this.paint.get("fill-extrusion-base").evaluate(n,l),I=(function(k,q){const X=[];for(const Y of k){const ne=[Y.x,Y.y,0,1];pt(ne,ne,q),X.push(new M(ne[0]/ne[3],ne[1]/ne[3]))}return X})(T,b),B=(function(k,q,X,Y){const ne=[],me=[],ie=Y[8]*q,le=Y[9]*q,Te=Y[10]*q,Re=Y[11]*q,He=Y[8]*X,it=Y[9]*X,rt=Y[10]*X,ft=Y[11]*X;for(const St of k){const _t=[],at=[];for(const et of St){const zt=et.x,Nt=et.y,qt=Y[0]*zt+Y[4]*Nt+Y[12],Ut=Y[1]*zt+Y[5]*Nt+Y[13],fi=Y[2]*zt+Y[6]*Nt+Y[14],dn=Y[3]*zt+Y[7]*Nt+Y[15],On=fi+Te,cr=dn+Re,ws=qt+He,Ir=Ut+it,er=fi+rt,ur=dn+ft,Cn=new M((qt+ie)/cr,(Ut+le)/cr);Cn.z=On/cr,_t.push(Cn);const tr=new M(ws/ur,Ir/ur);tr.z=er/ur,at.push(tr)}ne.push(_t),me.push(at)}return[ne,me]})(h,P,E,b);return(function(k,q,X){let Y=1/0;fy(X,q)&&(Y=Uy(X,q[0]));for(let ne=0;ne<q.length;ne++){const me=q[ne],ie=k[ne];for(let le=0;le<me.length-1;le++){const Te=me[le],Re=[Te,me[le+1],ie[le+1],ie[le],Te];Rc(X,Re)&&(Y=Math.min(Y,Uy(X,Re)))}}return Y!==1/0&&Y})(B[0],B[1],I)}}function Ih(r,e){return r.x*e.x+r.y*e.y}function Uy(r,e){if(r.length===1){let n=0;const l=e[n++];let h;for(;!h||l.equals(h);)if(h=e[n++],!h)return 1/0;for(;n<e.length;n++){const p=e[n],g=r[0],b=h.sub(l),T=p.sub(l),E=g.sub(l),P=Ih(b,b),I=Ih(b,T),B=Ih(T,T),k=Ih(E,b),q=Ih(E,T),X=P*B-I*I,Y=(B*k-I*q)/X,ne=(P*q-I*k)/X,me=l.z*(1-Y-ne)+h.z*Y+p.z*ne;if(isFinite(me))return me}return 1/0}{let n=1/0;for(const l of e)n=Math.min(n,l.z);return n}}const Hw=Mn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:jw}=Hw,Ww=Mn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:qw}=Ww,Xw=Math.cos(Math.PI/180*37.5),Vy=Math.pow(2,14)/.5;class dm{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((n=>{this.gradients[n.id]={}})),this.layoutVertexArray=new Ae,this.layoutVertexArray2=new _e,this.indexArray=new Ze,this.programConfigurations=new Ha(e.layers,e.zoom),this.segments=new Mt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,l){this.hasDependencies=df("line",this.layers,n)||this.hasLineDasharray(this.layers);const h=this.layers[0].layout.get("line-sort-key"),p=!h.isConstant(),g=[];for(const{feature:b,id:T,index:E,sourceLayerIndex:P}of e){const I=this.layers[0]._featureFilter.needGeometry,B=aa(b,I);if(!this.layers[0]._featureFilter.filter(new ji(this.zoom),B,l))continue;const k=p?h.evaluate(B,{},l):void 0,q={id:T,properties:b.properties,type:b.type,sourceLayerIndex:P,index:E,geometry:I?B.geometry:sa(b),patterns:{},dashes:{},sortKey:k};g.push(q)}p&&g.sort(((b,T)=>b.sortKey-T.sortKey));for(const b of g){const{geometry:T,index:E,sourceLayerIndex:P}=b;this.hasDependencies?(df("line",this.layers,n)?am("line",this.layers,b,{zoom:this.zoom},n):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,b,this.zoom,n),this.patternFeatures.push(b)):this.addFeature(b,T,E,l,{},{},n.subdivisionGranularity),n.featureIndex.insert(e[E].feature,T,E,P,this.index)}}update(e,n,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:l,dashPositions:h})}addFeatures(e,n,l,h){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,n,l,h,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,qw)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,jw),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,l,h,p,g,b){const T=this.layers[0].layout,E=T.get("line-join").evaluate(e,{}),P=T.get("line-cap"),I=T.get("line-miter-limit"),B=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const k of n)this.addLine(k,e,E,P,I,B,h,b);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:p,dashPositions:g,canonical:h})}addLine(e,n,l,h,p,g,b,T){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=Pl(e,b?T.line.getGranularityForZoomLevel(b.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ie=0;ie<e.length-1;ie++)this.totalDistance+=e[ie].dist(e[ie+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const E=Ch.types[n.type]==="Polygon";let P=e.length;for(;P>=2&&e[P-1].equals(e[P-2]);)P--;let I=0;for(;I<P-1&&e[I].equals(e[I+1]);)I++;if(P<(E?3:2))return;l==="bevel"&&(p=1.05);const B=this.overscaling<=16?122880/(512*this.overscaling):0,k=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let q,X,Y,ne,me;this.e1=this.e2=-1,E&&(q=e[P-2],me=e[I].sub(q)._unit()._perp());for(let ie=I;ie<P;ie++){if(Y=ie===P-1?E?e[I+1]:void 0:e[ie+1],Y&&e[ie].equals(Y))continue;me&&(ne=me),q&&(X=q),q=e[ie],me=Y?Y.sub(q)._unit()._perp():ne,ne=ne||me;let le=ne.add(me);le.x===0&&le.y===0||le._unit();const Te=ne.x*me.x+ne.y*me.y,Re=le.x*me.x+le.y*me.y,He=Re!==0?1/Re:1/0,it=2*Math.sqrt(2-2*Re),rt=Re<Xw&&X&&Y,ft=ne.x*me.y-ne.y*me.x>0;if(rt&&ie>I){const at=q.dist(X);if(at>2*B){const et=q.sub(q.sub(X)._mult(B/at)._round());this.updateDistance(X,et),this.addCurrentVertex(et,ne,0,0,k),X=et}}const St=X&&Y;let _t=St?l:E?"butt":h;if(St&&_t==="round"&&(He<g?_t="miter":He<=2&&(_t="fakeround")),_t==="miter"&&He>p&&(_t="bevel"),_t==="bevel"&&(He>2&&(_t="flipbevel"),He<p&&(_t="miter")),X&&this.updateDistance(X,q),_t==="miter")le._mult(He),this.addCurrentVertex(q,le,0,0,k);else if(_t==="flipbevel"){if(He>100)le=me.mult(-1);else{const at=He*ne.add(me).mag()/ne.sub(me).mag();le._perp()._mult(at*(ft?-1:1))}this.addCurrentVertex(q,le,0,0,k),this.addCurrentVertex(q,le.mult(-1),0,0,k)}else if(_t==="bevel"||_t==="fakeround"){const at=-Math.sqrt(He*He-1),et=ft?at:0,zt=ft?0:at;if(X&&this.addCurrentVertex(q,ne,et,zt,k),_t==="fakeround"){const Nt=Math.round(180*it/Math.PI/20);for(let qt=1;qt<Nt;qt++){let Ut=qt/Nt;if(Ut!==.5){const dn=Ut-.5;Ut+=Ut*dn*(Ut-1)*((1.0904+Te*(Te*(3.55645-1.43519*Te)-3.2452))*dn*dn+(.848013+Te*(.215638*Te-1.06021)))}const fi=me.sub(ne)._mult(Ut)._add(ne)._unit()._mult(ft?-1:1);this.addHalfVertex(q,fi.x,fi.y,!1,ft,0,k)}}Y&&this.addCurrentVertex(q,me,-et,-zt,k)}else if(_t==="butt")this.addCurrentVertex(q,le,0,0,k);else if(_t==="square"){const at=X?1:-1;this.addCurrentVertex(q,le,at,at,k)}else _t==="round"&&(X&&(this.addCurrentVertex(q,ne,0,0,k),this.addCurrentVertex(q,ne,1,1,k,!0)),Y&&(this.addCurrentVertex(q,me,-1,-1,k,!0),this.addCurrentVertex(q,me,0,0,k)));if(rt&&ie<P-1){const at=q.dist(Y);if(at>2*B){const et=q.add(Y.sub(q)._mult(B/at)._round());this.updateDistance(q,et),this.addCurrentVertex(et,me,0,0,k),q=et}}}}addCurrentVertex(e,n,l,h,p,g=!1){const b=n.y*h-n.x,T=-n.y-n.x*h;this.addHalfVertex(e,n.x+n.y*l,n.y-n.x*l,g,!1,l,p),this.addHalfVertex(e,b,T,g,!0,-h,p),this.distance>Vy/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,n,l,h,p,g))}addHalfVertex({x:e,y:n},l,h,p,g,b,T){const E=.5*(this.lineClips?this.scaledDistance*(Vy-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(n<<1)+(g?1:0),Math.round(63*l)+128,Math.round(63*h)+128,1+(b===0?0:b<0?-1:1)|(63&E)<<2,E>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const P=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,P,this.e2),T.primitiveLength++),g?this.e2=P:this.e1=P}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}hasLineDasharray(e){for(const n of e){const l=n.paint.get("line-dasharray");if(l&&!l.isConstant())return!0}return!1}addLineDashDependencies(e,n,l,h){for(const p of e){const g=p.paint.get("line-dasharray");if(!g||g.value.kind==="constant")continue;const b=p.layout.get("line-cap")==="round",T={dasharray:g.value.evaluate({zoom:l-1},n,{}),round:b},E={dasharray:g.value.evaluate({zoom:l},n,{}),round:b},P={dasharray:g.value.evaluate({zoom:l+1},n,{}),round:b},I=`${T.dasharray.join(",")},${T.round}`,B=`${E.dasharray.join(",")},${E.round}`,k=`${P.dasharray.join(",")},${P.round}`;h.dashDependencies[I]=T,h.dashDependencies[B]=E,h.dashDependencies[k]=P,n.dashes[p.id]={min:I,mid:B,max:k}}}}let Gy,Hy;Ft("LineBucket",dm,{omit:["layers","patternFeatures"]});var jy={get paint(){return Hy=Hy||new xr({"line-opacity":new Zt(oe.paint_line["line-opacity"]),"line-color":new Zt(oe.paint_line["line-color"]),"line-translate":new Ht(oe.paint_line["line-translate"]),"line-translate-anchor":new Ht(oe.paint_line["line-translate-anchor"]),"line-width":new Zt(oe.paint_line["line-width"]),"line-gap-width":new Zt(oe.paint_line["line-gap-width"]),"line-offset":new Zt(oe.paint_line["line-offset"]),"line-blur":new Zt(oe.paint_line["line-blur"]),"line-dasharray":new vl(oe.paint_line["line-dasharray"]),"line-pattern":new vl(oe.paint_line["line-pattern"]),"line-gradient":new Tc(oe.paint_line["line-gradient"])})},get layout(){return Gy=Gy||new xr({"line-cap":new Ht(oe.layout_line["line-cap"]),"line-join":new Zt(oe.layout_line["line-join"]),"line-miter-limit":new Ht(oe.layout_line["line-miter-limit"]),"line-round-limit":new Ht(oe.layout_line["line-round-limit"]),"line-sort-key":new Zt(oe.layout_line["line-sort-key"])})}};class Zw extends Zt{possiblyEvaluate(e,n){return n=new ji(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(e,n)}evaluate(e,n,l,h){return n=Dt({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,l,h)}}let gf;class $w extends Xr{constructor(e,n){super(e,jy,n),this.gradientVersion=0,gf||(gf=new Zw(jy.paint.properties["line-width"].specification),gf.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!(function(l){return l._styleExpression!==void 0})(n)&&n._styleExpression.expression instanceof Ks,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,n){super.recalculate(e,n),this.paint._values["line-floorwidth"]=gf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new dm(e)}queryRadius(e){const n=e,l=Wy(Lc("line-width",this,n),Lc("line-gap-width",this,n)),h=Lc("line-offset",this,n);return l/2+Math.abs(h)+uf(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:l,geometry:h,transform:p,pixelsToTileUnits:g}){const b=hf(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-p.bearingInRadians,g),T=g/2*Wy(this.paint.get("line-width").evaluate(n,l),this.paint.get("line-gap-width").evaluate(n,l)),E=this.paint.get("line-offset").evaluate(n,l);return E&&(h=(function(P,I){const B=[];for(let k=0;k<P.length;k++){const q=nw(P[k]),X=[];for(let Y=0;Y<q.length;Y++){const ne=q[Y],me=q[Y-1],ie=q[Y+1],le=Y===0?new M(0,0):ne.sub(me)._unit()._perp(),Te=Y===q.length-1?new M(0,0):ie.sub(ne)._unit()._perp(),Re=le._add(Te)._unit(),He=Re.x*Te.x+Re.y*Te.y;He!==0&&Re._mult(1/He),X.push(Re._mult(I)._add(ne))}B.push(X)}return B})(h,E*g)),(function(P,I,B){for(let k=0;k<I.length;k++){const q=I[k];if(P.length>=3){for(let X=0;X<q.length;X++)if(Dc(P,q[X]))return!0}if(ew(P,q,B))return!0}return!1})(b,h,T)}isTileClipped(){return!0}}function Wy(r,e){return e>0?e+2*r:r}const Yw=Mn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Kw=Mn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Mn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Jw=Mn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Mn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const qy=Mn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Qw=Mn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function e1(r,e,n){return r.sections.forEach((l=>{l.text=(function(h,p,g){const b=p.layout.get("text-transform").evaluate(g,{});return b==="uppercase"?h=h.toLocaleUpperCase():b==="lowercase"&&(h=h.toLocaleLowerCase()),ia.applyArabicShaping&&(h=ia.applyArabicShaping(h)),h})(l.text,e,n)})),r}Mn([{name:"triangle",components:3,type:"Uint16"}]),Mn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Mn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Mn([{type:"Float32",name:"offsetX"}]),Mn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Mn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var Wn=24;const Rh={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},t1={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},i1={40:!0};function Xy(r,e,n,l,h,p){if("fontStack"in e){const g=n[e.fontStack],b=g&&g[r];return b?b.metrics.advance*e.scale+h:0}{const g=l[e.imageName];return g?g.displaySize[0]*e.scale*Wn/p+h:0}}function Zy(r,e,n,l){const h=Math.pow(r-e,2);return l?r<e?h/2:2*h:h+Math.abs(n)*n}function n1(r,e,n){let l=0;return r===10&&(l-=1e4),n&&(l+=150),r!==40&&r!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function $y(r,e,n,l,h,p){let g=null,b=Zy(e,n,h,p);for(const T of l){const E=Zy(e-T.x,n,h,p)+T.badness;E<=b&&(g=T,b=E)}return{index:r,x:e,priorBreak:g,badness:b}}function Yy(r){return r?Yy(r.priorBreak).concat(r.index):[]}class Nc{constructor(e="",n=[],l=[]){this.text=e,this.sections=n,this.sectionIndex=l,this.imageSectionID=null}static fromFeature(e,n){const l=new Nc;for(let h=0;h<e.sections.length;h++){const p=e.sections[h];p.image?l.addImageSection(p):l.addTextSection(p,n)}return l}length(){return[...this.text].length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}verticalizePunctuation(){this.text=(function(e){let n="",l={premature:!0,value:void 0};const h=e[Symbol.iterator]();let p=h.next();const g=e[Symbol.iterator]();g.next();let b=g.next();for(;!p.done;)n+=!b.done&&oh(b.value.codePointAt(0))&&!Rh[b.value]||!l.premature&&oh(l.value.codePointAt(0))&&!Rh[l.value]||!Rh[p.value]?p.value:Rh[p.value],l={value:p.value,premature:!1},p=h.next(),b=g.next();return n})(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const e=this.text.match(/^\s*/),n=e?e[0].length:0,l=this.text.match(/\S\s*$/),h=l?l[0].length-1:0;this.text=this.text.substring(n,this.text.length-h),this.sectionIndex=this.sectionIndex.slice(n,this.sectionIndex.length-h)}substring(e,n){const l=[...this.text].slice(e,n).join(""),h=this.sectionIndex.slice(e,n);return new Nc(l,this.sections,h)}toCodeUnitIndex(e){return[...this.text].slice(0,e).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,n)=>Math.max(e,this.sections[n].scale)),0)}getMaxImageSize(e){let n=0,l=0;for(let h=0;h<this.length();h++){const p=this.getSection(h);if("imageName"in p){const g=e[p.imageName];if(!g)continue;const b=g.displaySize;n=Math.max(n,b[0]),l=Math.max(l,b[1])}}return{maxImageWidth:n,maxImageHeight:l}}addTextSection(e,n){this.text+=e.text,this.sections.push({scale:e.scale||1,verticalAlign:e.verticalAlign||"bottom",fontStack:e.fontStack||n});const l=this.sections.length-1;this.sectionIndex.push(...[...e.text].map((()=>l)))}addImageSection(e){const n=e.image?e.image.name:"";if(n.length===0)return void ci("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push({scale:1,verticalAlign:e.verticalAlign||"bottom",imageName:n}),this.sectionIndex.push(this.sections.length-1)):ci("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(e,n,l,h,p){const g=[],b=this.determineAverageLineWidth(e,n,l,h,p),T=this.hasZeroWidthSpaces();let E=0,P=0;const I=this.text[Symbol.iterator]();let B=I.next();const k=this.text[Symbol.iterator]();k.next();let q=k.next();const X=this.text[Symbol.iterator]();X.next(),X.next();let Y=X.next();for(;!B.done;){const ne=this.getSection(P),me=B.value.codePointAt(0);if(Kd(me)||(E+=Xy(me,ne,l,h,e,p)),!q.done){const ie=_l(me),le=q.value.codePointAt(0);(t1[me]||ie||"imageName"in ne||!Y.done&&i1[le])&&g.push($y(P+1,E,b,g,n1(me,le,ie&&T),!1))}P++,B=I.next(),q=k.next(),Y=X.next()}return Yy($y(this.length(),E,b,g,0,!0))}determineAverageLineWidth(e,n,l,h,p){let g=0,b=0;for(const T of this.text){const E=this.getSection(b);g+=Xy(T.codePointAt(0),E,l,h,e,p),b++}return g/Math.max(1,Math.ceil(g/n))}}const fm=4294967296,Ky=1/fm,Jy=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class _f{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,n,l=this.length){for(;this.pos<l;){const h=this.readVarint(),p=h>>3,g=this.pos;this.type=7&h,e(p,n,this),this.pos===g&&this.skip(h)}return n}readMessage(e,n){return this.readFields(e,n,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*fm;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*fm;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const n=this.buf;let l,h;return h=n[this.pos++],l=127&h,h<128?l:(h=n[this.pos++],l|=(127&h)<<7,h<128?l:(h=n[this.pos++],l|=(127&h)<<14,h<128?l:(h=n[this.pos++],l|=(127&h)<<21,h<128?l:(h=n[this.pos],l|=(15&h)<<28,(function(p,g,b){const T=b.buf;let E,P;if(P=T[b.pos++],E=(112&P)>>4,P<128||(P=T[b.pos++],E|=(127&P)<<3,P<128)||(P=T[b.pos++],E|=(127&P)<<10,P<128)||(P=T[b.pos++],E|=(127&P)<<17,P<128)||(P=T[b.pos++],E|=(127&P)<<24,P<128)||(P=T[b.pos++],E|=(1&P)<<31,P<128))return Bc(p,E,g);throw new Error("Expected varint not more than 10 bytes")})(l,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){const e=this.readVarint()+this.pos,n=this.pos;return this.pos=e,e-n>=12&&Jy?Jy.decode(this.buf.subarray(n,e)):(function(l,h,p){let g="",b=h;for(;b<p;){const T=l[b];let E,P,I,B=null,k=T>239?4:T>223?3:T>191?2:1;if(b+k>p)break;k===1?T<128&&(B=T):k===2?(E=l[b+1],(192&E)==128&&(B=(31&T)<<6|63&E,B<=127&&(B=null))):k===3?(E=l[b+1],P=l[b+2],(192&E)==128&&(192&P)==128&&(B=(15&T)<<12|(63&E)<<6|63&P,(B<=2047||B>=55296&&B<=57343)&&(B=null))):k===4&&(E=l[b+1],P=l[b+2],I=l[b+3],(192&E)==128&&(192&P)==128&&(192&I)==128&&(B=(15&T)<<18|(63&E)<<12|(63&P)<<6|63&I,(B<=65535||B>=1114112)&&(B=null))),B===null?(B=65533,k=1):B>65535&&(B-=65536,g+=String.fromCharCode(B>>>10&1023|55296),B=56320|1023&B),g+=String.fromCharCode(B),b+=k}return g})(this.buf,n,e)}readBytes(){const e=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,e);return this.pos=e,n}readPackedVarint(e=[],n){const l=this.readPackedEnd();for(;this.pos<l;)e.push(this.readVarint(n));return e}readPackedSVarint(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(e){const n=7&e;if(n===0)for(;this.buf[this.pos++]>127;);else if(n===2)this.pos=this.readVarint()+this.pos;else if(n===5)this.pos+=4;else{if(n!==1)throw new Error(`Unimplemented type: ${n}`);this.pos+=8}}writeTag(e,n){this.writeVarint(e<<3|n)}realloc(e){let n=this.length||16;for(;n<this.pos+e;)n*=2;if(n!==this.length){const l=new Uint8Array(n);l.set(this.buf),this.buf=l,this.dataView=new DataView(l.buffer),this.length=n}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Ky),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Ky),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?(function(n,l){let h,p;if(n>=0?(h=n%4294967296|0,p=n/4294967296|0):(h=~(-n%4294967296),p=~(-n/4294967296),4294967295^h?h=h+1|0:(h=0,p=p+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),(function(g,b,T){T.buf[T.pos++]=127&g|128,g>>>=7,T.buf[T.pos++]=127&g|128,g>>>=7,T.buf[T.pos++]=127&g|128,g>>>=7,T.buf[T.pos++]=127&g|128,T.buf[T.pos]=127&(g>>>=7)})(h,0,l),(function(g,b){const T=(7&g)<<4;b.buf[b.pos++]|=T|((g>>>=3)?128:0),g&&(b.buf[b.pos++]=127&g|((g>>>=7)?128:0),g&&(b.buf[b.pos++]=127&g|((g>>>=7)?128:0),g&&(b.buf[b.pos++]=127&g|((g>>>=7)?128:0),g&&(b.buf[b.pos++]=127&g|((g>>>=7)?128:0),g&&(b.buf[b.pos++]=127&g)))))})(p,l)})(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const n=this.pos;this.pos=(function(h,p,g){for(let b,T,E=0;E<p.length;E++){if(b=p.charCodeAt(E),b>55295&&b<57344){if(!T){b>56319||E+1===p.length?(h[g++]=239,h[g++]=191,h[g++]=189):T=b;continue}if(b<56320){h[g++]=239,h[g++]=191,h[g++]=189,T=b;continue}b=T-55296<<10|b-56320|65536,T=null}else T&&(h[g++]=239,h[g++]=191,h[g++]=189,T=null);b<128?h[g++]=b:(b<2048?h[g++]=b>>6|192:(b<65536?h[g++]=b>>12|224:(h[g++]=b>>18|240,h[g++]=b>>12&63|128),h[g++]=b>>6&63|128),h[g++]=63&b|128)}return g})(this.buf,e,this.pos);const l=this.pos-n;l>=128&&Qy(n,l,this),this.pos=n-1,this.writeVarint(l),this.pos+=l}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const n=e.length;this.writeVarint(n),this.realloc(n);for(let l=0;l<n;l++)this.buf[this.pos++]=e[l]}writeRawMessage(e,n){this.pos++;const l=this.pos;e(n,this);const h=this.pos-l;h>=128&&Qy(l,h,this),this.pos=l-1,this.writeVarint(h),this.pos+=h}writeMessage(e,n,l){this.writeTag(e,2),this.writeRawMessage(n,l)}writePackedVarint(e,n){n.length&&this.writeMessage(e,r1,n)}writePackedSVarint(e,n){n.length&&this.writeMessage(e,s1,n)}writePackedBoolean(e,n){n.length&&this.writeMessage(e,l1,n)}writePackedFloat(e,n){n.length&&this.writeMessage(e,a1,n)}writePackedDouble(e,n){n.length&&this.writeMessage(e,o1,n)}writePackedFixed32(e,n){n.length&&this.writeMessage(e,c1,n)}writePackedSFixed32(e,n){n.length&&this.writeMessage(e,u1,n)}writePackedFixed64(e,n){n.length&&this.writeMessage(e,h1,n)}writePackedSFixed64(e,n){n.length&&this.writeMessage(e,d1,n)}writeBytesField(e,n){this.writeTag(e,2),this.writeBytes(n)}writeFixed32Field(e,n){this.writeTag(e,5),this.writeFixed32(n)}writeSFixed32Field(e,n){this.writeTag(e,5),this.writeSFixed32(n)}writeFixed64Field(e,n){this.writeTag(e,1),this.writeFixed64(n)}writeSFixed64Field(e,n){this.writeTag(e,1),this.writeSFixed64(n)}writeVarintField(e,n){this.writeTag(e,0),this.writeVarint(n)}writeSVarintField(e,n){this.writeTag(e,0),this.writeSVarint(n)}writeStringField(e,n){this.writeTag(e,2),this.writeString(n)}writeFloatField(e,n){this.writeTag(e,5),this.writeFloat(n)}writeDoubleField(e,n){this.writeTag(e,1),this.writeDouble(n)}writeBooleanField(e,n){this.writeVarintField(e,+n)}}function Bc(r,e,n){return n?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function Qy(r,e,n){const l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(l);for(let h=n.pos-1;h>=r;h--)n.buf[h+l]=n.buf[h]}function r1(r,e){for(let n=0;n<r.length;n++)e.writeVarint(r[n])}function s1(r,e){for(let n=0;n<r.length;n++)e.writeSVarint(r[n])}function a1(r,e){for(let n=0;n<r.length;n++)e.writeFloat(r[n])}function o1(r,e){for(let n=0;n<r.length;n++)e.writeDouble(r[n])}function l1(r,e){for(let n=0;n<r.length;n++)e.writeBoolean(r[n])}function c1(r,e){for(let n=0;n<r.length;n++)e.writeFixed32(r[n])}function u1(r,e){for(let n=0;n<r.length;n++)e.writeSFixed32(r[n])}function h1(r,e){for(let n=0;n<r.length;n++)e.writeFixed64(r[n])}function d1(r,e){for(let n=0;n<r.length;n++)e.writeSFixed64(r[n])}function f1(r,e,n){r===1&&n.readMessage(p1,e)}function p1(r,e,n){if(r===3){const{id:l,bitmap:h,width:p,height:g,left:b,top:T,advance:E}=n.readMessage(m1,{});e.push({id:l,bitmap:new bh({width:p+6,height:g+6},h),metrics:{width:p,height:g,left:b,top:T,advance:E}})}}function m1(r,e,n){r===1?e.id=n.readVarint():r===2?e.bitmap=n.readBytes():r===3?e.width=n.readVarint():r===4?e.height=n.readVarint():r===5?e.left=n.readSVarint():r===6?e.top=n.readSVarint():r===7&&(e.advance=n.readVarint())}function ex(r){let e=0,n=0;for(const g of r)e+=g.w*g.h,n=Math.max(n,g.w);r.sort(((g,b)=>b.h-g.h));const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let h=0,p=0;for(const g of r)for(let b=l.length-1;b>=0;b--){const T=l[b];if(!(g.w>T.w||g.h>T.h)){if(g.x=T.x,g.y=T.y,p=Math.max(p,g.y+g.h),h=Math.max(h,g.x+g.w),g.w===T.w&&g.h===T.h){const E=l.pop();E&&b<l.length&&(l[b]=E)}else g.h===T.h?(T.x+=g.w,T.w-=g.w):g.w===T.w?(T.y+=g.h,T.h-=g.h):(l.push({x:T.x+g.w,y:T.y,w:T.w-g.w,h:g.h}),T.y+=g.h,T.h-=g.h);break}}return{w:h,h:p,fill:e/(h*p)||0}}class pm{constructor(e,{pixelRatio:n,version:l,stretchX:h,stretchY:p,content:g,textFitWidth:b,textFitHeight:T}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=h,this.stretchY=p,this.content=g,this.version=l,this.textFitWidth=b,this.textFitHeight=T}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class tx{constructor(e,n){const l={},h={};this.haveRenderCallbacks=[];const p=[];this.addImages(e,l,p),this.addImages(n,h,p);const{w:g,h:b}=ex(p),T=new Or({width:g||1,height:b||1});for(const E in e){const P=e[E],I=l[E].paddedRect;Or.copy(P.data,T,{x:0,y:0},{x:I.x+1,y:I.y+1},P.data)}for(const E in n){const P=n[E],I=h[E].paddedRect,B=I.x+1,k=I.y+1,q=P.data.width,X=P.data.height;Or.copy(P.data,T,{x:0,y:0},{x:B,y:k},P.data),Or.copy(P.data,T,{x:0,y:X-1},{x:B,y:k-1},{width:q,height:1}),Or.copy(P.data,T,{x:0,y:0},{x:B,y:k+X},{width:q,height:1}),Or.copy(P.data,T,{x:q-1,y:0},{x:B-1,y:k},{width:1,height:X}),Or.copy(P.data,T,{x:0,y:0},{x:B+q,y:k},{width:1,height:X})}this.image=T,this.iconPositions=l,this.patternPositions=h}addImages(e,n,l){for(const h in e){const p=e[h],g={x:0,y:0,w:p.data.width+2,h:p.data.height+2};l.push(g),n[h]=new pm(g,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(e,n){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in e.updatedImages)this.patchUpdatedImage(this.iconPositions[l],e.getImage(l),n),this.patchUpdatedImage(this.patternPositions[l],e.getImage(l),n)}patchUpdatedImage(e,n,l){if(!e||!n||e.version===n.version)return;e.version=n.version;const[h,p]=e.tl;l.update(n.data,void 0,{x:h,y:p})}}var Do;function yf(r,e,n,l,h,p,g,b,T,E,P,I,B,k,q){const X=Nc.fromFeature(r,h);let Y;I===_.az.vertical&&X.verticalizePunctuation();let ne=X.determineLineBreaks(E,p,e,l,k);const{processBidirectionalText:me,processStyledBidirectionalText:ie}=ia;if(me&&X.sections.length===1){Y=[],ne=ne.map((He=>X.toCodeUnitIndex(He)));const Re=me(X.toString(),ne);for(const He of Re){const it=[...He].map((()=>0));Y.push(new Nc(He,X.sections,it))}}else if(ie){Y=[],ne=ne.map((rt=>X.toCodeUnitIndex(rt)));let Re=0;const He=[];for(const rt of X.text)He.push(...Array(rt.length).fill(X.sectionIndex[Re])),Re++;const it=ie(X.text,He,ne);for(const rt of it){const ft=[];let St="";for(const _t of rt[0])ft.push(rt[1][St.length]),St+=_t;Y.push(new Nc(rt[0],X.sections,ft))}}else Y=(function(Re,He){const it=[];let rt=0;for(const ft of He)it.push(Re.substring(rt,ft)),rt=ft;return rt<Re.length()&&it.push(Re.substring(rt,Re.length())),it})(X,ne);const le=[],Te={positionedLines:le,text:X.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:I,iconsInText:!1,verticalizable:!1};return(function(Re,He,it,rt,ft,St,_t,at,et,zt,Nt,qt){let Ut=0,fi=0,dn=0,On=0;const cr=at==="right"?1:at==="left"?0:.5,ws=Wn/qt;let Ir=0;for(const Cn of ft){Cn.trim();const tr=Cn.getMaxScale(),br={positionedGlyphs:[],lineOffset:0};Re.positionedLines[Ir]=br;const wr=br.positionedGlyphs;let Nr=0;if(!Cn.length()){fi+=St,++Ir;continue}const hr=g1(rt,Cn,ws);let Br=0;for(const Xn of Cn.text){const gn=Cn.getSection(Br),Nn=Xn.codePointAt(0),vn=_1(et,Nt,Nn),Zn={glyph:Nn,imageName:null,x:Ut,y:fi+-17,vertical:vn,scale:1,fontStack:"",sectionIndex:Cn.getSectionIndex(Br),metrics:null,rect:null};let Wa;if("fontStack"in gn){if(Wa=y1(gn,Nn,vn,hr,He,it),!Wa)continue;Zn.fontStack=gn.fontStack}else{if(Re.iconsInText=!0,gn.scale*=ws,Wa=x1(gn,vn,tr,hr,rt),!Wa)continue;Nr=Math.max(Nr,Wa.imageOffset),Zn.imageName=gn.imageName}const{rect:Os,metrics:Bh,baselineOffset:Bo}=Wa;Zn.y+=Bo,Zn.scale=gn.scale,Zn.metrics=Bh,Zn.rect=Os,wr.push(Zn),vn?(Re.verticalizable=!0,Ut+=("imageName"in gn?Bh.advance:Wn)*gn.scale+zt):Ut+=Bh.advance*gn.scale+zt,Br++}wr.length!==0&&(dn=Math.max(Ut-zt,dn),v1(wr,0,wr.length-1,cr)),Ut=0,br.lineOffset=Math.max(Nr,(tr-1)*Wn);const Ts=St*tr+Nr;fi+=Ts,On=Math.max(Ts,On),++Ir}const{horizontalAlign:er,verticalAlign:ur}=mm(_t);(function(Cn,tr,br,wr,Nr,hr,Br,Ts,Xn){const gn=(tr-br)*Nr;let Nn=0;Nn=hr!==Br?-Ts*wr- -17:-wr*Xn*Br+.5*Br;for(const vn of Cn)for(const Zn of vn.positionedGlyphs)Zn.x+=gn,Zn.y+=Nn})(Re.positionedLines,cr,er,ur,dn,On,St,fi,ft.length),Re.top+=-ur*fi,Re.bottom=Re.top+fi,Re.left+=-er*dn,Re.right=Re.left+dn})(Te,e,n,l,Y,g,b,T,I,E,B,q),!(function(Re){for(const He of Re)if(He.positionedGlyphs.length!==0)return!1;return!0})(le)&&Te}function mm(r){let e=.5,n=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function g1(r,e,n){const l=e.getMaxScale()*Wn,{maxImageWidth:h,maxImageHeight:p}=e.getMaxImageSize(r),g=Math.max(l,p*n);return{verticalLineContentWidth:Math.max(l,h*n),horizontalLineContentHeight:g}}function ix(r){switch(r){case"top":return 0;case"center":return .5;default:return 1}}function _1(r,e,n){return!(r===_.az.horizontal||!e&&!ah(n)||e&&(Kd(n)||(l=n,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(l)))));var l}function y1(r,e,n,l,h,p){const g=p[r.fontStack],b=(function(E,P,I,B){if(E&&E.rect)return E;const k=P[I.fontStack],q=k&&k[B];return q?{rect:null,metrics:q.metrics}:null})(g&&g[e],h,r,e);if(b===null)return null;let T;if(n)T=l.verticalLineContentWidth-r.scale*Wn;else{const E=ix(r.verticalAlign);T=(l.horizontalLineContentHeight-r.scale*Wn)*E}return{rect:b.rect,metrics:b.metrics,baselineOffset:T}}function x1(r,e,n,l,h){const p=h[r.imageName];if(!p)return null;const g=p.paddedRect,b=p.displaySize,T={width:b[0],height:b[1],left:1,top:-3,advance:e?b[1]:b[0]};let E;if(e)E=l.verticalLineContentWidth-b[1]*r.scale;else{const P=ix(r.verticalAlign);E=(l.horizontalLineContentHeight-b[1]*r.scale)*P}return{rect:g,metrics:T,baselineOffset:E,imageOffset:(e?b[0]:b[1])*r.scale-Wn*n}}function v1(r,e,n,l){if(l===0)return;const h=r[n],p=(r[n].x+h.metrics.advance*h.scale)*l;for(let g=e;g<=n;g++)r[g].x-=p}function b1(r,e,n){const{horizontalAlign:l,verticalAlign:h}=mm(n),p=e[0]-r.displaySize[0]*l,g=e[1]-r.displaySize[1]*h;return{image:r,top:g,bottom:g+r.displaySize[1],left:p,right:p+r.displaySize[0]}}function nx(r){var e,n;let l=r.left,h=r.top,p=r.right-l,g=r.bottom-h;const b=(e=r.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",T=(n=r.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",E=(r.image.content[2]-r.image.content[0])/(r.image.content[3]-r.image.content[1]);if(T==="proportional"){if(b==="stretchOnly"&&p/g<E||b==="proportional"){const P=Math.ceil(g*E);l*=P/p,p=P}}else if(b==="proportional"&&T==="stretchOnly"&&E!==0&&p/g>E){const P=Math.ceil(p/E);h*=P/g,g=P}return{x1:l,y1:h,x2:l+p,y2:h+g}}function rx(r,e,n,l,h,p){const g=r.image;let b;if(g.content){const Y=g.content,ne=g.pixelRatio||1;b=[Y[0]/ne,Y[1]/ne,g.displaySize[0]-Y[2]/ne,g.displaySize[1]-Y[3]/ne]}const T=e.left*p,E=e.right*p;let P,I,B,k;n==="width"||n==="both"?(k=h[0]+T-l[3],I=h[0]+E+l[1]):(k=h[0]+(T+E-g.displaySize[0])/2,I=k+g.displaySize[0]);const q=e.top*p,X=e.bottom*p;return n==="height"||n==="both"?(P=h[1]+q-l[0],B=h[1]+X+l[2]):(P=h[1]+(q+X-g.displaySize[1])/2,B=P+g.displaySize[1]),{image:g,top:P,right:I,bottom:B,left:k,collisionPadding:b}}Ft("ImagePosition",pm),Ft("ImageAtlas",tx),_.az=void 0,(Do=_.az||(_.az={}))[Do.none=0]="none",Do[Do.horizontal=1]="horizontal",Do[Do.vertical=2]="vertical",Do[Do.horizontalOnly=3]="horizontalOnly";const ja=128,Lo=32640;function sx(r,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new ji(r+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:h}=n;let p=0;for(;p<l.length&&l[p]<=r;)p++;p=Math.max(0,p-1);let g=p;for(;g<l.length&&l[g]<r+1;)g++;g=Math.min(l.length-1,g);const b=l[p],T=l[g];return n.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:T,interpolationType:h}:{kind:"camera",minZoom:b,maxZoom:T,minSize:n.evaluate(new ji(b)),maxSize:n.evaluate(new ji(T)),interpolationType:h}}}function gm(r,e,n){let l="never";const h=r.get(e);return h?l=h:r.get(n)&&(l="always"),l}const w1=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function xf(r,e,n,l,h,p,g,b,T,E,P,I,B){const k=b?Math.min(Lo,Math.round(b[0])):0,q=b?Math.min(Lo,Math.round(b[1])):0;r.emplaceBack(e,n,Math.round(32*l),Math.round(32*h),p,g,(k<<1)+(T?1:0),q,16*E,16*P,256*I,256*B)}function _m(r,e,n){r.emplaceBack(e.x,e.y,n),r.emplaceBack(e.x,e.y,n),r.emplaceBack(e.x,e.y,n),r.emplaceBack(e.x,e.y,n)}function T1(r){for(const e of r.sections)if(ef(e.text))return!0;return!1}class ym{constructor(e){this.layoutVertexArray=new we,this.indexArray=new Ze,this.programConfigurations=e,this.segments=new Mt,this.dynamicLayoutVertexArray=new Be,this.opacityVertexArray=new Ye,this.hasVisibleVertices=!1,this.placedSymbolArray=new w}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,l,h){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Yw.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Kw.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,w1,!0),this.opacityVertexBuffer.itemSize=1),(l||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ft("SymbolBuffers",ym);class xm{constructor(e,n,l){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new l,this.segments=new Mt,this.collisionVertexArray=new Xe}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Jw.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ft("CollisionBuffers",xm);class kc{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((g=>g.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=sx(this.zoom,n["text-size"]),this.iconSizeData=sx(this.zoom,n["icon-size"]);const l=this.layers[0].layout,h=l.get("symbol-sort-key"),p=l.get("symbol-z-order");this.canOverlap=gm(l,"text-overlap","text-allow-overlap")!=="never"||gm(l,"icon-overlap","icon-allow-overlap")!=="never"||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&!h.isConstant(),this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,l.get("symbol-placement")==="point"&&(this.writingModes=l.get("text-writing-mode").map((g=>_.az[g]))),this.stateDependentLayerIds=this.layers.filter((g=>g.isStateDependent())).map((g=>g.id)),this.sourceID=e.sourceID}createArrays(){this.text=new ym(new Ha(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new ym(new Ha(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new R,this.lineVertexArray=new z,this.symbolInstances=new A,this.textAnchorOffsets=new V}calculateGlyphDependencies(e,n,l,h,p){for(const g of e)if(n[g.codePointAt(0)]=!0,(l||h)&&p){const b=Rh[g];b&&(n[b.codePointAt(0)]=!0)}}populate(e,n,l){const h=this.layers[0],p=h.layout,g=p.get("text-font"),b=p.get("text-field"),T=p.get("icon-image"),E=(b.value.kind!=="constant"||b.value.value instanceof Mr&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),P=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,I=p.get("symbol-sort-key");if(this.features=[],!E&&!P)return;const B=n.iconDependencies,k=n.glyphDependencies,q=n.availableImages,X=new ji(this.zoom);for(const{feature:Y,id:ne,index:me,sourceLayerIndex:ie}of e){const le=h._featureFilter.needGeometry,Te=aa(Y,le);if(!h._featureFilter.filter(X,Te,l))continue;let Re,He;if(le||(Te.geometry=sa(Y)),E){const rt=h.getValueAndResolveTokens("text-field",Te,l,q),ft=Mr.factory(rt),St=this.hasRTLText=this.hasRTLText||T1(ft);(!St||ia.getRTLTextPluginStatus()==="unavailable"||St&&ia.isParsed())&&(Re=e1(ft,h,Te))}if(P){const rt=h.getValueAndResolveTokens("icon-image",Te,l,q);He=rt instanceof Fr?rt:Fr.fromString(rt)}if(!Re&&!He)continue;const it=this.sortFeaturesByKey?I.evaluate(Te,{},l):void 0;if(this.features.push({id:ne,text:Re,icon:He,index:me,sourceLayerIndex:ie,geometry:Te.geometry,properties:Y.properties,type:Ch.types[Y.type],sortKey:it}),He&&(B[He.name]=!0),Re){const rt=g.evaluate(Te,{},l).join(","),ft=p.get("text-rotation-alignment")!=="viewport"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(_.az.vertical)>=0;for(const St of Re.sections)if(St.image)B[St.image.name]=!0;else{const _t=Io(Re.toString()),at=St.fontStack||rt,et=k[at]=k[at]||{};this.calculateGlyphDependencies(St.text,et,ft,this.allowVerticalPlacement,_t)}}}p.get("symbol-placement")==="line"&&(this.features=(function(Y){const ne={},me={},ie=[];let le=0;function Te(rt){ie.push(Y[rt]),le++}function Re(rt,ft,St){const _t=me[rt];return delete me[rt],me[ft]=_t,ie[_t].geometry[0].pop(),ie[_t].geometry[0]=ie[_t].geometry[0].concat(St[0]),_t}function He(rt,ft,St){const _t=ne[ft];return delete ne[ft],ne[rt]=_t,ie[_t].geometry[0].shift(),ie[_t].geometry[0]=St[0].concat(ie[_t].geometry[0]),_t}function it(rt,ft,St){const _t=St?ft[0][ft[0].length-1]:ft[0][0];return`${rt}:${_t.x}:${_t.y}`}for(let rt=0;rt<Y.length;rt++){const ft=Y[rt],St=ft.geometry,_t=ft.text?ft.text.toString():null;if(!_t){Te(rt);continue}const at=it(_t,St),et=it(_t,St,!0);if(at in me&&et in ne&&me[at]!==ne[et]){const zt=He(at,et,St),Nt=Re(at,et,ie[zt].geometry);delete ne[at],delete me[et],me[it(_t,ie[Nt].geometry,!0)]=Nt,ie[zt].geometry=null}else at in me?Re(at,et,St):et in ne?He(at,et,St):(Te(rt),ne[at]=le-1,me[et]=le-1)}return ie.filter((rt=>rt.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((Y,ne)=>Y.sortKey-ne.sortKey))}update(e,n,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,{imagePositions:l}),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,{imagePositions:l}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const l=this.lineVertexArray.length;if(e.segment!==void 0){let h=e.dist(n[e.segment+1]),p=e.dist(n[e.segment]);const g={};for(let b=e.segment+1;b<n.length;b++)g[b]={x:n[b].x,y:n[b].y,tileUnitDistanceFromAnchor:h},b<n.length-1&&(h+=n[b+1].dist(n[b]));for(let b=e.segment||0;b>=0;b--)g[b]={x:n[b].x,y:n[b].y,tileUnitDistanceFromAnchor:p},b>0&&(p+=n[b-1].dist(n[b]));for(let b=0;b<n.length;b++){const T=g[b];this.lineVertexArray.emplaceBack(T.x,T.y,T.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,n,l,h,p,g,b,T,E,P,I,B){const k=e.indexArray,q=e.layoutVertexArray,X=e.segments.prepareSegment(4*n.length,q,k,this.canOverlap?g.sortKey:void 0),Y=this.glyphOffsetArray.length,ne=X.vertexLength,me=this.allowVerticalPlacement&&b===_.az.vertical?Math.PI/2:0,ie=g.text&&g.text.sections;for(let le=0;le<n.length;le++){const{tl:Te,tr:Re,bl:He,br:it,tex:rt,pixelOffsetTL:ft,pixelOffsetBR:St,minFontScaleX:_t,minFontScaleY:at,glyphOffset:et,isSDF:zt,sectionIndex:Nt}=n[le],qt=X.vertexLength,Ut=et[1];xf(q,T.x,T.y,Te.x,Ut+Te.y,rt.x,rt.y,l,zt,ft.x,ft.y,_t,at),xf(q,T.x,T.y,Re.x,Ut+Re.y,rt.x+rt.w,rt.y,l,zt,St.x,ft.y,_t,at),xf(q,T.x,T.y,He.x,Ut+He.y,rt.x,rt.y+rt.h,l,zt,ft.x,St.y,_t,at),xf(q,T.x,T.y,it.x,Ut+it.y,rt.x+rt.w,rt.y+rt.h,l,zt,St.x,St.y,_t,at),_m(e.dynamicLayoutVertexArray,T,me),k.emplaceBack(qt,qt+2,qt+1),k.emplaceBack(qt+1,qt+2,qt+3),X.vertexLength+=4,X.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(et[0]),le!==n.length-1&&Nt===n[le+1].sectionIndex||e.programConfigurations.populatePaintArrays(q.length,g,g.index,{imagePositions:{},canonical:B,formattedSection:ie&&ie[Nt]})}e.placedSymbolArray.emplaceBack(T.x,T.y,Y,this.glyphOffsetArray.length-Y,ne,E,P,T.segment,l?l[0]:0,l?l[1]:0,h[0],h[1],b,0,!1,0,I)}_addCollisionDebugVertex(e,n,l,h,p,g){return n.emplaceBack(0,0),e.emplaceBack(l.x,l.y,h,p,Math.round(g.x),Math.round(g.y))}addCollisionDebugVertices(e,n,l,h,p,g,b){const T=p.segments.prepareSegment(4,p.layoutVertexArray,p.indexArray),E=T.vertexLength,P=p.layoutVertexArray,I=p.collisionVertexArray,B=b.anchorX,k=b.anchorY;this._addCollisionDebugVertex(P,I,g,B,k,new M(e,n)),this._addCollisionDebugVertex(P,I,g,B,k,new M(l,n)),this._addCollisionDebugVertex(P,I,g,B,k,new M(l,h)),this._addCollisionDebugVertex(P,I,g,B,k,new M(e,h)),T.vertexLength+=4;const q=p.indexArray;q.emplaceBack(E,E+1),q.emplaceBack(E+1,E+2),q.emplaceBack(E+2,E+3),q.emplaceBack(E+3,E),T.primitiveLength+=4}addDebugCollisionBoxes(e,n,l,h){for(let p=e;p<n;p++){const g=this.collisionBoxArray.get(p);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,h?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,l)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new xm(je,qy.members,bt),this.iconCollisionBox=new xm(je,qy.members,bt);for(let e=0;e<this.symbolInstances.length;e++){const n=this.symbolInstances.get(e);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(e,n,l,h,p,g,b,T,E){const P={};for(let I=n;I<l;I++){const B=e.get(I);P.textBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},P.textFeatureIndex=B.featureIndex;break}for(let I=h;I<p;I++){const B=e.get(I);P.verticalTextBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},P.verticalTextFeatureIndex=B.featureIndex;break}for(let I=g;I<b;I++){const B=e.get(I);P.iconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},P.iconFeatureIndex=B.featureIndex;break}for(let I=T;I<E;I++){const B=e.get(I);P.verticalIconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},P.verticalIconFeatureIndex=B.featureIndex;break}return P}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const l=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const l=e.placedSymbolArray.get(n),h=l.vertexStartIndex+4*l.numGlyphs;for(let p=l.vertexStartIndex;p<h;p+=4)e.indexArray.emplaceBack(p,p+2,p+1),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),l=Math.cos(e),h=[],p=[],g=[];for(let b=0;b<this.symbolInstances.length;++b){g.push(b);const T=this.symbolInstances.get(b);h.push(0|Math.round(n*T.anchorX+l*T.anchorY)),p.push(T.featureIndex)}return g.sort(((b,T)=>h[b]-h[T]||p[T]-p[b])),g}addToSortKeyRanges(e,n){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===n?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const l=this.symbolInstances.get(n);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach(((h,p,g)=>{h>=0&&g.indexOf(h)===p&&this.addIndicesForPlacedSymbol(this.text,h)})),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let ax,ox;Ft("SymbolBucket",kc,{omit:["layers","collisionBoxArray","features","compareText"]}),kc.MAX_GLYPHS=65535,kc.addDynamicAttributes=_m;var vm={get paint(){return ox=ox||new xr({"icon-opacity":new Zt(oe.paint_symbol["icon-opacity"]),"icon-color":new Zt(oe.paint_symbol["icon-color"]),"icon-halo-color":new Zt(oe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Zt(oe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Zt(oe.paint_symbol["icon-halo-blur"]),"icon-translate":new Ht(oe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ht(oe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Zt(oe.paint_symbol["text-opacity"]),"text-color":new Zt(oe.paint_symbol["text-color"],{runtimeType:Vn,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new Zt(oe.paint_symbol["text-halo-color"]),"text-halo-width":new Zt(oe.paint_symbol["text-halo-width"]),"text-halo-blur":new Zt(oe.paint_symbol["text-halo-blur"]),"text-translate":new Ht(oe.paint_symbol["text-translate"]),"text-translate-anchor":new Ht(oe.paint_symbol["text-translate-anchor"])})},get layout(){return ax=ax||new xr({"symbol-placement":new Ht(oe.layout_symbol["symbol-placement"]),"symbol-spacing":new Ht(oe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ht(oe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Zt(oe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ht(oe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ht(oe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ht(oe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ht(oe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ht(oe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ht(oe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Zt(oe.layout_symbol["icon-size"]),"icon-text-fit":new Ht(oe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ht(oe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Zt(oe.layout_symbol["icon-image"]),"icon-rotate":new Zt(oe.layout_symbol["icon-rotate"]),"icon-padding":new Zt(oe.layout_symbol["icon-padding"]),"icon-keep-upright":new Ht(oe.layout_symbol["icon-keep-upright"]),"icon-offset":new Zt(oe.layout_symbol["icon-offset"]),"icon-anchor":new Zt(oe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ht(oe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ht(oe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ht(oe.layout_symbol["text-rotation-alignment"]),"text-field":new Zt(oe.layout_symbol["text-field"]),"text-font":new Zt(oe.layout_symbol["text-font"]),"text-size":new Zt(oe.layout_symbol["text-size"]),"text-max-width":new Zt(oe.layout_symbol["text-max-width"]),"text-line-height":new Ht(oe.layout_symbol["text-line-height"]),"text-letter-spacing":new Zt(oe.layout_symbol["text-letter-spacing"]),"text-justify":new Zt(oe.layout_symbol["text-justify"]),"text-radial-offset":new Zt(oe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ht(oe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Zt(oe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Zt(oe.layout_symbol["text-anchor"]),"text-max-angle":new Ht(oe.layout_symbol["text-max-angle"]),"text-writing-mode":new Ht(oe.layout_symbol["text-writing-mode"]),"text-rotate":new Zt(oe.layout_symbol["text-rotate"]),"text-padding":new Ht(oe.layout_symbol["text-padding"]),"text-keep-upright":new Ht(oe.layout_symbol["text-keep-upright"]),"text-transform":new Zt(oe.layout_symbol["text-transform"]),"text-offset":new Zt(oe.layout_symbol["text-offset"]),"text-allow-overlap":new Ht(oe.layout_symbol["text-allow-overlap"]),"text-overlap":new Ht(oe.layout_symbol["text-overlap"]),"text-ignore-placement":new Ht(oe.layout_symbol["text-ignore-placement"]),"text-optional":new Ht(oe.layout_symbol["text-optional"])})}};class lx{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Un,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ft("FormatSectionOverride",lx,{omit:["defaultValue"]});class vf extends Xr{constructor(e,n){super(e,vm,n)}recalculate(e,n){if(super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const l=this.layout.get("text-writing-mode");if(l){const h=[];for(const p of l)h.indexOf(p)<0&&h.push(p);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,n,l,h){const p=this.layout.get(e).evaluate(n,{},l,h),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||Mo(g.value)||!p?p:(function(b,T){return T.replace(/{([^{}]+)}/g,((E,P)=>b&&P in b?String(b[P]):""))})(n.properties,p)}createBucket(e){return new kc(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of vm.paint.overridableProperties){if(!vf.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),l=new lx(n),h=new Zu(l,n.property.specification);let p=null;p=n.value.kind==="constant"||n.value.kind==="source"?new uc("source",h):new $u("composite",h,n.value.zoomStops),this.paint._values[e]=new os(n.property,p,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,l){return!(!this.layout||n.isDataDriven()||l.isDataDriven())&&vf.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const l=e.get("text-field"),h=vm.paint.properties[n];let p=!1;const g=b=>{for(const T of b)if(h.overrides&&h.overrides.hasOverride(T))return void(p=!0)};if(l.value.kind==="constant"&&l.value.value instanceof Mr)g(l.value.value.sections);else if(l.value.kind==="source"||l.value.kind==="composite"){const b=E=>{p||(E instanceof ys&&Tn(E.value)===Ta?g(E.value.sections):E instanceof Qo?g(E.sections):E.eachChild(b))},T=l.value;T._styleExpression&&b(T._styleExpression.expression)}return p}}let cx;var S1={get paint(){return cx=cx||new xr({"background-color":new Ht(oe.paint_background["background-color"]),"background-pattern":new wc(oe.paint_background["background-pattern"]),"background-opacity":new Ht(oe.paint_background["background-opacity"])})}};class M1 extends Xr{constructor(e,n){super(e,S1,n)}}class E1 extends Xr{constructor(e,n){super(e,{},n),this.onAdd=l=>{this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},this.onRemove=l=>{this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class A1{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const C1={once:!0},bm=63710088e-1;class Fo{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Fo(mt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,l=this.lat*n,h=e.lat*n,p=Math.sin(l)*Math.sin(h)+Math.cos(l)*Math.cos(h)*Math.cos((e.lng-this.lng)*n);return bm*Math.acos(Math.min(p,1))}static convert(e){if(e instanceof Fo)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Fo(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Fo(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const ux=2*Math.PI*bm;function hx(r){return ux*Math.cos(r*Math.PI/180)}function dx(r){return(180+r)/360}function fx(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function px(r,e){return r/hx(e)}function mx(r){return 360*r-180}function bf(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function gx(r,e){return r*hx(bf(e))}class Dh{constructor(e,n,l=0){this.x=+e,this.y=+n,this.z=+l}static fromLngLat(e,n=0){const l=Fo.convert(e);return new Dh(dx(l.lng),fx(l.lat),px(n,l.lat))}toLngLat(){return new Fo(mx(this.x),bf(this.y))}toAltitude(){return gx(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ux*(e=bf(this.y),1/Math.cos(e*Math.PI/180));var e}}function _x(r,e,n){var l=2*Math.PI*6378137/256/Math.pow(2,n);return[r*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}class wm{constructor(e,n,l){if(!(function(h,p,g){return!(h<0||h>25||g<0||g>=Math.pow(2,h)||p<0||p>=Math.pow(2,h))})(e,n,l))throw new Error(`x=${n}, y=${l}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=n,this.y=l,this.key=Uc(0,e,e,n,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n,l){const h=(g=this.y,b=this.z,T=_x(256*(p=this.x),256*(g=Math.pow(2,b)-g-1),b),E=_x(256*(p+1),256*(g+1),b),T[0]+","+T[1]+","+E[0]+","+E[1]);var p,g,b,T,E;const P=(function(I,B,k){let q,X="";for(let Y=I;Y>0;Y--)q=1<<Y-1,X+=(B&q?1:0)+(k&q?2:0);return X})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,P).replace(/{bbox-epsg-3857}/g,h)}isChildOf(e){const n=this.z-e.z;return n>0&&e.x===this.x>>n&&e.y===this.y>>n}getTilePoint(e){const n=Math.pow(2,this.z);return new M((e.x*n-this.x)*xt,(e.y*n-this.y)*xt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class yx{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Uc(e,n.z,n.z,n.x,n.y)}}class $r{constructor(e,n,l,h,p){if(this.terrainRttPosMatrix32f=null,e<l)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${l}`);this.overscaledZ=e,this.wrap=n,this.canonical=new wm(l,+h,+p),this.key=Uc(n,e,l,h,p)}clone(){return new $r(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-e;return e>this.canonical.z?new $r(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new $r(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(e,n){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-e;return e>this.canonical.z?Uc(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y):Uc(this.wrap*+n,e,e,this.canonical.x>>l,this.canonical.y>>l)}isChildOf(e){if(e.wrap!==this.wrap||this.overscaledZ-e.overscaledZ<=0)return!1;if(e.overscaledZ===0)return this.overscaledZ>0;const n=this.canonical.z-e.canonical.z;return!(n<0)&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new $r(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,l=2*this.canonical.x,h=2*this.canonical.y;return[new $r(n,this.wrap,n,l,h),new $r(n,this.wrap,n,l+1,h),new $r(n,this.wrap,n,l,h+1),new $r(n,this.wrap,n,l+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new $r(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new $r(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new yx(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Dh(e.x-this.wrap,e.y))}normalizeCoordinates(e,n,l=8192){if(e>=0&&e<l&&n>=0&&n<l)return{tileID:this,x:e,y:n};const h=Math.floor(e/l),p=Math.floor(n/l),g=e-h*l,b=n-p*l,T=this.canonical.z,E=1<<T,P=this.canonical.y+p;if(P<0||P>=E)return null;let I=this.canonical.x+h,B=this.wrap;return I<0?(B-=Math.ceil(-I/E),I=(I%E+E)%E):I>=E&&(B+=Math.floor(I/E),I%=E),{tileID:new $r(this.overscaledZ,B,T,I,P),x:g,y:b}}}function Uc(r,e,n,l,h){(r*=2)<0&&(r=-1*r-1);const p=1<<n;return(p*p*r+p*h+l).toString(36)+n.toString(36)+e.toString(36)}function Tm(r,e){return e?r.properties[e]:r.id}function P1(r,e){const n={id:r.id};if(e.removeAllProperties&&(delete r.removeProperties,delete r.addOrUpdateProperties,delete e.removeProperties),e.removeProperties)for(const l of e.removeProperties){const h=r.addOrUpdateProperties.findIndex((p=>p.key===l));h>-1&&r.addOrUpdateProperties.splice(h,1)}return(r.removeAllProperties||e.removeAllProperties)&&(n.removeAllProperties=!0),(r.removeProperties||e.removeProperties)&&(n.removeProperties=[...r.removeProperties||[],...e.removeProperties||[]]),(r.addOrUpdateProperties||e.addOrUpdateProperties)&&(n.addOrUpdateProperties=[...r.addOrUpdateProperties||[],...e.addOrUpdateProperties||[]]),(r.newGeometry||e.newGeometry)&&(n.newGeometry=e.newGeometry||r.newGeometry),n}function xx(r){var e,n;if(!r)return{};const l={};return l.removeAll=r.removeAll,l.remove=new Set(r.remove||[]),l.add=new Map((e=r.add)===null||e===void 0?void 0:e.map((h=>[h.id,h]))),l.update=new Map((n=r.update)===null||n===void 0?void 0:n.map((h=>[h.id,h]))),l}Ft("CanonicalTileID",wm),Ft("OverscaledTileID",$r,{omit:["terrainRttPosMatrix32f"]});class Il{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const n=new Il;return n.extend(e(new M(this.minX,this.minY))),n.extend(e(new M(this.maxX,this.minY))),n.extend(e(new M(this.minX,this.maxY))),n.extend(e(new M(this.maxX,this.maxY))),n}static fromPoints(e){const n=new Il;for(const l of e)n.extend(l);return n}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class vx{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const l=e[n];this._stringToNumber[l]=n,this._numberToString[n]=l}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class bx{constructor(e,n,l,h,p){this.type="Feature",this._vectorTileFeature=e,this._x=l,this._y=h,this._z=n,this.properties=e.properties,this.id=p}projectPoint(e,n,l,h){return[360*(e.x+n)/h-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+l)/h)*Math.PI))-90]}projectLine(e,n,l,h){return e.map((p=>this.projectPoint(p,n,l,h)))}get geometry(){if(this._geometry)return this._geometry;const e=this._vectorTileFeature,n=e.extent*Math.pow(2,this._z),l=e.extent*this._x,h=e.extent*this._y,p=e.loadGeometry();switch(e.type){case 1:{const g=[];for(const T of p)g.push(T[0]);const b=this.projectLine(g,l,h,n);this._geometry=g.length===1?{type:"Point",coordinates:b[0]}:{type:"MultiPoint",coordinates:b};break}case 2:{const g=p.map((b=>this.projectLine(b,l,h,n)));this._geometry=g.length===1?{type:"LineString",coordinates:g[0]}:{type:"MultiLineString",coordinates:g};break}case 3:{const g=Oy(p),b=[];for(const T of g)b.push(T.map((E=>this.projectLine(E,l,h,n))));this._geometry=b.length===1?{type:"Polygon",coordinates:b[0]}:{type:"MultiPolygon",coordinates:b};break}default:throw new Error(`unknown feature type: ${e.type}`)}return this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&n!=="_x"&&n!=="_y"&&n!=="_z"&&(e[n]=this[n]);return e}}class Vc{_name;dataBuffer;nullabilityBuffer;_size;constructor(e,n,l){this._name=e,this.dataBuffer=n,typeof l=="number"?this._size=l:(this.nullabilityBuffer=l,this._size=l.size())}getValue(e){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(e)?null:this.getValueFromBuffer(e)}has(e){return this.nullabilityBuffer&&this.nullabilityBuffer.get(e)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class wf extends Vc{}class Sm extends wf{getValueFromBuffer(e){return this.dataBuffer[e]}}class Mm extends wf{getValueFromBuffer(e){return this.dataBuffer[e]}}class wx extends Vc{delta;constructor(e,n,l,h){super(e,n,h),this.delta=l}}class Em extends wx{constructor(e,n,l,h){super(e,Int32Array.of(n),l,h)}getValueFromBuffer(e){return this.dataBuffer[0]+e*this.delta}}class Am extends Vc{constructor(e,n,l){super(e,Int32Array.of(n),l)}getValueFromBuffer(e){return this.dataBuffer[0]}}class I1{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(e,n,l,h,p=4096){this._name=e,this._geometryVector=n,this._idVector=l,this._propertyVectors=h,this._extent=p}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(e){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((n=>[n.name,n])))),this.propertyVectorsMap.get(e)}*[Symbol.iterator](){const e=this.geometryVector[Symbol.iterator]();let n=0;for(;n<this.numFeatures;){let l;this.idVector&&(l=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(n)):this.idVector.getValue(n));const h=e?.next().value,p={};for(const g of this.propertyVectors){if(!g)continue;const b=g.name,T=g.getValue(n);T!==null&&(p[b]=T)}n++,yield{id:l,geometry:h,properties:p}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const e=[],n=this.geometryVector.getGeometries();for(let l=0;l<this.numFeatures;l++){let h;this.idVector&&(h=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(l)):this.idVector.getValue(l));const p={coordinates:n[l],type:this.geometryVector.geometryType(l)},g={};for(const b of this.propertyVectors){if(!b)continue;const T=b.name,E=b.getValue(l);E!==null&&(g[T]=E)}e.push({id:h,geometry:p,properties:g})}return e}containsMaxSaveIntegerValues(e){return e instanceof Sm||e instanceof Am&&e instanceof Em||e instanceof Mm}}class R1{value;constructor(e){this.value=e}get(){return this.value}set(e){this.value=e}increment(){return this.value++}add(e){this.value+=e}}var Hi,zo,or,Fs,Rl,Yr,An,qn,Tx,us;function vr(r,e,n){const l=new Int32Array(n);let h=0,p=e.get();for(let g=0;g<l.length;g++){let b=r[p++],T=127&b;b<128||(b=r[p++],T|=(127&b)<<7,b<128||(b=r[p++],T|=(127&b)<<14,b<128||(b=r[p++],T|=(127&b)<<21,b<128||(b=r[p++],T|=(15&b)<<28)))),l[h++]=T}return e.set(p),l}function Cm(r,e,n){const l=new BigInt64Array(n);for(let h=0;h<l.length;h++)l[h]=D1(r,e);return l}function D1(r,e){let n=0n,l=0,h=e.get();for(;h<r.length;){const p=r[h++];if(n|=BigInt(127&p)<<BigInt(l),!(128&p))break;if(l+=7,l>=64)throw new Error("Varint too long")}return e.set(h),n}function L1(r,e){let n,l;return l=r[e.get()],e.increment(),n=127&l,l<128?n:(l=r[e.get()],e.increment(),n|=(127&l)<<7,l<128?n:(l=r[e.get()],e.increment(),n|=(127&l)<<14,l<128?n:(l=r[e.get()],e.increment(),n|=(127&l)<<21,l<128?n:(l=r[e.get()],n|=(15&l)<<28,(function(h,p,g){let b,T;if(T=p[g.get()],g.increment(),b=(112&T)>>4,T<128||(T=p[g.get()],g.increment(),b|=(127&T)<<3,T<128)||(T=p[g.get()],g.increment(),b|=(127&T)<<10,T<128)||(T=p[g.get()],g.increment(),b|=(127&T)<<17,T<128)||(T=p[g.get()],g.increment(),b|=(127&T)<<24,T<128)||(T=p[g.get()],g.increment(),b|=(1&T)<<31,T<128))return 4294967296*b+(h>>>0);throw new Error("Expected varint not more than 10 bytes")})(n,r,e)))))}function xn(r){return r>>>1^-(1&r)}function Kr(r){return r>>1n^-(1n&r)}function Gc(r){return r%2==1?(r+1)/-2:r/2}function Sx(r,e,n){if(n===void 0){n=0;for(let p=0;p<e;p++)n+=r[p]}const l=new Int32Array(n);let h=0;for(let p=0;p<e;p++){const g=r[p];l.fill(r[p+e],h,h+g),h+=g}return l}function Mx(r,e,n){if(n===void 0){n=0;for(let p=0;p<e;p++)n+=Number(r[p])}const l=new BigInt64Array(n);let h=0;for(let p=0;p<e;p++){const g=Number(r[p]);l.fill(r[p+e],h,h+g),h+=g}return l}function Ex(r,e,n){const l=new Float64Array(n);let h=0;for(let p=0;p<e;p++){const g=r[p];l.fill(r[p+e],h,h+g),h+=g}return l}function Ax(r){const e=r.length/4*4;let n=1;if(e>=4)for(let l=r[0];n<e-4;n+=4)l=r[n]+=l,l=r[n+1]+=l,l=r[n+2]+=l,l=r[n+3]+=l;for(;n!=r.length;)r[n]+=r[n-1],++n}(function(r){r.NONE="NONE",r.DELTA="DELTA",r.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",r.RLE="RLE",r.MORTON="MORTON",r.PDE="PDE"})(Hi||(Hi={})),(function(r){r.NONE="NONE",r.FAST_PFOR="FAST_PFOR",r.VARINT="VARINT",r.ALP="ALP"})(zo||(zo={})),(function(r){r.PRESENT="PRESENT",r.DATA="DATA",r.OFFSET="OFFSET",r.LENGTH="LENGTH"})(or||(or={}));class Pm{_dictionaryType;_offsetType;_lengthType;constructor(e,n,l){this._dictionaryType=e,this._offsetType=n,this._lengthType=l}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function Cr(r,e){const n=(function(l,h){const p=l[h.get()],g=Object.values(or)[p>>4];let b=null;switch(g){case or.DATA:b=new Pm(Object.values(Fs)[15&p]);break;case or.OFFSET:b=new Pm(null,Object.values(Rl)[15&p]);break;case or.LENGTH:b=new Pm(null,null,Object.values(Yr)[15&p])}h.increment();const T=l[h.get()],E=Object.values(Hi)[T>>5],P=Object.values(Hi)[T>>2&7],I=Object.values(zo)[3&T];h.increment();const B=vr(l,h,2),k=B[0];return{physicalStreamType:g,logicalStreamType:b,logicalLevelTechnique1:E,logicalLevelTechnique2:P,physicalLevelTechnique:I,numValues:k,byteLength:B[1],decompressedCount:k}})(r,e);return n.logicalLevelTechnique1===Hi.MORTON?(function(l,h,p){const g=vr(h,p,2);return{physicalStreamType:l.physicalStreamType,logicalStreamType:l.logicalStreamType,logicalLevelTechnique1:l.logicalLevelTechnique1,logicalLevelTechnique2:l.logicalLevelTechnique2,physicalLevelTechnique:l.physicalLevelTechnique,numValues:l.numValues,byteLength:l.byteLength,decompressedCount:l.decompressedCount,numBits:g[0],coordinateShift:g[1]}})(n,r,e):Hi.RLE!==n.logicalLevelTechnique1&&Hi.RLE!==n.logicalLevelTechnique2||zo.NONE===n.physicalLevelTechnique?n:(function(l,h,p){const g=vr(h,p,2);return{physicalStreamType:l.physicalStreamType,logicalStreamType:l.logicalStreamType,logicalLevelTechnique1:l.logicalLevelTechnique1,logicalLevelTechnique2:l.logicalLevelTechnique2,physicalLevelTechnique:l.physicalLevelTechnique,numValues:l.numValues,byteLength:l.byteLength,decompressedCount:g[1],runs:g[0],numRleValues:g[1]}})(n,r,e)}(function(r){r.NONE="NONE",r.SINGLE="SINGLE",r.SHARED="SHARED",r.VERTEX="VERTEX",r.MORTON="MORTON",r.FSST="FSST"})(Fs||(Fs={})),(function(r){r.VERTEX="VERTEX",r.INDEX="INDEX",r.STRING="STRING",r.KEY="KEY"})(Rl||(Rl={})),(function(r){r.VAR_BINARY="VAR_BINARY",r.GEOMETRIES="GEOMETRIES",r.PARTS="PARTS",r.RINGS="RINGS",r.TRIANGLES="TRIANGLES",r.SYMBOL="SYMBOL",r.DICTIONARY="DICTIONARY"})(Yr||(Yr={})),(function(r){r[r.FLAT=0]="FLAT",r[r.CONST=1]="CONST",r[r.SEQUENCE=2]="SEQUENCE",r[r.DICTIONARY=3]="DICTIONARY",r[r.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(An||(An={}));class zs{values;_size;constructor(e,n){this.values=e,this._size=n}get(e){const n=Math.floor(e/8);return(this.values[n]>>e%8&1)==1}set(e,n){const l=Math.floor(e/8);this.values[l]=this.values[l]|(n?1:0)<<e%8}getInt(e){const n=Math.floor(e/8);return this.values[n]>>e%8&1}size(){return this._size}getBuffer(){return this.values}}function Tf(r,e,n){if(!e)return r;const l=e.size(),h=new r.constructor(l);let p=0;for(let g=0;g<l;g++)h[g]=e.get(g)?r[p++]:n;return h}function Pr(r,e,n,l,h,p){return(function(g,b,T,E,P){switch(b.logicalLevelTechnique1){case Hi.DELTA:if(b.logicalLevelTechnique2===Hi.RLE){const I=b;if(!P)return(function(B,k,q){const X=new Int32Array(q);let Y=0,ne=0;for(let me=0;me<k;me++){const ie=B[me],le=xn(B[me+k]);for(let Te=0;Te<ie;Te++)ne+=le,X[Y++]=ne}return X})(g,I.runs,I.numRleValues);g=Sx(g,I.runs,I.numRleValues)}(function(I){I[0]=xn(I[0]);const B=I.length/4*4;let k=1;if(B>=4)for(;k<B-4;k+=4){const q=I[k+1],X=I[k+2],Y=I[k+3];I[k]=xn(I[k])+I[k-1],I[k+1]=xn(q)+I[k],I[k+2]=xn(X)+I[k+1],I[k+3]=xn(Y)+I[k+2]}for(;k!=I.length;++k)I[k]=xn(I[k])+I[k-1]})(g);break;case Hi.RLE:g=(function(I,B,k){return k?(function(q,X,Y){if(Y===void 0){Y=0;for(let ie=0;ie<X;ie++)Y+=q[ie]}const ne=new Int32Array(Y);let me=0;for(let ie=0;ie<X;ie++){const le=q[ie];let Te=q[ie+X];Te=xn(Te),ne.fill(Te,me,me+le),me+=le}return ne})(I,B.runs,B.numRleValues):Sx(I,B.runs,B.numRleValues)})(g,b,T);break;case Hi.MORTON:Ax(g);break;case Hi.COMPONENTWISE_DELTA:(function(I){if(I.length<2)return;I[0]=xn(I[0]),I[1]=xn(I[1]);const B=I.length/4*4;let k=2;if(B>=4)for(;k<B-4;k+=4){const q=I[k+1],X=I[k+2],Y=I[k+3];I[k]=xn(I[k])+I[k-2],I[k+1]=xn(q)+I[k-1],I[k+2]=xn(X)+I[k],I[k+3]=xn(Y)+I[k+1]}for(;k!=I.length;k+=2)I[k]=xn(I[k])+I[k-2],I[k+1]=xn(I[k+1])+I[k-1]})(g);break;case Hi.NONE:T&&(function(I){for(let B=0;B<I.length;B++)I[B]=xn(I[B])})(g);break;default:throw new Error(`The specified Logical level technique is not supported: ${b.logicalLevelTechnique1}`)}return P?Tf(g,P,0):g})(Sf(r,e,n),n,l,0,p)}function Oo(r,e,n){return(function(l,h){if(h.logicalLevelTechnique1===Hi.DELTA&&h.logicalLevelTechnique2===Hi.NONE)return(function(p){const g=new Int32Array(p.length+1);g[0]=0,g[1]=xn(p[0]);let b=g[1];for(let T=2;T!=g.length;++T)b+=xn(p[T-1]),g[T]=g[T-1]+b;return new Uint32Array(g)})(l);if(h.logicalLevelTechnique1===Hi.RLE&&h.logicalLevelTechnique2===Hi.NONE)return(function(p,g,b){const T=new Int32Array(b+1);T[0]=0;let E=1,P=T[0];for(let I=0;I<g;I++){const B=p[I],k=p[I+g];for(let q=E;q<E+B;q++)T[q]=k+P,P=T[q];E+=B}return new Uint32Array(T)})(l,h.runs,h.numRleValues);if(h.logicalLevelTechnique1===Hi.NONE&&h.logicalLevelTechnique2===Hi.NONE){(function(g){let b=0;for(let T=0;T<g.length;T++)g[T]+=b,b=g[T]})(l);const p=new Uint32Array(h.numValues+1);return p[0]=0,p.set(l,1),p}if(h.logicalLevelTechnique1===Hi.DELTA&&h.logicalLevelTechnique2===Hi.RLE){const p=(function(g,b,T){const E=new Int32Array(T+1);E[0]=0;let P=1,I=E[0];for(let B=0;B<b;B++){const k=g[B];let q=g[B+b];q=xn(q);for(let X=P;X<P+k;X++)E[X]=q+I,I=E[X];P+=k}return new Uint32Array(E)})(l,h.runs,h.numRleValues);return Ax(p),p}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")})(Sf(r,e,n),n)}function Sf(r,e,n){const l=n.physicalLevelTechnique;if(l===zo.FAST_PFOR)return(function(){throw new Error("FastPFor is not implemented yet.")})();if(l===zo.VARINT)return vr(r,e,n.numValues);if(l===zo.NONE){const h=e.get();e.add(n.byteLength);const p=r.subarray(h,e.get());return new Int32Array(p)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function Im(r,e,n,l){const h=Sf(r,e,n);if(h.length===1){const p=h[0];return l?xn(p):p}return l?(function(p){return xn(p[1])})(h):(function(p){return p[1]})(h)}function Cx(r,e,n){return(function(l){if(l.length==2){const h=xn(l[1]);return[h,h]}return[xn(l[2]),xn(l[3])]})(Sf(r,e,n))}function Px(r,e,n){return(function(l){if(l.length==2){const h=Kr(l[1]);return[h,h]}return[Kr(l[2]),Kr(l[3])]})(Cm(r,e,n.numValues))}function Ix(r,e,n,l,h){return(function(p,g,b,T){switch(g.logicalLevelTechnique1){case Hi.DELTA:if(g.logicalLevelTechnique2===Hi.RLE){const E=g;if(!T)return(function(P,I,B){const k=new BigInt64Array(B);let q=0,X=0n;for(let Y=0;Y<I;Y++){const ne=Number(P[Y]),me=Kr(P[Y+I]);for(let ie=0;ie<ne;ie++)X+=me,k[q++]=X}return k})(p,E.runs,E.numRleValues);p=Mx(p,E.runs,E.numRleValues)}(function(E){E[0]=Kr(E[0]);const P=E.length/4*4;let I=1;if(P>=4)for(;I<P-4;I+=4){const B=E[I+1],k=E[I+2],q=E[I+3];E[I]=Kr(E[I])+E[I-1],E[I+1]=Kr(B)+E[I],E[I+2]=Kr(k)+E[I+1],E[I+3]=Kr(q)+E[I+2]}for(;I!=E.length;++I)E[I]=Kr(E[I])+E[I-1]})(p);break;case Hi.RLE:p=(function(E,P,I){return I?(function(B,k,q){if(q===void 0){q=0;for(let ne=0;ne<k;ne++)q+=Number(B[ne])}const X=new BigInt64Array(q);let Y=0;for(let ne=0;ne<k;ne++){const me=Number(B[ne]);let ie=B[ne+k];ie=Kr(ie),X.fill(ie,Y,Y+me),Y+=me}return X})(E,P.runs,P.numRleValues):Mx(E,P.runs,P.numRleValues)})(p,g,b);break;case Hi.NONE:b&&(function(E){for(let P=0;P<E.length;P++)E[P]=Kr(E[P])})(p);break;default:throw new Error(`The specified Logical level technique is not supported: ${g.logicalLevelTechnique1}`)}return T?Tf(p,T,0n):p})(Cm(r,e,n.numValues),n,l,h)}function Rx(r,e,n,l){const h=Cm(r,e,n.numValues);if(h.length===1){const p=h[0];return l?Kr(p):p}return l?(function(p){return Kr(p[1])})(h):(function(p){return p[1]})(h)}function Mf(r,e,n,l){const h=r.logicalLevelTechnique1;if(h===Hi.RLE)return r.runs===1?An.CONST:An.FLAT;if(h!==Hi.DELTA||r.logicalLevelTechnique2!==Hi.RLE)return r.numValues===1?An.CONST:An.FLAT;const p=e instanceof zs?e.size():e;if(r.numRleValues!==p)return An.FLAT;if(r.runs===1)return An.SEQUENCE;if(r.runs!==2)return r.numValues===1?An.CONST:An.FLAT;const g=l.get();let b;if(r.physicalLevelTechnique===zo.VARINT)b=vr(n,l,4);else{const T=l.get();b=new Int32Array(n.buffer,n.byteOffset+T,4)}return l.set(g),b[2]===2&&b[3]===2?An.SEQUENCE:r.numValues===1?An.CONST:An.FLAT}class Dx extends wf{getValueFromBuffer(e){return this.dataBuffer[e]}}class Lx extends wx{constructor(e,n,l,h){super(e,BigInt64Array.of(n),l,h)}getValueFromBuffer(e){return this.dataBuffer[0]+BigInt(e)*this.delta}}class Hc{_geometryOffsets;_partOffsets;_ringOffsets;constructor(e,n,l){this._geometryOffsets=e,this._partOffsets=n,this._ringOffsets=l}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function Rm(r,e,n){return{x:Fx(r,e)-n,y:Fx(r>>1,e)-n}}function Fx(r,e){let n=0;for(let l=0;l<e;l++)n|=(r&1<<2*l)>>l;return n}(function(r){r[r.POINT=0]="POINT",r[r.LINESTRING=1]="LINESTRING",r[r.POLYGON=2]="POLYGON",r[r.MULTIPOINT=3]="MULTIPOINT",r[r.MULTILINESTRING=4]="MULTILINESTRING",r[r.MULTIPOLYGON=5]="MULTIPOLYGON"})(qn||(qn={})),(function(r){r[r.POINT=0]="POINT",r[r.LINESTRING=1]="LINESTRING",r[r.POLYGON=2]="POLYGON"})(Tx||(Tx={})),(function(r){r[r.MORTON=0]="MORTON",r[r.VEC_2=1]="VEC_2",r[r.VEC_3=2]="VEC_3"})(us||(us={}));class F1{createPoint(e){return[[e]]}createMultiPoint(e){return e.map((n=>[n]))}createLineString(e){return[e]}createMultiLineString(e){return e}createPolygon(e,n){return[e].concat(n)}createMultiPolygon(e){return e.flat()}}function zx(r){const e=new Array(r.numGeometries);let n=1,l=1,h=1,p=0;const g=new F1;let b=0,T=0;const E=r.mortonSettings,P=r.topologyVector,I=P.geometryOffsets,B=P.partOffsets,k=P.ringOffsets,q=r.vertexOffsets,X=r.containsPolygonGeometry(),Y=r.vertexBuffer;for(let ne=0;ne<r.numGeometries;ne++){const me=r.geometryType(ne);if(me===qn.POINT){if(q&&q.length!==0)if(r.vertexBufferType===us.VEC_2){const ie=2*q[T++],le=new M(Y[ie],Y[ie+1]);e[p++]=g.createPoint(le)}else{const ie=Rm(Y[q[T++]],E.numBits,E.coordinateShift),le=new M(ie.x,ie.y);e[p++]=g.createPoint(le)}else{const ie=new M(Y[b++],Y[b++]);e[p++]=g.createPoint(ie)}I&&h++,B&&n++,k&&l++}else if(me===qn.MULTIPOINT){const ie=I[h]-I[h-1];h++;const le=new Array(ie);if(q&&q.length!==0){for(let Te=0;Te<ie;Te++){const Re=2*q[T++];le[Te]=new M(Y[Re],Y[Re+1])}e[p++]=g.createMultiPoint(le)}else{for(let Te=0;Te<ie;Te++){const Re=Y[b++],He=Y[b++];le[Te]=new M(Re,He)}e[p++]=g.createMultiPoint(le)}}else if(me===qn.LINESTRING){let ie,le=0;X?(le=k[l]-k[l-1],l++):le=B[n]-B[n-1],n++,q&&q.length!==0?(ie=r.vertexBufferType===us.VEC_2?Lm(Y,q,T,le,!1):Fm(Y,q,T,le,!1,E),T+=le):(ie=Dm(Y,b,le,!1),b+=2*le),e[p++]=g.createLineString(ie),I&&h++}else if(me===qn.POLYGON){const ie=B[n]-B[n-1];n++;const le=new Array(ie-1);let Te=k[l]-k[l-1];if(l++,q&&q.length!==0){const Re=r.vertexBufferType===us.VEC_2?Af(Y,q,T,Te):Cf(Y,q,T,Te,0,E);T+=Te;for(let He=0;He<le.length;He++)Te=k[l]-k[l-1],l++,le[He]=r.vertexBufferType===us.VEC_2?Af(Y,q,T,Te):Cf(Y,q,T,Te,0,E),T+=Te;e[p++]=g.createPolygon(Re,le)}else{const Re=Ef(Y,b,Te);b+=2*Te;for(let He=0;He<le.length;He++)Te=k[l]-k[l-1],l++,le[He]=Ef(Y,b,Te),b+=2*Te;e[p++]=g.createPolygon(Re,le)}I&&h++}else if(me===qn.MULTILINESTRING){const ie=I[h]-I[h-1];h++;const le=new Array(ie);if(q&&q.length!==0){for(let Te=0;Te<ie;Te++){let Re=0;X?(Re=k[l]-k[l-1],l++):Re=B[n]-B[n-1],n++;const He=r.vertexBufferType===us.VEC_2?Lm(Y,q,T,Re,!1):Fm(Y,q,T,Re,!1,E);le[Te]=He,T+=Re}e[p++]=g.createMultiLineString(le)}else{for(let Te=0;Te<ie;Te++){let Re=0;X?(Re=k[l]-k[l-1],l++):Re=B[n]-B[n-1],n++,le[Te]=Dm(Y,b,Re,!1),b+=2*Re}e[p++]=g.createMultiLineString(le)}}else{if(me!==qn.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const ie=I[h]-I[h-1];h++;const le=new Array(ie);let Te=0;if(q&&q.length!==0){for(let Re=0;Re<ie;Re++){const He=B[n]-B[n-1];n++;const it=new Array(He-1);Te=k[l]-k[l-1],l++;const rt=r.vertexBufferType===us.VEC_2?Af(Y,q,T,Te):Cf(Y,q,T,Te,0,E);T+=Te;for(let ft=0;ft<it.length;ft++)Te=k[l]-k[l-1],l++,it[ft]=r.vertexBufferType===us.VEC_2?Af(Y,q,T,Te):Cf(Y,q,T,Te,0,E),T+=Te;le[Re]=g.createPolygon(rt,it)}e[p++]=g.createMultiPolygon(le)}else{for(let Re=0;Re<ie;Re++){const He=B[n]-B[n-1];n++;const it=new Array(He-1);Te=k[l]-k[l-1],l++;const rt=Ef(Y,b,Te);b+=2*Te;for(let ft=0;ft<it.length;ft++){const St=k[l]-k[l-1];l++,it[ft]=Ef(Y,b,St),b+=2*St}le[Re]=g.createPolygon(rt,it)}e[p++]=g.createMultiPolygon(le)}}}}return e}function Ef(r,e,n){return Dm(r,e,n,!0)}function Af(r,e,n,l){return Lm(r,e,n,l,!0)}function Cf(r,e,n,l,h,p){return Fm(r,e,n,l,!0,p)}function Dm(r,e,n,l){const h=new Array(l?n+1:n);for(let p=0;p<2*n;p+=2)h[p/2]=new M(r[e+p],r[e+p+1]);return l&&(h[h.length-1]=h[0]),h}function Lm(r,e,n,l,h){const p=new Array(h?l+1:l);for(let g=0;g<2*l;g+=2){const b=2*e[n+g/2];p[g/2]=new M(r[b],r[b+1])}return h&&(p[p.length-1]=p[0]),p}function Fm(r,e,n,l,h,p){const g=new Array(h?l+1:l);for(let b=0;b<l;b++){const T=Rm(r[e[n+b]],p.numBits,p.coordinateShift);g[b]=new M(T.x,T.y)}return h&&(g[g.length-1]=g[0]),g}class Ox{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(e,n,l,h,p){this._vertexBufferType=e,this._topologyVector=n,this._vertexOffsets=l,this._vertexBuffer=h,this._mortonSettings=p}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const e=zx(this);let n=0;for(;n<this.numGeometries;)yield{coordinates:e[n],type:this.geometryType(n)},n++}getSimpleEncodedVertex(e){const n=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[n],this.vertexBuffer[n+1]]}getVertex(e){if(this.vertexOffsets&&this.mortonSettings){const l=Rm(this.vertexBuffer[this.vertexOffsets[e]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[l.x,l.y]}const n=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[n],this.vertexBuffer[n+1]]}getGeometries(){return zx(this)}get mortonSettings(){return this._mortonSettings}}class Nx extends Ox{_numGeometries;_geometryType;constructor(e,n,l,h,p,g,b){super(l,h,p,g,b),this._numGeometries=e,this._geometryType=n}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===qn.POLYGON||this._geometryType===qn.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class Bx extends Ox{_geometryTypes;constructor(e,n,l,h,p,g){super(e,l,h,p,g),this._geometryTypes=n}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let e=0;e<this.numGeometries;e++)if(this.geometryType(e)===qn.POLYGON||this.geometryType(e)===qn.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class kx{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(e,n,l,h){this._triangleOffsets=e,this._indexBuffer=n,this._vertexBuffer=l,this._topologyVector=h}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const e=new Array(this.numGeometries),n=this._topologyVector,l=n.partOffsets,h=n.ringOffsets,p=n.geometryOffsets;let g=0,b=1,T=1,E=1;for(let P=0;P<this.numGeometries;P++)switch(this.geometryType(P)){case qn.POLYGON:{const I=l[b]-l[b-1];b++;const B=[];for(let k=0;k<I;k++){const q=h[T]-h[T-1];T++;const X=[];for(let Y=0;Y<q;Y++){const ne=this._vertexBuffer[g++],me=this._vertexBuffer[g++];X.push(new M(ne,me))}X.length>0&&X.push(X[0]),B.push(X)}e[P]=B,p&&E++}break;case qn.MULTIPOLYGON:{const I=p[E]-p[E-1];E++;const B=[];for(let k=0;k<I;k++){const q=l[b]-l[b-1];b++;for(let X=0;X<q;X++){const Y=h[T]-h[T-1];T++;const ne=[];for(let me=0;me<Y;me++){const ie=this._vertexBuffer[g++],le=this._vertexBuffer[g++];ne.push(new M(ie,le))}ne.length>0&&ne.push(ne[0]),B.push(ne)}}e[P]=B}}return e}[Symbol.iterator](){return null}}function Ux(r,e,n,l,h,p){return new z1(r,e,n,l,h,p)}class z1 extends kx{_numGeometries;_geometryType;constructor(e,n,l,h,p,g){super(l,h,p,g),this._numGeometries=e,this._geometryType=n}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function Vx(r,e,n,l,h){return new O1(r,e,n,l,h)}class O1 extends kx{_geometryTypes;constructor(e,n,l,h,p){super(n,l,h,p),this._geometryTypes=e}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function N1(r,e,n,l,h){const p=Cr(r,n);let g=null,b=null,T=null,E=null;if(Mf(p,l,r,n)===An.CONST){const me=Im(r,n,p,!1);let ie=null,le=null,Te=null,Re=null;for(let He=0;He<e-1;He++){const it=Cr(r,n);switch(it.physicalStreamType){case or.LENGTH:switch(it.logicalStreamType.lengthType){case Yr.GEOMETRIES:ie=Oo(r,n,it);break;case Yr.PARTS:le=Oo(r,n,it);break;case Yr.RINGS:Te=Oo(r,n,it);break;case Yr.TRIANGLES:Re=Oo(r,n,it)}break;case or.OFFSET:switch(it.logicalStreamType.offsetType){case Rl.VERTEX:g=Pr(r,n,it,!1);break;case Rl.INDEX:E=Pr(r,n,it,!1)}break;case or.DATA:Fs.VERTEX===it.logicalStreamType.dictionaryType?b=Pr(r,n,it,!0):(T={numBits:it.numBits,coordinateShift:it.coordinateShift},b=Pr(r,n,it,!1))}}return E!==null?ie!=null||le!=null?Ux(l,me,Re,E,b,new Hc(ie,le,Te)):Ux(l,me,Re,E,b):T===null?(function(He,it,rt,ft,St){return new Nx(He,it,us.VEC_2,rt,ft,St)})(l,me,new Hc(ie,le,Te),g,b):(function(He,it,rt,ft,St,_t){return new Nx(He,it,us.MORTON,rt,ft,St,_t)})(l,me,new Hc(ie,le,Te),g,b,T)}const P=Pr(r,n,p,!1);let I=null,B=null,k=null,q=null;for(let me=0;me<e-1;me++){const ie=Cr(r,n);switch(ie.physicalStreamType){case or.LENGTH:switch(ie.logicalStreamType.lengthType){case Yr.GEOMETRIES:I=Pr(r,n,ie,!1);break;case Yr.PARTS:B=Pr(r,n,ie,!1);break;case Yr.RINGS:k=Pr(r,n,ie,!1);break;case Yr.TRIANGLES:q=Oo(r,n,ie)}break;case or.OFFSET:switch(ie.logicalStreamType.offsetType){case Rl.VERTEX:g=Pr(r,n,ie,!1);break;case Rl.INDEX:E=Pr(r,n,ie,!1)}break;case or.DATA:Fs.VERTEX===ie.logicalStreamType.dictionaryType?b=Pr(r,n,ie,!0):(T={numBits:ie.numBits,coordinateShift:ie.coordinateShift},b=Pr(r,n,ie,!1))}}let X=null,Y=null,ne=null;return I!==null?(X=zm(P,I,2),B!==null&&k!==null?(Y=Gx(P,X,B,!1),ne=(function(me,ie,le,Te){const Re=new Uint32Array(le[le.length-1]+1);let He=0;Re[0]=He;let it=1,rt=1,ft=0;for(let St=0;St<me.length;St++){const _t=me[St],at=ie[St+1]-ie[St];if(_t!==0&&_t!==3)for(let et=0;et<at;et++){const zt=le[it]-le[it-1];it++;for(let Nt=0;Nt<zt;Nt++)He=Re[rt++]=He+Te[ft++]}else for(let et=0;et<at;et++)Re[rt++]=++He,it++}return Re})(P,X,Y,k)):B!==null&&(Y=(function(me,ie,le){const Te=new Uint32Array(ie[ie.length-1]+1);let Re=0;Te[0]=Re;let He=1,it=0;for(let rt=0;rt<me.length;rt++){const ft=me[rt],St=ie[rt+1]-ie[rt];if(ft===4||ft===1)for(let _t=0;_t<St;_t++)Re=Te[He++]=Re+le[it++];else for(let _t=0;_t<St;_t++)Te[He++]=++Re}return Te})(P,X,B))):B!==null&&k!==null?(Y=zm(P,B,1),ne=Gx(P,Y,k,!0)):B!==null&&(Y=zm(P,B,0)),E!==null&&Y===null?Vx(P,q,E,b):E!==null?Vx(P,q,E,b,new Hc(X,Y,ne)):T===null?(function(me,ie,le,Te){return new Bx(us.VEC_2,me,ie,le,Te)})(P,new Hc(X,Y,ne),g,b):(function(me,ie,le,Te,Re){return new Bx(us.MORTON,me,ie,le,Te,Re)})(P,new Hc(X,Y,ne),g,b,T)}function zm(r,e,n){const l=new Uint32Array(r.length+1);let h=0;l[0]=h;let p=0;for(let g=0;g<r.length;g++)h=l[g+1]=h+(r[g]>n?e[p++]:1);return l}function Gx(r,e,n,l){const h=new Uint32Array(e[e.length-1]+1);let p=0;h[0]=p;let g=1,b=0;for(let T=0;T<r.length;T++){const E=r[T],P=e[T+1]-e[T];if(E===5||E===2||l&&(E===4||E===1))for(let I=0;I<P;I++)p=h[g++]=p+n[b++];else for(let I=0;I<P;I++)h[g++]=++p}return h}class B1 extends Vc{dataVector;constructor(e,n,l){super(e,n.getBuffer(),l),this.dataVector=n}getValueFromBuffer(e){return this.dataVector.get(e)}}class k1 extends wf{getValueFromBuffer(e){return this.dataBuffer[e]}}class Hx extends Vc{constructor(e,n,l){super(e,BigInt64Array.of(n),l)}getValueFromBuffer(e){return this.dataBuffer[0]}}function Lh(r,e,n,l,h){const p=(function(g,b,T,E){const P=new Uint8Array(b);let I=0;const B=E.get()+T;for(;I<b&&!(E.get()>=B);){const k=g[E.increment()];if(k<=127){const q=k+3,X=g[E.increment()],Y=Math.min(I+q,b);P.fill(X,I,Y),I=Y}else{const q=256-k;for(let X=0;X<q&&I<b;X++)P[I++]=g[E.increment()]}}return E.set(B),P})(r,Math.ceil(e/8),n,l);return h?(function(g,b,T){if(!T)return g;const E=T.size(),P=new zs(g,b),I=new zs(new Uint8Array(Math.ceil(E/8)),E);let B=0;for(let k=0;k<E;k++){const q=!!T.get(k)&&P.get(B++);I.set(k,q)}return I.getBuffer()})(p,e,h):p}const U1=new TextDecoder;function Om(r,e,n){return n-e>=12?U1.decode(r.subarray(e,n)):(function(l,h,p){let g="",b=h;for(;b<p;){const T=l[b];let E,P,I,B=null,k=T>239?4:T>223?3:T>191?2:1;if(b+k>p)break;k===1?T<128&&(B=T):k===2?(E=l[b+1],(192&E)==128&&(B=(31&T)<<6|63&E,B<=127&&(B=null))):k===3?(E=l[b+1],P=l[b+2],(192&E)==128&&(192&P)==128&&(B=(15&T)<<12|(63&E)<<6|63&P,(B<=2047||B>=55296&&B<=57343)&&(B=null))):k===4&&(E=l[b+1],P=l[b+2],I=l[b+3],(192&E)==128&&(192&P)==128&&(192&I)==128&&(B=(15&T)<<18|(63&E)<<12|(63&P)<<6|63&I,(B<=65535||B>=1114112)&&(B=null))),B===null?(B=65533,k=1):B>65535&&(B-=65536,g+=String.fromCharCode(B>>>10&1023|55296),B=56320|1023&B),g+=String.fromCharCode(B),b+=k}return g})(r,e,n)}class Nm extends Vc{offsetBuffer;constructor(e,n,l,h){super(e,l,h),this.offsetBuffer=n}}class jx extends Nm{textEncoder;constructor(e,n,l,h){super(e,n,l,h??n.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(e){return Om(this.dataBuffer,this.offsetBuffer[e],this.offsetBuffer[e+1])}}class jc extends Nm{indexBuffer;textEncoder;constructor(e,n,l,h,p){super(e,l,h,p??n.length),this.indexBuffer=n,this.indexBuffer=n,this.textEncoder=new TextEncoder}getValueFromBuffer(e){const n=this.indexBuffer[e];return Om(this.dataBuffer,this.offsetBuffer[n],this.offsetBuffer[n+1])}}class Wx extends Nm{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(e,n,l,h,p,g,b){super(e,l,h,b),this.indexBuffer=n,this.symbolOffsetBuffer=p,this.symbolTableBuffer=g,this.textEncoder=new TextEncoder}getValueFromBuffer(e){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(l,h,p){const g=[],b=new Array(h.length).fill(0);for(let T=1;T<h.length;T++)b[T]=b[T-1]+h[T-1];for(let T=0;T<p.length;T++)if(p[T]===255)g.push(p[++T]);else{const E=h[p[T]],P=b[p[T]];for(let I=0;I<E;I++)g.push(l[P+I])}return new Uint8Array(g)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const n=this.indexBuffer[e];return Om(this.decodedDictionary,this.offsetBuffer[n],this.offsetBuffer[n+1])}offsetToLengthBuffer(e){const n=new Uint32Array(e.length-1);let l=e[0];for(let h=1;h<e.length;h++){const p=e[h];n[h-1]=p-l,l=p}return n}}function V1(r,e,n,l,h,p){return n.type==="scalarType"?(function(g,b,T,E,P,I){let B=null,k=0;if(g===0)return null;if(I.nullable){const X=Cr(b,T);k=X.numValues;const Y=T.get(),ne=Lh(b,k,X.byteLength,T);T.set(Y+X.byteLength),B=new zs(ne,X.numValues)}const q=B??E;switch(P.physicalType){case 4:case 3:return(function(X,Y,ne,me,ie){const le=Cr(X,Y),Te=Mf(le,ie,X,Y),Re=me.physicalType===3;if(Te===An.FLAT){const He=Pr(X,Y,le,Re,0,Fh(ie)?ie:void 0);return new Sm(ne.name,He,ie)}if(Te===An.SEQUENCE){const He=Cx(X,Y,le);return new Em(ne.name,He[0],He[1],le.numRleValues)}{const He=Im(X,Y,le,Re);return new Am(ne.name,He,ie)}})(b,T,I,P,q);case 9:return(function(X,Y,ne,me,ie){let le=null,Te=null,Re=null,He=null,it=null,rt=null,ft=null,St=null;for(let _t=0;_t<me;_t++){const at=Cr(Y,ne);if(at.byteLength!==0)switch(at.physicalStreamType){case or.PRESENT:{const et=Lh(Y,at.numValues,at.byteLength,ne);rt=new zs(et,at.numValues);break}case or.OFFSET:Te=Pr(Y,ne,at,!1,0,ie!=null||rt!=null?ie??rt:void 0);break;case or.LENGTH:{const et=Oo(Y,ne,at);Yr.DICTIONARY===at.logicalStreamType.lengthType?le=et:Yr.SYMBOL===at.logicalStreamType.lengthType?He=et:ft=et;break}case or.DATA:{const et=Y.subarray(ne.get(),ne.get()+at.byteLength);ne.add(at.byteLength);const zt=at.logicalStreamType.dictionaryType;Fs.FSST===zt?it=et:Fs.SINGLE===zt||Fs.SHARED===zt?Re=et:Fs.NONE===zt&&(St=et);break}}}return(function(_t,at,et,zt,Nt,qt,Ut){return at?new Wx(_t,et,zt,Nt,qt,at,Ut):null})(X,it,Te,le,Re,He,ie??rt)??(function(_t,at,et,zt,Nt){return at?Nt?new jc(_t,et,zt,at,Nt):new jc(_t,et,zt,at):null})(X,Re,Te,le,ie??rt)??(function(_t,at,et,zt,Nt){if(!at||!et)return null;if(zt)return Nt?new jc(_t,zt,at,et,Nt):new jc(_t,zt,at,et);if(Nt&&Nt.size()!==at.length-1){const qt=new Int32Array(Nt.size());let Ut=0;for(let fi=0;fi<Nt.size();fi++)qt[fi]=Nt.get(fi)?Ut++:0;return new jc(_t,qt,at,et,Nt)}return Nt?new jx(_t,at,et,Nt):new jx(_t,at,et)})(X,ft,St,Te,ie??rt)})(I.name,b,T,I.nullable?g-1:g,B);case 0:return(function(X,Y,ne,me,ie){const le=Cr(X,Y),Te=le.numValues,Re=Y.get(),He=Fh(ie)?ie:void 0,it=Lh(X,Te,le.byteLength,Y,He);Y.set(Re+le.byteLength);const rt=new zs(it,Te);return new B1(ne.name,rt,ie)})(b,T,I,0,q);case 6:case 5:return(function(X,Y,ne,me,ie){const le=Cr(X,Y),Te=Mf(le,me,X,Y),Re=ie.physicalType===5;if(Te===An.FLAT){const He=Ix(X,Y,le,Re,Fh(me)?me:void 0);return new Dx(ne.name,He,me)}if(Te===An.SEQUENCE){const He=Px(X,Y,le);return new Lx(ne.name,He[0],He[1],le.numRleValues)}{const He=Rx(X,Y,le,Re);return new Hx(ne.name,He,me)}})(b,T,I,q,P);case 7:return(function(X,Y,ne,me){const ie=Cr(X,Y),le=Fh(me)?me:void 0,Te=(function(Re,He,it,rt){const ft=He.get(),St=ft+it*Float32Array.BYTES_PER_ELEMENT,_t=new Uint8Array(Re.subarray(ft,St)).buffer,at=new Float32Array(_t);return He.set(St),rt?Tf(at,rt,0):at})(X,Y,ie.numValues,le);return new k1(ne.name,Te,me)})(b,T,I,q);case 8:return(function(X,Y,ne,me){const ie=Cr(X,Y),le=Fh(me)?me:void 0,Te=(function(Re,He,it,rt){const ft=He.get(),St=ft+it*Float64Array.BYTES_PER_ELEMENT,_t=new Uint8Array(Re.subarray(ft,St)).buffer,at=new Float64Array(_t);return He.set(St),rt?Tf(at,rt,0):at})(X,Y,ie.numValues,le);return new Mm(ne.name,Te,me)})(b,T,I,q);default:throw new Error(`The specified data type for the field is currently not supported: ${P}`)}})(l,r,e,h,n.scalarType,n):l===0?null:(function(g,b,T,E){let P=null,I=null,B=null,k=null,q=!1;for(;!q;){const me=Cr(g,b);switch(me.physicalStreamType){case or.LENGTH:Yr.DICTIONARY===me.logicalStreamType.lengthType?P=Oo(g,b,me):B=Oo(g,b,me);break;case or.DATA:Fs.SINGLE===me.logicalStreamType.dictionaryType||Fs.SHARED===me.logicalStreamType.dictionaryType?(I=g.subarray(b.get(),b.get()+me.byteLength),q=!0):k=g.subarray(b.get(),b.get()+me.byteLength),b.add(me.byteLength)}}const X=T.complexType.children,Y=[];let ne=0;for(const me of X){const ie=vr(g,b,1)[0];if(ie==0)continue;const le=me.name?`${T.name}${me.name}`:T.name;if(ie!==2||me.type!=="scalarField"||me.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const Te=Cr(g,b),Re=Lh(g,Te.numValues,Te.byteLength,b),He=Cr(g,b),it=Pr(g,b,He,!1,0,He.decompressedCount!==E?new zs(Re,Te.numValues):void 0);Y[ne++]=k?new Wx(le,it,P,I,B,k,new zs(Re,Te.numValues)):new jc(le,it,P,I,new zs(Re,Te.numValues))}return Y})(r,e,n,h)}function Fh(r){return r instanceof zs}function qx(r){switch(r){case 0:case 1:case 2:case 3:{const e={};e.nullable=!!(1&r),e.columnScope=0;const n={};return n.physicalType=r>1?6:4,n.type="physicalType",e.scalarType=n,e.type="scalarType",e}case 4:{const e={nullable:!1,columnScope:0},n={type:"physicalType",physicalType:0};return e.type="complexType",e.complexType=n,e}case 30:{const e={nullable:!1,columnScope:0},n={type:"physicalType",physicalType:1};return e.type="complexType",e.complexType=n,e}default:return(function(e){let n=null;switch(e){case 10:case 11:n=0;break;case 12:case 13:n=1;break;case 14:case 15:n=2;break;case 16:case 17:n=3;break;case 18:case 19:n=4;break;case 20:case 21:n=5;break;case 22:case 23:n=6;break;case 24:case 25:n=7;break;case 26:case 27:n=8;break;case 28:case 29:n=9;break;default:return null}const l={};l.nullable=!!(1&e),l.columnScope=0;const h={type:"physicalType"};return h.physicalType=n,l.type="scalarType",l.scalarType=h,l})(r)}}function Xx(r){return r>=10}function Zx(r){return r===30}function G1(r){if(r.name==="id")return!1;if(r.type==="scalarType"){const e=r.scalarType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(e.type==="logicalType")return!1}else if(r.type==="complexType"){const e=r.complexType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",r),!1}const H1=new TextDecoder;function Bm(r,e){const n=vr(r,e,1)[0];if(n===0)return"";const l=e.get(),h=r.subarray(l,l+n);return e.add(n),H1.decode(h)}function $x(r,e){const n=vr(r,e,1)[0]>>>0;if(n<10||n>30)throw new Error(`Unsupported field type code ${n}. Supported: 10-29(scalars), 30(STRUCT)`);const l=qx(n);if(Xx(n)&&(l.name=Bm(r,e)),Zx(n)){const h=vr(r,e,1)[0]>>>0;l.complexType.children=new Array(h);for(let p=0;p<h;p++)l.complexType.children[p]=$x(r,e)}return(function(h){return{name:h.name,nullable:h.nullable,scalarField:h.scalarType,complexField:h.complexType,type:h.type==="scalarType"?"scalarField":"complexField"}})(l)}function j1(r,e){const n=vr(r,e,1)[0]>>>0,l=qx(n);if(!l)throw new Error(`Unsupported column type code ${n}. Supported: 0-3(ID), 4(GEOMETRY), 10-29(scalars), 30(STRUCT)`);if(Xx(n)?l.name=Bm(r,e):n>=0&&n<=3?l.name="id":n===4&&(l.name="geometry"),Zx(n)){const h=vr(r,e,1)[0]>>>0,p=l.complexType;p.children=new Array(h);for(let g=0;g<h;g++)p.children[g]=$x(r,e)}return l}function W1(r,e){const n={featureTables:[]},l={};l.name=Bm(r,e);const h=vr(r,e,1)[0]>>>0,p=vr(r,e,1)[0]>>>0;l.columns=new Array(p);for(let g=0;g<p;g++)l.columns[g]=j1(r,e);return n.featureTables.push(l),[n,h]}function q1(r,e,n,l,h,p,g=!1){const b=e.scalarType.physicalType,T=Mf(h,p,r,n);if(b===4)switch(T){case An.FLAT:{const E=Pr(r,n,h,!1);return new Sm(l,E,p)}case An.SEQUENCE:{const E=Cx(r,n,h);return new Em(l,E[0],E[1],h.numRleValues)}case An.CONST:{const E=Im(r,n,h,!1);return new Am(l,E,p)}}else switch(T){case An.FLAT:{if(g){const P=(function(I,B,k){const q=(function(X,Y,ne){const me=new Float64Array(ne);for(let ie=0;ie<ne;ie++)me[ie]=L1(X,Y);return me})(I,B,k.numValues);return(function(X,Y){switch(Y.logicalLevelTechnique1){case Hi.DELTA:return Y.logicalLevelTechnique2===Hi.RLE&&(X=Ex(X,Y.runs,Y.numRleValues)),(function(ne){ne[0]=Gc(ne[0]);const me=ne.length/4*4;let ie=1;if(me>=4)for(;ie<me-4;ie+=4){const le=ne[ie+1],Te=ne[ie+2],Re=ne[ie+3];ne[ie]=Gc(ne[ie])+ne[ie-1],ne[ie+1]=Gc(le)+ne[ie],ne[ie+2]=Gc(Te)+ne[ie+1],ne[ie+3]=Gc(Re)+ne[ie+2]}for(;ie!=ne.length;++ie)ne[ie]=Gc(ne[ie])+ne[ie-1]})(X),X;case Hi.RLE:return(function(ne,me){return Ex(ne,me.runs,me.numRleValues)})(X,Y);case Hi.NONE:return X;default:throw new Error(`The specified Logical level technique is not supported: ${Y.logicalLevelTechnique1}`)}})(q,k)})(r,n,h);return new Mm(l,P,p)}const E=Ix(r,n,h,!1);return new Dx(l,E,p)}case An.SEQUENCE:{const E=Px(r,n,h);return new Lx(l,E[0],E[1],h.numRleValues)}case An.CONST:{const E=Rx(r,n,h,!1);return new Hx(l,E,p)}}throw new Error("Vector type not supported for id column.")}class X1{constructor(e,n){var l;switch(this._featureData=e,this.properties=this._featureData.properties||{},(l=this._featureData.geometry)===null||l===void 0?void 0:l.type){case qn.POINT:case qn.MULTIPOINT:this.type=1;break;case qn.LINESTRING:case qn.MULTILINESTRING:this.type=2;break;case qn.POLYGON:case qn.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=n,this.id=Number(this._featureData.id)}loadGeometry(){const e=[];for(const n of this._featureData.geometry.coordinates){const l=[];for(const h of n)l.push(new M(h.x,h.y));e.push(l)}return e}}class Z1{constructor(e){this.features=[],this.featureTable=e,this.name=e.name,this.extent=e.extent,this.version=2,this.features=e.getFeatures(),this.length=this.features.length}feature(e){return new X1(this.features[e],this.extent)}}class Yx{constructor(e){this.layers={};const n=(function(l,h,p=!0){const g=new R1(0),b=[];for(;g.get()<l.length;){const T=vr(l,g,1)[0]>>>0,E=g.get()+T;if(E>l.length)throw new Error(`Block overruns tile: ${E} > ${l.length}`);if(vr(l,g,1)[0]>>>0!=1){g.set(E);continue}const P=W1(l,g),I=P[1],B=P[0].featureTables[0];let k=null,q=null;const X=[];let Y=0;for(const me of B.columns){const ie=me.name;if(ie==="id"){let le=null;if(me.nullable){const Re=Cr(l,g),He=g.get(),it=Lh(l,Re.numValues,Re.byteLength,g);g.set(He+Re.byteLength),le=new zs(it,Re.numValues)}const Te=Cr(l,g);Y=Te.decompressedCount,k=q1(l,me,g,ie,Te,le??Y,p)}else if(ie==="geometry"){const le=vr(l,g,1)[0];if(Y===0){const Te=g.get();Y=Cr(l,g).decompressedCount,g.set(Te)}q=N1(l,le,g,Y)}else{const le=G1(me)?vr(l,g,1)[0]:1;if(le===0)continue;const Te=V1(l,g,me,le,Y);if(Te)if(Array.isArray(Te))for(const Re of Te)X.push(Re);else X.push(Te)}}const ne=new I1(B.name,q,k,X,I);b.push(ne),g.set(E)}return b})(new Uint8Array(e));this.layers=n.reduce(((l,h)=>Object.assign(Object.assign({},l),{[h.name]:new Z1(h)})),{})}}class $1{constructor(e,n){this.feature=e,this.type=e.type,this.properties=e.tags?e.tags:{},this.extent=n,"id"in e&&(typeof e.id=="string"?this.id=parseInt(e.id,10):typeof e.id!="number"||isNaN(e.id)||(this.id=e.id))}loadGeometry(){const e=[],n=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const l of n){const h=[];for(const p of l)h.push(new M(p[0],p[1]));e.push(h)}return e}}const zh="_geojsonTileLayer";function Y1(r,e){e.writeVarintField(15,r.version||1),e.writeStringField(1,r.name||""),e.writeVarintField(5,r.extent||4096);const n={keys:[],values:[],keycache:{},valuecache:{}};for(let p=0;p<r.length;p++)n.feature=r.feature(p),e.writeMessage(2,K1,n);const l=n.keys;for(const p of l)e.writeStringField(3,p);const h=n.values;for(const p of h)e.writeMessage(4,eT,p)}function K1(r,e){if(!r.feature)return;const n=r.feature;n.id!==void 0&&e.writeVarintField(1,n.id),e.writeMessage(2,J1,r),e.writeVarintField(3,n.type),e.writeMessage(4,Q1,n)}function J1(r,e){for(const n in r.feature?.properties){let l=r.feature.properties[n],h=r.keycache[n];if(l==null)continue;h===void 0&&(r.keys.push(n),h=r.keys.length-1,r.keycache[n]=h),e.writeVarint(h),typeof l!="string"&&typeof l!="boolean"&&typeof l!="number"&&(l=JSON.stringify(l));const p=typeof l+":"+l;let g=r.valuecache[p];g===void 0&&(r.values.push(l),g=r.values.length-1,r.valuecache[p]=g),e.writeVarint(g)}}function km(r,e){return(e<<3)+(7&r)}function Kx(r){return r<<1^r>>31}function Q1(r,e){const n=r.loadGeometry(),l=r.type;let h=0,p=0;for(const g of n){let b=1;l===1&&(b=g.length),e.writeVarint(km(1,b));const T=l===3?g.length-1:g.length;for(let E=0;E<T;E++){E===1&&l!==1&&e.writeVarint(km(2,T-1));const P=g[E].x-h,I=g[E].y-p;e.writeVarint(Kx(P)),e.writeVarint(Kx(I)),h+=P,p+=I}r.type===3&&e.writeVarint(km(7,1))}}function eT(r,e){const n=typeof r;n==="string"?e.writeStringField(1,r):n==="boolean"?e.writeBooleanField(7,r):n==="number"&&(r%1!=0?e.writeDoubleField(3,r):r<0?e.writeSVarintField(6,r):e.writeVarintField(5,r))}class Jx{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Co(xt,16,0),this.grid3D=new Co(xt,16,0),this.featureIndexArray=new ee,this.promoteId=n}insert(e,n,l,h,p,g){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,h,p);const T=g?this.grid3D:this.grid;for(let E=0;E<n.length;E++){const P=n[E],I=[1/0,1/0,-1/0,-1/0];for(let B=0;B<P.length;B++){const k=P[B];I[0]=Math.min(I[0],k.x),I[1]=Math.min(I[1],k.y),I[2]=Math.max(I[2],k.x),I[3]=Math.max(I[3],k.y)}I[0]<xt&&I[1]<xt&&I[2]>=0&&I[3]>=0&&T.insert(b,I[0],I[1],I[2],I[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new Ny(new _f(this.rawTileData)).layers:new Yx(this.rawTileData).layers,this.sourceLayerCoder=new vx(this.vtLayers?Object.keys(this.vtLayers).sort():[zh])),this.vtLayers}query(e,n,l,h){this.loadVTLayers();const p=e.params,g=xt/e.tileSize/e.scale,b=al(p.filter,p.globalState),T=e.queryGeometry,E=e.queryPadding*g,P=Il.fromPoints(T),I=this.grid.query(P.minX-E,P.minY-E,P.maxX+E,P.maxY+E),B=Il.fromPoints(e.cameraQueryGeometry).expandBy(E),k=this.grid3D.query(B.minX,B.minY,B.maxX,B.maxY,((Y,ne,me,ie)=>(function(le,Te,Re,He,it){for(const ft of le)if(Te<=ft.x&&Re<=ft.y&&He>=ft.x&&it>=ft.y)return!0;const rt=[new M(Te,Re),new M(Te,it),new M(He,it),new M(He,Re)];if(le.length>2){for(const ft of rt)if(Dc(le,ft))return!0}for(let ft=0;ft<le.length-1;ft++)if(iw(le[ft],le[ft+1],rt))return!0;return!1})(e.cameraQueryGeometry,Y-E,ne-E,me+E,ie+E)));for(const Y of k)I.push(Y);I.sort(tT);const q={};let X;for(let Y=0;Y<I.length;Y++){const ne=I[Y];if(ne===X)continue;X=ne;const me=this.featureIndexArray.get(ne);let ie=null;this.loadMatchingFeature(q,me.bucketIndex,me.sourceLayerIndex,me.featureIndex,b,p.layers,p.availableImages,n,l,h,((le,Te,Re)=>(ie||(ie=sa(le)),Te.queryIntersectsFeature({queryGeometry:T,feature:le,featureState:Re,geometry:ie,zoom:this.z,transform:e.transform,pixelsToTileUnits:g,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation}))))}return q}loadMatchingFeature(e,n,l,h,p,g,b,T,E,P,I){const B=this.bucketLayerIDs[n];if(g&&!B.some((Y=>g.has(Y))))return;const k=this.sourceLayerCoder.decode(l),q=this.vtLayers[k].feature(h);if(p.needGeometry){const Y=aa(q,!0);if(!p.filter(new ji(this.tileID.overscaledZ),Y,this.tileID.canonical))return}else if(!p.filter(new ji(this.tileID.overscaledZ),q))return;const X=this.getId(q,k);for(let Y=0;Y<B.length;Y++){const ne=B[Y];if(g&&!g.has(ne))continue;const me=T[ne];if(!me)continue;let ie={};X&&P&&(ie=P.getState(me.sourceLayer||zh,X));const le=Dt({},E[ne]);le.paint=Qx(le.paint,me.paint,q,ie,b),le.layout=Qx(le.layout,me.layout,q,ie,b);const Te=!I||I(q,me,ie);if(!Te)continue;const Re=new bx(q,this.z,this.x,this.y,X);Re.layer=le;let He=e[ne];He===void 0&&(He=e[ne]=[]),He.push({featureIndex:h,feature:Re,intersectionZ:Te})}}lookupSymbolFeatures(e,n,l,h,p,g,b,T){const E={};this.loadVTLayers();const P=al(p.filterSpec,p.globalState);for(const I of e)this.loadMatchingFeature(E,l,h,I,P,g,b,T,n);return E}hasLayer(e){for(const n of this.bucketLayerIDs)for(const l of n)if(e===l)return!0;return!1}getId(e,n){var l;let h=e.id;return this.promoteId&&(h=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof h=="boolean"&&(h=Number(h)),h===void 0&&(!((l=e.properties)===null||l===void 0)&&l.cluster)&&this.promoteId&&(h=Number(e.properties.cluster_id))),h}}function Qx(r,e,n,l,h){return Gt(r,((p,g)=>{const b=e instanceof xl?e.get(g):null;return b&&b.evaluate?b.evaluate(n,l,h):b}))}function tT(r,e){return e-r}function e0(r,e,n,l,h){const p=[];for(let g=0;g<r.length;g++){const b=r[g];let T;for(let E=0;E<b.length-1;E++){let P=b[E],I=b[E+1];P.x<e&&I.x<e||(P.x<e?P=new M(e,P.y+(e-P.x)/(I.x-P.x)*(I.y-P.y))._round():I.x<e&&(I=new M(e,P.y+(e-P.x)/(I.x-P.x)*(I.y-P.y))._round()),P.y<n&&I.y<n||(P.y<n?P=new M(P.x+(n-P.y)/(I.y-P.y)*(I.x-P.x),n)._round():I.y<n&&(I=new M(P.x+(n-P.y)/(I.y-P.y)*(I.x-P.x),n)._round()),P.x>=l&&I.x>=l||(P.x>=l?P=new M(l,P.y+(l-P.x)/(I.x-P.x)*(I.y-P.y))._round():I.x>=l&&(I=new M(l,P.y+(l-P.x)/(I.x-P.x)*(I.y-P.y))._round()),P.y>=h&&I.y>=h||(P.y>=h?P=new M(P.x+(h-P.y)/(I.y-P.y)*(I.x-P.x),h)._round():I.y>=h&&(I=new M(P.x+(h-P.y)/(I.y-P.y)*(I.x-P.x),h)._round()),T&&P.equals(T[T.length-1])||(T=[P],p.push(T)),T.push(I)))))}}return p}function t0(r,e,n,l,h){switch(e){case 1:return(function(p,g,b,T){const E=[];for(const P of p)for(const I of P){const B=T===0?I.x:I.y;B>=g&&B<=b&&E.push([I])}return E})(r,n,l,h);case 2:return i0(r,n,l,h,!1);case 3:return i0(r,n,l,h,!0)}return[]}function iT(r,e,n,l,h){const p=l===0?nT:rT;let g=[];const b=[];for(let P=0;P<r.length-1;P++){const I=r[P],B=r[P+1],k=l===0?I.x:I.y,q=l===0?B.x:B.y;let X=!1;k<e?q>e&&g.push(p(I,B,e)):k>n?q<n&&g.push(p(I,B,n)):g.push(I),q<e&&k>=e&&(g.push(p(I,B,e)),X=!0),q>n&&k<=n&&(g.push(p(I,B,n)),X=!0),!h&&X&&(b.push(g),g=[])}const T=r.length-1,E=l===0?r[T].x:r[T].y;return E>=e&&E<=n&&g.push(r[T]),h&&g.length>0&&!g[0].equals(g[g.length-1])&&g.push(new M(g[0].x,g[0].y)),g.length>0&&b.push(g),b}function i0(r,e,n,l,h){const p=[];for(const g of r){const b=iT(g,e,n,l,h);b.length>0&&p.push(...b)}return p}function nT(r,e,n){return new M(n,r.y+(n-r.x)/(e.x-r.x)*(e.y-r.y))}function rT(r,e,n){return new M(r.x+(n-r.y)/(e.y-r.y)*(e.x-r.x),n)}Ft("FeatureIndex",Jx,{omit:["rawTileData","sourceLayerCoder"]});class No extends M{constructor(e,n,l,h){super(e,n),this.angle=l,h!==void 0&&(this.segment=h)}clone(){return new No(this.x,this.y,this.angle,this.segment)}}function n0(r,e,n,l,h){if(e.segment===void 0||n===0)return!0;let p=e,g=e.segment+1,b=0;for(;b>-n/2;){if(g--,g<0)return!1;b-=r[g].dist(p),p=r[g]}b+=r[g].dist(r[g+1]),g++;const T=[];let E=0;for(;b<n/2;){const P=r[g],I=r[g+1];if(!I)return!1;let B=r[g-1].angleTo(P)-P.angleTo(I);for(B=Math.abs((B+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:b,angleDelta:B}),E+=B;b-T[0].distance>l;)E-=T.shift().angleDelta;if(E>h)return!1;g++,b+=P.dist(I)}return!0}function r0(r){let e=0;for(let n=0;n<r.length-1;n++)e+=r[n].dist(r[n+1]);return e}function s0(r,e,n){return r?.6*e*n:0}function a0(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function sT(r,e,n,l,h,p){const g=s0(n,h,p),b=a0(n,l)*p;let T=0;const E=r0(r)/2;for(let P=0;P<r.length-1;P++){const I=r[P],B=r[P+1],k=I.dist(B);if(T+k>E){const q=(E-T)/k,X=cn.number(I.x,B.x,q),Y=cn.number(I.y,B.y,q),ne=new No(X,Y,B.angleTo(I),P);return ne._round(),!g||n0(r,ne,b,g,e)?ne:void 0}T+=k}}function aT(r,e,n,l,h,p,g,b,T){const E=s0(l,p,g),P=a0(l,h),I=P*g,B=r[0].x===0||r[0].x===T||r[0].y===0||r[0].y===T;return e-I<e/4&&(e=I+e/4),o0(r,B?e/2*b%e:(P/2+2*p)*g*b%e,e,E,n,I,B,!1,T)}function o0(r,e,n,l,h,p,g,b,T){const E=p/2,P=r0(r);let I=0,B=e-n,k=[];for(let q=0;q<r.length-1;q++){const X=r[q],Y=r[q+1],ne=X.dist(Y),me=Y.angleTo(X);for(;B+n<I+ne;){B+=n;const ie=(B-I)/ne,le=cn.number(X.x,Y.x,ie),Te=cn.number(X.y,Y.y,ie);if(le>=0&&le<T&&Te>=0&&Te<T&&B-E>=0&&B+E<=P){const Re=new No(le,Te,me,q);Re._round(),l&&!n0(r,Re,p,l,h)||k.push(Re)}}I+=ne}return b||k.length||g||(k=o0(r,I/2,n,l,h,p,g,!0,T)),k}function l0(r,e,n,l){const h=[],p=r.image,g=p.pixelRatio,b=p.paddedRect.w-2,T=p.paddedRect.h-2;let E={x1:r.left,y1:r.top,x2:r.right,y2:r.bottom};const P=p.stretchX||[[0,b]],I=p.stretchY||[[0,T]],B=(et,zt)=>et+zt[1]-zt[0],k=P.reduce(B,0),q=I.reduce(B,0),X=b-k,Y=T-q;let ne=0,me=k,ie=0,le=q,Te=0,Re=X,He=0,it=Y;if(p.content&&l){const et=p.content,zt=et[2]-et[0],Nt=et[3]-et[1];(p.textFitWidth||p.textFitHeight)&&(E=nx(r)),ne=Pf(P,0,et[0]),ie=Pf(I,0,et[1]),me=Pf(P,et[0],et[2]),le=Pf(I,et[1],et[3]),Te=et[0]-ne,He=et[1]-ie,Re=zt-me,it=Nt-le}const rt=E.x1,ft=E.y1,St=E.x2-rt,_t=E.y2-ft,at=(et,zt,Nt,qt)=>{const Ut=If(et.stretch-ne,me,St,rt),fi=Rf(et.fixed-Te,Re,et.stretch,k),dn=If(zt.stretch-ie,le,_t,ft),On=Rf(zt.fixed-He,it,zt.stretch,q),cr=If(Nt.stretch-ne,me,St,rt),ws=Rf(Nt.fixed-Te,Re,Nt.stretch,k),Ir=If(qt.stretch-ie,le,_t,ft),er=Rf(qt.fixed-He,it,qt.stretch,q),ur=new M(Ut,dn),Cn=new M(cr,dn),tr=new M(cr,Ir),br=new M(Ut,Ir),wr=new M(fi/g,On/g),Nr=new M(ws/g,er/g),hr=e*Math.PI/180;if(hr){const Xn=Math.sin(hr),gn=Math.cos(hr),Nn=[gn,-Xn,Xn,gn];ur._matMult(Nn),Cn._matMult(Nn),br._matMult(Nn),tr._matMult(Nn)}const Br=et.stretch+et.fixed,Ts=zt.stretch+zt.fixed;return{tl:ur,tr:Cn,bl:br,br:tr,tex:{x:p.paddedRect.x+1+Br,y:p.paddedRect.y+1+Ts,w:Nt.stretch+Nt.fixed-Br,h:qt.stretch+qt.fixed-Ts},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:wr,pixelOffsetBR:Nr,minFontScaleX:Re/g/St,minFontScaleY:it/g/_t,isSDF:n}};if(l&&(p.stretchX||p.stretchY)){const et=c0(P,X,k),zt=c0(I,Y,q);for(let Nt=0;Nt<et.length-1;Nt++){const qt=et[Nt],Ut=et[Nt+1];for(let fi=0;fi<zt.length-1;fi++)h.push(at(qt,zt[fi],Ut,zt[fi+1]))}}else h.push(at({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:T+1}));return h}function Pf(r,e,n){let l=0;for(const h of r)l+=Math.max(e,Math.min(n,h[1]))-Math.max(e,Math.min(n,h[0]));return l}function c0(r,e,n){const l=[{fixed:-1,stretch:0}];for(const[h,p]of r){const g=l[l.length-1];l.push({fixed:h-g.stretch,stretch:g.stretch}),l.push({fixed:h-g.stretch,stretch:g.stretch+(p-h)})}return l.push({fixed:e+1,stretch:n}),l}function If(r,e,n,l){return r/e*n+l}function Rf(r,e,n,l){return r-e*n/l}Ft("Anchor",No);class Df{constructor(e,n,l,h,p,g,b,T,E,P){var I;if(this.boxStartIndex=e.length,E){let B=g.top,k=g.bottom;const q=g.collisionPadding;q&&(B-=q[1],k+=q[3]);let X=k-B;X>0&&(X=Math.max(10,X),this.circleDiameter=X)}else{const B=!((I=g.image)===null||I===void 0)&&I.content&&(g.image.textFitWidth||g.image.textFitHeight)?nx(g):{x1:g.left,y1:g.top,x2:g.right,y2:g.bottom};B.y1=B.y1*b-T[0],B.y2=B.y2*b+T[2],B.x1=B.x1*b-T[3],B.x2=B.x2*b+T[1];const k=g.collisionPadding;if(k&&(B.x1-=k[0]*b,B.y1-=k[1]*b,B.x2+=k[2]*b,B.y2+=k[3]*b),P){const q=new M(B.x1,B.y1),X=new M(B.x2,B.y1),Y=new M(B.x1,B.y2),ne=new M(B.x2,B.y2),me=P*Math.PI/180;q._rotate(me),X._rotate(me),Y._rotate(me),ne._rotate(me),B.x1=Math.min(q.x,X.x,Y.x,ne.x),B.x2=Math.max(q.x,X.x,Y.x,ne.x),B.y1=Math.min(q.y,X.y,Y.y,ne.y),B.y2=Math.max(q.y,X.y,Y.y,ne.y)}e.emplaceBack(n.x,n.y,B.x1,B.y1,B.x2,B.y2,l,h,p)}this.boxEndIndex=e.length}}class oT{constructor(e=[],n=(l,h)=>l<h?-1:l>h?1:0){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:l}=this,h=n[e];for(;e>0;){const p=e-1>>1,g=n[p];if(l(h,g)>=0)break;n[e]=g,e=p}n[e]=h}_down(e){const{data:n,compare:l}=this,h=this.length>>1,p=n[e];for(;e<h;){let g=1+(e<<1);const b=g+1;if(b<this.length&&l(n[b],n[g])<0&&(g=b),l(n[g],p)>=0)break;n[e]=n[g],e=g}n[e]=p}}function lT(r,e=1,n=!1){const l=Il.fromPoints(r[0]),h=Math.min(l.width(),l.height());let p=h/2;const g=new oT([],cT),{minX:b,minY:T,maxX:E,maxY:P}=l;if(h===0)return new M(b,T);for(let k=b;k<E;k+=h)for(let q=T;q<P;q+=h)g.push(new Wc(k+p,q+p,p,r));let I=(function(k){let q=0,X=0,Y=0;const ne=k[0];for(let me=0,ie=ne.length,le=ie-1;me<ie;le=me++){const Te=ne[me],Re=ne[le],He=Te.x*Re.y-Re.x*Te.y;X+=(Te.x+Re.x)*He,Y+=(Te.y+Re.y)*He,q+=3*He}return new Wc(X/q,Y/q,0,k)})(r),B=g.length;for(;g.length;){const k=g.pop();(k.d>I.d||!I.d)&&(I=k,n&&console.log("found best %d after %d probes",Math.round(1e4*k.d)/1e4,B)),k.max-I.d<=e||(p=k.h/2,g.push(new Wc(k.p.x-p,k.p.y-p,p,r)),g.push(new Wc(k.p.x+p,k.p.y-p,p,r)),g.push(new Wc(k.p.x-p,k.p.y+p,p,r)),g.push(new Wc(k.p.x+p,k.p.y+p,p,r)),B+=4)}return n&&(console.log(`num probes: ${B}`),console.log(`best distance: ${I.d}`)),I.p}function cT(r,e){return e.max-r.max}function Wc(r,e,n,l){this.p=new M(r,e),this.h=n,this.d=(function(h,p){let g=!1,b=1/0;for(let T=0;T<p.length;T++){const E=p[T];for(let P=0,I=E.length,B=I-1;P<I;B=P++){const k=E[P],q=E[B];k.y>h.y!=q.y>h.y&&h.x<(q.x-k.x)*(h.y-k.y)/(q.y-k.y)+k.x&&(g=!g),b=Math.min(b,py(h,k,q))}}return(g?1:-1)*Math.sqrt(b)})(this.p,l),this.max=this.d+this.h*Math.SQRT2}var lr;_.aP=void 0,(lr=_.aP||(_.aP={}))[lr.center=1]="center",lr[lr.left=2]="left",lr[lr.right=3]="right",lr[lr.top=4]="top",lr[lr.bottom=5]="bottom",lr[lr["top-left"]=6]="top-left",lr[lr["top-right"]=7]="top-right",lr[lr["bottom-left"]=8]="bottom-left",lr[lr["bottom-right"]=9]="bottom-right";const Um=Number.POSITIVE_INFINITY;function u0(r,e){return e[1]!==Um?(function(n,l,h){let p=0,g=0;switch(l=Math.abs(l),h=Math.abs(h),n){case"top-right":case"top-left":case"top":g=h-7;break;case"bottom-right":case"bottom-left":case"bottom":g=7-h}switch(n){case"top-right":case"bottom-right":case"right":p=-l;break;case"top-left":case"bottom-left":case"left":p=l}return[p,g]})(r,e[0],e[1]):(function(n,l){let h=0,p=0;l<0&&(l=0);const g=l/Math.SQRT2;switch(n){case"top-right":case"top-left":p=g-7;break;case"bottom-right":case"bottom-left":p=7-g;break;case"bottom":p=7-l;break;case"top":p=l-7}switch(n){case"top-right":case"bottom-right":h=-g;break;case"top-left":case"bottom-left":h=g;break;case"left":h=l;break;case"right":h=-l}return[h,p]})(r,e[0])}function h0(r,e,n){var l;const h=r.layout,p=(l=h.get("text-variable-anchor-offset"))===null||l===void 0?void 0:l.evaluate(e,{},n);if(p){const b=p.values,T=[];for(let E=0;E<b.length;E+=2){const P=T[E]=b[E],I=b[E+1].map((B=>B*Wn));P.startsWith("top")?I[1]-=7:P.startsWith("bottom")&&(I[1]+=7),T[E+1]=I}return new gr(T)}const g=h.get("text-variable-anchor");if(g){let b;b=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[h.get("text-radial-offset").evaluate(e,{},n)*Wn,Um]:h.get("text-offset").evaluate(e,{},n).map((E=>E*Wn));const T=[];for(const E of g)T.push(E,u0(E,b));return new gr(T)}return null}function Vm(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function uT(r,e,n,l,h,p,g,b,T,E,P,I){let B=p.textMaxSize.evaluate(e,{});B===void 0&&(B=g);const k=r.layers[0].layout,q=k.get("icon-offset").evaluate(e,{},P),X=f0(n.horizontal),Y=g/24,ne=r.tilePixelRatio*Y,me=r.tilePixelRatio*B/24,ie=r.tilePixelRatio*b,le=r.tilePixelRatio*k.get("symbol-spacing"),Te=k.get("text-padding")*r.tilePixelRatio,Re=(function(Nt,qt,Ut,fi=1){const dn=Nt.get("icon-padding").evaluate(qt,{},Ut),On=dn&&dn.values;return[On[0]*fi,On[1]*fi,On[2]*fi,On[3]*fi]})(k,e,P,r.tilePixelRatio),He=k.get("text-max-angle")/180*Math.PI,it=k.get("text-rotation-alignment")!=="viewport"&&k.get("symbol-placement")!=="point",rt=k.get("icon-rotation-alignment")==="map"&&k.get("symbol-placement")!=="point",ft=k.get("symbol-placement"),St=le/2,_t=k.get("icon-text-fit");let at;l&&_t!=="none"&&(r.allowVerticalPlacement&&n.vertical&&(at=rx(l,n.vertical,_t,k.get("icon-text-fit-padding"),q,Y)),X&&(l=rx(l,X,_t,k.get("icon-text-fit-padding"),q,Y)));const et=P?I.line.getGranularityForZoomLevel(P.z):1,zt=(Nt,qt)=>{qt.x<0||qt.x>=xt||qt.y<0||qt.y>=xt||(function(Ut,fi,dn,On,cr,ws,Ir,er,ur,Cn,tr,br,wr,Nr,hr,Br,Ts,Xn,gn,Nn,vn,Zn,Wa,Os,Bh){const Bo=Ut.addToLineVertexArray(fi,dn);let Dl,qc,Xc,Zc,_0=0,y0=0,x0=0,v0=0,$m=-1,Ym=-1;const qa={};let b0=En("");if(Ut.allowVerticalPlacement&&On.vertical){const Tr=er.layout.get("text-rotate").evaluate(vn,{},Os)+90;Xc=new Df(ur,fi,Cn,tr,br,On.vertical,wr,Nr,hr,Tr),Ir&&(Zc=new Df(ur,fi,Cn,tr,br,Ir,Ts,Xn,hr,Tr))}if(cr){const Tr=er.layout.get("icon-rotate").evaluate(vn,{}),hs=er.layout.get("icon-text-fit")!=="none",Ll=l0(cr,Tr,Wa,hs),Bs=Ir?l0(Ir,Tr,Wa,hs):void 0;qc=new Df(ur,fi,Cn,tr,br,cr,Ts,Xn,!1,Tr),_0=4*Ll.length;const Fl=Ut.iconSizeData;let oa=null;Fl.kind==="source"?(oa=[ja*er.layout.get("icon-size").evaluate(vn,{})],oa[0]>Lo&&ci(`${Ut.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Fl.kind==="composite"&&(oa=[ja*Zn.compositeIconSizes[0].evaluate(vn,{},Os),ja*Zn.compositeIconSizes[1].evaluate(vn,{},Os)],(oa[0]>Lo||oa[1]>Lo)&&ci(`${Ut.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ut.addSymbols(Ut.icon,Ll,oa,Nn,gn,vn,_.az.none,fi,Bo.lineStartIndex,Bo.lineLength,-1,Os),$m=Ut.icon.placedSymbolArray.length-1,Bs&&(y0=4*Bs.length,Ut.addSymbols(Ut.icon,Bs,oa,Nn,gn,vn,_.az.vertical,fi,Bo.lineStartIndex,Bo.lineLength,-1,Os),Ym=Ut.icon.placedSymbolArray.length-1)}const w0=Object.keys(On.horizontal);for(const Tr of w0){const hs=On.horizontal[Tr];if(!Dl){b0=En(hs.text);const Bs=er.layout.get("text-rotate").evaluate(vn,{},Os);Dl=new Df(ur,fi,Cn,tr,br,hs,wr,Nr,hr,Bs)}const Ll=hs.positionedLines.length===1;if(x0+=d0(Ut,fi,hs,ws,er,hr,vn,Br,Bo,On.vertical?_.az.horizontal:_.az.horizontalOnly,Ll?w0:[Tr],qa,$m,Zn,Os),Ll)break}On.vertical&&(v0+=d0(Ut,fi,On.vertical,ws,er,hr,vn,Br,Bo,_.az.vertical,["vertical"],qa,Ym,Zn,Os));const fT=Dl?Dl.boxStartIndex:Ut.collisionBoxArray.length,pT=Dl?Dl.boxEndIndex:Ut.collisionBoxArray.length,mT=Xc?Xc.boxStartIndex:Ut.collisionBoxArray.length,gT=Xc?Xc.boxEndIndex:Ut.collisionBoxArray.length,_T=qc?qc.boxStartIndex:Ut.collisionBoxArray.length,yT=qc?qc.boxEndIndex:Ut.collisionBoxArray.length,xT=Zc?Zc.boxStartIndex:Ut.collisionBoxArray.length,vT=Zc?Zc.boxEndIndex:Ut.collisionBoxArray.length;let Ns=-1;const Ff=(Tr,hs)=>Tr&&Tr.circleDiameter?Math.max(Tr.circleDiameter,hs):hs;Ns=Ff(Dl,Ns),Ns=Ff(Xc,Ns),Ns=Ff(qc,Ns),Ns=Ff(Zc,Ns);const T0=Ns>-1?1:0;T0&&(Ns*=Bh/Wn),Ut.glyphOffsetArray.length>=kc.MAX_GLYPHS&&ci("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),vn.sortKey!==void 0&&Ut.addToSortKeyRanges(Ut.symbolInstances.length,vn.sortKey);const bT=h0(er,vn,Os),[wT,TT]=(function(Tr,hs){const Ll=Tr.length,Bs=hs?.values;if(Bs?.length>0)for(let Fl=0;Fl<Bs.length;Fl+=2){const oa=Bs[Fl+1];Tr.emplaceBack(_.aP[Bs[Fl]],oa[0],oa[1])}return[Ll,Tr.length]})(Ut.textAnchorOffsets,bT);Ut.symbolInstances.emplaceBack(fi.x,fi.y,qa.right>=0?qa.right:-1,qa.center>=0?qa.center:-1,qa.left>=0?qa.left:-1,qa.vertical||-1,$m,Ym,b0,fT,pT,mT,gT,_T,yT,xT,vT,Cn,x0,v0,_0,y0,T0,0,wr,Ns,wT,TT)})(r,qt,Nt,n,l,h,at,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,ne,[Te,Te,Te,Te],it,T,ie,Re,rt,q,e,p,E,P,g)};if(ft==="line")for(const Nt of e0(e.geometry,0,0,xt,xt)){const qt=Pl(Nt,et),Ut=aT(qt,le,He,n.vertical||X,l,24,me,r.overscaling,xt);for(const fi of Ut)X&&hT(r,X.text,St,fi)||zt(qt,fi)}else if(ft==="line-center"){for(const Nt of e.geometry)if(Nt.length>1){const qt=Pl(Nt,et),Ut=sT(qt,He,n.vertical||X,l,24,me);Ut&&zt(qt,Ut)}}else if(e.type==="Polygon")for(const Nt of Ql(e.geometry,0)){const qt=lT(Nt,16);zt(Pl(Nt[0],et,!0),new No(qt.x,qt.y,0))}else if(e.type==="LineString")for(const Nt of e.geometry){const qt=Pl(Nt,et);zt(qt,new No(qt[0].x,qt[0].y,0))}else if(e.type==="Point")for(const Nt of e.geometry)for(const qt of Nt)zt([qt],new No(qt.x,qt.y,0))}function d0(r,e,n,l,h,p,g,b,T,E,P,I,B,k,q){const X=(function(me,ie,le,Te,Re,He,it,rt){const ft=Te.layout.get("text-rotate").evaluate(He,{})*Math.PI/180,St=[];for(const _t of ie.positionedLines)for(const at of _t.positionedGlyphs){if(!at.rect)continue;const et=at.rect||{};let zt=4,Nt=!0,qt=1,Ut=0;const fi=(Re||rt)&&at.vertical,dn=at.metrics.advance*at.scale/2;if(rt&&ie.verticalizable&&(Ut=_t.lineOffset/2-(at.imageName?-(Wn-at.metrics.width*at.scale)/2:(at.scale-1)*Wn)),at.imageName){const Xn=it[at.imageName];Nt=Xn.sdf,qt=Xn.pixelRatio,zt=1/qt}const On=Re?[at.x+dn,at.y]:[0,0];let cr=Re?[0,0]:[at.x+dn+le[0],at.y+le[1]-Ut],ws=[0,0];fi&&(ws=cr,cr=[0,0]);const Ir=at.metrics.isDoubleResolution?2:1,er=(at.metrics.left-zt)*at.scale-dn+cr[0],ur=(-at.metrics.top-zt)*at.scale+cr[1],Cn=er+et.w/Ir*at.scale/qt,tr=ur+et.h/Ir*at.scale/qt,br=new M(er,ur),wr=new M(Cn,ur),Nr=new M(er,tr),hr=new M(Cn,tr);if(fi){const Xn=new M(-dn,dn- -17),gn=-Math.PI/2,Nn=12-dn,vn=new M(22-Nn,-(at.imageName?Nn:0)),Zn=new M(...ws);br._rotateAround(gn,Xn)._add(vn)._add(Zn),wr._rotateAround(gn,Xn)._add(vn)._add(Zn),Nr._rotateAround(gn,Xn)._add(vn)._add(Zn),hr._rotateAround(gn,Xn)._add(vn)._add(Zn)}if(ft){const Xn=Math.sin(ft),gn=Math.cos(ft),Nn=[gn,-Xn,Xn,gn];br._matMult(Nn),wr._matMult(Nn),Nr._matMult(Nn),hr._matMult(Nn)}const Br=new M(0,0),Ts=new M(0,0);St.push({tl:br,tr:wr,bl:Nr,br:hr,tex:et,writingMode:ie.writingMode,glyphOffset:On,sectionIndex:at.sectionIndex,isSDF:Nt,pixelOffsetTL:Br,pixelOffsetBR:Ts,minFontScaleX:0,minFontScaleY:0})}return St})(0,n,b,h,p,g,l,r.allowVerticalPlacement),Y=r.textSizeData;let ne=null;Y.kind==="source"?(ne=[ja*h.layout.get("text-size").evaluate(g,{})],ne[0]>Lo&&ci(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):Y.kind==="composite"&&(ne=[ja*k.compositeTextSizes[0].evaluate(g,{},q),ja*k.compositeTextSizes[1].evaluate(g,{},q)],(ne[0]>Lo||ne[1]>Lo)&&ci(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),r.addSymbols(r.text,X,ne,b,p,g,E,e,T.lineStartIndex,T.lineLength,B,q);for(const me of P)I[me]=r.text.placedSymbolArray.length-1;return 4*X.length}function f0(r){for(const e in r)return r[e];return null}function hT(r,e,n,l){const h=r.compareText;if(e in h){const p=h[e];for(let g=p.length-1;g>=0;g--)if(l.dist(p[g])<n)return!0}else h[e]=[];return h[e].push(l),!1}const p0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Gm{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,l]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=l>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const p=p0[15&l];if(!p)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(e,2,1),[b]=new Uint32Array(e,4,1);return new Gm(b,g,p,e)}constructor(e,n=64,l=Float64Array,h){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=l,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const p=p0.indexOf(this.ArrayType),g=2*e*this.ArrayType.BYTES_PER_ELEMENT,b=e*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-b%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${l}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+T,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+g+b+T),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+T,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=e,this.coords[this._pos++]=n,l}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Hm(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,l,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:g,nodeSize:b}=this,T=[0,p.length-1,0],E=[];for(;T.length;){const P=T.pop()||0,I=T.pop()||0,B=T.pop()||0;if(I-B<=b){for(let Y=B;Y<=I;Y++){const ne=g[2*Y],me=g[2*Y+1];ne>=e&&ne<=l&&me>=n&&me<=h&&E.push(p[Y])}continue}const k=B+I>>1,q=g[2*k],X=g[2*k+1];q>=e&&q<=l&&X>=n&&X<=h&&E.push(p[k]),(P===0?e<=q:n<=X)&&(T.push(B),T.push(k-1),T.push(1-P)),(P===0?l>=q:h>=X)&&(T.push(k+1),T.push(I),T.push(1-P))}return E}within(e,n,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:p,nodeSize:g}=this,b=[0,h.length-1,0],T=[],E=l*l;for(;b.length;){const P=b.pop()||0,I=b.pop()||0,B=b.pop()||0;if(I-B<=g){for(let Y=B;Y<=I;Y++)g0(p[2*Y],p[2*Y+1],e,n)<=E&&T.push(h[Y]);continue}const k=B+I>>1,q=p[2*k],X=p[2*k+1];g0(q,X,e,n)<=E&&T.push(h[k]),(P===0?e-l<=q:n-l<=X)&&(b.push(B),b.push(k-1),b.push(1-P)),(P===0?e+l>=q:n+l>=X)&&(b.push(k+1),b.push(I),b.push(1-P))}return T}}function Hm(r,e,n,l,h,p){if(h-l<=n)return;const g=l+h>>1;m0(r,e,g,l,h,p),Hm(r,e,n,l,g-1,1-p),Hm(r,e,n,g+1,h,1-p)}function m0(r,e,n,l,h,p){for(;h>l;){if(h-l>600){const E=h-l+1,P=n-l+1,I=Math.log(E),B=.5*Math.exp(2*I/3),k=.5*Math.sqrt(I*B*(E-B)/E)*(P-E/2<0?-1:1);m0(r,e,n,Math.max(l,Math.floor(n-P*B/E+k)),Math.min(h,Math.floor(n+(E-P)*B/E+k)),p)}const g=e[2*n+p];let b=l,T=h;for(Oh(r,e,l,n),e[2*h+p]>g&&Oh(r,e,l,h);b<T;){for(Oh(r,e,b,T),b++,T--;e[2*b+p]<g;)b++;for(;e[2*T+p]>g;)T--}e[2*l+p]===g?Oh(r,e,l,T):(T++,Oh(r,e,T,h)),T<=n&&(l=T+1),n<=T&&(h=T-1)}}function Oh(r,e,n,l){jm(r,n,l),jm(e,2*n,2*l),jm(e,2*n+1,2*l+1)}function jm(r,e,n){const l=r[e];r[e]=r[n],r[n]=l}function g0(r,e,n,l){const h=r-n,p=e-l;return h*h+p*p}var Wm;_.cI=void 0,(Wm=_.cI||(_.cI={})).create="create",Wm.load="load",Wm.fullLoad="fullLoad";let Lf=null,Nh=[];const qm=1e3/60,Xm="loadTime",Zm="fullLoadTime",dT={mark(r){performance.mark(r)},recordStartOfFrameAt(r){Lf!=null&&Nh.push(r-Lf),Lf=r},resetRuntimeMetrics(){Lf=null,Nh=[]},clearInitializationMetrics(){performance.clearMeasures(Xm),performance.clearMeasures(Zm);for(const r in _.cI)performance.clearMarks(_.cI[r])},remove(){this.resetRuntimeMetrics(),this.clearInitializationMetrics()},getPerformanceMetrics(){performance.measure(Xm,_.cI.create,_.cI.load),performance.measure(Zm,_.cI.create,_.cI.fullLoad);const r=performance.getEntriesByName(Xm)[0].duration,e=performance.getEntriesByName(Zm)[0].duration,n=Nh.length;return{loadTimeMs:r,fullLoadTimeMs:e,averageFramesPerSecond:1/(Nh.reduce(((l,h)=>l+h),0)/n/1e3),virtualDroppedFramesCount:Nh.filter((l=>l>qm)).reduce(((l,h)=>l+(h-qm)/qm),0),totalFramesCount:n}}};_.$=N,_.A=de,_.B=Ao,_.C=Hn,_.D=Ht,_.E=ze,_.F=function([r,e,n]){return e+=90,e*=Math.PI/180,n*=Math.PI/180,{x:r*Math.cos(e)*Math.sin(n),y:r*Math.sin(e)*Math.sin(n),z:r*Math.cos(n)}},_.G=cn,_.H=ji,_.I=pm,_.J=Yd,_.K=function(r){if(ui==null){const e=r.navigator?r.navigator.userAgent:null;ui=!!r.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return ui},_.L=class{constructor(r,e){this.target=r,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new A1((()=>this.process())),this.subscription=xe(this.target,"message",(n=>this.receive(n)),!1),this.globalScope=ri(self)?r:window}registerMessageHandler(r,e){this.messageHandlers[r]=e}unregisterMessageHandler(r){delete this.messageHandlers[r]}sendAsync(r,e){return new Promise(((n,l)=>{const h=Math.round(1e18*Math.random()).toString(36).substring(0,10),p=e?xe(e.signal,"abort",(()=>{p?.unsubscribe(),delete this.resolveRejects[h];const T={id:h,type:"<cancel>",origin:location.origin,targetMapId:r.targetMapId,sourceMapId:this.mapId};this.target.postMessage(T)}),C1):null;this.resolveRejects[h]={resolve:T=>{p?.unsubscribe(),n(T)},reject:T=>{p?.unsubscribe(),l(T)}};const g=[],b=Object.assign(Object.assign({},r),{id:h,sourceMapId:this.mapId,origin:location.origin,data:ml(r.data,g)});this.target.postMessage(b,{transfer:g})}))}receive(r){const e=r.data,n=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!=="resource://android"&&location.origin!=="resource://android"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[n];const l=this.abortControllers[n];return delete this.abortControllers[n],void(l&&l.abort())}if(ri(self)||e.mustQueue)return this.tasks[n]=e,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,e)}}process(){if(this.taskQueue.length===0)return;const r=this.taskQueue.shift(),e=this.tasks[r];delete this.tasks[r],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(r,e)}processTask(r,e){return o(this,void 0,void 0,(function*(){if(e.type==="<response>"){const h=this.resolveRejects[r];return delete this.resolveRejects[r],h?void(e.error?h.reject(gl(e.error)):h.resolve(gl(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(r,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=gl(e.data),l=new AbortController;this.abortControllers[r]=l;try{const h=yield this.messageHandlers[e.type](e.sourceMapId,n,l);this.completeTask(r,null,h)}catch(h){this.completeTask(r,h)}}))}completeTask(r,e,n){const l=[];delete this.abortControllers[r];const h={id:r,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?ml(e):null,data:ml(n,l)};this.target.postMessage(h,{transfer:l})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},_.M=U,_.N=function(){var r=new de(16);return de!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},_.O=function(r,e,n){var l,h,p,g,b,T,E,P,I,B,k,q,X=n[0],Y=n[1],ne=n[2];return e===r?(r[12]=e[0]*X+e[4]*Y+e[8]*ne+e[12],r[13]=e[1]*X+e[5]*Y+e[9]*ne+e[13],r[14]=e[2]*X+e[6]*Y+e[10]*ne+e[14],r[15]=e[3]*X+e[7]*Y+e[11]*ne+e[15]):(h=e[1],p=e[2],g=e[3],b=e[4],T=e[5],E=e[6],P=e[7],I=e[8],B=e[9],k=e[10],q=e[11],r[0]=l=e[0],r[1]=h,r[2]=p,r[3]=g,r[4]=b,r[5]=T,r[6]=E,r[7]=P,r[8]=I,r[9]=B,r[10]=k,r[11]=q,r[12]=l*X+b*Y+I*ne+e[12],r[13]=h*X+T*Y+B*ne+e[13],r[14]=p*X+E*Y+k*ne+e[14],r[15]=g*X+P*Y+q*ne+e[15]),r},_.P=M,_.Q=function(r,e,n){var l=n[0],h=n[1],p=n[2];return r[0]=e[0]*l,r[1]=e[1]*l,r[2]=e[2]*l,r[3]=e[3]*l,r[4]=e[4]*h,r[5]=e[5]*h,r[6]=e[6]*h,r[7]=e[7]*h,r[8]=e[8]*p,r[9]=e[9]*p,r[10]=e[10]*p,r[11]=e[11]*p,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},_.R=Or,_.S=function(r,e,n){var l=e[0],h=e[1],p=e[2],g=e[3],b=e[4],T=e[5],E=e[6],P=e[7],I=e[8],B=e[9],k=e[10],q=e[11],X=e[12],Y=e[13],ne=e[14],me=e[15],ie=n[0],le=n[1],Te=n[2],Re=n[3];return r[0]=ie*l+le*b+Te*I+Re*X,r[1]=ie*h+le*T+Te*B+Re*Y,r[2]=ie*p+le*E+Te*k+Re*ne,r[3]=ie*g+le*P+Te*q+Re*me,r[4]=(ie=n[4])*l+(le=n[5])*b+(Te=n[6])*I+(Re=n[7])*X,r[5]=ie*h+le*T+Te*B+Re*Y,r[6]=ie*p+le*E+Te*k+Re*ne,r[7]=ie*g+le*P+Te*q+Re*me,r[8]=(ie=n[8])*l+(le=n[9])*b+(Te=n[10])*I+(Re=n[11])*X,r[9]=ie*h+le*T+Te*B+Re*Y,r[10]=ie*p+le*E+Te*k+Re*ne,r[11]=ie*g+le*P+Te*q+Re*me,r[12]=(ie=n[12])*l+(le=n[13])*b+(Te=n[14])*I+(Re=n[15])*X,r[13]=ie*h+le*T+Te*B+Re*Y,r[14]=ie*p+le*E+Te*k+Re*ne,r[15]=ie*g+le*P+Te*q+Re*me,r},_.T=sm,_.U=function(r,e){const n={};for(let l=0;l<e.length;l++){const h=e[l];h in r&&(n[h]=r[h])}return n},_.V=Fo,_.W=mt,_.X=fx,_.Y=dx,_.Z=Et,_._=o,_.a=jt,_.a$=fe,_.a0=W,_.a1=Si,_.a2=$r,_.a3=mx,_.a4=bf,_.a5=xt,_.a6=function(r,e,n){if(!r)return e||{};if(!e)return r||{};const l=xx(r),h=xx(e);(function(g,b){b.removeAll&&(g.add.clear(),g.update.clear(),g.remove.clear(),b.remove.clear());for(const T of b.remove)g.add.delete(T),g.update.delete(T);for(const[T,E]of b.update){const P=g.update.get(T);P&&(b.update.set(T,P1(P,E)),g.update.delete(T))}})(l,h);const p={};if((l.removeAll||h.removeAll)&&(p.removeAll=!0),p.remove=new Set([...l.remove,...h.remove]),p.add=new Map([...l.add,...h.add]),p.update=new Map([...l.update,...h.update]),p.remove.size&&p.add.size)for(const g of p.add.keys())p.remove.delete(g);return(function(g){const b={};return g.removeAll&&(b.removeAll=g.removeAll),g.remove&&(b.remove=Array.from(g.remove)),g.add&&(b.add=Array.from(g.add.values())),g.update&&(b.update=Array.from(g.update.values())),b})(p)},_.a7=function(r,e){const n=new Map;if(r==null||r.type==null)return n;if(r.type==="Feature"){const l=Tm(r,e);return l==null?void 0:(n.set(l,r),n)}if(r.type==="FeatureCollection"){const l=new Set;for(const h of r.features){const p=Tm(h,e);if(p==null||l.has(p))return;l.add(p),n.set(p,h)}return n}},_.a8=function(r,e,n){var l,h;const p=[];if(e.removeAll)r.clear();else if(e.remove)for(const g of e.remove){const b=r.get(g);b&&(p.push(b.geometry),r.delete(g))}if(e.add)for(const g of e.add){const b=Tm(g,n);if(b==null)continue;const T=r.get(b);T&&p.push(T.geometry),p.push(g.geometry),r.set(b,g)}if(e.update)for(const g of e.update){const b=r.get(g.id);if(!b)continue;const T=!!g.newGeometry,E=g.removeAllProperties||((l=g.removeProperties)===null||l===void 0?void 0:l.length)>0||((h=g.addOrUpdateProperties)===null||h===void 0?void 0:h.length)>0;if(!T&&!E)continue;p.push(b.geometry);const P=Object.assign({},b);if(r.set(g.id,P),T&&(p.push(g.newGeometry),P.geometry=g.newGeometry),E){if(P.properties=g.removeAllProperties?{}:Object.assign({},P.properties||{}),g.removeProperties)for(const I of g.removeProperties)delete P.properties[I];if(g.addOrUpdateProperties)for(const{key:I,value:B}of g.addOrUpdateProperties)P.properties[I]=B}}return p},_.a9=Dh,_.aA=function(r,{uSize:e,uSizeT:n},{lowerSize:l,upperSize:h}){return r.kind==="source"?l/ja:r.kind==="composite"?cn.number(l/ja,h/ja,n):e},_.aB=function(r,e){var n=e[0],l=e[1],h=e[2],p=e[3],g=e[4],b=e[5],T=e[6],E=e[7],P=e[8],I=e[9],B=e[10],k=e[11],q=e[12],X=e[13],Y=e[14],ne=e[15],me=n*b-l*g,ie=n*T-h*g,le=n*E-p*g,Te=l*T-h*b,Re=l*E-p*b,He=h*E-p*T,it=P*X-I*q,rt=P*Y-B*q,ft=P*ne-k*q,St=I*Y-B*X,_t=I*ne-k*X,at=B*ne-k*Y,et=me*at-ie*_t+le*St+Te*ft-Re*rt+He*it;return et?(r[0]=(b*at-T*_t+E*St)*(et=1/et),r[1]=(h*_t-l*at-p*St)*et,r[2]=(X*He-Y*Re+ne*Te)*et,r[3]=(B*Re-I*He-k*Te)*et,r[4]=(T*ft-g*at-E*rt)*et,r[5]=(n*at-h*ft+p*rt)*et,r[6]=(Y*le-q*He-ne*ie)*et,r[7]=(P*He-B*le+k*ie)*et,r[8]=(g*_t-b*ft+E*it)*et,r[9]=(l*ft-n*_t-p*it)*et,r[10]=(q*Re-X*le+ne*me)*et,r[11]=(I*le-P*Re-k*me)*et,r[12]=(b*rt-g*St-T*it)*et,r[13]=(n*St-l*rt+h*it)*et,r[14]=(X*ie-q*Te-Y*me)*et,r[15]=(P*Te-I*ie+B*me)*et,r):null},_.aC=Je,_.aD=function(r){var e=r[0],n=r[1];return Math.sqrt(e*e+n*n)},_.aE=function(r){return r[0]=0,r[1]=0,r},_.aF=function(r,e,n){return r[0]=e[0]*n,r[1]=e[1]*n,r},_.aG=_m,_.aH=pt,_.aI=function(r,e,n,l){const h=e.y-r.y,p=e.x-r.x,g=l.y-n.y,b=l.x-n.x,T=g*p-b*h;if(T===0)return null;const E=(b*(r.y-n.y)-g*(r.x-n.x))/T;return new M(r.x+E*p,r.y+E*h)},_.aJ=e0,_.aK=Rc,_.aL=function(r){let e=1/0,n=1/0,l=-1/0,h=-1/0;for(const p of r)e=Math.min(e,p.x),n=Math.min(n,p.y),l=Math.max(l,p.x),h=Math.max(h,p.y);return[e,n,l,h]},_.aM=Wn,_.aN=At,_.aO=function(r,e,n,l,h=!1){if(!n[0]&&!n[1])return[0,0];const p=h?l==="map"?-r.bearingInRadians:0:l==="viewport"?r.bearingInRadians:0;if(p){const g=Math.sin(p),b=Math.cos(p);n=[n[0]*b-n[1]*g,n[0]*g+n[1]*b]}return[h?n[0]:At(e,n[0],r.zoom),h?n[1]:At(e,n[1],r.zoom)]},_.aQ=gm,_.aR=Vm,_.aS=mm,_.aT=Gm,_.aU=Mn,_.aV=mf,_.aW=ce,_.aX=Mt,_.aY=Ze,_.aZ=ke,_.a_=gx,_.aa=Il,_.ab=25,_.ac=wm,_.ad=r=>{const e=window.document.createElement("video");return e.muted=!0,new Promise((n=>{e.onloadstart=()=>{n(e)};for(const l of r){const h=window.document.createElement("source");Se(l)||(e.crossOrigin="Anonymous"),h.src=l,e.appendChild(h)}}))},_.ae=gt,_.af=function(){return ni++},_.ag=d,_.ah=kc,_.ai=zh,_.aj=al,_.ak=aa,_.al=bx,_.am=function(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((n,l,h,p)=>{const g=h||p;return e[l]=!g||g.toLowerCase(),""})),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e},_.an=ot,_.ao=85.051129,_.ap=Q,_.aq=function(r){return Math.pow(2,r)},_.ar=Me,_.as=px,_.at=function(r){return Math.log(r)/Math.LN2},_.au=function(r){var e=r[0],n=r[1];return e*e+n*n},_.av=function(r){if(!r.length)return new Set;const e=Math.max(...r.map((T=>T.canonical.z)));let n=1/0,l=-1/0,h=1/0,p=-1/0;const g=[];for(const T of r){const{x:E,y:P,z:I}=T.canonical,B=Math.pow(2,e-I),k=E*B,q=P*B;g.push({id:T,x:k,y:q}),k<n&&(n=k),k>l&&(l=k),q<h&&(h=q),q>p&&(p=q)}const b=new Set;for(const T of g)T.x!==n&&T.x!==l&&T.y!==h&&T.y!==p||b.add(T.id);return b},_.aw=function(r,e){const n=Math.abs(2*r.wrap)-+(r.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return r.overscaledZ-e.overscaledZ||l-n||e.canonical.y-r.canonical.y||e.canonical.x-r.canonical.x},_.ax=class{constructor(r,e){this.max=r,this.onRemove=e,this.reset()}reset(){for(const r in this.data)for(const e of this.data[r])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(r,e,n){const l=r.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);const h={value:e,timeout:void 0};if(n!==void 0&&(h.timeout=setTimeout((()=>{this.remove(r,h)}),n)),this.data[l].push(h),this.order.push(l),this.order.length>this.max){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const e=this.data[r].shift();return e.timeout&&clearTimeout(e.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),e.value}getByKey(r){const e=this.data[r];return e?e[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,e){if(!this.has(r))return this;const n=r.wrapped().key,l=e===void 0?0:this.data[n].indexOf(e),h=this.data[n][l];return this.data[n].splice(l,1),h.timeout&&clearTimeout(h.timeout),this.data[n].length===0&&delete this.data[n],this.onRemove(h.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(r){const e=[];for(const n in this.data)for(const l of this.data[n])r(l.value)||e.push(l);for(const n of e)this.remove(n.value.tileID,n)}},_.ay=function(r,e){let n=0,l=0;if(r.kind==="constant")l=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:h,minZoom:p,maxZoom:g}=r,b=h?ot(yr.interpolationFactor(h,e,p,g),0,1):0;r.kind==="camera"?l=cn.number(r.minSize,r.maxSize,b):n=b}return{uSizeT:n,uSize:l}},_.b=Le,_.b$=Ga,_.b0=re,_.b1=function(r){var e=new de(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e},_.b2=function(r,e,n){return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],r},_.b3=function(r,e){var n=e[0],l=e[1],h=e[2],p=n*n+l*l+h*h;return p>0&&(p=1/Math.sqrt(p)),r[0]=e[0]*p,r[1]=e[1]*p,r[2]=e[2]*p,r},_.b4=Oe,_.b5=function(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]},_.b6=function(r,e,n){return r[0]=e[0]*n[0],r[1]=e[1]*n[1],r[2]=e[2]*n[2],r[3]=e[3]*n[3],r},_.b7=Ie,_.b8=function(r,e,n){const l=e[0]*n[0]+e[1]*n[1]+e[2]*n[2];return l===0?null:(-(r[0]*n[0]+r[1]*n[1]+r[2]*n[2])-n[3])/l},_.b9=Qe,_.bA=function(){return new Float64Array(3)},_.bB=nt,_.bC=function(r,e,n){var l=n[0],h=n[1],p=n[2],g=n[3],b=e[0],T=e[1],E=e[2],P=h*E-p*T,I=p*b-l*E,B=l*T-h*b;return r[0]=b+g*(P+=P)+h*(B+=B)-p*(I+=I),r[1]=T+g*I+p*P-l*B,r[2]=E+g*B+l*I-h*P,r},_.bD=function(r,e,n){const l=(h=[r[0],r[1],r[2],e[0],e[1],e[2],n[0],n[1],n[2]])[0]*((P=h[8])*(g=h[4])-(b=h[5])*(E=h[7]))+h[1]*(-P*(p=h[3])+b*(T=h[6]))+h[2]*(E*p-g*T);var h,p,g,b,T,E,P;if(l===0)return null;const I=Oe([],[e[0],e[1],e[2]],[n[0],n[1],n[2]]),B=Oe([],[n[0],n[1],n[2]],[r[0],r[1],r[2]]),k=Oe([],[r[0],r[1],r[2]],[e[0],e[1],e[2]]),q=fe([],I,-r[3]);return re(q,q,fe([],B,-e[3])),re(q,q,fe([],k,-n[3])),fe(q,q,1/l),q},_.bE=bm,_.bF=function(){return new Float64Array(4)},_.bG=function(r,e,n,l){var h=[],p=[];return h[0]=e[0]-n[0],h[1]=e[1]-n[1],h[2]=e[2]-n[2],p[0]=h[0]*Math.cos(l)-h[1]*Math.sin(l),p[1]=h[0]*Math.sin(l)+h[1]*Math.cos(l),p[2]=h[2],r[0]=p[0]+n[0],r[1]=p[1]+n[1],r[2]=p[2]+n[2],r},_.bH=function(r,e,n,l){var h=[],p=[];return h[0]=e[0]-n[0],h[1]=e[1]-n[1],h[2]=e[2]-n[2],p[0]=h[0],p[1]=h[1]*Math.cos(l)-h[2]*Math.sin(l),p[2]=h[1]*Math.sin(l)+h[2]*Math.cos(l),r[0]=p[0]+n[0],r[1]=p[1]+n[1],r[2]=p[2]+n[2],r},_.bI=function(r,e,n,l){var h=[],p=[];return h[0]=e[0]-n[0],h[1]=e[1]-n[1],h[2]=e[2]-n[2],p[0]=h[2]*Math.sin(l)+h[0]*Math.cos(l),p[1]=h[1],p[2]=h[2]*Math.cos(l)-h[0]*Math.sin(l),r[0]=p[0]+n[0],r[1]=p[1]+n[1],r[2]=p[2]+n[2],r},_.bJ=function(r,e,n){var l=Math.sin(n),h=Math.cos(n),p=e[0],g=e[1],b=e[2],T=e[3],E=e[8],P=e[9],I=e[10],B=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=p*h-E*l,r[1]=g*h-P*l,r[2]=b*h-I*l,r[3]=T*h-B*l,r[8]=p*l+E*h,r[9]=g*l+P*h,r[10]=b*l+I*h,r[11]=T*l+B*h,r},_.bK=function(r,e){const n=Rt(r,360),l=Rt(e,360),h=l-n,p=l>n?h-360:h+360;return Math.abs(h)<Math.abs(p)?h:p},_.bL=function(r){return r[0]=0,r[1]=0,r[2]=0,r},_.bM=function(r,e,n,l){const h=Math.sqrt(r*r+e*e),p=Math.sqrt(n*n+l*l);r/=h,e/=h,n/=p,l/=p;const g=Math.acos(r*n+e*l);return-e*n+r*l>0?g:-g},_.bN=function(r,e){const n=Rt(r,2*Math.PI),l=Rt(e,2*Math.PI);return Math.min(Math.abs(n-l),Math.abs(n-l+2*Math.PI),Math.abs(n-l-2*Math.PI))},_.bO=function(){const r={},e=oe.$version;for(const n in oe.$root){const l=oe.$root[n];if(l.required){let h=null;h=n==="version"?e:l.type==="array"?[]:{},h!=null&&(r[n]=h)}}return r},_.bP=ae,_.bQ=sh,_.bR=function r(e,n){if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(let l=0;l<e.length;l++)if(!r(e[l],n[l]))return!1;return!0}if(typeof e=="object"&&e!==null&&n!==null){if(typeof n!="object"||Object.keys(e).length!==Object.keys(n).length)return!1;for(const l in e)if(!r(e[l],n[l]))return!1;return!0}return e===n},_.bS=function(r){r=r.slice();const e=Object.create(null);for(let n=0;n<r.length;n++)e[r[n].id]=r[n];for(let n=0;n<r.length;n++)"ref"in r[n]&&(r[n]=lt(r[n],e[r[n].ref]));return r},_.bT=function(r,e){if(r.type==="custom")return new E1(r,e);switch(r.type){case"background":return new M1(r,e);case"circle":return new cw(r,e);case"color-relief":return new mw(r,e);case"fill":return new Iw(r,e);case"fill-extrusion":return new Gw(r,e);case"heatmap":return new hw(r,e);case"hillshade":return new fw(r,e);case"line":return new $w(r,e);case"raster":return new Yp(r,e);case"symbol":return new vf(r,e)}},_.bU=r=>r.type==="raster",_.bV=Ti,_.bW=function(r,e){if(!r)return[{command:"setStyle",args:[e]}];let n=[];try{if(!vt(r.version,e.version))return[{command:"setStyle",args:[e]}];vt(r.center,e.center)||n.push({command:"setCenter",args:[e.center]}),vt(r.state,e.state)||n.push({command:"setGlobalState",args:[e.state]}),vt(r.centerAltitude,e.centerAltitude)||n.push({command:"setCenterAltitude",args:[e.centerAltitude]}),vt(r.zoom,e.zoom)||n.push({command:"setZoom",args:[e.zoom]}),vt(r.bearing,e.bearing)||n.push({command:"setBearing",args:[e.bearing]}),vt(r.pitch,e.pitch)||n.push({command:"setPitch",args:[e.pitch]}),vt(r.roll,e.roll)||n.push({command:"setRoll",args:[e.roll]}),vt(r.sprite,e.sprite)||n.push({command:"setSprite",args:[e.sprite]}),vt(r.glyphs,e.glyphs)||n.push({command:"setGlyphs",args:[e.glyphs]}),vt(r.transition,e.transition)||n.push({command:"setTransition",args:[e.transition]}),vt(r.light,e.light)||n.push({command:"setLight",args:[e.light]}),vt(r.terrain,e.terrain)||n.push({command:"setTerrain",args:[e.terrain]}),vt(r.sky,e.sky)||n.push({command:"setSky",args:[e.sky]}),vt(r.projection,e.projection)||n.push({command:"setProjection",args:[e.projection]});const l={},h=[];(function(g,b,T,E){let P;for(P in b=b||{},g=g||{})Object.prototype.hasOwnProperty.call(g,P)&&(Object.prototype.hasOwnProperty.call(b,P)||$t(P,T,E));for(P in b)Object.prototype.hasOwnProperty.call(b,P)&&(Object.prototype.hasOwnProperty.call(g,P)?vt(g[P],b[P])||(g[P].type==="geojson"&&b[P].type==="geojson"&&fn(g,b,P)?It(T,{command:"setGeoJSONSourceData",args:[P,b[P].data]}):Di(P,b,T,E)):Ct(P,b,T))})(r.sources,e.sources,h,l);const p=[];r.layers&&r.layers.forEach((g=>{"source"in g&&l[g.source]?n.push({command:"removeLayer",args:[g.id]}):p.push(g)})),n=n.concat(h),(function(g,b,T){b=b||[];const E=(g=g||[]).map(Ln),P=b.map(Ln),I=g.reduce(on,{}),B=b.reduce(on,{}),k=E.slice(),q=Object.create(null);let X,Y,ne,me,ie;for(let le=0,Te=0;le<E.length;le++)X=E[le],Object.prototype.hasOwnProperty.call(B,X)?Te++:(It(T,{command:"removeLayer",args:[X]}),k.splice(k.indexOf(X,Te),1));for(let le=0,Te=0;le<P.length;le++)X=P[P.length-1-le],k[k.length-1-le]!==X&&(Object.prototype.hasOwnProperty.call(I,X)?(It(T,{command:"removeLayer",args:[X]}),k.splice(k.lastIndexOf(X,k.length-Te),1)):Te++,me=k[k.length-le],It(T,{command:"addLayer",args:[B[X],me]}),k.splice(k.length-le,0,X),q[X]=!0);for(let le=0;le<P.length;le++)if(X=P[le],Y=I[X],ne=B[X],!q[X]&&!vt(Y,ne))if(vt(Y.source,ne.source)&&vt(Y["source-layer"],ne["source-layer"])&&vt(Y.type,ne.type)){for(ie in rn(Y.layout,ne.layout,T,X,null,"setLayoutProperty"),rn(Y.paint,ne.paint,T,X,null,"setPaintProperty"),vt(Y.filter,ne.filter)||It(T,{command:"setFilter",args:[X,ne.filter]}),vt(Y.minzoom,ne.minzoom)&&vt(Y.maxzoom,ne.maxzoom)||It(T,{command:"setLayerZoomRange",args:[X,ne.minzoom,ne.maxzoom]}),Y)Object.prototype.hasOwnProperty.call(Y,ie)&&ie!=="layout"&&ie!=="paint"&&ie!=="filter"&&ie!=="metadata"&&ie!=="minzoom"&&ie!=="maxzoom"&&(ie.indexOf("paint.")===0?rn(Y[ie],ne[ie],T,X,ie.slice(6),"setPaintProperty"):vt(Y[ie],ne[ie])||It(T,{command:"setLayerProperty",args:[X,ie,ne[ie]]}));for(ie in ne)Object.prototype.hasOwnProperty.call(ne,ie)&&!Object.prototype.hasOwnProperty.call(Y,ie)&&ie!=="layout"&&ie!=="paint"&&ie!=="filter"&&ie!=="metadata"&&ie!=="minzoom"&&ie!=="maxzoom"&&(ie.indexOf("paint.")===0?rn(Y[ie],ne[ie],T,X,ie.slice(6),"setPaintProperty"):vt(Y[ie],ne[ie])||It(T,{command:"setLayerProperty",args:[X,ie,ne[ie]]}))}else It(T,{command:"removeLayer",args:[X]}),me=k[k.lastIndexOf(X)+1],It(T,{command:"addLayer",args:[ne,me]})})(p,e.layers,n)}catch(l){console.warn("Unable to compute style diff:",l),n=[{command:"setStyle",args:[e]}]}return n},_.bX=function(r){const e=[],n=r.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},_.bY=Gt,_.bZ=pi,_.b_=class extends Ar{constructor(r,e){super(r,e),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},_.ba=function(r,e,n){return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r},_.bb=function(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]},_.bc=yx,_.bd=Uc,_.be=function(r,e,n,l,h){var p=1/Math.tan(e/2);if(r[0]=p/n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=p,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,h!=null&&h!==1/0){var g=1/(l-h);r[10]=(h+l)*g,r[14]=2*h*l*g}else r[10]=-1,r[14]=-2*l;return r},_.bf=function(r){var e=new de(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e},_.bg=function(r,e,n){var l=Math.sin(n),h=Math.cos(n),p=e[0],g=e[1],b=e[2],T=e[3],E=e[4],P=e[5],I=e[6],B=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=p*h+E*l,r[1]=g*h+P*l,r[2]=b*h+I*l,r[3]=T*h+B*l,r[4]=E*h-p*l,r[5]=P*h-g*l,r[6]=I*h-b*l,r[7]=B*h-T*l,r},_.bh=function(r,e,n){var l=Math.sin(n),h=Math.cos(n),p=e[4],g=e[5],b=e[6],T=e[7],E=e[8],P=e[9],I=e[10],B=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=p*h+E*l,r[5]=g*h+P*l,r[6]=b*h+I*l,r[7]=T*h+B*l,r[8]=E*h-p*l,r[9]=P*h-g*l,r[10]=I*h-b*l,r[11]=B*h-T*l,r},_.bi=function(){const r=new Float32Array(16);return Me(r),r},_.bj=function(){const r=new Float64Array(16);return Me(r),r},_.bk=function(){return new Float64Array(16)},_.bl=function(r,e,n){const l=new Float64Array(4);return nt(l,r,e-90,n),l},_.bm=function(r,e,n,l){var h,p,g,b,T,E=e[0],P=e[1],I=e[2],B=e[3],k=n[0],q=n[1],X=n[2],Y=n[3];return(p=E*k+P*q+I*X+B*Y)<0&&(p=-p,k=-k,q=-q,X=-X,Y=-Y),1-p>ge?(h=Math.acos(p),g=Math.sin(h),b=Math.sin((1-l)*h)/g,T=Math.sin(l*h)/g):(b=1-l,T=l),r[0]=b*E+T*k,r[1]=b*P+T*q,r[2]=b*I+T*X,r[3]=b*B+T*Y,r},_.bn=function(r){const e=new Float64Array(9);var n,l,h,p,g,b,T,E,P,I,B,k,q,X,Y,ne,me,ie;I=(h=(l=r)[0])*(T=h+h),B=(p=l[1])*T,q=(g=l[2])*T,X=g*(E=p+p),ne=(b=l[3])*T,me=b*E,ie=b*(P=g+g),(n=e)[0]=1-(k=p*E)-(Y=g*P),n[3]=B-ie,n[6]=q+me,n[1]=B+ie,n[4]=1-I-Y,n[7]=X-ne,n[2]=q-me,n[5]=X+ne,n[8]=1-I-k;const le=ke(-Math.asin(ot(e[2],-1,1)));let Te,Re;return Math.hypot(e[5],e[8])<.001?(Te=0,Re=-ke(Math.atan2(e[3],e[4]))):(Te=ke(e[5]===0&&e[8]===0?0:Math.atan2(e[5],e[8])),Re=ke(e[1]===0&&e[0]===0?0:Math.atan2(e[1],e[0]))),{roll:Te,pitch:le+90,bearing:Re}},_.bo=function(r,e){return r.roll==e.roll&&r.pitch==e.pitch&&r.bearing==e.bearing},_.bp=mi,_.bq=Va,_.br=Oc,_.bs=Eh,_.bt=zc,_.bu=oi,_.bv=ti,_.bw=_r,_.bx=function(r,e,n,l,h){return oi(l,h,ot((r-e)/(n-e),0,1))},_.by=function(r,e,n,l){return r[0]=e[0]+n[0]*l,r[1]=e[1]+n[1]*l,r[2]=e[2]+n[2]*l,r},_.bz=Rt,_.c=be,_.c$=class{constructor(r){this.start=`${r}#start`,this.end=`${r}#end`,this.measure=r,performance.mark(this.start)}finish(){performance.mark(this.end);let r=performance.getEntriesByName(this.measure);return r.length===0&&(performance.measure(this.measure,this.start,this.end),r=performance.getEntriesByName(this.measure),performance.clearMarks(this.start),performance.clearMarks(this.end),performance.clearMeasures(this.measure)),r}},_.c0=class extends Ar{constructor(r,e){super(r,e),this.current=Zr}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let e=1;e<16;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},_.c1=Al,_.c2=class extends Ar{constructor(r,e){super(r,e),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},_.c3=class extends Ar{constructor(r,e){super(r,e),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},_.c4=ve,_.c5=function(r,e){var n=Math.sin(e),l=Math.cos(e);return r[0]=l,r[1]=n,r[2]=0,r[3]=-n,r[4]=l,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},_.c6=function(r,e,n){var l=e[0],h=e[1],p=e[2];return r[0]=l*n[0]+h*n[3]+p*n[6],r[1]=l*n[1]+h*n[4]+p*n[7],r[2]=l*n[2]+h*n[5]+p*n[8],r},_.c7=function(r,e,n,l,h,p,g){var b=1/(e-n),T=1/(l-h),E=1/(p-g);return r[0]=-2*b,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*T,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*E,r[11]=0,r[12]=(e+n)*b,r[13]=(h+l)*T,r[14]=(g+p)*E,r[15]=1,r},_.c8=class extends Ar{constructor(r,e){super(r,e),this.current=new Array}set(r){if(r!=this.current){this.current=r;const e=new Float32Array(4*r.length);for(let n=0;n<r.length;n++)e[4*n]=r[n].r,e[4*n+1]=r[n].g,e[4*n+2]=r[n].b,e[4*n+3]=r[n].a;this.gl.uniform4fv(this.location,e)}}},_.c9=class extends Ar{constructor(r,e){super(r,e),this.current=new Array}set(r){if(r!=this.current){this.current=r;const e=new Float32Array(r);this.gl.uniform1fv(this.location,e)}}},_.cA=function(r,e){var n;if(!yt[e])return!1;const l=r?.target,h=((n=l?.ownerDocument)===null||n===void 0?void 0:n.defaultView)||window;return r instanceof h.MouseEvent||r instanceof h.WheelEvent},_.cB=function(r,e){return ht[e]&&"touches"in r},_.cC=function(r){return ht[r]||yt[r]},_.cD=function(r,e,n){var l=e[0],h=e[1];return r[0]=n[0]*l+n[4]*h+n[12],r[1]=n[1]*l+n[5]*h+n[13],r},_.cE=function(r,e){const{x:n,y:l}=Dh.fromLngLat(e);return!(r<0||r>25||l<0||l>=1||n<0||n>=1)},_.cF=function(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},_.cG=class extends Sc{},_.cH=dT,_.cJ=Z,_.cK=function(r,e){be.REGISTERED_PROTOCOLS[r]=e},_.cL=function(r){delete be.REGISTERED_PROTOCOLS[r]},_.cM=function(r,e){const n={};for(let h=0;h<r.length;h++){const p=e&&e[r[h].id]||kd(r[h]);e&&(e[r[h].id]=p);let g=n[p];g||(g=n[p]=[]),g.push(r[h])}const l=[];for(const h in n)l.push(n[h]);return l},_.cN=Ft,_.cO=vx,_.cP=Jx,_.cQ=tx,_.cR=function(r){var e;r.bucket.createArrays(),r.bucket.tilePixelRatio=xt/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const n=r.bucket.layers[0],l=n.layout,h=n._unevaluatedLayout._values,p={layoutIconSize:h["icon-size"].possiblyEvaluate(new ji(r.bucket.zoom+1),r.canonical),layoutTextSize:h["text-size"].possiblyEvaluate(new ji(r.bucket.zoom+1),r.canonical),textMaxSize:h["text-size"].possiblyEvaluate(new ji(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:P,maxZoom:I}=r.bucket.textSizeData;p.compositeTextSizes=[h["text-size"].possiblyEvaluate(new ji(P),r.canonical),h["text-size"].possiblyEvaluate(new ji(I),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:P,maxZoom:I}=r.bucket.iconSizeData;p.compositeIconSizes=[h["icon-size"].possiblyEvaluate(new ji(P),r.canonical),h["icon-size"].possiblyEvaluate(new ji(I),r.canonical)]}const g=l.get("text-line-height")*Wn,b=l.get("text-rotation-alignment")!=="viewport"&&l.get("symbol-placement")!=="point",T=l.get("text-keep-upright"),E=l.get("text-size");for(const P of r.bucket.features){const I=l.get("text-font").evaluate(P,{},r.canonical).join(","),B=E.evaluate(P,{},r.canonical),k=p.layoutTextSize.evaluate(P,{},r.canonical),q=p.layoutIconSize.evaluate(P,{},r.canonical),X={horizontal:{},vertical:void 0},Y=P.text;let ne,me=[0,0];if(Y){const Te=Y.toString(),Re=l.get("text-letter-spacing").evaluate(P,{},r.canonical)*Wn,He=Zp(Te)?Re:0,it=l.get("text-anchor").evaluate(P,{},r.canonical),rt=h0(n,P,r.canonical);if(!rt){const at=l.get("text-radial-offset").evaluate(P,{},r.canonical);me=at?u0(it,[at*Wn,Um]):l.get("text-offset").evaluate(P,{},r.canonical).map((et=>et*Wn))}let ft=b?"center":l.get("text-justify").evaluate(P,{},r.canonical);const St=l.get("symbol-placement")==="point"?l.get("text-max-width").evaluate(P,{},r.canonical)*Wn:1/0,_t=()=>{r.bucket.allowVerticalPlacement&&Io(Te)&&(X.vertical=yf(Y,r.glyphMap,r.glyphPositions,r.imagePositions,I,St,g,it,"left",He,me,_.az.vertical,!0,k,B))};if(!b&&rt){const at=new Set;if(ft==="auto")for(let zt=0;zt<rt.values.length;zt+=2)at.add(Vm(rt.values[zt]));else at.add(ft);let et=!1;for(const zt of at)if(!X.horizontal[zt])if(et)X.horizontal[zt]=X.horizontal[0];else{const Nt=yf(Y,r.glyphMap,r.glyphPositions,r.imagePositions,I,St,g,"center",zt,He,me,_.az.horizontal,!1,k,B);Nt&&(X.horizontal[zt]=Nt,et=Nt.positionedLines.length===1)}_t()}else{ft==="auto"&&(ft=Vm(it));const at=yf(Y,r.glyphMap,r.glyphPositions,r.imagePositions,I,St,g,it,ft,He,me,_.az.horizontal,!1,k,B);at&&(X.horizontal[ft]=at),_t(),Io(Te)&&b&&T&&(X.vertical=yf(Y,r.glyphMap,r.glyphPositions,r.imagePositions,I,St,g,it,ft,He,me,_.az.vertical,!1,k,B))}}let ie=!1;if(P.icon&&P.icon.name){const Te=r.imageMap[P.icon.name];Te&&(ne=b1(r.imagePositions[P.icon.name],l.get("icon-offset").evaluate(P,{},r.canonical),l.get("icon-anchor").evaluate(P,{},r.canonical)),ie=!!Te.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=ie:r.bucket.sdfIcons!==ie&&ci("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Te.pixelRatio!==r.bucket.pixelRatio||l.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const le=f0(X.horizontal)||X.vertical;(e=r.bucket).iconsInText||(e.iconsInText=!!le&&le.iconsInText),(le||ne)&&uT(r.bucket,P,X,ne,r.imageMap,p,k,q,me,ie,r.canonical,r.subdivisionGranularity)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},_.cS=cm,_.cT=hm,_.cU=dm,_.cV=function(r){const e=new _f;return(function(n,l){for(const h in n.layers)l.writeMessage(3,Y1,n.layers[h])})(r,e),e.finish()},_.cW=function(r,e,n,l,h,p){let g=t0(r,e,n,h,0);return g=t0(g,e,l,p,1),g},_.cX=class{constructor(r){this.maxEntries=r,this.map=new Map}get(r){const e=this.map.get(r);return e!==void 0&&(this.map.delete(r),this.map.set(r,e)),e}set(r,e){if(this.map.has(r))this.map.delete(r);else if(this.map.size>=this.maxEntries){const n=this.map.keys().next().value;this.map.delete(n)}this.map.set(r,e)}clear(){this.map.clear()}},_.cY=Ny,_.cZ=_f,_.c_=Yx,_.ca=class extends ka{},_.cb=Qw,_.cc=class extends El{},_.cd=rm,_.ce=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},_.cf=wy,_.cg=function(r,e,n){var l=e[0],h=e[1],p=e[2],g=n[3]*l+n[7]*h+n[11]*p+n[15];return r[0]=(n[0]*l+n[4]*h+n[8]*p+n[12])/(g=g||1),r[1]=(n[1]*l+n[5]*h+n[9]*p+n[13])/g,r[2]=(n[2]*l+n[6]*h+n[10]*p+n[14])/g,r},_.ch=class extends dh{},_.ci=class extends t{},_.cj=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]&&r[4]===e[4]&&r[5]===e[5]&&r[6]===e[6]&&r[7]===e[7]&&r[8]===e[8]&&r[9]===e[9]&&r[10]===e[10]&&r[11]===e[11]&&r[12]===e[12]&&r[13]===e[13]&&r[14]===e[14]&&r[15]===e[15]},_.ck=function(r,e){var n=r[0],l=r[1],h=r[2],p=r[3],g=r[4],b=r[5],T=r[6],E=r[7],P=r[8],I=r[9],B=r[10],k=r[11],q=r[12],X=r[13],Y=r[14],ne=r[15],me=e[0],ie=e[1],le=e[2],Te=e[3],Re=e[4],He=e[5],it=e[6],rt=e[7],ft=e[8],St=e[9],_t=e[10],at=e[11],et=e[12],zt=e[13],Nt=e[14],qt=e[15];return Math.abs(n-me)<=ge*Math.max(1,Math.abs(n),Math.abs(me))&&Math.abs(l-ie)<=ge*Math.max(1,Math.abs(l),Math.abs(ie))&&Math.abs(h-le)<=ge*Math.max(1,Math.abs(h),Math.abs(le))&&Math.abs(p-Te)<=ge*Math.max(1,Math.abs(p),Math.abs(Te))&&Math.abs(g-Re)<=ge*Math.max(1,Math.abs(g),Math.abs(Re))&&Math.abs(b-He)<=ge*Math.max(1,Math.abs(b),Math.abs(He))&&Math.abs(T-it)<=ge*Math.max(1,Math.abs(T),Math.abs(it))&&Math.abs(E-rt)<=ge*Math.max(1,Math.abs(E),Math.abs(rt))&&Math.abs(P-ft)<=ge*Math.max(1,Math.abs(P),Math.abs(ft))&&Math.abs(I-St)<=ge*Math.max(1,Math.abs(I),Math.abs(St))&&Math.abs(B-_t)<=ge*Math.max(1,Math.abs(B),Math.abs(_t))&&Math.abs(k-at)<=ge*Math.max(1,Math.abs(k),Math.abs(at))&&Math.abs(q-et)<=ge*Math.max(1,Math.abs(q),Math.abs(et))&&Math.abs(X-zt)<=ge*Math.max(1,Math.abs(X),Math.abs(zt))&&Math.abs(Y-Nt)<=ge*Math.max(1,Math.abs(Y),Math.abs(Nt))&&Math.abs(ne-qt)<=ge*Math.max(1,Math.abs(ne),Math.abs(qt))},_.cl=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},_.cm=r=>r.type==="symbol",_.cn=r=>r.type==="circle",_.co=r=>r.type==="heatmap",_.cp=r=>r.type==="line",_.cq=r=>r.type==="fill",_.cr=r=>r.type==="fill-extrusion",_.cs=r=>r.type==="hillshade",_.ct=r=>r.type==="color-relief",_.cu=r=>r.type==="background",_.cv=r=>r.type==="custom",_.cw=Ii,_.cx=function(r,e,n){if(e<=0)return r;const l=1/e;return n===void 0||Math.abs(n)<1e-10?Math.round(r*l)/l:(n>0?Math.ceil(r*l-1e-9):Math.floor(r*l+1e-10))/l},_.cy=function(r,e,n){const l=ut(e.x-n.x,e.y-n.y),h=ut(r.x-n.x,r.y-n.y);var p,g;return ke(Math.atan2(l[0]*h[1]-l[1]*h[0],(p=l)[0]*(g=h)[0]+p[1]*g[1]))},_.cz=yi,_.d=Se,_.d0=function(r,e,n,l,h){return o(this,void 0,void 0,(function*(){if(W())try{return yield Si(r,e,n,l,h)}catch{}return(function(p,g,b,T,E){const P=p.width,I=p.height;Ri&&Vt||(Ri=new OffscreenCanvas(P,I),Vt=Ri.getContext("2d",{willReadFrequently:!0})),Ri.width=P,Ri.height=I,Vt.drawImage(p,0,0,P,I);const B=Vt.getImageData(g,b,T,E);return Vt.clearRect(0,0,P,I),B.data})(r,e,n,l,h)}))},_.d1=My,_.d2=C,_.d3=class{constructor(r,e){this.layers={[zh]:this},this.name=zh,this.version=e?e.version:1,this.extent=e?e.extent:4096,this.length=r.length,this.features=r}feature(r){return new $1(this.features[r],this.extent)}},_.d4=sl,_.d5=ia,_.e=Dt,_.f=r=>o(void 0,void 0,void 0,(function*(){if(r.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(r)],{type:"image/png"});try{return createImageBitmap(e)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),_.g=H,_.h=r=>new Promise(((e,n)=>{const l=new Image;l.onload=()=>{e(l),URL.revokeObjectURL(l.src),l.onload=null,window.requestAnimationFrame((()=>{l.src=Ji}))},l.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const h=new Blob([new Uint8Array(r)],{type:"image/png"});l.src=r.byteLength?URL.createObjectURL(h):Ji})),_.i=ri,_.j=(r,e)=>pe(Dt(r,{type:"json"}),e),_.k=Ne,_.l=Ce,_.m=pe,_.n=(r,e)=>pe(Dt(r,{type:"arrayBuffer"}),e),_.o=function(r){return new _f(r).readFields(f1,[])},_.p=ex,_.q=function(r){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(r))},_.r=bh,_.s=xe,_.t=xr,_.u=oe,_.v=fl,_.w=ci,_.x=uh,_.y=pl,_.z=yl})),f("worker",["./shared"],(function(_){class o{constructor(H,U){this.keyCache={},H&&this.replace(H,U)}replace(H,U){this._layerConfigs={},this._layers={},this.update(H,[],U)}update(H,U,Z){for(const pe of H){this._layerConfigs[pe.id]=pe;const Se=this._layers[pe.id]=_.bT(pe,Z);Se._featureFilter=_.aj(Se.filter,Z),this.keyCache[pe.id]&&delete this.keyCache[pe.id]}for(const pe of U)delete this.keyCache[pe],delete this._layerConfigs[pe],delete this._layers[pe];this.familiesBySource={};const ae=_.cM(Object.values(this._layerConfigs),this.keyCache);for(const pe of ae){const Se=pe.map((oe=>this._layers[oe.id])),Fe=Se[0];if(Fe.isHidden())continue;const te=Fe.source||"";let Ce=this.familiesBySource[te];Ce||(Ce=this.familiesBySource[te]={});const Ne=Fe.sourceLayer||_.ai;let ze=Ce[Ne];ze||(ze=Ce[Ne]=[]),ze.push(Se)}}}class M{constructor(H){const U={},Z=[];for(const Fe in H){const te=H[Fe],Ce=U[Fe]={};for(const Ne in te){const ze=te[+Ne];if(!ze||ze.bitmap.width===0||ze.bitmap.height===0)continue;const oe={x:0,y:0,w:ze.bitmap.width+2,h:ze.bitmap.height+2};Z.push(oe),Ce[Ne]={rect:oe,metrics:ze.metrics}}}const{w:ae,h:pe}=_.p(Z),Se=new _.r({width:ae||1,height:pe||1});for(const Fe in H){const te=H[Fe];for(const Ce in te){const Ne=te[+Ce];if(!Ne||Ne.bitmap.width===0||Ne.bitmap.height===0)continue;const ze=U[Fe][Ce].rect;_.r.copy(Ne.bitmap,Se,{x:0,y:0},{x:ze.x+1,y:ze.y+1},Ne.bitmap)}}this.image=Se,this.positions=U}}_.cN("GlyphAtlas",M);class C{constructor(H){this.tileID=new _.a2(H.tileID.overscaledZ,H.tileID.wrap,H.tileID.canonical.z,H.tileID.canonical.x,H.tileID.canonical.y),this.uid=H.uid,this.zoom=H.zoom,this.pixelRatio=H.pixelRatio,this.tileSize=H.tileSize,this.source=H.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=H.showCollisionBoxes,this.collectResourceTiming=!!H.collectResourceTiming,this.returnDependencies=!!H.returnDependencies,this.promoteId=H.promoteId,this.inFlightDependencies=[]}parse(H,U,Z,ae,pe){return _._(this,void 0,void 0,(function*(){this.status="parsing",this.data=H,this.collisionBoxArray=new _.ag;const Se=new _.cO(Object.keys(H.layers).sort()),Fe=new _.cP(this.tileID,this.promoteId);Fe.bucketLayerIDs=[];const te={},Ce={featureIndex:Fe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:Z,subdivisionGranularity:pe},Ne=U.familiesBySource[this.source];for(const Ci in Ne){const zi=H.layers[Ci];if(!zi)continue;zi.version===1&&_.w(`Vector tile source "${this.source}" layer "${Ci}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const is=Se.encode(Ci),Un=[];for(let Tt=0;Tt<zi.length;Tt++){const Yt=zi.feature(Tt),si=Fe.getId(Yt,Ci);Un.push({feature:Yt,id:si,index:Tt,sourceLayerIndex:is})}for(const Tt of Ne[Ci]){const Yt=Tt[0];Yt.source!==this.source&&_.w(`layer.source = ${Yt.source} does not equal this.source = ${this.source}`),Yt.isHidden(this.zoom,!0)||(D(Tt,this.zoom,Z),(te[Yt.id]=Yt.createBucket({index:Fe.bucketLayerIDs.length,layers:Tt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:is,sourceID:this.source})).populate(Un,Ce,this.tileID.canonical),Fe.bucketLayerIDs.push(Tt.map((si=>si.id))))}}const ze=_.bY(Ce.glyphDependencies,(Ci=>Object.keys(Ci).map(Number)));this.inFlightDependencies.forEach((Ci=>Ci?.abort())),this.inFlightDependencies=[];let oe=Promise.resolve({});if(Object.keys(ze).length){const Ci=new AbortController;this.inFlightDependencies.push(Ci),oe=ae.sendAsync({type:"GG",data:{stacks:ze,source:this.source,tileID:this.tileID,type:"glyphs"}},Ci)}const Ve=Object.keys(Ce.iconDependencies);let lt=Promise.resolve({});if(Ve.length){const Ci=new AbortController;this.inFlightDependencies.push(Ci),lt=ae.sendAsync({type:"GI",data:{icons:Ve,source:this.source,tileID:this.tileID,type:"icons"}},Ci)}const vt=Object.keys(Ce.patternDependencies);let It=Promise.resolve({});if(vt.length){const Ci=new AbortController;this.inFlightDependencies.push(Ci),It=ae.sendAsync({type:"GI",data:{icons:vt,source:this.source,tileID:this.tileID,type:"patterns"}},Ci)}const Ct=Ce.dashDependencies;let $t=Promise.resolve({});if(Object.keys(Ct).length){const Ci=new AbortController;this.inFlightDependencies.push(Ci),$t=ae.sendAsync({type:"GDA",data:{dashes:Ct}},Ci)}const[Di,fn,rn,Ln]=yield Promise.all([oe,lt,It,$t]),on=new M(Di),gt=new _.cQ(fn,rn);for(const Ci in te){const zi=te[Ci];zi instanceof _.ah?(D(zi.layers,this.zoom,Z),_.cR({bucket:zi,glyphMap:Di,glyphPositions:on.positions,imageMap:fn,imagePositions:gt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Ce.subdivisionGranularity})):zi.hasDependencies&&(zi instanceof _.cS||zi instanceof _.cT||zi instanceof _.cU)&&(D(zi.layers,this.zoom,Z),zi.addFeatures(Ce,this.tileID.canonical,gt.patternPositions,Ln))}return this.status="done",{buckets:Object.values(te).filter((Ci=>!Ci.isEmpty())),featureIndex:Fe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:on.image,imageAtlas:gt,dashPositions:Ln,glyphMap:this.returnDependencies?Di:null,iconMap:this.returnDependencies?fn:null,glyphPositions:this.returnDependencies?on.positions:null}}))}}function D(be,H,U){const Z=new _.H(H);for(const ae of be)ae.recalculate(Z,U)}class F{constructor(){this.loading={},this.loaded={},this.parsing={}}startLoading(H,U){this.loading[H]=U}finishLoading(H){delete this.loading[H]}abort(H){const U=this.loading[H];U?.abort&&(U.abort.abort(),delete this.loading[H])}setParsing(H,U){this.parsing[H]=U}consumeParsing(H){const U=this.parsing[H];if(U)return delete this.parsing[H],U}clearParsing(H){delete this.parsing[H]}markLoaded(H,U){this.loaded[H]=U}getLoaded(H){const U=this.loaded[H];if(U)return U}removeLoaded(H){delete this.loaded[H]}clearLoaded(){this.loaded={}}}class O{constructor(H,U,Z,ae,pe){this.type=H,this.properties=Z||{},this.extent=pe,this.pointsArray=U,this.id=ae}loadGeometry(){return this.pointsArray.map((H=>H.map((U=>new _.P(U.x,U.y)))))}}class j{constructor(H,U,Z){this.version=2,this._myFeatures=H,this.name=U,this.length=H.length,this.extent=Z}feature(H){return this._myFeatures[H]}}class K{constructor(){this.layers={}}addLayer(H){this.layers[H.name]=H}}function J(be){let H=_.cV(be);return H.byteOffset===0&&H.byteLength===H.buffer.byteLength||(H=new Uint8Array(H)),{vectorTile:be,rawData:H.buffer}}function N(be,H,U){const{extent:Z}=be,ae=Math.pow(2,U.z-H.z),pe=(U.x-H.x*ae)*Z,Se=(U.y-H.y*ae)*Z,Fe=[];for(let te=0;te<be.length;te++){const Ce=be.feature(te);let Ne=Ce.loadGeometry();for(const oe of Ne)for(const Ve of oe)Ve.x=Ve.x*ae-pe,Ve.y=Ve.y*ae-Se;const ze=128;Ne=_.cW(Ne,Ce.type,-ze,-ze,Z+ze,Z+ze),Ne.length!==0&&Fe.push(new O(Ce.type,Ne,Ce.properties,Ce.id,Z))}return new j(Fe,be.name,Z)}class W{constructor(H,U,Z){this.actor=H,this.layerIndex=U,this.availableImages=Z,this.tileState=new F,this.overzoomedTileResultCache=new _.cX(1e3)}loadVectorTile(H,U){return _._(this,void 0,void 0,(function*(){const Z=yield _.n(H.request,U);try{return{vectorTile:H.encoding!=="mlt"?new _.cY(new _.cZ(Z.data)):new _.c_(Z.data),rawData:Z.data,cacheControl:Z.cacheControl,expires:Z.expires}}catch(ae){const pe=new Uint8Array(Z.data);let Se=`Unable to parse the tile at ${H.request.url}, `;throw Se+=pe[0]===31&&pe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ae.message}`,new Error(Se)}}))}loadTile(H){return _._(this,void 0,void 0,(function*(){const{uid:U,overzoomParameters:Z}=H;Z&&(H.request=Z.overzoomRequest);const ae=this._startRequestTiming(H),pe=new C(H);this.tileState.startLoading(U,pe);const Se=new AbortController;pe.abort=Se;try{const Fe=yield this.loadVectorTile(H,Se);if(this.tileState.finishLoading(U),!Fe)return null;let{vectorTile:te,rawData:Ce}=Fe;Z&&({vectorTile:te,rawData:Ce}=this._getOverzoomTile(H,Fe.vectorTile));const Ne=this._getExpiryData(Fe),ze=this._finishRequestTiming(ae);pe.vectorTile=te,this.tileState.markLoaded(U,pe);const oe={rawData:Ce,cacheControl:Ne,resourceTiming:ze};this.tileState.setParsing(U,oe);try{return yield this._parseWorkerTile(pe,H,oe)}finally{this.tileState.clearParsing(U)}}catch(Fe){throw this.tileState.finishLoading(U),pe.status="done",this.tileState.markLoaded(U,pe),Fe}}))}_parseWorkerTile(H,U,Z){return _._(this,void 0,void 0,(function*(){let ae=yield H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor,U.subdivisionGranularity);if(Z){const{rawData:pe,cacheControl:Se,resourceTiming:Fe}=Z;ae=_.e({rawTileData:pe.slice(0),encoding:U.encoding},ae,Se,Fe)}return ae}))}_getExpiryData(H){const{expires:U,cacheControl:Z}=H,ae={};return U&&(ae.expires=U),Z&&(ae.cacheControl=Z),ae}_startRequestTiming(H){var U;if(!((U=H.request)===null||U===void 0)&&U.collectResourceTiming)return new _.c$(H.request.url)}_finishRequestTiming(H){const U=H?.finish();return U?{resourceTiming:JSON.parse(JSON.stringify(U))}:{}}_getOverzoomTile(H,U){const{tileID:Z,source:ae,overzoomParameters:pe}=H,{maxZoomTileID:Se}=pe,Fe=`${Se.key}_${Z.key}`,te=this.overzoomedTileResultCache.get(Fe);if(te)return te;const Ce=new K,Ne=this.layerIndex.familiesBySource[ae];for(const oe in Ne){const Ve=U.layers[oe];if(!Ve)continue;const lt=N(Ve,Se,Z.canonical);lt.length>0&&Ce.addLayer(lt)}const ze=J(Ce);return this.overzoomedTileResultCache.set(Fe,ze),ze}reloadTile(H){return _._(this,void 0,void 0,(function*(){const U=H.uid,Z=this.tileState.getLoaded(U);if(!Z)throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");if(Z.showCollisionBoxes=H.showCollisionBoxes,Z.status==="parsing"){const ae=this.tileState.consumeParsing(U);return yield this._parseWorkerTile(Z,H,ae)}if(Z.status==="done"&&Z.vectorTile)return yield this._parseWorkerTile(Z,H)}))}abortTile(H){return _._(this,void 0,void 0,(function*(){this.tileState.abort(H.uid)}))}removeTile(H){return _._(this,void 0,void 0,(function*(){this.tileState.removeLoaded(H.uid)}))}}class ge{constructor(){this.loaded={}}loadTile(H){return _._(this,void 0,void 0,(function*(){const{uid:U,encoding:Z,rawImageData:ae,redFactor:pe,greenFactor:Se,blueFactor:Fe,baseShift:te}=H,Ce=ae.width+2,Ne=ae.height+2,ze=_.b(ae)?new _.R({width:Ce,height:Ne},yield _.d0(ae,-1,-1,Ce,Ne)):ae,oe=new _.d1(U,ze,Z,pe,Se,Fe,te);return this.loaded=this.loaded||{},this.loaded[U]=oe,oe}))}removeTile(H){const U=this.loaded,Z=H.uid;U&&U[Z]&&delete U[Z]}}var de,ve,Me=(function(){if(ve)return de;function be(U,Z){if(U.length!==0){H(U[0],Z);for(var ae=1;ae<U.length;ae++)H(U[ae],!Z)}}function H(U,Z){for(var ae=0,pe=0,Se=0,Fe=U.length,te=Fe-1;Se<Fe;te=Se++){var Ce=(U[Se][0]-U[te][0])*(U[te][1]+U[Se][1]),Ne=ae+Ce;pe+=Math.abs(ae)>=Math.abs(Ce)?ae-Ne+Ce:Ce-Ne+ae,ae=Ne}ae+pe>=0!=!!Z&&U.reverse()}return ve=1,de=function U(Z,ae){var pe,Se=Z&&Z.type;if(Se==="FeatureCollection")for(pe=0;pe<Z.features.length;pe++)U(Z.features[pe],ae);else if(Se==="GeometryCollection")for(pe=0;pe<Z.geometries.length;pe++)U(Z.geometries[pe],ae);else if(Se==="Feature")U(Z.geometry,ae);else if(Se==="Polygon")be(Z.coordinates,ae);else if(Se==="MultiPolygon")for(pe=0;pe<Z.coordinates.length;pe++)be(Z.coordinates[pe],ae);return Z}})(),De=_.d2(Me);const Ie={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:be=>be},$e=Math.fround||(re=new Float32Array(1),be=>(re[0]=+be,re[0]));var re;class fe{constructor(H){this.options=Object.assign(Object.create(Ie),H),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(H){const{log:U,minZoom:Z,maxZoom:ae}=this.options;U&&console.time("total time");const pe=`prepare ${H.length} points`;U&&console.time(pe),this.points=H;const Se=[];for(let te=0;te<H.length;te++){const Ce=H[te];if(!Ce.geometry)continue;const[Ne,ze]=Ce.geometry.coordinates,oe=$e(Qe(Ne)),Ve=$e(pt(ze));Se.push(oe,Ve,1/0,te,-1,1),this.options.reduce&&Se.push(0)}let Fe=this.trees[ae+1]=this._createTree(Se);U&&console.timeEnd(pe);for(let te=ae;te>=Z;te--){const Ce=+Date.now();Fe=this.trees[te]=this._createTree(this._cluster(Fe,te)),U&&console.log("z%d: %d clusters in %dms",te,Fe.numItems,+Date.now()-Ce)}return U&&console.timeEnd("total time"),this}getClusters(H,U){let Z=((H[0]+180)%360+360)%360-180;const ae=Math.max(-90,Math.min(90,H[1]));let pe=H[2]===180?180:((H[2]+180)%360+360)%360-180;const Se=Math.max(-90,Math.min(90,H[3]));if(H[2]-H[0]>=360)Z=-180,pe=180;else if(Z>pe){const ze=this.getClusters([Z,ae,180,Se],U),oe=this.getClusters([-180,ae,pe,Se],U);return ze.concat(oe)}const Fe=this.trees[this._limitZoom(U)],te=Fe.range(Qe(Z),pt(Se),Qe(pe),pt(ae)),Ce=Fe.data,Ne=[];for(const ze of te){const oe=this.stride*ze;Ne.push(Ce[oe+5]>1?Oe(Ce,oe,this.clusterProps):this.points[Ce[oe+3]])}return Ne}getChildren(H){const U=this._getOriginId(H),Z=this._getOriginZoom(H),ae="No cluster with the specified id.",pe=this.trees[Z];if(!pe)throw new Error(ae);const Se=pe.data;if(U*this.stride>=Se.length)throw new Error(ae);const Fe=this.options.radius/(this.options.extent*Math.pow(2,Z-1)),te=pe.within(Se[U*this.stride],Se[U*this.stride+1],Fe),Ce=[];for(const Ne of te){const ze=Ne*this.stride;Se[ze+4]===H&&Ce.push(Se[ze+5]>1?Oe(Se,ze,this.clusterProps):this.points[Se[ze+3]])}if(Ce.length===0)throw new Error(ae);return Ce}getLeaves(H,U,Z){const ae=[];return this._appendLeaves(ae,H,U=U||10,Z=Z||0,0),ae}getTile(H,U,Z){const ae=this.trees[this._limitZoom(H)],pe=Math.pow(2,H),{extent:Se,radius:Fe}=this.options,te=Fe/Se,Ce=(Z-te)/pe,Ne=(Z+1+te)/pe,ze={features:[]};return this._addTileFeatures(ae.range((U-te)/pe,Ce,(U+1+te)/pe,Ne),ae.data,U,Z,pe,ze),U===0&&this._addTileFeatures(ae.range(1-te/pe,Ce,1,Ne),ae.data,pe,Z,pe,ze),U===pe-1&&this._addTileFeatures(ae.range(0,Ce,te/pe,Ne),ae.data,-1,Z,pe,ze),ze.features.length?ze:null}getClusterExpansionZoom(H){let U=this._getOriginZoom(H)-1;for(;U<=this.options.maxZoom;){const Z=this.getChildren(H);if(U++,Z.length!==1)break;H=Z[0].properties.cluster_id}return U}_appendLeaves(H,U,Z,ae,pe){const Se=this.getChildren(U);for(const Fe of Se){const te=Fe.properties;if(te&&te.cluster?pe+te.point_count<=ae?pe+=te.point_count:pe=this._appendLeaves(H,te.cluster_id,Z,ae,pe):pe<ae?pe++:H.push(Fe),H.length===Z)break}return pe}_createTree(H){const U=new _.aT(H.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Z=0;Z<H.length;Z+=this.stride)U.add(H[Z],H[Z+1]);return U.finish(),U.data=H,U}_addTileFeatures(H,U,Z,ae,pe,Se){for(const Fe of H){const te=Fe*this.stride,Ce=U[te+5]>1;let Ne,ze,oe;if(Ce)Ne=tt(U,te,this.clusterProps),ze=U[te],oe=U[te+1];else{const vt=this.points[U[te+3]];Ne=vt.properties;const[It,Ct]=vt.geometry.coordinates;ze=Qe(It),oe=pt(Ct)}const Ve={type:1,geometry:[[Math.round(this.options.extent*(ze*pe-Z)),Math.round(this.options.extent*(oe*pe-ae))]],tags:Ne};let lt;lt=Ce||this.options.generateId?U[te+3]:this.points[U[te+3]].id,lt!==void 0&&(Ve.id=lt),Se.features.push(Ve)}}_limitZoom(H){return Math.max(this.options.minZoom,Math.min(Math.floor(+H),this.options.maxZoom+1))}_cluster(H,U){const{radius:Z,extent:ae,reduce:pe,minPoints:Se}=this.options,Fe=Z/(ae*Math.pow(2,U)),te=H.data,Ce=[],Ne=this.stride;for(let ze=0;ze<te.length;ze+=Ne){if(te[ze+2]<=U)continue;te[ze+2]=U;const oe=te[ze],Ve=te[ze+1],lt=H.within(te[ze],te[ze+1],Fe),vt=te[ze+5];let It=vt;for(const Ct of lt){const $t=Ct*Ne;te[$t+2]>U&&(It+=te[$t+5])}if(It>vt&&It>=Se){let Ct,$t=oe*vt,Di=Ve*vt,fn=-1;const rn=(ze/Ne<<5)+(U+1)+this.points.length;for(const Ln of lt){const on=Ln*Ne;if(te[on+2]<=U)continue;te[on+2]=U;const gt=te[on+5];$t+=te[on]*gt,Di+=te[on+1]*gt,te[on+4]=rn,pe&&(Ct||(Ct=this._map(te,ze,!0),fn=this.clusterProps.length,this.clusterProps.push(Ct)),pe(Ct,this._map(te,on)))}te[ze+4]=rn,Ce.push($t/It,Di/It,1/0,rn,-1,It),pe&&Ce.push(fn)}else{for(let Ct=0;Ct<Ne;Ct++)Ce.push(te[ze+Ct]);if(It>1)for(const Ct of lt){const $t=Ct*Ne;if(!(te[$t+2]<=U)){te[$t+2]=U;for(let Di=0;Di<Ne;Di++)Ce.push(te[$t+Di])}}}}return Ce}_getOriginId(H){return H-this.points.length>>5}_getOriginZoom(H){return(H-this.points.length)%32}_map(H,U,Z){if(H[U+5]>1){const Se=this.clusterProps[H[U+6]];return Z?Object.assign({},Se):Se}const ae=this.points[H[U+3]].properties,pe=this.options.map(ae);return Z&&pe===ae?Object.assign({},pe):pe}}function Oe(be,H,U){return{type:"Feature",id:be[H+3],properties:tt(be,H,U),geometry:{type:"Point",coordinates:[(Z=be[H],360*(Z-.5)),ct(be[H+1])]}};var Z}function tt(be,H,U){const Z=be[H+5],ae=Z>=1e4?`${Math.round(Z/1e3)}k`:Z>=1e3?Math.round(Z/100)/10+"k":Z,pe=be[H+6],Se=pe===-1?{}:Object.assign({},U[pe]);return Object.assign(Se,{cluster:!0,cluster_id:be[H+3],point_count:Z,point_count_abbreviated:ae})}function Qe(be){return be/360+.5}function pt(be){const H=Math.sin(be*Math.PI/180),U=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return U<0?0:U>1?1:U}function ct(be){const H=(180-360*be)*Math.PI/180;return 360*Math.atan(Math.exp(H))/Math.PI-90}function nt(be,H,U,Z){let ae=Z;const pe=H+(U-H>>1);let Se,Fe=U-H;const te=be[H],Ce=be[H+1],Ne=be[U],ze=be[U+1];for(let oe=H+3;oe<U;oe+=3){const Ve=Je(be[oe],be[oe+1],te,Ce,Ne,ze);if(Ve>ae)Se=oe,ae=Ve;else if(Ve===ae){const lt=Math.abs(oe-pe);lt<Fe&&(Se=oe,Fe=lt)}}ae>Z&&(Se-H>3&&nt(be,H,Se,Z),be[Se+2]=ae,U-Se>3&&nt(be,Se,U,Z))}function Je(be,H,U,Z,ae,pe){let Se=ae-U,Fe=pe-Z;if(Se!==0||Fe!==0){const te=((be-U)*Se+(H-Z)*Fe)/(Se*Se+Fe*Fe);te>1?(U=ae,Z=pe):te>0&&(U+=Se*te,Z+=Fe*te)}return Se=be-U,Fe=H-Z,Se*Se+Fe*Fe}function ut(be,H,U,Z){const ae={type:H,geom:U},pe={id:be??null,type:ae.type,geometry:ae.geom,tags:Z,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};switch(ae.type){case"Point":case"MultiPoint":case"LineString":xt(pe,ae.geom);break;case"Polygon":xt(pe,ae.geom[0]);break;case"MultiLineString":for(const Se of ae.geom)xt(pe,Se);break;case"MultiPolygon":for(const Se of ae.geom)xt(pe,Se[0])}return pe}function xt(be,H){for(let U=0;U<H.length;U+=3)be.minX=Math.min(be.minX,H[U]),be.minY=Math.min(be.minY,H[U+1]),be.maxX=Math.max(be.maxX,H[U]),be.maxY=Math.max(be.maxY,H[U+1])}function At(be,H){const U=[];switch(be.type){case"FeatureCollection":for(let Z=0;Z<be.features.length;Z++)Rt(U,be.features[Z],H,Z);break;case"Feature":Rt(U,be,H);break;default:Rt(U,{geometry:be,properties:void 0},H)}return U}function Rt(be,H,U,Z){if(!H.geometry)return;if(H.geometry.type==="GeometryCollection"){for(const Fe of H.geometry.geometries)Rt(be,{id:H.id,geometry:Fe,properties:H.properties},U,Z);return}if(!H.geometry.coordinates?.length)return;const pe=Math.pow(U.tolerance/((1<<U.maxZoom)*U.extent),2);let Se=H.id;switch(U.promoteId?Se=H.properties?.[U.promoteId]:U.generateId&&(Se=Z||0),H.geometry.type){case"Point":{const Fe=[];return oi(H.geometry.coordinates,Fe),void be.push(ut(Se,H.geometry.type,Fe,H.properties))}case"MultiPoint":{const Fe=[];for(const te of H.geometry.coordinates)oi(te,Fe);return void be.push(ut(Se,H.geometry.type,Fe,H.properties))}case"LineString":{const Fe=[];return ti(H.geometry.coordinates,Fe,pe,!1),void be.push(ut(Se,H.geometry.type,Fe,H.properties))}case"MultiLineString":{if(U.lineMetrics){for(const te of H.geometry.coordinates){const Ce=[];ti(te,Ce,pe,!1),be.push(ut(Se,"LineString",Ce,H.properties))}return}const Fe=[];return Ii(H.geometry.coordinates,Fe,pe,!1),void be.push(ut(Se,H.geometry.type,Fe,H.properties))}case"Polygon":{const Fe=[];return Ii(H.geometry.coordinates,Fe,pe,!0),void be.push(ut(Se,H.geometry.type,Fe,H.properties))}case"MultiPolygon":{const Fe=[];for(const te of H.geometry.coordinates){const Ce=[];Ii(te,Ce,pe,!0),Fe.push(Ce)}return void be.push(ut(Se,H.geometry.type,Fe,H.properties))}default:throw new Error("Input data is not a valid GeoJSON object.")}}function oi(be,H){H.push(yi(be[0]),ot(be[1]),0)}function ti(be,H,U,Z){let ae,pe,Se=0;for(let te=0;te<be.length;te++){const Ce=yi(be[te][0]),Ne=ot(be[te][1]);H.push(Ce,Ne,0),te>0&&(Se+=Z?(ae*Ne-Ce*pe)/2:Math.sqrt(Math.pow(Ce-ae,2)+Math.pow(Ne-pe,2))),ae=Ce,pe=Ne}const Fe=H.length-3;H[2]=1,U>0&&nt(H,0,Fe,U),H[Fe+2]=1,H.size=Math.abs(Se),H.start=0,H.end=H.size}function Ii(be,H,U,Z){for(let ae=0;ae<be.length;ae++){const pe=[];ti(be[ae],pe,U,Z),H.push(pe)}}function yi(be){return be/360+.5}function ot(be){const H=Math.sin(be*Math.PI/180),U=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return U<0?0:U>1?1:U}function mt(be,H,U,Z,ae,pe,Se,Fe){if(Z/=H,pe>=(U/=H)&&Se<Z)return be;if(Se<U||pe>=Z)return null;const te=[];for(const Ce of be){const Ne=ae===0?Ce.minX:Ce.minY,ze=ae===0?Ce.maxX:Ce.maxY;if(Ne>=U&&ze<Z)te.push(Ce);else if(!(ze<U||Ne>=Z))switch(Ce.type){case"Point":case"MultiPoint":{const oe=[];if(Dt(Ce.geometry,oe,U,Z,ae),!oe.length)continue;te.push(ut(Ce.id,oe.length===3?"Point":"MultiPoint",oe,Ce.tags));continue}case"LineString":{const oe=[];if(ni(Ce.geometry,oe,U,Z,ae,!1,Fe.lineMetrics),!oe.length)continue;if(Fe.lineMetrics){for(const Ve of oe)te.push(ut(Ce.id,Ce.type,Ve,Ce.tags));continue}if(oe.length>1){te.push(ut(Ce.id,"MultiLineString",oe,Ce.tags));continue}te.push(ut(Ce.id,Ce.type,oe[0],Ce.tags));continue}case"MultiLineString":{const oe=[];if(pi(Ce.geometry,oe,U,Z,ae,!1),!oe.length)continue;if(oe.length===1){te.push(ut(Ce.id,"LineString",oe[0],Ce.tags));continue}te.push(ut(Ce.id,Ce.type,oe,Ce.tags));continue}case"Polygon":{const oe=[];if(pi(Ce.geometry,oe,U,Z,ae,!0),!oe.length)continue;te.push(ut(Ce.id,Ce.type,oe,Ce.tags));continue}case"MultiPolygon":{const oe=[];for(const Ve of Ce.geometry){const lt=[];pi(Ve,lt,U,Z,ae,!0),lt.length&&oe.push(lt)}if(!oe.length)continue;te.push(ut(Ce.id,Ce.type,oe,Ce.tags));continue}}}return te.length?te:null}function Dt(be,H,U,Z,ae){for(let pe=0;pe<be.length;pe+=3){const Se=be[pe+ae];Se>=U&&Se<=Z&&Ti(H,be[pe],be[pe+1],be[pe+2])}}function ni(be,H,U,Z,ae,pe,Se){let Fe=Gt(be);const te=ae===0?xi:ci;let Ce,Ne,ze=be.start;for(let It=0;It<be.length-3;It+=3){const Ct=be[It],$t=be[It+1],Di=be[It+2],fn=be[It+3],rn=be[It+4],Ln=ae===0?Ct:$t,on=ae===0?fn:rn;let gt=!1;Se&&(Ce=Math.sqrt(Math.pow(Ct-fn,2)+Math.pow($t-rn,2))),Ln<U?on>U&&(Ne=te(Fe,Ct,$t,fn,rn,U),Se&&(Fe.start=ze+Ce*Ne)):Ln>Z?on<Z&&(Ne=te(Fe,Ct,$t,fn,rn,Z),Se&&(Fe.start=ze+Ce*Ne)):Ti(Fe,Ct,$t,Di),on<U&&Ln>=U&&(Ne=te(Fe,Ct,$t,fn,rn,U),gt=!0),on>Z&&Ln<=Z&&(Ne=te(Fe,Ct,$t,fn,rn,Z),gt=!0),!pe&&gt&&(Se&&(Fe.end=ze+Ce*Ne),H.push(Fe),Fe=Gt(be)),Se&&(ze+=Ce)}let oe=be.length-3;const Ve=be[oe],lt=be[oe+1],vt=ae===0?Ve:lt;vt>=U&&vt<=Z&&Ti(Fe,Ve,lt,be[oe+2]),oe=Fe.length-3,pe&&oe>=3&&(Fe[oe]!==Fe[0]||Fe[oe+1]!==Fe[1])&&Ti(Fe,Fe[0],Fe[1],Fe[2]),Fe.length&&H.push(Fe)}function Gt(be){const H=[];return H.size=be.size,H.start=be.start,H.end=be.end,H}function pi(be,H,U,Z,ae,pe){for(const Se of be)ni(Se,H,U,Z,ae,pe,!1)}function Ti(be,H,U,Z){be.push(H,U,Z)}function xi(be,H,U,Z,ae,pe){const Se=(pe-H)/(Z-H);return Ti(be,pe,U+(ae-U)*Se,1),Se}function ci(be,H,U,Z,ae,pe){const Se=(pe-U)/(ae-U);return Ti(be,H+(Z-H)*Se,pe,1),Se}function vi(be,H){const U=H.buffer/H.extent;let Z=be;const ae=mt(be,1,-1-U,U,0,-1,2,H),pe=mt(be,1,1-U,2+U,0,-1,2,H);return(ae||pe)&&(Z=mt(be,1,-U,1+U,0,-1,2,H)||[],ae&&(Z=ri(ae,1).concat(Z)),pe&&(Z=Z.concat(ri(pe,-1)))),Z}function ri(be,H){const U=[];for(const Z of be)switch(Z.type){case"Point":case"MultiPoint":case"LineString":{const ae=ui(Z.geometry,H);U.push(ut(Z.id,Z.type,ae,Z.tags));continue}case"MultiLineString":case"Polygon":{const ae=[];for(const pe of Z.geometry)ae.push(ui(pe,H));U.push(ut(Z.id,Z.type,ae,Z.tags));continue}case"MultiPolygon":{const ae=[];for(const pe of Z.geometry){const Se=[];for(const Fe of pe)Se.push(ui(Fe,H));ae.push(Se)}U.push(ut(Z.id,Z.type,ae,Z.tags));continue}}return U}function ui(be,H){const U=[];U.size=be.size,be.start!==void 0&&(U.start=be.start,U.end=be.end);for(let Z=0;Z<be.length;Z+=3)U.push(be[Z]+H,be[Z+1],be[Z+2]);return U}function Le(be,H){if(be.transformed)return be;const U=1<<be.z,Z=be.x,ae=be.y;for(const pe of be.features){if(pe.type===1){const Fe=[];for(let te=0;te<pe.geometry.length;te+=2)Fe.push(Ji(pe.geometry[te],pe.geometry[te+1],H,U,Z,ae));pe.geometry=Fe;continue}const Se=[];for(const Fe of pe.geometry){const te=[];for(let Ce=0;Ce<Fe.length;Ce+=2)te.push(Ji(Fe[Ce],Fe[Ce+1],H,U,Z,ae));Se.push(te)}pe.geometry=Se}return be.transformed=!0,be}function Ji(be,H,U,Z,ae,pe){return[Math.round(U*(be*Z-ae)),Math.round(U*(H*Z-pe))]}function Si(be,H,U,Z,ae){const pe=H===ae.maxZoom?0:ae.tolerance/((1<<H)*ae.extent),Se={features:[],numPoints:0,numSimplified:0,numFeatures:be.length,source:null,x:U,y:Z,z:H,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Fe of be)Ri(Se,Fe,pe,ae);return Se}function Ri(be,H,U,Z){be.minX=Math.min(be.minX,H.minX),be.minY=Math.min(be.minY,H.minY),be.maxX=Math.max(be.maxX,H.maxX),be.maxY=Math.max(be.maxY,H.maxY);let ae,pe=H.tags||null;switch(H.type){case"Point":case"MultiPoint":{const Se=[];for(let Fe=0;Fe<H.geometry.length;Fe+=3)Se.push(H.geometry[Fe],H.geometry[Fe+1]),be.numPoints++,be.numSimplified++;if(!Se.length)return;ae={type:1,tags:pe,geometry:Se};break}case"LineString":{const Se=[];if(Vt(Se,H.geometry,be,U,!1,!1),!Se.length)return;if(Z.lineMetrics){pe={};for(const Fe in H.tags)pe[Fe]=H.tags[Fe];pe.mapbox_clip_start=H.geometry.start/H.geometry.size,pe.mapbox_clip_end=H.geometry.end/H.geometry.size}ae={type:2,tags:pe,geometry:Se};break}case"MultiLineString":case"Polygon":{const Se=[];for(let Fe=0;Fe<H.geometry.length;Fe++)Vt(Se,H.geometry[Fe],be,U,H.type==="Polygon",Fe===0);if(!Se.length)return;ae={type:H.type==="Polygon"?3:2,tags:pe,geometry:Se};break}case"MultiPolygon":{const Se=[];for(let Fe=0;Fe<H.geometry.length;Fe++){const te=H.geometry[Fe];for(let Ce=0;Ce<te.length;Ce++)Vt(Se,te[Ce],be,U,!0,Ce===0)}if(!Se.length)return;ae={type:3,tags:pe,geometry:Se};break}}H.id!==null&&(ae.id=H.id),be.features.push(ae)}function Vt(be,H,U,Z,ae,pe){const Se=Z*Z;if(Z>0&&H.size<(ae?Se:Z))return void(U.numPoints+=H.length/3);const Fe=[];for(let te=0;te<H.length;te+=3)(Z===0||H[te+2]>Se)&&(U.numSimplified++,Fe.push(H[te],H[te+1])),U.numPoints++;ae&&(function(te,Ce){let Ne=0;for(let ze=0,oe=te.length,Ve=oe-2;ze<oe;Ve=ze,ze+=2)Ne+=(te[ze]-te[Ve])*(te[ze+1]+te[Ve+1]);if(Ne>0===Ce)for(let ze=0,oe=te.length;ze<oe/2;ze+=2){const Ve=te[ze],lt=te[ze+1];te[ze]=te[oe-2-ze],te[ze+1]=te[oe-1-ze],te[oe-2-ze]=Ve,te[oe-1-ze]=lt}})(Fe,pe),be.push(Fe)}function xe(be,H,U){const Z=!!H.newGeometry,ae=H.removeAllProperties||H.removeProperties?.length>0||H.addOrUpdateProperties?.length>0;if(Z){let pe=At({type:"FeatureCollection",features:[{type:"Feature",id:be.id,geometry:H.newGeometry,properties:ae?Q(be.tags,H):be.tags}]},U);return pe=vi(pe,U),pe[0]}if(ae){const pe={...be};return pe.tags=Q(pe.tags,H),pe}return null}function Q(be,H){if(H.removeAllProperties)return{};const U={...be||{}};if(H.removeProperties)for(const Z of H.removeProperties)delete U[Z];if(H.addOrUpdateProperties)for(const{key:Z,value:ae}of H.addOrUpdateProperties)U[Z]=ae;return U}const ke={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,updateable:!1,debug:0};class ht{options;tiles;tileCoords;stats={};total=0;source;constructor(H,U){const Z=(U=this.options=Object.assign({},ke,U)).debug;if(Z&&console.time("preprocess data"),U.maxZoom<0||U.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(U.promoteId&&U.generateId)throw new Error("promoteId and generateId cannot be used together.");let ae=At(H,U);this.tiles={},this.tileCoords=[],Z&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",U.indexMaxZoom,U.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ae=vi(ae,U),ae.length&&this.splitTile(ae,0,0,0),U.updateable&&(this.source=ae),Z&&(ae.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(H,U,Z,ae,pe,Se,Fe){const te=[H,U,Z,ae],Ce=this.options,Ne=Ce.debug;for(;te.length;){ae=te.pop(),Z=te.pop(),U=te.pop(),H=te.pop();const ze=1<<U,oe=yt(U,Z,ae);let Ve=this.tiles[oe];if(!Ve&&(Ne>1&&console.time("creation"),Ve=this.tiles[oe]=Si(H,U,Z,ae,Ce),this.tileCoords.push({z:U,x:Z,y:ae,id:oe}),Ne)){Ne>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",U,Z,ae,Ve.numFeatures,Ve.numPoints,Ve.numSimplified),console.timeEnd("creation"));const gt=`z${U}`;this.stats[gt]=(this.stats[gt]||0)+1,this.total++}if(Ve.source=H,pe==null){if(U===Ce.indexMaxZoom||Ve.numPoints<=Ce.indexMaxPoints)continue}else{if(U===Ce.maxZoom||U===pe)continue;if(pe!=null){const gt=pe-U;if(Z!==Se>>gt||ae!==Fe>>gt)continue}}if(Ve.source=null,!H.length)continue;Ne>1&&console.time("clipping");const lt=.5*Ce.buffer/Ce.extent,vt=.5-lt,It=.5+lt,Ct=1+lt;let $t=null,Di=null,fn=null,rn=null;const Ln=mt(H,ze,Z-lt,Z+It,0,Ve.minX,Ve.maxX,Ce),on=mt(H,ze,Z+vt,Z+Ct,0,Ve.minX,Ve.maxX,Ce);Ln&&($t=mt(Ln,ze,ae-lt,ae+It,1,Ve.minY,Ve.maxY,Ce),Di=mt(Ln,ze,ae+vt,ae+Ct,1,Ve.minY,Ve.maxY,Ce)),on&&(fn=mt(on,ze,ae-lt,ae+It,1,Ve.minY,Ve.maxY,Ce),rn=mt(on,ze,ae+vt,ae+Ct,1,Ve.minY,Ve.maxY,Ce)),Ne>1&&console.timeEnd("clipping"),te.push($t||[],U+1,2*Z,2*ae),te.push(Di||[],U+1,2*Z,2*ae+1),te.push(fn||[],U+1,2*Z+1,2*ae),te.push(rn||[],U+1,2*Z+1,2*ae+1)}}getTile(H,U,Z){H=+H,U=+U,Z=+Z;const ae=this.options,{extent:pe,debug:Se}=ae;if(H<0||H>24)return null;const Fe=1<<H,te=yt(H,U=U+Fe&Fe-1,Z);if(this.tiles[te])return Le(this.tiles[te],pe);Se>1&&console.log("drilling down to z%d-%d-%d",H,U,Z);let Ce,Ne=H,ze=U,oe=Z;for(;!Ce&&Ne>0;)Ne--,ze>>=1,oe>>=1,Ce=this.tiles[yt(Ne,ze,oe)];return Ce?.source?(Se>1&&(console.log("found parent tile z%d-%d-%d",Ne,ze,oe),console.time("drilling down")),this.splitTile(Ce.source,Ne,ze,oe,H,U,Z),Se>1&&console.timeEnd("drilling down"),this.tiles[te]?Le(this.tiles[te],pe):null):null}invalidateTiles(H){const U=this.options,{debug:Z}=U;let ae=1/0,pe=-1/0,Se=1/0,Fe=-1/0;for(const Ne of H)ae=Math.min(ae,Ne.minX),pe=Math.max(pe,Ne.maxX),Se=Math.min(Se,Ne.minY),Fe=Math.max(Fe,Ne.maxY);const te=U.buffer/U.extent,Ce=new Set;for(const Ne in this.tiles){const ze=this.tiles[Ne],oe=1<<ze.z,Ve=(ze.x-te)/oe,lt=(ze.x+1+te)/oe,vt=(ze.y-te)/oe,It=(ze.y+1+te)/oe;if(pe<Ve||ae>=lt||Fe<vt||Se>=It)continue;let Ct=!1;for(const $t of H)if($t.maxX>=Ve&&$t.minX<lt&&$t.maxY>=vt&&$t.minY<It){Ct=!0;break}if(Ct){if(Z){Z>1&&console.log("invalidate tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ze.z,ze.x,ze.y,ze.numFeatures,ze.numPoints,ze.numSimplified);const $t=`z${ze.z}`;this.stats[$t]=(this.stats[$t]||0)-1,this.total--}delete this.tiles[Ne],Ce.add(Ne)}}Ce.size&&(this.tileCoords=this.tileCoords.filter((Ne=>!Ce.has(Ne.id))))}updateData(H){const U=this.options,Z=U.debug;if(!U.updateable)throw new Error("to update tile geojson `updateable` option must be set to true");const{affected:ae,source:pe}=(function(ze,oe,Ve){const lt=(function(It){return It?{removeAll:It.removeAll,remove:new Set(It.remove||[]),add:new Map(It.add?.map((Ct=>[Ct.id,Ct]))),update:new Map(It.update?.map((Ct=>[Ct.id,Ct])))}:{remove:new Set,add:new Map,update:new Map}})(oe);let vt=[];if(lt.removeAll&&(vt=ze,ze=[]),lt.remove.size||lt.add.size){const It=[];for(const Ct of ze){const{id:$t}=Ct;(lt.remove.has($t)||lt.add.has($t))&&It.push(Ct)}if(It.length){vt.push(...It);const Ct=new Set(It.map(($t=>$t.id)));ze=ze.filter(($t=>!Ct.has($t.id)))}if(lt.add.size){let Ct=At({type:"FeatureCollection",features:Array.from(lt.add.values())},Ve);Ct=vi(Ct,Ve),vt.push(...Ct),ze.push(...Ct)}}if(lt.update.size)for(const[It,Ct]of lt.update){const $t=ze.findIndex((rn=>rn.id===It));if($t===-1)continue;const Di=ze[$t],fn=xe(Di,Ct,Ve);fn&&(vt.push(Di,fn),ze[$t]=fn)}return{affected:vt,source:ze}})(this.source,H,U);if(!ae.length)return;this.source=pe,Z>1&&(console.log("invalidating tiles"),console.time("invalidating")),this.invalidateTiles(ae),Z>1&&console.timeEnd("invalidating");const[Se,Fe,te]=[0,0,0],Ce=Si(this.source,Se,Fe,te,this.options);Ce.source=this.source;const Ne=yt(Se,Fe,te);if(this.tiles[Ne]=Ce,this.tileCoords.push({z:Se,x:Fe,y:te,id:Ne}),Z){const ze=`z${Se}`;this.stats[ze]=(this.stats[ze]||0)+1,this.total++}}}function yt(be,H,U){return 32*((1<<be)*U+H)+be}class st{constructor(H,U,Z,ae=jt){this._dataUpdateable=new Map,this.actor=H,this.layerIndex=U,this.availableImages=Z,this.tileState=new F,this._createGeoJSONIndex=ae}loadVectorTile(H){if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const{z:U,x:Z,y:ae}=H.tileID.canonical,pe=this._geoJSONIndex.getTile(U,Z,ae);return pe?J(new _.d3(pe.features,{version:2,extent:_.a5})):null}loadTile(H){return _._(this,void 0,void 0,(function*(){const{uid:U}=H,Z=new C(H);Z.abort=new AbortController;try{const ae=this.loadVectorTile(H);if(!ae)return null;const{vectorTile:pe,rawData:Se}=ae;Z.vectorTile=pe,this.tileState.markLoaded(U,Z);const Fe={rawData:Se};this.tileState.setParsing(U,Fe);try{return yield this._parseWorkerTile(Z,H,Fe)}finally{this.tileState.clearParsing(U)}}catch(ae){throw Z.status="done",this.tileState.markLoaded(U,Z),ae}}))}_reloadLoadedTile(H){return _._(this,void 0,void 0,(function*(){const U=H.uid,Z=this.tileState.getLoaded(U);if(!Z)throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");if(Z.showCollisionBoxes=H.showCollisionBoxes,Z.status==="parsing"){const ae=this.tileState.consumeParsing(U);return yield this._parseWorkerTile(Z,H,ae)}if(Z.status==="done"&&Z.vectorTile)return yield this._parseWorkerTile(Z,H)}))}_parseWorkerTile(H,U,Z){return _._(this,void 0,void 0,(function*(){let ae=yield H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor,U.subdivisionGranularity);if(Z){const{rawData:pe}=Z;ae=_.e({rawTileData:pe.slice(0)},ae)}return ae}))}abortTile(H){return _._(this,void 0,void 0,(function*(){this.tileState.abort(H.uid)}))}removeTile(H){return _._(this,void 0,void 0,(function*(){this.tileState.removeLoaded(H.uid)}))}loadData(H){return _._(this,void 0,void 0,(function*(){var U;(U=this._pendingRequest)===null||U===void 0||U.abort();const Z=this._startRequestTiming(H);this._pendingRequest=new AbortController;try{(!this._pendingData||H.request||H.data||H.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(H,this._pendingRequest));const ae=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(ae,H),this.tileState.clearLoaded();const pe={};return H.request&&(pe.data=ae),this._finishRequestTiming(Z,H,pe),pe}catch(ae){if(delete this._pendingRequest,_.Z(ae))return{abandoned:!0};throw ae}}))}_startRequestTiming(H){var U;if(!((U=H.request)===null||U===void 0)&&U.collectResourceTiming)return new _.c$(H.request.url)}_finishRequestTiming(H,U,Z){const ae=H?.finish();ae&&(Z.resourceTiming={[U.source]:JSON.parse(JSON.stringify(ae))})}getData(){return _._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(H){return this.tileState.getLoaded(H.uid)?this._reloadLoadedTile(H):this.loadTile(H)}loadAndProcessGeoJSON(H,U){return _._(this,void 0,void 0,(function*(){let Z;if(H.request?Z=yield this.loadGeoJSONFromUrl(H.request,H.promoteId,U):H.data?Z=this._loadGeoJSONFromObject(H.data,H.promoteId):H.dataDiff&&(Z=this._loadGeoJSONFromDiff(H.dataDiff,H.promoteId,H.source)),delete this._pendingRequest,typeof Z!="object")throw new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`);return De(Z,!0),H.filter&&(Z=this._filterGeoJSON(Z,H.filter)),Z}))}loadGeoJSONFromUrl(H,U,Z){return _._(this,void 0,void 0,(function*(){const ae=yield _.j(H,Z);return this._dataUpdateable=_.a7(ae.data,U),ae.data}))}_loadGeoJSONFromObject(H,U){return this._dataUpdateable=_.a7(H,U),H}_loadGeoJSONFromDiff(H,U,Z){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${Z}`);_.a8(this._dataUpdateable,H,U);const ae=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(ae)}_filterGeoJSON(H,U){const Z=_.d4(U,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Z.result==="error")throw new Error(Z.value.map((pe=>`${pe.key}: ${pe.message}`)).join(", "));const ae=H.features.filter((pe=>Z.value.evaluate({zoom:0},pe)));return this._toFeatureCollection(ae)}_toFeatureCollection(H){return{type:"FeatureCollection",features:H}}removeSource(H){return _._(this,void 0,void 0,(function*(){var U;(U=this._pendingRequest)===null||U===void 0||U.abort()}))}getClusterExpansionZoom(H){return this._geoJSONIndex.getClusterExpansionZoom(H.clusterId)}getClusterChildren(H){return this._geoJSONIndex.getChildren(H.clusterId)}getClusterLeaves(H){return this._geoJSONIndex.getLeaves(H.clusterId,H.limit,H.offset)}}function jt(be,H){return H.cluster?new fe((function({superclusterOptions:U,clusterProperties:Z}){if(!Z||!U)return U;const ae={},pe={},Se={accumulated:null,zoom:0},Fe={properties:null},te=Object.keys(Z);for(const Ce of te){const[Ne,ze]=Z[Ce],oe=_.d4(ze),Ve=_.d4(typeof Ne=="string"?[Ne,["accumulated"],["get",Ce]]:Ne);ae[Ce]=oe.value,pe[Ce]=Ve.value}return U.map=Ce=>{Fe.properties=Ce;const Ne={};for(const ze of te)Ne[ze]=ae[ze].evaluate(Se,Fe);return Ne},U.reduce=(Ce,Ne)=>{Fe.properties=Ne;for(const ze of te)Se.accumulated=Ce[ze],Ce[ze]=pe[ze].evaluate(Se,Fe)},U})(H)).load(be.features):(function(U,Z){return new ht(U,Z)})(be,H.geojsonVtOptions)}class Et{constructor(H){this.self=H,this.actor=new _.L(H),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(U,Z)=>{if(this.externalWorkerSourceTypes[U])throw new Error(`Worker source with name "${U}" already registered.`);this.externalWorkerSourceTypes[U]=Z},this.self.addProtocol=_.cK,this.self.removeProtocol=_.cL,this.self.registerRTLTextPlugin=U=>{_.d5.setMethods(U)},this.actor.registerMessageHandler("LDT",((U,Z)=>this._getDEMWorkerSource(U,Z.source).loadTile(Z))),this.actor.registerMessageHandler("RDT",((U,Z)=>_._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(U,Z.source).removeTile(Z)})))),this.actor.registerMessageHandler("GCEZ",((U,Z)=>_._(this,void 0,void 0,(function*(){return this._getWorkerSource(U,Z.type,Z.source).getClusterExpansionZoom(Z)})))),this.actor.registerMessageHandler("GCC",((U,Z)=>_._(this,void 0,void 0,(function*(){return this._getWorkerSource(U,Z.type,Z.source).getClusterChildren(Z)})))),this.actor.registerMessageHandler("GCL",((U,Z)=>_._(this,void 0,void 0,(function*(){return this._getWorkerSource(U,Z.type,Z.source).getClusterLeaves(Z)})))),this.actor.registerMessageHandler("LD",((U,Z)=>this._getWorkerSource(U,Z.type,Z.source).loadData(Z))),this.actor.registerMessageHandler("GD",((U,Z)=>this._getWorkerSource(U,Z.type,Z.source).getData())),this.actor.registerMessageHandler("LT",((U,Z)=>this._getWorkerSource(U,Z.type,Z.source).loadTile(Z))),this.actor.registerMessageHandler("RT",((U,Z)=>this._getWorkerSource(U,Z.type,Z.source).reloadTile(Z))),this.actor.registerMessageHandler("AT",((U,Z)=>this._getWorkerSource(U,Z.type,Z.source).abortTile(Z))),this.actor.registerMessageHandler("RMT",((U,Z)=>this._getWorkerSource(U,Z.type,Z.source).removeTile(Z))),this.actor.registerMessageHandler("RS",((U,Z)=>_._(this,void 0,void 0,(function*(){if(!this.workerSources[U]||!this.workerSources[U][Z.type]||!this.workerSources[U][Z.type][Z.source])return;const ae=this.workerSources[U][Z.type][Z.source];delete this.workerSources[U][Z.type][Z.source],ae.removeSource!==void 0&&ae.removeSource(Z)})))),this.actor.registerMessageHandler("RM",(U=>_._(this,void 0,void 0,(function*(){delete this.layerIndexes[U],delete this.availableImages[U],delete this.workerSources[U],delete this.demWorkerSources[U],this.globalStates.delete(U)})))),this.actor.registerMessageHandler("SR",((U,Z)=>_._(this,void 0,void 0,(function*(){this.referrer=Z})))),this.actor.registerMessageHandler("SRPS",((U,Z)=>this._syncRTLPluginState(U,Z))),this.actor.registerMessageHandler("IS",((U,Z)=>_._(this,void 0,void 0,(function*(){this.self.importScripts(Z)})))),this.actor.registerMessageHandler("SI",((U,Z)=>this._setImages(U,Z))),this.actor.registerMessageHandler("UL",((U,Z)=>_._(this,void 0,void 0,(function*(){this._getLayerIndex(U).update(Z.layers,Z.removedIds,this._getGlobalState(U))})))),this.actor.registerMessageHandler("UGS",((U,Z)=>_._(this,void 0,void 0,(function*(){const ae=this._getGlobalState(U);for(const pe in Z)ae[pe]=Z[pe]})))),this.actor.registerMessageHandler("SL",((U,Z)=>_._(this,void 0,void 0,(function*(){this._getLayerIndex(U).replace(Z,this._getGlobalState(U))}))))}_getGlobalState(H){let U=this.globalStates.get(H);return U||(U={},this.globalStates.set(H,U)),U}_setImages(H,U){return _._(this,void 0,void 0,(function*(){this.availableImages[H]=U;for(const Z in this.workerSources[H]){const ae=this.workerSources[H][Z];for(const pe in ae)ae[pe].availableImages=U}}))}_syncRTLPluginState(H,U){return _._(this,void 0,void 0,(function*(){return yield _.d5.syncState(U,this.self.importScripts)}))}_getAvailableImages(H){let U=this.availableImages[H];return U||(U=[]),U}_getLayerIndex(H){let U=this.layerIndexes[H];return U||(U=this.layerIndexes[H]=new o),U}_getWorkerSource(H,U,Z){if(this.workerSources[H]||(this.workerSources[H]={}),this.workerSources[H][U]||(this.workerSources[H][U]={}),!this.workerSources[H][U][Z]){const ae={sendAsync:(pe,Se)=>(pe.targetMapId=H,this.actor.sendAsync(pe,Se))};switch(U){case"vector":this.workerSources[H][U][Z]=new W(ae,this._getLayerIndex(H),this._getAvailableImages(H));break;case"geojson":this.workerSources[H][U][Z]=new st(ae,this._getLayerIndex(H),this._getAvailableImages(H));break;default:this.workerSources[H][U][Z]=new this.externalWorkerSourceTypes[U](ae,this._getLayerIndex(H),this._getAvailableImages(H))}}return this.workerSources[H][U][Z]}_getDEMWorkerSource(H,U){return this.demWorkerSources[H]||(this.demWorkerSources[H]={}),this.demWorkerSources[H][U]||(this.demWorkerSources[H][U]=new ge),this.demWorkerSources[H][U]}}return _.i(self)&&(self.worker=new Et(self)),Et})),f("index",["exports","./shared"],(function(_,o){var M="5.18.0";function C(){var y=new o.A(4);return o.A!=Float32Array&&(y[1]=0,y[2]=0),y[0]=1,y[3]=1,y}let D,F,O;const j={frame(y,t,a,u){const d=u||window,x=d.requestAnimationFrame((S=>{w(),t(S)})),{unsubscribe:w}=o.s(y.signal,"abort",(()=>{w(),d.cancelAnimationFrame(x),a(new o.a(y.signal.reason))}),!1)},frameAsync(y,t){return new Promise(((a,u)=>{this.frame(y,a,u,t)}))},getImageData(y,t=0){return this.getImageCanvasContext(y).getImageData(-t,-t,y.width+2*t,y.height+2*t)},getImageCanvasContext(y){const t=window.document.createElement("canvas"),a=t.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return t.width=y.width,t.height=y.height,a.drawImage(y,0,0,y.width,y.height),a},resolveURL:y=>(D||(D=document.createElement("a")),D.href=y,D.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return O!==void 0?O:!!matchMedia&&(F==null&&(F=matchMedia("(prefers-reduced-motion: reduce)")),F.matches)},set prefersReducedMotion(y){O=y}},K=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(y){this._frozenAt=y}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function J(){return K.getCurrentTime()}class N{static testProp(t){if(!N.docStyle)return t[0];for(let a=0;a<t.length;a++)if(t[a]in N.docStyle)return t[a];return t[0]}static create(t,a,u){const d=window.document.createElement(t);return a!==void 0&&(d.className=a),u&&u.appendChild(d),d}static createNS(t,a){return window.document.createElementNS(t,a)}static disableDrag(){N.docStyle&&N.selectProp&&(N.userSelect=N.docStyle[N.selectProp],N.docStyle[N.selectProp]="none")}static enableDrag(){N.docStyle&&N.selectProp&&(N.docStyle[N.selectProp]=N.userSelect)}static setTransform(t,a){t.style[N.transformProp]=a}static addEventListener(t,a,u,d={}){t.addEventListener(a,u,"passive"in d?d:d.capture)}static removeEventListener(t,a,u,d={}){t.removeEventListener(a,u,"passive"in d?d:d.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",N.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",N.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",N.suppressClickInternal,!0)}),0)}static getScale(t){const a=t.getBoundingClientRect();return{x:a.width/t.offsetWidth||1,y:a.height/t.offsetHeight||1,boundingClientRect:a}}static getPoint(t,a,u){const d=a.boundingClientRect;return new o.P((u.clientX-d.left)/a.x-t.clientLeft,(u.clientY-d.top)/a.y-t.clientTop)}static mousePos(t,a){const u=N.getScale(t);return N.getPoint(t,u,a)}static touchPos(t,a){const u=[],d=N.getScale(t);for(let x=0;x<a.length;x++)u.push(N.getPoint(t,d,a[x]));return u}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const a=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),u=a.querySelectorAll("script");for(const d of u)d.remove();return N.clean(a),a.innerHTML}static isPossiblyDangerous(t,a){const u=a.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!u.includes("javascript:")&&!u.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const a=t.children;for(const u of a)N.removeAttributes(u),N.clean(u)}static removeAttributes(t){for(const{name:a,value:u}of t.attributes)N.isPossiblyDangerous(a,u)&&t.removeAttribute(a)}}N.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,N.selectProp=N.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),N.transformProp=N.testProp(["transform","WebkitTransform"]);const W={supported:!1,testSupport:function(y){!ve&&de&&(Me?De(y):ge=y)}};let ge,de,ve=!1,Me=!1;function De(y){const t=y.createTexture();y.bindTexture(y.TEXTURE_2D,t);try{if(y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,de),y.isContextLost())return;W.supported=!0}catch{}y.deleteTexture(t),ve=!0}var Ie;typeof document<"u"&&(de=document.createElement("img"),de.onload=()=>{ge&&De(ge),ge=null,Me=!0},de.onerror=()=>{ve=!0,ge=null},de.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(y){let t,a,u,d;y.resetRequestQueue=()=>{t=[],a=0,u=0,d={}},y.addThrottleControl=A=>{const R=u++;return d[R]=A,R},y.removeThrottleControl=A=>{delete d[A],w()},y.getImage=(A,R,z=!0)=>new Promise(((G,V)=>{W.supported&&(A.headers||(A.headers={}),A.headers.accept="image/webp,*/*"),o.e(A,{type:"image"}),t.push({abortController:R,requestParameters:A,supportImageRefresh:z,state:"queued",onError:$=>{V($)},onSuccess:$=>{G($)}}),w()}));const x=A=>o._(this,void 0,void 0,(function*(){A.state="running";const{requestParameters:R,supportImageRefresh:z,onError:G,onSuccess:V,abortController:$}=A,ee=z===!1&&!o.i(self)&&!o.g(R.url)&&(!R.headers||Object.keys(R.headers).reduce(((ue,ye)=>ue&&ye==="accept"),!0));a++;const ce=ee?S(R,$):o.m(R,$);try{const ue=yield ce;delete A.abortController,A.state="completed",ue.data instanceof HTMLImageElement||o.b(ue.data)?V(ue):ue.data&&V({data:yield(he=ue.data,typeof createImageBitmap=="function"?o.f(he):o.h(he)),cacheControl:ue.cacheControl,expires:ue.expires})}catch(ue){delete A.abortController,G(ue)}finally{a--,w()}var he})),w=()=>{const A=(()=>{for(const R of Object.keys(d))if(d[R]())return!0;return!1})()?o.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let R=a;R<A&&t.length>0;R++){const z=t.shift();z.abortController.signal.aborted?R--:x(z)}},S=(A,R)=>new Promise(((z,G)=>{const V=new Image,$=A.url,ee=A.credentials;ee&&ee==="include"?V.crossOrigin="use-credentials":(ee&&ee==="same-origin"||!o.d($))&&(V.crossOrigin="anonymous"),R.signal.addEventListener("abort",(()=>{V.src="",G(new o.a(R.signal.reason))})),V.fetchPriority="high",V.onload=()=>{V.onerror=V.onload=null,z({data:V})},V.onerror=()=>{V.onerror=V.onload=null,R.signal.aborted||G(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},V.src=$}))})(Ie||(Ie={})),Ie.resetRequestQueue();class $e{constructor(t){this._transformRequestFn=t??null}transformRequest(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function re(y){const t=[];if(typeof y=="string")t.push({id:"default",url:y});else if(y&&y.length>0){const a=[];for(const{id:u,url:d}of y){const x=`${u}${d}`;a.indexOf(x)===-1&&(a.push(x),t.push({id:u,url:d}))}}return t}function fe(y,t,a){try{const u=new URL(y);return u.pathname+=`${t}${a}`,u.toString()}catch{throw new Error(`Invalid sprite URL "${y}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function Oe(y){const{userImage:t}=y;return!!(t&&t.render&&t.render())&&(y.data.replace(new Uint8Array(t.data.buffer)),!0)}class tt extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const t of Object.keys(this.images))this.removeImage(t);this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:a,promiseResolve:u}of this.requestors)u(this._getImagesForIds(a));this.requestors=[]}}getImage(t){const a=this.images[t];if(a&&!a.data&&a.spriteData){const u=a.spriteData;a.data=new o.R({width:u.width,height:u.height},u.context.getImageData(u.x,u.y,u.width,u.height).data),a.spriteData=null}return a}addImage(t,a){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,a)&&(this.images[t]=a)}_validate(t,a){let u=!0;const d=a.data||a.spriteData;return this._validateStretch(a.stretchX,d&&d.width)||(this.fire(new o.k(new Error(`Image "${t}" has invalid "stretchX" value`))),u=!1),this._validateStretch(a.stretchY,d&&d.height)||(this.fire(new o.k(new Error(`Image "${t}" has invalid "stretchY" value`))),u=!1),this._validateContent(a.content,a)||(this.fire(new o.k(new Error(`Image "${t}" has invalid "content" value`))),u=!1),u}_validateStretch(t,a){if(!t)return!0;let u=0;for(const d of t){if(d[0]<u||d[1]<d[0]||a<d[1])return!1;u=d[1]}return!0}_validateContent(t,a){if(!t)return!0;if(t.length!==4)return!1;const u=a.spriteData,d=u&&u.width||a.data.width,x=u&&u.height||a.data.height;return!(t[0]<0||d<t[0]||t[1]<0||x<t[1]||t[2]<0||d<t[2]||t[3]<0||x<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,a,u=!0){const d=this.getImage(t);if(u&&(d.data.width!==a.data.width||d.data.height!==a.data.height))throw new Error(`size mismatch between old image (${d.data.width}x${d.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=d.version+1,this.images[t]=a,this.updatedImages[t]=!0}removeImage(t){const a=this.images[t];delete this.images[t],delete this.patterns[t],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise(((a,u)=>{let d=!0;if(!this.isLoaded())for(const x of t)this.images[x]||(d=!1);this.isLoaded()||d?a(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:a})}))}_getImagesForIds(t){const a={};for(const u of t){let d=this.getImage(u);d||(this.fire(new o.l("styleimagemissing",{id:u})),d=this.getImage(u)),d?a[u]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,textFitWidth:d.textFitWidth,textFitHeight:d.textFitHeight,hasRenderCallback:!!(d.userImage&&d.userImage.render)}:o.w(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return a}getPixelSize(){const{width:t,height:a}=this.atlasImage;return{width:t,height:a}}getPattern(t){const a=this.patterns[t],u=this.getImage(t);if(!u)return null;if(a&&a.position.version===u.version)return a.position;if(a)a.position.version=u.version;else{const d={w:u.data.width+2,h:u.data.height+2,x:0,y:0},x=new o.I(d,u);this.patterns[t]={bin:d,position:x}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const a=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.T(t,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const x in this.patterns)t.push(this.patterns[x].bin);const{w:a,h:u}=o.p(t),d=this.atlasImage;d.resize({width:a||1,height:u||1});for(const x in this.patterns){const{bin:w}=this.patterns[x],S=w.x+1,A=w.y+1,R=this.getImage(x).data,z=R.width,G=R.height;o.R.copy(R,d,{x:0,y:0},{x:S,y:A},{width:z,height:G}),o.R.copy(R,d,{x:0,y:G-1},{x:S,y:A-1},{width:z,height:1}),o.R.copy(R,d,{x:0,y:0},{x:S,y:A+G},{width:z,height:1}),o.R.copy(R,d,{x:z-1,y:0},{x:S-1,y:A},{width:1,height:G}),o.R.copy(R,d,{x:0,y:0},{x:S+z,y:A},{width:1,height:G})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const a of t){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const u=this.getImage(a);u||o.w(`Image with ID: "${a}" was not found`),Oe(u)&&this.updateImage(a,u)}}cloneImages(){const t={};for(const a in this.images){const u=this.images[a];t[a]=Object.assign(Object.assign({},u),{data:u.data?u.data.clone():null})}return t}}const Qe=1e20;function pt(y,t,a,u,d,x,w,S,A){for(let R=t;R<t+u;R++)ct(y,a*x+R,x,d,w,S,A);for(let R=a;R<a+d;R++)ct(y,R*x+t,1,u,w,S,A)}function ct(y,t,a,u,d,x,w){x[0]=0,w[0]=-Qe,w[1]=Qe,d[0]=y[t];for(let S=1,A=0,R=0;S<u;S++){d[S]=y[t+S*a];const z=S*S;do{const G=x[A];R=(d[S]-d[G]+z-G*G)/(S-G)/2}while(R<=w[A]&&--A>-1);A++,x[A]=S,w[A]=R,w[A+1]=Qe}for(let S=0,A=0;S<u;S++){for(;w[A+1]<S;)A++;const R=x[A],z=S-R;y[t+S*a]=d[R]+z*z}}const nt=o.v.layout_symbol["text-font"].default.join(",");class Je{constructor(t,a,u){this.requestManager=t,this.localIdeographFontFamily=a,this.entries={},this.lang=u}setURL(t){this.url=t}getGlyphs(t){return o._(this,void 0,void 0,(function*(){const a=[];for(const x in t)for(const w of t[x])a.push(this._getAndCacheGlyphsPromise(x,w));const u=yield Promise.all(a),d={};for(const{stack:x,id:w,glyph:S}of u)d[x]||(d[x]={}),d[x][w]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics};return d}))}_getAndCacheGlyphsPromise(t,a){return o._(this,void 0,void 0,(function*(){let u=this.entries[t];u||(u=this.entries[t]={glyphs:{},requests:{},ranges:{}});let d=u.glyphs[a];return d!==void 0?{stack:t,id:a,glyph:d}:!this.url||this._charUsesLocalIdeographFontFamily(a)?(d=u.glyphs[a]=this._drawGlyph(u,t,a),{stack:t,id:a,glyph:d}):yield this._downloadAndCacheRangePromise(t,a)}))}_downloadAndCacheRangePromise(t,a){return o._(this,void 0,void 0,(function*(){const u=this.entries[t],d=Math.floor(a/256);if(u.ranges[d])return{stack:t,id:a,glyph:null};if(!u.requests[d]){const x=Je.loadGlyphRange(t,d,this.url,this.requestManager);u.requests[d]=x}try{const x=yield u.requests[d];for(const w in x)u.glyphs[+w]=x[+w];return u.ranges[d]=!0,{stack:t,id:a,glyph:x[a]||null}}catch(x){const w=u.glyphs[a]=this._drawGlyph(u,t,a);return this._warnOnMissingGlyphRange(w,d,a,x),{stack:t,id:a,glyph:w}}}))}_warnOnMissingGlyphRange(t,a,u,d){const x=256*a,w=x+255,S=u.toString(16).padStart(4,"0").toUpperCase();o.w(`Unable to load glyph range ${a}, ${x}-${w}. Rendering codepoint U+${S} locally instead. ${d}`)}_charUsesLocalIdeographFontFamily(t){return!!this.localIdeographFontFamily&&o.q(t)}_drawGlyph(t,a,u){const d=a===nt&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(u),x=d?"ideographTinySDF":"tinySDF";t[x]||(t[x]=this._createTinySDF(d?this.localIdeographFontFamily:a));const w=t[x].draw(String.fromCodePoint(u)),S=new RegExp("^\\p{gc=Cf}+$","u").test(String.fromCodePoint(u));return{id:u,bitmap:new o.r({width:w.width||60,height:w.height||60},w.data),metrics:{width:S?0:w.glyphWidth/2||24,height:w.glyphHeight/2||24,left:w.glyphLeft/2+.5||0,top:w.glyphTop/2-27.5||-8,advance:S?0:w.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(t){const a=t?t.split(","):[];a.push("sans-serif");const u=a.map((d=>/[-\w]+/.test(d)?d:`'${CSS.escape(d)}'`)).join(",");return new Je.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:u,fontWeight:this._fontWeight(a[0]),fontStyle:this._fontStyle(a[0]),lang:this.lang})}_fontStyle(t){return/italic/i.test(t)?"italic":/oblique/i.test(t)?"oblique":"normal"}_fontWeight(t){const a={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let u;for(const[d,x]of Object.entries(a))new RegExp(`\\b${d}\\b`,"i").test(t)&&(u=`${x}`);return u}destroy(){for(const t in this.entries){const a=this.entries[t];a.tinySDF&&(a.tinySDF=null),a.ideographTinySDF&&(a.ideographTinySDF=null),a.glyphs={},a.requests={},a.ranges={}}this.entries={}}}Je.loadGlyphRange=function(y,t,a,u){return o._(this,void 0,void 0,(function*(){const d=256*t,x=d+255,w=u.transformRequest(a.replace("{fontstack}",y).replace("{range}",`${d}-${x}`),"Glyphs"),S=yield o.n(w,new AbortController);if(!S||!S.data)throw new Error(`Could not load glyph range. range: ${t}, ${d}-${x}`);const A={};for(const R of o.o(S.data))A[R.id]=R;return A}))},Je.TinySDF=class{constructor({fontSize:y=24,buffer:t=3,radius:a=8,cutoff:u=.25,fontFamily:d="sans-serif",fontWeight:x="normal",fontStyle:w="normal",lang:S=null}={}){this.buffer=t,this.cutoff=u,this.radius=a,this.lang=S;const A=this.size=y+4*t,R=this._createCanvas(A),z=this.ctx=R.getContext("2d",{willReadFrequently:!0});z.font=`${w} ${x} ${y}px ${d}`,z.textBaseline="alphabetic",z.textAlign="left",z.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Uint16Array(A)}_createCanvas(y){const t=document.createElement("canvas");return t.width=t.height=y,t}draw(y){const{width:t,actualBoundingBoxAscent:a,actualBoundingBoxDescent:u,actualBoundingBoxLeft:d,actualBoundingBoxRight:x}=this.ctx.measureText(y),w=Math.ceil(a),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(x-d))),A=Math.min(this.size-this.buffer,w+Math.ceil(u)),R=S+2*this.buffer,z=A+2*this.buffer,G=Math.max(R*z,0),V=new Uint8ClampedArray(G),$={data:V,width:R,height:z,glyphWidth:S,glyphHeight:A,glyphTop:w,glyphLeft:0,glyphAdvance:t};if(S===0||A===0)return $;const{ctx:ee,buffer:ce,gridInner:he,gridOuter:ue}=this;this.lang&&(ee.lang=this.lang),ee.clearRect(ce,ce,S,A),ee.fillText(y,ce,ce+w);const ye=ee.getImageData(ce,ce,S,A);ue.fill(Qe,0,G),he.fill(0,0,G);for(let Ae=0;Ae<A;Ae++)for(let _e=0;_e<S;_e++){const Ee=ye.data[4*(Ae*S+_e)+3]/255;if(Ee===0)continue;const Pe=(Ae+ce)*R+_e+ce;if(Ee===1)ue[Pe]=0,he[Pe]=Qe;else{const we=.5-Ee;ue[Pe]=we>0?we*we:0,he[Pe]=we<0?we*we:0}}pt(ue,0,0,R,z,R,this.f,this.v,this.z),pt(he,ce,ce,S,A,R,this.f,this.v,this.z);for(let Ae=0;Ae<G;Ae++){const _e=Math.sqrt(ue[Ae])-Math.sqrt(he[Ae]);V[Ae]=Math.round(255-255*(_e/this.radius+this.cutoff))}return $}};class ut{constructor(){this.specification=o.u.light.position}possiblyEvaluate(t,a){return o.F(t.expression.evaluate(a))}interpolate(t,a,u){return{x:o.G.number(t.x,a.x,u),y:o.G.number(t.y,a.y,u),z:o.G.number(t.z,a.z,u)}}}let xt;class At extends o.E{constructor(t){super(),xt=xt||new o.t({anchor:new o.D(o.u.light.anchor),position:new ut,color:new o.D(o.u.light.color),intensity:new o.D(o.u.light.intensity)}),this._transitionable=new o.x(xt,void 0),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a={}){if(!this._validate(o.y,t,a))for(const u in t){const d=t[u];u.endsWith(o.z)?this._transitionable.setTransition(u.slice(0,-o.z.length),d):this._transitionable.setValue(u,d)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,u){return(!u||u.validate!==!1)&&o.B(this,t.call(o.C,{value:a,style:{glyphs:!0,sprite:!0},styleSpec:o.u}))}}const Rt=new o.t({"sky-color":new o.D(o.u.sky["sky-color"]),"horizon-color":new o.D(o.u.sky["horizon-color"]),"fog-color":new o.D(o.u.sky["fog-color"]),"fog-ground-blend":new o.D(o.u.sky["fog-ground-blend"]),"horizon-fog-blend":new o.D(o.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new o.D(o.u.sky["sky-horizon-blend"]),"atmosphere-blend":new o.D(o.u.sky["atmosphere-blend"])});class oi extends o.E{constructor(t){super(),this._transitionable=new o.x(Rt,void 0),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.H(0))}setSky(t,a={}){if(!this._validate(o.J,t,a)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const u in t){const d=t[u];u.endsWith(o.z)?this._transitionable.setTransition(u.slice(0,-o.z.length),d):this._transitionable.setValue(u,d)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,u={}){return u?.validate!==!1&&o.B(this,t.call(o.C,o.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:o.u})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class ti{constructor(t,a){this.width=t,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,a){const u=t.join(",")+String(a);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(t,a)),this.dashEntry[u]}getDashRanges(t,a,u){const d=[];let x=t.length%2==1?-t[t.length-1]*u:0,w=t[0]*u,S=!0;d.push({left:x,right:w,isDash:S,zeroLength:t[0]===0});let A=t[0];for(let R=1;R<t.length;R++){S=!S;const z=t[R];x=A*u,A+=z,w=A*u,d.push({left:x,right:w,isDash:S,zeroLength:z===0})}return d}addRoundDash(t,a,u){const d=a/2;for(let x=-u;x<=u;x++){const w=this.width*(this.nextRow+u+x);let S=0,A=t[S];for(let R=0;R<this.width;R++){R/A.right>1&&(A=t[++S]);const z=Math.abs(R-A.left),G=Math.abs(R-A.right),V=Math.min(z,G);let $;const ee=x/u*(d+1);if(A.isDash){const ce=d-Math.abs(ee);$=Math.sqrt(V*V+ce*ce)}else $=d-Math.sqrt(V*V+ee*ee);this.data[w+R]=Math.max(0,Math.min(255,$+128))}}}addRegularDash(t){for(let S=t.length-1;S>=0;--S){const A=t[S],R=t[S+1];A.zeroLength?t.splice(S,1):R&&R.isDash===A.isDash&&(R.left=A.left,t.splice(S,1))}const a=t[0],u=t[t.length-1];a.isDash===u.isDash&&(a.left=u.left-this.width,u.right=a.right+this.width);const d=this.width*this.nextRow;let x=0,w=t[x];for(let S=0;S<this.width;S++){S/w.right>1&&(w=t[++x]);const A=Math.abs(S-w.left),R=Math.abs(S-w.right),z=Math.min(A,R);this.data[d+S]=Math.max(0,Math.min(255,(w.isDash?z:-z)+128))}}addDash(t,a){const u=a?7:0,d=2*u+1;if(this.nextRow+d>this.height)return o.w("LineAtlas out of space"),null;let x=0;for(let S=0;S<t.length;S++)x+=t[S];if(x!==0){const S=this.width/x,A=this.getDashRanges(t,this.width,S);a?this.addRoundDash(A,S,u):this.addRegularDash(A)}const w={y:this.nextRow+u,height:2*u,width:x};return this.nextRow+=d,this.dirty=!0,w}bind(t){const a=t.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}const Ii="maplibre_preloaded_worker_pool";class yi{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<yi.workerCount;)this.workers.push(new Worker(o.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach((a=>{a.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Ii]}numActive(){return Object.keys(this.active).length}}const ot=Math.floor(j.hardwareConcurrency/2);let mt,Dt;function ni(){return mt||(mt=new yi),mt}yi.workerCount=o.K(globalThis)?Math.max(Math.min(ot,3),1):1;class Gt{constructor(t,a){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=a;const u=this.workerPool.acquire(a);for(let d=0;d<u.length;d++){const x=new o.L(u[d],a);x.name=`Worker ${d}`,this.actors.push(x)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,a){const u=[];for(const d of this.actors)u.push(d.sendAsync({type:t,data:a}));return Promise.all(u)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach((a=>{a.remove()})),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,a){for(const u of this.actors)u.registerMessageHandler(t,a)}unregisterMessageHandler(t){for(const a of this.actors)a.unregisterMessageHandler(t)}}function pi(){return Dt||(Dt=new Gt(ni(),o.M),Dt.registerMessageHandler("GR",((y,t,a)=>o.m(t,a)))),Dt}function Ti(y,t){const a=o.N();return o.O(a,a,[1,1,0]),o.Q(a,a,[.5*y.width,.5*y.height,1]),y.calculatePosMatrix?o.S(a,a,y.calculatePosMatrix(t.toUnwrapped())):a}function xi(y,t,a,u,d,x,w){var S;const A=(function(V,$,ee){if(V)for(const ce of V){const he=$[ce];if(he&&he.source===ee&&he.type==="fill-extrusion")return!0}else for(const ce in $){const he=$[ce];if(he.source===ee&&he.type==="fill-extrusion")return!0}return!1})((S=d?.layers)!==null&&S!==void 0?S:null,t,y.id),R=x.maxPitchScaleFactor(),z=y.tilesIn(u,R,A);z.sort(ci);const G=[];for(const V of z)G.push({wrappedTileID:V.tileID.wrapped().key,queryResults:V.tile.queryRenderedFeatures(t,a,y.getState(),V.queryGeometry,V.cameraQueryGeometry,V.scale,d,x,R,Ti(x,V.tileID),w?($,ee)=>w(V.tileID,$,ee):void 0)});return(function(V,$){for(const ee in V)for(const ce of V[ee])vi(ce,$);return V})((function(V){const $={},ee={};for(const ce of V){const he=ce.queryResults,ue=ce.wrappedTileID,ye=ee[ue]=ee[ue]||{};for(const Ae in he){const _e=he[Ae],Ee=ye[Ae]=ye[Ae]||{},Pe=$[Ae]=$[Ae]||[];for(const we of _e)Ee[we.featureIndex]||(Ee[we.featureIndex]=!0,Pe.push(we))}}return $})(G),y)}function ci(y,t){const a=y.tileID,u=t.tileID;return a.overscaledZ-u.overscaledZ||a.canonical.y-u.canonical.y||a.wrap-u.wrap||a.canonical.x-u.canonical.x}function vi(y,t){const a=y.feature,u=t.getFeatureState(a.layer["source-layer"],a.id);a.source=a.layer.source,a.layer["source-layer"]&&(a.sourceLayer=a.layer["source-layer"]),a.state=u}function ri(y,t,a,u){return o._(this,void 0,void 0,(function*(){let d=y;if(y.url?d=(yield o.j(t.transformRequest(y.url,"Source"),a)).data:yield j.frameAsync(a,u),!d)return null;const x=o.U(o.e(d,y),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in d&&d.vector_layers&&(x.vectorLayerIds=d.vector_layers.map((w=>w.id))),x}))}class ui{constructor(t,a){t&&(a?this.setSouthWest(t).setNorthEast(a):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof o.V?new o.V(t.lng,t.lat):o.V.convert(t),this}setSouthWest(t){return this._sw=t instanceof o.V?new o.V(t.lng,t.lat):o.V.convert(t),this}extend(t){const a=this._sw,u=this._ne;let d,x;if(t instanceof o.V)d=t,x=t;else{if(!(t instanceof ui))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(ui.convert(t)):this.extend(o.V.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(o.V.convert(t)):this;if(d=t._sw,x=t._ne,!d||!x)return this}return a||u?(a.lng=Math.min(d.lng,a.lng),a.lat=Math.min(d.lat,a.lat),u.lng=Math.max(x.lng,u.lng),u.lat=Math.max(x.lat,u.lat)):(this._sw=new o.V(d.lng,d.lat),this._ne=new o.V(x.lng,x.lat)),this}getCenter(){return new o.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.V(this.getWest(),this.getNorth())}getSouthEast(){return new o.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:a,lat:u}=o.V.convert(t);let d=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&d}intersects(t){if(!((t=ui.convert(t)).getNorth()>=this.getSouth()&&t.getSouth()<=this.getNorth()))return!1;const a=Math.abs(this.getEast()-this.getWest()),u=Math.abs(t.getEast()-t.getWest());if(a>=360||u>=360)return!0;const d=o.W(this.getWest(),-180,180),x=o.W(this.getEast(),-180,180),w=o.W(t.getWest(),-180,180),S=o.W(t.getEast(),-180,180),A=d>x,R=w>S;return!(!A||!R)||(A?S>=d||w<=x:R?x>=w||d<=S:w<=x&&S>=d)}static convert(t){return t instanceof ui?t:t&&new ui(t)}static fromLngLat(t,a=0){const u=360*a/40075017,d=u/Math.cos(Math.PI/180*t.lat);return new ui(new o.V(t.lng-d,t.lat-u),new o.V(t.lng+d,t.lat+u))}adjustAntiMeridian(){const t=new o.V(this._sw.lng,this._sw.lat),a=new o.V(this._ne.lng,this._ne.lat);return new ui(t,t.lng>a.lng?new o.V(a.lng+360,a.lat):a)}}class Le{constructor(t,a,u){this.bounds=ui.convert(this.validateBounds(t)),this.minzoom=a||0,this.maxzoom=u||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const a=Math.pow(2,t.z),u=Math.floor(o.Y(this.bounds.getWest())*a),d=Math.floor(o.X(this.bounds.getNorth())*a),x=Math.ceil(o.Y(this.bounds.getEast())*a),w=Math.ceil(o.X(this.bounds.getSouth())*a);return t.x>=u&&t.x<x&&t.y>=d&&t.y<w}}class Ji extends o.E{constructor(t,a,u,d){if(super(),this.id=t,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.U(a,["url","scheme","tileSize","promoteId","encoding"])),this._options=o.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d)}load(){return o._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield ri(this._options,this.map._requestManager,this._tileJSONRequest,this.map._ownerWindow);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),t&&(o.e(this,t),t.bounds&&(this.tileBounds=new Le(t.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this._loaded=!0,o.Z(t)||this.fire(new o.k(t))}}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return o.e({},this._options)}loadTile(t){return o._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(a,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(t)};u.request.collectResourceTiming=this._collectResourceTiming;let d="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise(((x,w)=>{t.reloadPromise={resolve:x,reject:w}}))}else t.actor=this.dispatcher.getActor(),d="LT";t.abortController=new AbortController;try{const x=yield t.actor.sendAsync({type:d,data:u},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,x)}catch(x){if(delete t.abortController,t.aborted)return;if(x&&x.status!==404)throw x;this._afterTileLoadWorkerResponse(t,null)}}))}_getOverzoomParameters(t){if(t.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const a=t.tileID.scaledTo(this.maxzoom).canonical,u=a.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:a,overzoomRequest:this.map._requestManager.transformRequest(u,"Tile")}}_afterTileLoadWorkerResponse(t,a){if(a&&a.resourceTiming&&(t.resourceTiming=a.resourceTiming),a&&this.map._refreshExpiredTiles&&t.setExpiryData(a),t.loadVectorData(a,this.map.painter),t.reloadPromise){const u=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(u.resolve).catch(u.reject)}}abortTile(t){return o._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}unloadTile(t){return o._(this,void 0,void 0,(function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class Si extends o.E{constructor(t,a,u,d){super(),this.id=t,this.dispatcher=u,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},a),o.e(this,o.U(a,["url","scheme","tileSize"]))}load(){return o._(this,arguments,void 0,(function*(t=!1){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield ri(this._options,this.map._requestManager,this._tileJSONRequest,this.map._ownerWindow);this._tileJSONRequest=null,this._loaded=!0,a&&(o.e(this,a),a.bounds&&(this.tileBounds=new Le(a.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(a){this._tileJSONRequest=null,this._loaded=!0,o.Z(a)||this.fire(new o.k(a))}}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}serialize(){return o.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return o._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const u=yield Ie.getImage(this.map._requestManager.transformRequest(a,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(u&&u.data){this.map._refreshExpiredTiles&&(u.cacheControl||u.expires)&&t.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const d=this.map.painter.context,x=d.gl,w=u.data;t.texture=this.map.painter.getTileTexture(w.width),t.texture?t.texture.update(w,{useMipmap:!0}):(t.texture=new o.T(d,w,x.RGBA,{useMipmap:!0}),t.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(u){if(delete t.abortController,t.aborted)t.state="unloaded";else if(u)throw t.state="errored",u}}))}abortTile(t){return o._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)}))}unloadTile(t){return o._(this,void 0,void 0,(function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)}))}hasTransition(){return!1}}class Ri extends Si{constructor(t,a,u,d){super(t,a,u,d),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(t){return o._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u=this.map._requestManager.transformRequest(a,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const d=yield Ie.getImage(u,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(d&&d.data){const x=d.data;this.map._refreshExpiredTiles&&(d.cacheControl||d.expires)&&t.setExpiryData({cacheControl:d.cacheControl,expires:d.expires});const w=o.b(x)&&o.$()?x:yield this.readImageNow(x),S={type:this.type,uid:t.uid,source:this.id,rawImageData:w,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const A=yield t.actor.sendAsync({type:"LDT",data:S});t.dem=A,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(d){if(delete t.abortController,t.aborted)t.state="unloaded";else if(d)throw t.state="errored",d}}))}readImageNow(t){return o._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&o.a0()){const a=t.width+2,u=t.height+2;try{return new o.R({width:a,height:u},yield o.a1(t,-1,-1,a,u))}catch{}}return j.getImageData(t,1)}))}_getNeighboringTiles(t){const a=t.canonical,u=Math.pow(2,a.z),d=(a.x-1+u)%u,x=a.x===0?t.wrap-1:t.wrap,w=(a.x+1+u)%u,S=a.x+1===u?t.wrap+1:t.wrap,A={};return A[new o.a2(t.overscaledZ,x,a.z,d,a.y).key]={backfilled:!1},A[new o.a2(t.overscaledZ,S,a.z,w,a.y).key]={backfilled:!1},a.y>0&&(A[new o.a2(t.overscaledZ,x,a.z,d,a.y-1).key]={backfilled:!1},A[new o.a2(t.overscaledZ,t.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},A[new o.a2(t.overscaledZ,S,a.z,w,a.y-1).key]={backfilled:!1}),a.y+1<u&&(A[new o.a2(t.overscaledZ,x,a.z,d,a.y+1).key]={backfilled:!1},A[new o.a2(t.overscaledZ,t.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},A[new o.a2(t.overscaledZ,S,a.z,w,a.y+1).key]={backfilled:!1}),A}unloadTile(t){return o._(this,void 0,void 0,(function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))}))}}function Vt(y){return y.type==="GeometryCollection"?y.geometries.map((t=>t.coordinates)).flat(1/0):y.coordinates.flat(1/0)}function xe(y){const t=new ui;let a;switch(y.type){case"FeatureCollection":a=y.features.map((u=>Vt(u.geometry))).flat(1/0);break;case"Feature":a=Vt(y.geometry);break;default:a=Vt(y)}if(a.length==0)return t;for(let u=0;u<a.length-1;u+=2)t.extend([a[u],a[u+1]]);return t}class Q extends o.E{constructor(t,a,u,d){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:a.data},this.actor=u.getActor(),this.setEventedParent(d),this._data=typeof a.data=="string"?{url:a.data}:{geojson:a.data},this._options=o.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId,a.clusterMaxZoom!==void 0&&this.maxzoom<=a.clusterMaxZoom&&o.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${a.clusterMaxZoom}".`),this.workerOptions=o.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(a.buffer!==void 0?a.buffer:128),tolerance:this._pixelsToTileUnits(a.tolerance!==void 0?a.tolerance:.375),extent:o.a5,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(a.clusterMaxZoom),minPoints:Math.max(2,a.clusterMinPoints||2),extent:o.a5,radius:this._pixelsToTileUnits(a.clusterRadius||50),log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(t){return t*(o.a5/this.tileSize)}_getClusterMaxZoom(t){const a=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||o.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${a}"`),a}load(){return o._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(t){this.map=t,this.load()}setData(t,a){this._data=typeof t=="string"?{url:t}:{geojson:t},this._pendingWorkerUpdate={data:t};const u=this._updateWorkerData();return a?u:this}updateData(t,a){this._pendingWorkerUpdate.diff=o.a6(this._pendingWorkerUpdate.diff,t);const u=this._updateWorkerData();return a?u:this}getData(){return o._(this,void 0,void 0,(function*(){const t=o.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})}))}getBounds(){return o._(this,void 0,void 0,(function*(){return xe(yield this.getData())}))}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,a,u){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:a,offset:u}})}_updateWorkerData(){return o._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void o.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:t,diff:a}=this._pendingWorkerUpdate,u=this._getLoadGeoJSONParameters(t,a);t!==void 0?this._pendingWorkerUpdate.data=void 0:a&&(this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,yield this._dispatchWorkerUpdate(u)}))}_getLoadGeoJSONParameters(t,a){const u=o.e({type:this.type},this.workerOptions);return typeof t=="string"?(u.request=this.map._requestManager.transformRequest(j.resolveURL(t),"Source"),u.request.collectResourceTiming=this._collectResourceTiming,u):t!==void 0?(u.data=t,u):(a&&(u.dataDiff=a),u)}_dispatchWorkerUpdate(t){return o._(this,void 0,void 0,(function*(){this._isUpdatingWorker=!0,this.fire(new o.l("dataloading",{dataType:"source"}));try{const a=yield this.actor.sendAsync({type:"LD",data:t});if(this._isUpdatingWorker=!1,this._removed||a.abandoned)return void this.fire(new o.l("dataabort",{dataType:"source"}));a.data&&(this._data={geojson:a.data});const u=this._applyDiffToSource(t.dataDiff),d=this._getShouldReloadTileOptions(u),x={dataType:"source"};this._applyResourceTiming(x,a),this.fire(new o.l("data",Object.assign(Object.assign({},x),{sourceDataType:"metadata"}))),this.fire(new o.l("data",Object.assign(Object.assign({},x),{sourceDataType:"content",shouldReloadTileOptions:d})))}catch(a){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new o.l("dataabort",{dataType:"source"}));this.fire(new o.k(a))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyResourceTiming(t,a){var u;if(!this._collectResourceTiming)return;const d=(u=a.resourceTiming)===null||u===void 0?void 0:u[this.id];if(!d)return;const x=d.slice(0);x?.length&&o.e(t,{resourceTiming:x})}_applyDiffToSource(t){if(!t)return;const a=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){const d=o.a7(this._data.geojson,a);if(!d)throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:d}}if(!this._data.updateable)return;const u=o.a8(this._data.updateable,t,a);return t.removeAll||this._options.cluster?void 0:u}_getShouldReloadTileOptions(t){if(t)return{affectedBounds:t.filter(Boolean).map((a=>xe(a)))}}shouldReloadTile(t,{affectedBounds:a}){if(t.state==="loading")return!0;if(t.state==="unloaded")return!1;const{buffer:u,extent:d}=this.workerOptions.geojsonVtOptions,x=(function({x:w,y:S,z:A},R=0){const z=o.a3((w-R)/Math.pow(2,A)),G=o.a4((S+1+R)/Math.pow(2,A)),V=o.a3((w+1+R)/Math.pow(2,A)),$=o.a4((S-R)/Math.pow(2,A));return new ui([z,G],[V,$])})(t.tileID.canonical,u/d);for(const w of a)if(x.intersects(w))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(t){return o._(this,void 0,void 0,(function*(){const a=t.actor?"RT":"LT";t.actor=this.actor;const u={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};t.abortController=new AbortController;const d=yield this.actor.sendAsync({type:a,data:u},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(d,this.map.painter,a==="RT")}))}abortTile(t){return o._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0}))}unloadTile(t){return o._(this,void 0,void 0,(function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return o.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class ke extends o.E{constructor(t,a,u,d){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=u,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(d),this.options=a}load(t){return o._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const a=yield Ie.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,a&&a.data&&(this.image=a.data,t&&(this.coordinates=t),this._finishLoading())}catch(a){this._request=null,this._loaded=!0,o.Z(a)||this.fire(new o.k(a))}}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const a=t.map(o.a9.fromLngLat);var u;return this.tileID=(function(d){const x=o.aa.fromPoints(d),w=x.width(),S=x.height(),A=Math.max(w,S),R=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),z=Math.pow(2,R);return new o.ac(R,Math.floor((x.minX+x.maxX)/2*z),Math.floor((x.minY+x.maxY)/2*z))})(a),this.terrainTileRanges=this._getOverlappingTileRanges(a),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=a.map((d=>this.tileID.getTilePoint(d)._round())),this.flippedWindingOrder=((u=this.tileCoords)[1].x-u[0].x)*(u[2].y-u[0].y)-(u[1].y-u[0].y)*(u[2].x-u[0].x)<0,this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,a=t.gl;this.texture||(this.texture=new o.T(t,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let u=!1;for(const d in this.tiles){const x=this.tiles[d];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,u=!0)}u&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return o._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:a,minY:u,maxX:d,maxY:x}=o.aa.fromPoints(t),w={};for(let S=0;S<=o.ab;S++){const A=Math.pow(2,S),R=Math.floor(a*A),z=Math.floor(u*A),G=Math.floor(d*A),V=Math.floor(x*A),$=(R%A+A)%A,ee=G%A,ce=Math.floor(R/A),he=Math.floor(G/A);w[S]={minWrap:ce,maxWrap:he,minTileXWrapped:$,maxTileXWrapped:ee,minTileY:z,maxTileY:V}}return w}}class ht extends ke{constructor(t,a,u,d){super(t,a,u,d),this.roundZoom=!0,this.type="video",this.options=a}load(){return o._(this,void 0,void 0,(function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const a of t.urls)this.urls.push(this.map._requestManager.transformRequest(a,"Source").url);try{const a=yield o.ad(this.urls);if(this._loaded=!0,!a)return;this.video=a,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(a){this.fire(new o.k(a))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const a=this.video.seekable;t<a.start(0)||t>a.end(0)?this.fire(new o.k(new o.ae(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,a=t.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(t,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let u=!1;for(const d in this.tiles){const x=this.tiles[d];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,u=!0)}u&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class yt extends ke{constructor(t,a,u,d){super(t,a,u,d),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some((x=>!Array.isArray(x)||x.length!==2||x.some((w=>typeof w!="number"))))||this.fire(new o.k(new o.ae(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.k(new o.ae(`sources.${t}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new o.k(new o.ae(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new o.k(new o.ae(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.k(new o.ae(`sources.${t}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){return o._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context,u=a.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new o.T(a,this.canvas,u.RGBA,{premultiply:!0}),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let d=!1;for(const x in this.tiles){const w=this.tiles[x];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,d=!0)}d&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const st={},jt=y=>{switch(y){case"geojson":return Q;case"image":return ke;case"raster":return Si;case"raster-dem":return Ri;case"vector":return Ji;case"video":return ht;case"canvas":return yt}return st[y]},Et="RTLPluginLoaded";class be extends o.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=pi()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch((a=>{throw this.status="error",a}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return o._(this,arguments,void 0,(function*(a,u=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=j.resolveURL(a),!this.url)throw new Error(`requested url ${a} is invalid`);if(this.status==="unavailable"){if(!u)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return o._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new o.l(Et))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let H=null;function U(){return H||(H=new be),H}var Z,ae;(function(y){y[y.Base=0]="Base",y[y.Parent=1]="Parent"})(Z||(Z={})),(function(y){y[y.Departing=0]="Departing",y[y.Incoming=1]="Incoming"})(ae||(ae={}));class pe{constructor(t,a){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=t,this.uid=o.af(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttFingerprint={},this.expiredRequestCount=0,this.state="loading"}isRenderable(t){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(t||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:t,fadingDirection:a,fadingParentID:u,fadeEndTime:d}){this.resetFadeLogic(),this.fadingRole=t,this.fadingDirection=a,this.fadingParentID=u,this.fadeEndTime=d}setSelfFadeLogic(t){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=t}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=J(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,a,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData,this.latestFeatureIndex.encoding=t.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=(function(d,x){const w={};if(!x)return w;for(const S of d){const A=S.layerIds.map((R=>x.getLayer(R))).filter(Boolean);if(A.length!==0){S.layers=A,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map((R=>A.filter((z=>z.id===R))[0])));for(const R of A)w[R.id]=S}}return w})(t.buckets,a?.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const x=this.buckets[d];if(x instanceof o.ah){if(this.hasSymbolBuckets=!0,!u)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const x=this.buckets[d];if(x instanceof o.ah&&x.hasRTLText){this.hasRTLText=!0,U().lazyLoad();break}}this.queryPadding=0;for(const d in this.buckets){const x=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(d).queryRadius(x))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),this.dashPositions=t.dashPositions}else this.collisionBoxArray=new o.ag}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const u in this.buckets){const d=this.buckets[u];d.uploadPending()&&d.upload(t)}const a=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new o.T(t,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(t,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,a,u,d,x,w,S,A,R,z,G){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:d,cameraQueryGeometry:x,scale:w,tileSize:this.tileSize,pixelPosMatrix:z,transform:A,params:S,queryPadding:this.queryPadding*R,getElevation:G},t,a,u):{}}querySourceFeatures(t,a){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const d=u.loadVTLayers(),x=a&&a.sourceLayer?a.sourceLayer:"",w=d[o.ai]||d[x];if(!w)return;const S=o.aj(a?.filter,a?.globalState),{z:A,x:R,y:z}=this.tileID.canonical,G={z:A,x:R,y:z};for(let V=0;V<w.length;V++){const $=w.feature(V);if(S.needGeometry){const he=o.ak($,!0);if(!S.filter(new o.H(this.tileID.overscaledZ),he,this.tileID.canonical))continue}else if(!S.filter(new o.H(this.tileID.overscaledZ),$))continue;const ee=u.getId($,x),ce=new o.al($,A,R,z,ee);ce.tile=G,t.push(ce)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const a=this.expirationTime;if(t.cacheControl){const u=o.am(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const u=Date.now();let d=!1;if(this.expirationTime>u)d=!1;else if(a)if(this.expirationTime<a)d=!0;else{const x=this.expirationTime-a;x?this.expirationTime=u+Math.max(x,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const u=this.latestFeatureIndex.loadVTLayers();for(const d in this.buckets){if(!a.style.hasLayer(d))continue;const x=this.buckets[d],w=x.layers[0].sourceLayer||o.ai,S=u[w],A=t[w];if(!S||!A||Object.keys(A).length===0)continue;x.update(A,S,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const R=a&&a.style&&a.style.getLayer(d);R&&(this.queryPadding=Math.max(this.queryPadding,R.queryRadius(x)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<J()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(t){this.symbolFadeHoldUntil=J()+t}setDependencies(t,a){const u={};for(const d of a)u[d]=!0;this.dependencies[t]=u}hasDependency(t,a){for(const u of t){const d=this.dependencies[u];if(d){for(const x of a)if(d[x])return!0}}return!1}}class Se{constructor(){this.state={},this.stateChanges={},this.deletedStates={},this.revision=0}updateState(t,a,u){const d=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][d]=this.stateChanges[t][d]||{},o.e(this.stateChanges[t][d],u),this.deletedStates[t]===null){this.deletedStates[t]={};for(const x in this.state[t])x!==d&&(this.deletedStates[t][x]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][d]===null){this.deletedStates[t][d]={};for(const x in this.state[t][d])u[x]||(this.deletedStates[t][d][x]=null)}else for(const x in u)this.deletedStates[t]&&this.deletedStates[t][d]&&this.deletedStates[t][d][x]===null&&delete this.deletedStates[t][d][x]}removeFeatureState(t,a,u){if(this.deletedStates[t]===null)return;const d=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&a!==void 0)this.deletedStates[t][d]!==null&&(this.deletedStates[t][d]=this.deletedStates[t][d]||{},this.deletedStates[t][d][u]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][d])for(u in this.deletedStates[t][d]={},this.stateChanges[t][d])this.deletedStates[t][d][u]=null;else this.deletedStates[t][d]=null;else this.deletedStates[t]=null}getState(t,a){const u=String(a),d=o.e({},(this.state[t]||{})[u],(this.stateChanges[t]||{})[u]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const x=this.deletedStates[t][a];if(x===null)return{};for(const w in x)delete d[w]}return d}initializeTileState(t,a){t.setFeatureState(this.state,a)}coalesceChanges(t,a){const u={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const x={};for(const w in this.stateChanges[d])this.state[d][w]||(this.state[d][w]={}),o.e(this.state[d][w],this.stateChanges[d][w]),x[w]=this.state[d][w];u[d]=x}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const x={};if(this.deletedStates[d]===null)for(const w in this.state[d])x[w]={},this.state[d][w]={};else for(const w in this.deletedStates[d]){if(this.deletedStates[d][w]===null)this.state[d][w]={};else for(const S of Object.keys(this.deletedStates[d][w]))delete this.state[d][w][S];x[w]=this.state[d][w]}u[d]=u[d]||{},o.e(u[d],x)}this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0&&(this.revision++,t.setFeatureState(u,a))}}const Fe=89.25;function te(y,t){const a=o.an(t.lat,-o.ao,o.ao);return new o.P(o.Y(t.lng)*y,o.X(a)*y)}function Ce(y,t){return new o.a9(t.x/y,t.y/y).toLngLat()}function Ne(y){return y.cameraToCenterDistance*Math.min(.85*Math.tan(o.ap(90-y.pitch)),Math.tan(o.ap(Fe-y.pitch)))}function ze(y,t){const a=y.canonical,u=t/o.aq(a.z),d=a.x+Math.pow(2,a.z)*y.wrap,x=o.ar(new Float64Array(16));return o.O(x,x,[d*u,a.y*u,0]),o.Q(x,x,[u/o.a5,u/o.a5,1]),x}function oe(y,t,a,u,d){const x=o.a9.fromLngLat(y,t),w=d*o.as(1,y.lat),{x:S,y:A,z:R}=Ve(a,u);return new o.a9(x.x+w*-S,x.y+w*-A,x.z+w*-R)}function Ve(y,t){const a=o.ap(y),u=o.ap(t),d=Math.cos(-a),x=Math.sin(a);return{x:x*Math.sin(u),y:-x*Math.cos(u),z:d}}function lt(y,t,a){const u=t.intersectsFrustum(y);if(!a||u===0)return u;const d=t.intersectsPlane(a);return d===0?0:u===2&&d===2?2:1}function vt(y,t,a){let u=0;const d=(a-t)/10;for(let x=0;x<10;x++)u+=d*Math.pow(Math.cos(t+(x+.5)/10*(a-t)),y);return u}function It(y,t){return function(a,u,d,x,w){const S=2*((y-1)/o.at(Math.cos(o.ap(Fe-w))/Math.cos(o.ap(Fe)))-1),A=Math.acos(d/x),R=2*vt(S-1,0,o.ap(w/2)),z=Math.min(o.ap(Fe),A+o.ap(w/2)),G=vt(S-1,Math.min(z,A-o.ap(w/2)),z),V=Math.atan(u/d),$=Math.hypot(u,d);let ee=a;return ee+=o.at(x/$/Math.max(.5,Math.cos(o.ap(w/2)))),ee+=S*o.at(Math.cos(V))/2,ee-=o.at(Math.max(1,G/R/t))/2,ee}}const Ct=It(9.314,3);function $t(y,t){const a=(t.roundZoom?Math.round:Math.floor)(y.zoom+o.at(y.tileSize/t.tileSize));return Math.max(0,a)}function Di(y,t){const a=y.getCameraFrustum(),u=y.getClippingPlane(),d=y.screenPointToMercatorCoordinate(y.getCameraPoint()),x=o.a9.fromLngLat(y.center,y.elevation);d.z=x.z+Math.cos(y.pitchInRadians)*y.cameraToCenterDistance/y.worldSize;const w=y.getCoveringTilesDetailsProvider(),S=w.allowVariableZoom(y,t),A=$t(y,t),R=t.minzoom||0,z=t.maxzoom!==void 0?t.maxzoom:y.maxZoom,G=Math.min(Math.max(0,A),z),V=Math.pow(2,G),$=[V*d.x,V*d.y,0],ee=[V*x.x,V*x.y,0],ce=Math.hypot(x.x-d.x,x.y-d.y),he=Math.abs(x.z-d.z),ue=Math.hypot(ce,he),ye=Ee=>({zoom:0,x:0,y:0,wrap:Ee,fullyVisible:!1}),Ae=[],_e=[];if(y.renderWorldCopies&&w.allowWorldCopies())for(let Ee=1;Ee<=3;Ee++)Ae.push(ye(-Ee)),Ae.push(ye(Ee));for(Ae.push(ye(0));Ae.length>0;){const Ee=Ae.pop(),Pe=Ee.x,we=Ee.y;let Be=Ee.fullyVisible;const Ye={x:Pe,y:we,z:Ee.zoom},je=w.getTileBoundingVolume(Ye,Ee.wrap,y.elevation,t);if(!Be){const wt=lt(a,je,u);if(wt===0)continue;Be=wt===2}const Xe=w.distanceToTile2d(d.x,d.y,Ye,je);let Ze=A;S&&(Ze=(t.calculateTileZoom||Ct)(y.zoom+o.at(y.tileSize/t.tileSize),Xe,he,ue,y.fov)),Ze=(t.roundZoom?Math.round:Math.floor)(Ze),Ze=Math.max(0,Ze);const bt=Math.min(Ze,z);if(Ee.wrap=w.getWrap(x,Ye,Ee.wrap),Ee.zoom>=bt){if(Ee.zoom<R)continue;const wt=G-Ee.zoom,dt=$[0]-.5-(Pe<<wt),Mt=$[1]-.5-(we<<wt),ai=t.reparseOverscaled?Math.max(Ee.zoom,Ze):Ee.zoom;_e.push({tileID:new o.a2(Ee.zoom===z?ai:Ee.zoom,Ee.wrap,Ee.zoom,Pe,we),distanceSq:o.au([ee[0]-.5-Pe,ee[1]-.5-we]),tileDistanceToCamera:Math.sqrt(dt*dt+Mt*Mt)})}else for(let wt=0;wt<4;wt++)Ae.push({zoom:Ee.zoom+1,x:(Pe<<1)+wt%2,y:(we<<1)+(wt>>1),wrap:Ee.wrap,fullyVisible:Be})}return _e.sort(((Ee,Pe)=>Ee.distanceSq-Pe.distanceSq)).map((Ee=>Ee.tileID))}const fn=o.aa.fromPoints([new o.P(0,0),new o.P(o.a5,o.a5)]);function rn(y){return y==="raster"||y==="image"||y==="video"}function Ln(y,t,a,u,d,x,w){if(!t.hasData())return!1;const{tileID:S,fadingRole:A,fadingDirection:R,fadingParentID:z}=t;if(A===Z.Base&&R===ae.Incoming&&z)return a[z.key]=z,!0;const G=Math.max(S.overscaledZ-d,x);for(let V=S.overscaledZ-1;V>=G;V--){const $=S.scaledTo(V),ee=y.getLoadedTile($);if(ee)return t.setCrossFadeLogic({fadingRole:Z.Base,fadingDirection:ae.Incoming,fadingParentID:ee.tileID,fadeEndTime:u+w}),ee.setCrossFadeLogic({fadingRole:Z.Parent,fadingDirection:ae.Departing,fadeEndTime:u+w}),a[$.key]=$,!0}return!1}function on(y,t,a,u,d,x){if(!t.hasData())return!1;const w=t.tileID.children(d);let S=gt(y,t,w,a,u,d,x);if(S)return!0;for(const A of w)gt(y,t,A.children(d),a,u,d,x)&&(S=!0);return S}function gt(y,t,a,u,d,x,w){if(a[0].overscaledZ>=x)return!1;let S=!1;for(const A of a){const R=y.getLoadedTile(A);if(!R)continue;const{fadingRole:z,fadingDirection:G,fadingParentID:V}=R;z===Z.Base&&G===ae.Departing&&V||(R.setCrossFadeLogic({fadingRole:Z.Base,fadingDirection:ae.Departing,fadingParentID:t.tileID,fadeEndTime:d+w}),t.setCrossFadeLogic({fadingRole:Z.Parent,fadingDirection:ae.Incoming,fadeEndTime:d+w})),u[A.key]=A,S=!0}return S}function Ci(y,t,a,u){const d=y.tileID;return!!y.selfFading||!y.hasData()&&!!t.has(d)&&(y.setSelfFadeLogic(a+u),!0)}function zi(y,t){var a;y.needsHillshadePrepare=!0,y.needsTerrainPrepare=!0;let u=t.tileID.canonical.x-y.tileID.canonical.x;const d=t.tileID.canonical.y-y.tileID.canonical.y,x=Math.pow(2,y.tileID.canonical.z),w=t.tileID.key;u===0&&d===0||Math.abs(d)>1||(Math.abs(u)>1&&(Math.abs(u+x)===1?u+=x:Math.abs(u-x)===1&&(u-=x)),t.dem&&y.dem&&(y.dem.backfillBorder(t.dem,u,d),!((a=y.neighboringTiles)===null||a===void 0)&&a[w]&&(y.neighboringTiles[w].backfilled=!0)))}class is{constructor(){this._tiles={}}handleWrapJump(t){const a={};for(const u in this._tiles){const d=this._tiles[u];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+t),a[d.tileID.key]=d}this._tiles=a}setFeatureState(t,a){for(const u in this._tiles)this._tiles[u].setFeatureState(t,a)}getAllTiles(){return Object.values(this._tiles)}getAllIds(t=!1){return t?Object.values(this._tiles).map((a=>a.tileID)).sort(o.aw).map((a=>a.key)):Object.keys(this._tiles)}getTileById(t){return this._tiles[t]}setTile(t,a){this._tiles[t]=a}deleteTileById(t){delete this._tiles[t]}getLoadedTile(t){const a=this.getTileById(t.key);return a?.hasData()?a:null}isIdRenderable(t,a=!1){var u;return(u=this.getTileById(t))===null||u===void 0?void 0:u.isRenderable(a)}getRenderableIds(t=0,a){const u=[];for(const d of this.getAllIds())this.isIdRenderable(d,a)&&u.push(this.getTileById(d));return a?u.sort(((d,x)=>{const w=d.tileID,S=x.tileID,A=new o.P(w.canonical.x,w.canonical.y)._rotate(-t),R=new o.P(S.canonical.x,S.canonical.y)._rotate(-t);return w.overscaledZ-S.overscaledZ||R.y-A.y||R.x-A.x})).map((d=>d.tileID.key)):u.map((d=>d.tileID)).sort(o.aw).map((d=>d.key))}}class Un extends o.E{constructor(t,a,u){super(),this.id=t,this.dispatcher=u,this.on("data",(d=>this._dataHandler(d))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((d,x,w,S)=>{const A=new(jt(x.type))(d,x,w,S);if(A.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${A.id}`);return A})(t,a,u,this),this._inViewTiles=new is,this._outOfViewCache=new o.ax(0,(d=>this._unloadTile(d))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new Se,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){for(const a of this._inViewTiles.getAllTiles())a.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t),this._inViewTiles=new is}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,a,u){return o._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,a,u)}catch(d){t.state="errored",d.status!==404?this._source.fire(new o.k(d,{tile:t})):this.update(this.transform,this.terrain)}}))}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new o.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const a of this._inViewTiles.getAllTiles())a.upload(t),a.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(t){var a;return this._inViewTiles.getRenderableIds((a=this.transform)===null||a===void 0?void 0:a.bearingInRadians,t)}hasRenderableParent(t){const a=t.overscaledZ-1;if(a>=this._source.minzoom){const u=this.getLoadedTile(t.scaledTo(a));if(u)return this._inViewTiles.isIdRenderable(u.tileID.key)}return!1}reload(t,a=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const u of this._inViewTiles.getAllIds()){const d=this._inViewTiles.getTileById(u);a&&!this._source.shouldReloadTile(d,a)||(t?this._reloadTile(u,"expired"):d.state!=="errored"&&this._reloadTile(u,"reloading"))}}}_reloadTile(t,a){return o._(this,void 0,void 0,(function*(){const u=this._inViewTiles.getTileById(t);u&&(u.state!=="loading"&&(u.state=a),yield this._loadTile(u,t,a))}))}_tileLoaded(t,a,u){t.timeAdded=J(),t.selfFading&&(t.fadeEndTime=t.timeAdded+this._rasterFadeDuration),u==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(a,t),this.getSource().type==="raster-dem"&&t.dem&&(function(d,x){var w,S;const A=x.getRenderableIds();for(const R of A){if(!d.neighboringTiles||!d.neighboringTiles[R])continue;const z=x.getTileById(R);d.neighboringTiles[R].backfilled||zi(d,z),!((S=(w=z.neighboringTiles)===null||w===void 0?void 0:w[d.tileID.key])===null||S===void 0)&&S.backfilled||zi(z,d)}})(t,this._inViewTiles),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new o.l("data",{dataType:"source",tile:t,coord:t.tileID}))}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._inViewTiles.getTileById(t)}_retainLoadedChildren(t,a){const u=this._getLoadedDescendents(a),d=new Set;for(const x of a){const w=u[x.key];if(!w?.length){d.add(x);continue}const S=x.overscaledZ+Un.maxOverzooming,A=w.filter((G=>G.tileID.overscaledZ<=S));if(!A.length){d.add(x);continue}const R=Math.min(...A.map((G=>G.tileID.overscaledZ))),z=A.filter((G=>G.tileID.overscaledZ===R)).map((G=>G.tileID));for(const G of z)t[G.key]=G;this._areDescendentsComplete(z,R,x.overscaledZ)||d.add(x)}return d}_getLoadedDescendents(t){var a;const u={};for(const d of this._inViewTiles.getAllTiles().filter((x=>x.hasData())))for(const x of t)d.tileID.isChildOf(x)&&(u[a=x.key]||(u[a]=[])).push(d);return u}_areDescendentsComplete(t,a,u){return t.length===1&&t[0].isOverscaled()?t[0].overscaledZ===a:Math.pow(4,a-u)===t.length}getLoadedTile(t){return this._inViewTiles.getLoadedTile(t)}updateCacheSize(t){const a=Math.ceil(t.width/this._source.tileSize)+1,u=Math.ceil(t.height/this._source.tileSize)+1,d=Math.floor(a*u*(this._maxTileCacheZoomLevels===null?o.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._outOfViewCache.setMaxSize(x)}handleWrapJump(t){const a=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);this._prevLng=t,a&&(this._inViewTiles.handleWrapJump(a),this._resetTileReloadTimers())}update(t,a){if(!this._sourceLoaded||this._paused)return;let u;this.transform=t,this.terrain=a,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?u=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((A=>new o.a2(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y))):(u=Di(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?t.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(u=u.filter((A=>this._source.hasTile(A))))):u=[],this.usedForTerrain&&(u=this._addTerrainIdealTiles(u));const d=u.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,d&&this.fire(new o.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const x=$t(t,this._source),w=this._updateRetainedTiles(u,x),S=rn(this._source.type);S&&this._rasterFadeDuration>0&&!a&&(function(A,R,z,G,V,$,ee){const ce=J(),he=o.av(R);for(const ue of R){const ye=A.getTileById(ue.key);ye.fadingDirection!==ae.Departing&&ye.fadeOpacity!==0||ye.resetFadeLogic(),Ln(A,ye,z,ce,G,V,ee)||on(A,ye,z,ce,$,ee)||Ci(ye,he,ce,ee)||ye.resetFadeLogic()}})(this._inViewTiles,u,w,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),S?this._cleanUpRasterTiles(w):this._cleanUpVectorTiles(w)}_cleanUpRasterTiles(t){for(const a of this._inViewTiles.getAllIds())t[a]||this._removeTile(a)}_cleanUpVectorTiles(t){for(const a of this._inViewTiles.getAllIds()){const u=this._inViewTiles.getTileById(a);t[a]?u.clearSymbolFadeHold():u.hasSymbolBuckets?u.holdingForSymbolFade()?u.symbolFadeFinished()&&this._removeTile(a):u.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(a)}}_addTerrainIdealTiles(t){const a=[];for(const u of t)if(u.canonical.z>this._source.minzoom){const d=u.scaledTo(u.canonical.z-1);a.push(d);const x=u.scaledTo(Math.max(this._source.minzoom,Math.min(u.canonical.z,5)));a.push(x)}return t.concat(a)}releaseSymbolFadeTiles(){for(const t of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(t).holdingForSymbolFade()&&this._removeTile(t)}_updateRetainedTiles(t,a){var u;const d=new Set;for(const R of t)this._addTile(R).hasData()||d.add(R);const x=t.reduce(((R,z)=>(R[z.key]=z,R)),{}),w=this._retainLoadedChildren(x,d),S={},A=Math.max(a-Un.maxUnderzooming,this._source.minzoom);for(const R of w){let z=this._inViewTiles.getTileById(R.key),G=z?.wasRequested();for(let V=R.overscaledZ-1;V>=A;--V){const $=R.scaledTo(V);if(S[$.key])break;if(S[$.key]=!0,z=this.getTile($),!z&&G&&(z=this._addTile($)),z){const ee=z.hasData();if((ee||!(!((u=this.map)===null||u===void 0)&&u.cancelPendingTileRequestsWhileZooming)||G)&&(x[$.key]=$),G=z.wasRequested(),ee)break}}}return x}_addTile(t){let a=this._inViewTiles.getTileById(t.key);if(a)return a;a=this._outOfViewCache.getAndRemove(t),a&&(a.resetFadeLogic(),this._setTileReloadTimer(t.key,a),a.tileID=t,this._state.initializeTileState(a,this.map?this.map.painter:null));const u=a;return a||(a=new pe(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(a,t.key,a.state)),a.uses++,this._inViewTiles.setTile(t.key,a),u||this._source.fire(new o.l("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(t,a){this._clearTileReloadTimer(t);const u=a.getExpiryTimeout();u&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),u))}_clearTileReloadTimer(t){const a=this._timers[t];a&&(clearTimeout(a),delete this._timers[t])}_resetTileReloadTimers(){for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t of this._inViewTiles.getAllIds()){const a=this._inViewTiles.getTileById(t);this._setTileReloadTimer(t,a)}}refreshTiles(t){for(const a of this._inViewTiles.getAllIds()){const u=this._inViewTiles.getTileById(a);(this._inViewTiles.isIdRenderable(a)||u.state=="errored")&&t.some((d=>d.equals(u.tileID.canonical)))&&this._reloadTile(a,"expired")}}_removeTile(t){const a=this._inViewTiles.getTileById(t);a&&(a.uses--,this._inViewTiles.deleteTileById(t),this._clearTileReloadTimer(t),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._outOfViewCache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}_dataHandler(t){t.dataType==="source"&&(t.sourceDataType!=="metadata"?t.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(t.sourceDataChanged,t.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t of this._inViewTiles.getAllIds())this._removeTile(t);this._outOfViewCache.reset()}tilesIn(t,a,u){const d=[],x=this.transform;if(!x)return d;const w=x.getCoveringTilesDetailsProvider().allowWorldCopies(),S=u?x.getCameraQueryGeometry(t):t,A=$=>x.screenPointToMercatorCoordinate($,this.terrain),R=this.transformBbox(t,A,!w),z=this.transformBbox(S,A,!w),G=this.getIds(),V=o.aa.fromPoints(z);for(let $=0;$<G.length;$++){const ee=this._inViewTiles.getTileById(G[$]);if(ee.holdingForSymbolFade())continue;const ce=w?[ee.tileID]:[ee.tileID.unwrapTo(-1),ee.tileID.unwrapTo(0)],he=Math.pow(2,x.zoom-ee.tileID.overscaledZ),ue=a*ee.queryPadding*o.a5/ee.tileSize/he;for(const ye of ce){const Ae=V.map((_e=>ye.getTilePoint(new o.a9(_e.x,_e.y))));if(Ae.expandBy(ue),Ae.intersects(fn)){const _e=R.map((Pe=>ye.getTilePoint(Pe))),Ee=z.map((Pe=>ye.getTilePoint(Pe)));d.push({tile:ee,tileID:w?ye:ye.unwrapTo(0),queryGeometry:_e,cameraQueryGeometry:Ee,scale:he})}}}return d}transformBbox(t,a,u){let d=t.map(a);if(u){const x=o.aa.fromPoints(t);x.shrinkBy(.001*Math.min(x.width(),x.height()));const w=x.map(a);o.aa.fromPoints(d).covers(w)||(d=d.map((S=>S.x>.5?new o.a9(S.x-1,S.y,S.z):S)))}return d}getVisibleCoordinates(t){const a=this.getRenderableIds(t).map((u=>this._inViewTiles.getTileById(u).tileID));return this.transform&&this.transform.populateCache(a),a}hasTransition(){return!!this._source.hasTransition()||!(!rn(this._source.type)||!(function(t,a){if(a<=0)return!1;const u=J();for(const d of t.getAllTiles())if(d.fadeEndTime>=u)return!0;return!1})(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(t){this._rasterFadeDuration=t}setFeatureState(t,a,u){this._state.updateState(t=t||o.ai,a,u)}removeFeatureState(t,a,u){this._state.removeFeatureState(t=t||o.ai,a,u)}getFeatureState(t,a){return this._state.getState(t=t||o.ai,a)}setDependencies(t,a,u){const d=this._inViewTiles.getTileById(t);d&&d.setDependencies(a,u)}reloadTilesForDependencies(t,a){for(const u of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(u).hasDependency(t,a)&&this._reloadTile(u,"reloading");this._outOfViewCache.filter((u=>!u.hasDependency(t,a)))}areTilesLoaded(){for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}}Un.maxUnderzooming=10,Un.maxOverzooming=3;class Tt{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=o.an(t,0,1);let a=1,u=this._distances[a];const d=t*this.paddedLength+this.padding;for(;u<d&&a<this._distances.length;)u=this._distances[++a];const x=a-1,w=this._distances[x],S=u-w,A=S>0?(d-w)/S:0;return this.points[x].mult(1-A).add(this.points[a].mult(A))}}function Yt(y,t){let a=!0;return y==="always"||y!=="never"&&t!=="never"||(a=!1),a}class si{constructor(t,a,u){const d=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(t/u),this.yCellCount=Math.ceil(a/u);for(let w=0;w<this.xCellCount*this.yCellCount;w++)d.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,u,d,x){this._forEachCell(a,u,d,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(d),this.bboxes.push(x)}insertCircle(t,a,u,d){this._forEachCell(a-d,u-d,a+d,u+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(u),this.circles.push(d)}_insertBoxCell(t,a,u,d,x,w){this.boxCells[x].push(w)}_insertCircleCell(t,a,u,d,x,w){this.circleCells[x].push(w)}_query(t,a,u,d,x,w,S){if(u<0||t>this.width||d<0||a>this.height)return[];const A=[];if(t<=0&&a<=0&&this.width<=u&&this.height<=d){if(x)return[{key:null,x1:t,y1:a,x2:u,y2:d}];for(let R=0;R<this.boxKeys.length;R++)A.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const z=this.circles[3*R],G=this.circles[3*R+1],V=this.circles[3*R+2];A.push({key:this.circleKeys[R],x1:z-V,y1:G-V,x2:z+V,y2:G+V})}}else this._forEachCell(t,a,u,d,this._queryCell,A,{hitTest:x,overlapMode:w,seenUids:{box:{},circle:{}}},S);return A}query(t,a,u,d){return this._query(t,a,u,d,!1,null)}hitTest(t,a,u,d,x,w){return this._query(t,a,u,d,!0,x,w).length>0}hitTestCircle(t,a,u,d,x){const w=t-u,S=t+u,A=a-u,R=a+u;if(S<0||w>this.width||R<0||A>this.height)return!1;const z=[];return this._forEachCell(w,A,S,R,this._queryCellCircle,z,{hitTest:!0,overlapMode:d,circle:{x:t,y:a,radius:u},seenUids:{box:{},circle:{}}},x),z.length>0}_queryCell(t,a,u,d,x,w,S,A){const{seenUids:R,hitTest:z,overlapMode:G}=S,V=this.boxCells[x];if(V!==null){const ee=this.bboxes;for(const ce of V)if(!R.box[ce]){R.box[ce]=!0;const he=4*ce,ue=this.boxKeys[ce];if(t<=ee[he+2]&&a<=ee[he+3]&&u>=ee[he+0]&&d>=ee[he+1]&&(!A||A(ue))&&(!z||!Yt(G,ue.overlapMode))&&(w.push({key:ue,x1:ee[he],y1:ee[he+1],x2:ee[he+2],y2:ee[he+3]}),z))return!0}}const $=this.circleCells[x];if($!==null){const ee=this.circles;for(const ce of $)if(!R.circle[ce]){R.circle[ce]=!0;const he=3*ce,ue=this.circleKeys[ce];if(this._circleAndRectCollide(ee[he],ee[he+1],ee[he+2],t,a,u,d)&&(!A||A(ue))&&(!z||!Yt(G,ue.overlapMode))){const ye=ee[he],Ae=ee[he+1],_e=ee[he+2];if(w.push({key:ue,x1:ye-_e,y1:Ae-_e,x2:ye+_e,y2:Ae+_e}),z)return!0}}}return!1}_queryCellCircle(t,a,u,d,x,w,S,A){const{circle:R,seenUids:z,overlapMode:G}=S,V=this.boxCells[x];if(V!==null){const ee=this.bboxes;for(const ce of V)if(!z.box[ce]){z.box[ce]=!0;const he=4*ce,ue=this.boxKeys[ce];if(this._circleAndRectCollide(R.x,R.y,R.radius,ee[he+0],ee[he+1],ee[he+2],ee[he+3])&&(!A||A(ue))&&!Yt(G,ue.overlapMode))return w.push(!0),!0}}const $=this.circleCells[x];if($!==null){const ee=this.circles;for(const ce of $)if(!z.circle[ce]){z.circle[ce]=!0;const he=3*ce,ue=this.circleKeys[ce];if(this._circlesCollide(ee[he],ee[he+1],ee[he+2],R.x,R.y,R.radius)&&(!A||A(ue))&&!Yt(G,ue.overlapMode))return w.push(!0),!0}}}_forEachCell(t,a,u,d,x,w,S,A){const R=this._convertToXCellCoord(t),z=this._convertToYCellCoord(a),G=this._convertToXCellCoord(u),V=this._convertToYCellCoord(d);for(let $=R;$<=G;$++)for(let ee=z;ee<=V;ee++)if(x.call(this,t,a,u,d,this.xCellCount*ee+$,w,S,A))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,u,d,x,w){const S=d-t,A=x-a,R=u+w;return R*R>S*S+A*A}_circleAndRectCollide(t,a,u,d,x,w,S){const A=(w-d)/2,R=Math.abs(t-(d+A));if(R>A+u)return!1;const z=(S-x)/2,G=Math.abs(a-(x+z));if(G>z+u)return!1;if(R<=A||G<=z)return!0;const V=R-A,$=G-z;return V*V+$*$<=u*u}}function Vn(y,t,a){const u=o.N();if(!y){const{vecSouth:G,vecEast:V}=Hr(t),$=C();$[0]=V[0],$[1]=V[1],$[2]=G[0],$[3]=G[1],d=$,(z=(w=(x=$)[0])*(R=x[3])-(A=x[2])*(S=x[1]))&&(d[0]=R*(z=1/z),d[1]=-S*z,d[2]=-A*z,d[3]=w*z),u[0]=$[0],u[1]=$[1],u[4]=$[2],u[5]=$[3]}var d,x,w,S,A,R,z;return o.Q(u,u,[1/a,1/a,1]),u}function ba(y,t,a,u){if(y){const d=o.N();if(!t){const{vecSouth:x,vecEast:w}=Hr(a);d[0]=w[0],d[1]=w[1],d[4]=x[0],d[5]=x[1]}return o.Q(d,d,[u,u,1]),d}return a.pixelsToClipSpaceMatrix}function Hr(y){const t=Math.cos(y.rollInRadians),a=Math.sin(y.rollInRadians),u=Math.cos(y.pitchInRadians),d=Math.cos(y.bearingInRadians),x=Math.sin(y.bearingInRadians),w=o.aC();w[0]=-d*u*a-x*t,w[1]=-x*u*a+d*t;const S=o.aD(w);S<1e-9?o.aE(w):o.aF(w,w,1/S);const A=o.aC();A[0]=d*u*t-x*a,A[1]=x*u*t+d*a;const R=o.aD(A);return R<1e-9?o.aE(A):o.aF(A,A,1/R),{vecEast:A,vecSouth:w}}function li(y,t,a,u){let d;u?(d=[y,t,u(y,t),1],o.aH(d,d,a)):(d=[y,t,0,1],Kt(d,d,a));const x=d[3];return{point:new o.P(d[0]/x,d[1]/x),signedDistanceFromCamera:x,isOccluded:!1}}function wa(y,t){return .5+y/t*.5}function Ta(y,t){return y.x>=-t[0]&&y.x<=t[0]&&y.y>=-t[1]&&y.y<=t[1]}function lo(y,t,a,u,d,x,w,S,A,R,z,G,V){const $=a?y.textSizeData:y.iconSizeData,ee=o.ay($,t.transform.zoom),ce=[256/t.width*2+1,256/t.height*2+1],he=a?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;he.clear();const ue=y.lineVertexArray,ye=a?y.text.placedSymbolArray:y.icon.placedSymbolArray,Ae=t.transform.width/t.transform.height;let _e=!1;for(let Ee=0;Ee<ye.length;Ee++){const Pe=ye.get(Ee);if(Pe.hidden||Pe.writingMode===o.az.vertical&&!_e){Jt(Pe.numGlyphs,he);continue}_e=!1;const we=new o.P(Pe.anchorX,Pe.anchorY),Be={getElevation:V,pitchedLabelPlaneMatrix:u,lineVertexArray:ue,pitchWithMap:x,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:we,unwrappedTileID:A,width:R,height:z,translation:G},Ye=Pt(Pe.anchorX,Pe.anchorY,Be);if(!Ta(Ye.point,ce)){Jt(Pe.numGlyphs,he);continue}const je=wa(t.transform.cameraToCenterDistance,Ye.signedDistanceFromCamera),Xe=o.aA($,ee,Pe),Ze=x?Xe*t.transform.getPitchedTextCorrection(Pe.anchorX,Pe.anchorY,A)/je:Xe*je,bt=se({projectionContext:Be,pitchedLabelPlaneMatrixInverse:d,symbol:Pe,fontSize:Ze,flip:!1,keepUpright:w,glyphOffsetArray:y.glyphOffsetArray,dynamicLayoutVertexArray:he,aspectRatio:Ae,rotateToLine:S});_e=bt.useVertical,(bt.notEnoughRoom||_e||bt.needsFlipping&&se({projectionContext:Be,pitchedLabelPlaneMatrixInverse:d,symbol:Pe,fontSize:Ze,flip:!0,keepUpright:w,glyphOffsetArray:y.glyphOffsetArray,dynamicLayoutVertexArray:he,aspectRatio:Ae,rotateToLine:S}).notEnoughRoom)&&Jt(Pe.numGlyphs,he)}a?y.text.dynamicLayoutVertexBuffer.updateData(he):y.icon.dynamicLayoutVertexBuffer.updateData(he)}function Xs(y,t,a,u,d,x,w,S){const A=x.glyphStartIndex+x.numGlyphs,R=x.lineStartIndex,z=x.lineStartIndex+x.lineLength,G=t.getoffsetX(x.glyphStartIndex),V=t.getoffsetX(A-1),$=Ot(y*G,a,u,d,x.segment,R,z,S,w);if(!$)return null;const ee=Ot(y*V,a,u,d,x.segment,R,z,S,w);return ee?S.projectionCache.anyProjectionOccluded?null:{first:$,last:ee}:null}function Sa(y,t,a,u){return y===o.az.horizontal&&Math.abs(a.y-t.y)>Math.abs(a.x-t.x)*u?{useVertical:!0}:(y===o.az.vertical?t.y<a.y:t.x>a.x)?{needsFlipping:!0}:null}function se(y){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:a,symbol:u,fontSize:d,flip:x,keepUpright:w,glyphOffsetArray:S,dynamicLayoutVertexArray:A,aspectRatio:R,rotateToLine:z}=y,G=d/24,V=u.lineOffsetX*G,$=u.lineOffsetY*G;let ee;if(u.numGlyphs>1){const ce=u.glyphStartIndex+u.numGlyphs,he=u.lineStartIndex,ue=u.lineStartIndex+u.lineLength,ye=Xs(G,S,V,$,x,u,z,t);if(!ye)return{notEnoughRoom:!0};const Ae=qe(ye.first.point.x,ye.first.point.y,t,a),_e=qe(ye.last.point.x,ye.last.point.y,t,a);if(w&&!x){const Ee=Sa(u.writingMode,Ae,_e,R);if(Ee)return Ee}ee=[ye.first];for(let Ee=u.glyphStartIndex+1;Ee<ce-1;Ee++){const Pe=Ot(G*S.getoffsetX(Ee),V,$,x,u.segment,he,ue,t,z);if(!Pe)return{notEnoughRoom:!0};ee.push(Pe)}ee.push(ye.last)}else{if(w&&!x){const he=Ge(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,ue=u.lineStartIndex+u.segment+1,ye=new o.P(t.lineVertexArray.getx(ue),t.lineVertexArray.gety(ue)),Ae=Ge(ye.x,ye.y,t),_e=Ae.signedDistanceFromCamera>0?Ae.point:Ue(t.tileAnchorPoint,ye,he,1,t),Ee=qe(he.x,he.y,t,a),Pe=qe(_e.x,_e.y,t,a),we=Sa(u.writingMode,Ee,Pe,R);if(we)return we}const ce=Ot(G*S.getoffsetX(u.glyphStartIndex),V,$,x,u.segment,u.lineStartIndex,u.lineStartIndex+u.lineLength,t,z);if(!ce||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};ee=[ce]}for(const ce of ee)o.aG(A,ce.point,ce.angle);return{}}function Ue(y,t,a,u,d){const x=y.add(y.sub(t)._unit()),w=Ge(x.x,x.y,d).point,S=a.sub(w);return a.add(S._mult(u/S.mag()))}function Ke(y,t,a){const u=t.projectionCache;if(u.projections[y])return u.projections[y];const d=new o.P(t.lineVertexArray.getx(y),t.lineVertexArray.gety(y)),x=Ge(d.x,d.y,t);if(x.signedDistanceFromCamera>0)return u.projections[y]=x.point,u.anyProjectionOccluded=u.anyProjectionOccluded||x.isOccluded,x.point;const w=y-a.direction;return Ue(a.distanceFromAnchor===0?t.tileAnchorPoint:new o.P(t.lineVertexArray.getx(w),t.lineVertexArray.gety(w)),d,a.previousVertex,a.absOffsetX-a.distanceFromAnchor+1,t)}function Ge(y,t,a){const u=y+a.translation[0],d=t+a.translation[1];let x;return a.pitchWithMap?(x=li(u,d,a.pitchedLabelPlaneMatrix,a.getElevation),x.isOccluded=!1):(x=a.transform.projectTileCoordinates(u,d,a.unwrappedTileID,a.getElevation),x.point.x=(.5*x.point.x+.5)*a.width,x.point.y=(.5*-x.point.y+.5)*a.height),x}function qe(y,t,a,u){if(a.pitchWithMap){const d=[y,t,0,1];return o.aH(d,d,u),a.transform.projectTileCoordinates(d[0]/d[3],d[1]/d[3],a.unwrappedTileID,a.getElevation).point}return{x:y/a.width*2-1,y:1-t/a.height*2}}function Pt(y,t,a){return a.transform.projectTileCoordinates(y,t,a.unwrappedTileID,a.getElevation)}function kt(y,t,a){return y._unit()._perp()._mult(t*a)}function Lt(y,t,a,u,d,x,w,S,A){if(S.projectionCache.offsets[y])return S.projectionCache.offsets[y];const R=a.add(t);if(y+A.direction<u||y+A.direction>=d)return S.projectionCache.offsets[y]=R,R;const z=Ke(y+A.direction,S,A),G=kt(z.sub(a),w,A.direction),V=a.add(G),$=z.add(G);return S.projectionCache.offsets[y]=o.aI(x,R,V,$)||R,S.projectionCache.offsets[y]}function Ot(y,t,a,u,d,x,w,S,A){const R=u?y-t:y+t;let z=R>0?1:-1,G=0;u&&(z*=-1,G=Math.PI),z<0&&(G+=Math.PI);let V,$=z>0?x+d:x+d+1;S.projectionCache.cachedAnchorPoint?V=S.projectionCache.cachedAnchorPoint:(V=Ge(S.tileAnchorPoint.x,S.tileAnchorPoint.y,S).point,S.projectionCache.cachedAnchorPoint=V);let ee,ce,he=V,ue=V,ye=0,Ae=0;const _e=Math.abs(R),Ee=[];let Pe;for(;ye+Ae<=_e;){if($+=z,$<x||$>=w)return null;ye+=Ae,ue=he,ce=ee;const Ye={absOffsetX:_e,direction:z,distanceFromAnchor:ye,previousVertex:ue};if(he=Ke($,S,Ye),a===0)Ee.push(ue),Pe=he.sub(ue);else{let je;const Xe=he.sub(ue);je=Xe.mag()===0?kt(Ke($+z,S,Ye).sub(he),a,z):kt(Xe,a,z),ce||(ce=ue.add(je)),ee=Lt($,je,he,x,w,ce,a,S,Ye),Ee.push(ce),Pe=ee.sub(ce)}Ae=Pe.mag()}const we=Pe._mult((_e-ye)/Ae)._add(ce||ue),Be=G+Math.atan2(he.y-ue.y,he.x-ue.x);return Ee.push(we),{point:we,angle:A?Be:0,path:Ee}}const Xt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Jt(y,t){for(let a=0;a<y;a++){const u=t.length;t.resize(u+4),t.float32.set(Xt,3*u)}}function Kt(y,t,a){const u=t[0],d=t[1];return y[0]=a[0]*u+a[4]*d+a[12],y[1]=a[1]*u+a[5]*d+a[13],y[3]=a[3]*u+a[7]*d+a[15],y}const Wt=100;class Ui{constructor(t,a=new si(t.width+200,t.height+200,25),u=new si(t.width+200,t.height+200,25)){this.transform=t,this.grid=a,this.ignoredGrid=u,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Wt,this.screenBottomBoundary=t.height+Wt,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,a,u,d,x,w,S,A,R,z,G,V){const $=this.projectAndGetPerspectiveRatio(t.anchorPointX+A[0],t.anchorPointY+A[1],x,z,V),ee=u*$.perspectiveRatio;let ce;if(w||S)ce=this._projectCollisionBox(t,ee,d,x,w,S,A,$,z,G,V);else{const Pe=$.x+(G?G.x*ee:0),we=$.y+(G?G.y*ee:0);ce={allPointsOccluded:!1,box:[Pe+t.x1*ee,we+t.y1*ee,Pe+t.x2*ee,we+t.y2*ee]}}const[he,ue,ye,Ae]=ce.box,_e=w?ce.allPointsOccluded:$.isOccluded;let Ee=_e;return Ee||(Ee=$.perspectiveRatio<this.perspectiveRatioCutoff),Ee||(Ee=!this.isInsideGrid(he,ue,ye,Ae)),Ee||a!=="always"&&this.grid.hitTest(he,ue,ye,Ae,a,R)?{box:[he,ue,ye,Ae],placeable:!1,offscreen:!1,occluded:_e}:{box:[he,ue,ye,Ae],placeable:!0,offscreen:this.isOffscreen(he,ue,ye,Ae),occluded:_e}}placeCollisionCircles(t,a,u,d,x,w,S,A,R,z,G,V,$,ee){const ce=[],he=new o.P(a.anchorX,a.anchorY),ue=this.getPerspectiveRatio(he.x,he.y,w,ee),ye=(R?x*this.transform.getPitchedTextCorrection(a.anchorX,a.anchorY,w)/ue:x*ue)/o.aM,Ae={getElevation:ee,pitchedLabelPlaneMatrix:S,lineVertexArray:u,pitchWithMap:R,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:he,unwrappedTileID:w,width:this.transform.width,height:this.transform.height,translation:$},_e=Xs(ye,d,a.lineOffsetX*ye,a.lineOffsetY*ye,!1,a,!1,Ae);let Ee=!1,Pe=!1,we=!0;if(_e){const Be=.5*G*ue+V,Ye=new o.P(-100,-100),je=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Xe=new Tt,Ze=_e.first,bt=_e.last;let wt=[];for(let ai=Ze.path.length-1;ai>=1;ai--)wt.push(Ze.path[ai]);for(let ai=1;ai<bt.path.length;ai++)wt.push(bt.path[ai]);const dt=2.5*Be;if(R){const ai=this.projectPathToScreenSpace(wt,Ae);wt=ai.some((Vi=>Vi.signedDistanceFromCamera<=0))?[]:ai.map((Vi=>Vi.point))}let Mt=[];if(wt.length>0){const ai=wt[0].clone(),Vi=wt[0].clone();for(let sn=1;sn<wt.length;sn++)ai.x=Math.min(ai.x,wt[sn].x),ai.y=Math.min(ai.y,wt[sn].y),Vi.x=Math.max(Vi.x,wt[sn].x),Vi.y=Math.max(Vi.y,wt[sn].y);Mt=ai.x>=Ye.x&&Vi.x<=je.x&&ai.y>=Ye.y&&Vi.y<=je.y?[wt]:Vi.x<Ye.x||ai.x>je.x||Vi.y<Ye.y||ai.y>je.y?[]:o.aJ([wt],Ye.x,Ye.y,je.x,je.y)}for(const ai of Mt){Xe.reset(ai,.25*Be);let Vi=0;Vi=Xe.length<=.5*Be?1:Math.ceil(Xe.paddedLength/dt)+1;for(let sn=0;sn<Vi;sn++){const $i=sn/Math.max(Vi-1,1),un=Xe.lerp($i),Yi=un.x+Wt,yn=un.y+Wt;ce.push(Yi,yn,Be,0);const hn=Yi-Be,jn=yn-Be,In=Yi+Be,En=yn+Be;if(we=we&&this.isOffscreen(hn,jn,In,En),Pe=Pe||this.isInsideGrid(hn,jn,In,En),t!=="always"&&this.grid.hitTestCircle(Yi,yn,Be,t,z)&&(Ee=!0,!A))return{circles:[],offscreen:!1,collisionDetected:Ee}}}}return{circles:!A&&Ee||!Pe||ue<this.perspectiveRatioCutoff?[]:ce,offscreen:we,collisionDetected:Ee}}projectPathToScreenSpace(t,a){const u=(function(d,x){const w=o.N();return o.aB(w,x.pitchedLabelPlaneMatrix),d.map((S=>{const A=li(S.x,S.y,w,x.getElevation),R=x.transform.projectTileCoordinates(A.point.x,A.point.y,x.unwrappedTileID,x.getElevation);return R.point.x=(.5*R.point.x+.5)*x.width,R.point.y=(.5*-R.point.y+.5)*x.height,R}))})(t,a);return(function(d){let x=0,w=0,S=0,A=0;for(let R=0;R<d.length;R++)d[R].isOccluded?(S=R+1,A=0):(A++,A>w&&(w=A,x=S));return d.slice(x,x+w)})(u)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[],u=new o.aa;for(const G of t){const V=new o.P(G.x+Wt,G.y+Wt);u.extend(V),a.push(V)}const{minX:d,minY:x,maxX:w,maxY:S}=u,A=this.grid.query(d,x,w,S).concat(this.ignoredGrid.query(d,x,w,S)),R={},z={};for(const G of A){const V=G.key;if(R[V.bucketInstanceId]===void 0&&(R[V.bucketInstanceId]={}),R[V.bucketInstanceId][V.featureIndex])continue;const $=[new o.P(G.x1,G.y1),new o.P(G.x2,G.y1),new o.P(G.x2,G.y2),new o.P(G.x1,G.y2)];o.aK(a,$)&&(R[V.bucketInstanceId][V.featureIndex]=!0,z[V.bucketInstanceId]===void 0&&(z[V.bucketInstanceId]=[]),z[V.bucketInstanceId].push(V.featureIndex))}return z}insertCollisionBox(t,a,u,d,x,w){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:x,collisionGroupID:w,overlapMode:a},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,u,d,x,w){const S=u?this.ignoredGrid:this.grid,A={bucketInstanceId:d,featureIndex:x,collisionGroupID:w,overlapMode:a};for(let R=0;R<t.length;R+=4)S.insertCircle(A,t[R],t[R+1],t[R+2])}projectAndGetPerspectiveRatio(t,a,u,d,x){if(x){let w;d?(w=[t,a,d(t,a),1],o.aH(w,w,x)):(w=[t,a,0,1],Kt(w,w,x));const S=w[3];return{x:(w[0]/S+1)/2*this.transform.width+Wt,y:(-w[1]/S+1)/2*this.transform.height+Wt,perspectiveRatio:.5+this.transform.cameraToCenterDistance/S*.5,isOccluded:!1,signedDistanceFromCamera:S}}{const w=this.transform.projectTileCoordinates(t,a,u,d);return{x:(w.point.x+1)/2*this.transform.width+Wt,y:(1-w.point.y)/2*this.transform.height+Wt,perspectiveRatio:.5+this.transform.cameraToCenterDistance/w.signedDistanceFromCamera*.5,isOccluded:w.isOccluded,signedDistanceFromCamera:w.signedDistanceFromCamera}}}getPerspectiveRatio(t,a,u,d){const x=this.transform.projectTileCoordinates(t,a,u,d);return .5+this.transform.cameraToCenterDistance/x.signedDistanceFromCamera*.5}isOffscreen(t,a,u,d){return u<Wt||t>=this.screenRightBoundary||d<Wt||a>this.screenBottomBoundary}isInsideGrid(t,a,u,d){return u>=0&&t<this.gridRightBoundary&&d>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=o.ar([]);return o.O(t,t,[-100,-100,0]),t}_projectCollisionBox(t,a,u,d,x,w,S,A,R,z,G){let V=1,$=0,ee=0,ce=1;const he=t.anchorPointX+S[0],ue=t.anchorPointY+S[1];if(w&&!x){const wt=this.projectAndGetPerspectiveRatio(he+1,ue,d,R,G),dt=wt.x-A.x,Mt=Math.atan((wt.y-A.y)/dt)+(dt<0?Math.PI:0),ai=Math.sin(Mt),Vi=Math.cos(Mt);V=Vi,$=ai,ee=-ai,ce=Vi}else if(!w&&x){const wt=Hr(this.transform);V=wt.vecEast[0],$=wt.vecEast[1],ee=wt.vecSouth[0],ce=wt.vecSouth[1]}let ye=A.x,Ae=A.y,_e=a;x&&(ye=he,Ae=ue,_e=Math.pow(2,-(this.transform.zoom-u.overscaledZ)),_e*=this.transform.getPitchedTextCorrection(he,ue,d),z||(_e*=o.an(.5+A.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),z&&(ye+=V*z.x*_e+ee*z.y*_e,Ae+=$*z.x*_e+ce*z.y*_e);const Ee=t.x1*_e,Pe=t.x2*_e,we=(Ee+Pe)/2,Be=t.y1*_e,Ye=t.y2*_e,je=(Be+Ye)/2,Xe=[{offsetX:Ee,offsetY:Be},{offsetX:we,offsetY:Be},{offsetX:Pe,offsetY:Be},{offsetX:Pe,offsetY:je},{offsetX:Pe,offsetY:Ye},{offsetX:we,offsetY:Ye},{offsetX:Ee,offsetY:Ye},{offsetX:Ee,offsetY:je}];let Ze=[];for(const{offsetX:wt,offsetY:dt}of Xe)Ze.push(new o.P(ye+V*wt+ee*dt,Ae+$*wt+ce*dt));let bt=!1;if(x){const wt=Ze.map((dt=>this.projectAndGetPerspectiveRatio(dt.x,dt.y,d,R,G)));bt=wt.some((dt=>!dt.isOccluded)),Ze=wt.map((dt=>new o.P(dt.x,dt.y)))}else bt=!0;return{box:o.aL(Ze),allPointsOccluded:!bt}}}class ln{constructor(t,a,u,d){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):d&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class Wi{constructor(t,a,u,d,x){this.text=new ln(t?t.text:null,a,u,x),this.icon=new ln(t?t.icon:null,a,d,x)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Gi{constructor(t,a,u){this.text=t,this.icon=a,this.skipFade=u}}class Qt{constructor(t,a,u,d,x){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=u,this.bucketIndex=d,this.tileID=x}}class ki{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:u=>u.collisionGroupID===a}}return this.collisionGroups[t]}}function Ei(y,t,a,u,d){const{horizontalAlign:x,verticalAlign:w}=o.aS(y);return new o.P(-(x-.5)*t+u[0]*d,-(w-.5)*a+u[1]*d)}class Yn{constructor(t,a,u,d,x){this.transform=t.clone(),this.terrain=a,this.collisionIndex=new Ui(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new ki(d),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const a=this.terrain;return a?(u,d)=>a.getElevation(t,u,d):null}getBucketParts(t,a,u,d){const x=u.getBucket(a),w=u.latestFeatureIndex;if(!x||!w||a.id!==x.layerIds[0])return;const S=u.collisionBoxArray,A=x.layers[0].layout,R=x.layers[0].paint,z=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),G=u.tileSize/o.a5,V=u.tileID.toUnwrapped(),$=A.get("text-rotation-alignment")==="map",ee=o.aN(u,1,this.transform.zoom),ce=o.aO(this.collisionIndex.transform,u,R.get("text-translate"),R.get("text-translate-anchor")),he=o.aO(this.collisionIndex.transform,u,R.get("icon-translate"),R.get("icon-translate-anchor")),ue=Vn($,this.transform,ee);this.retainedQueryData[x.bucketInstanceId]=new Qt(x.bucketInstanceId,w,x.sourceLayerIndex,x.index,u.tileID);const ye={bucket:x,layout:A,translationText:ce,translationIcon:he,unwrappedTileID:V,pitchedLabelPlaneMatrix:ue,scale:z,textPixelRatio:G,holdingForFade:u.holdingForSymbolFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:o.ay(x.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(d)for(const Ae of x.sortKeyRanges){const{sortKey:_e,symbolInstanceStart:Ee,symbolInstanceEnd:Pe}=Ae;t.push({sortKey:_e,symbolInstanceStart:Ee,symbolInstanceEnd:Pe,parameters:ye})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:ye})}attemptAnchorPlacement(t,a,u,d,x,w,S,A,R,z,G,V,$,ee,ce,he,ue,ye,Ae,_e){const Ee=o.aP[t.textAnchor],Pe=[t.textOffset0,t.textOffset1],we=Ei(Ee,u,d,Pe,x),Be=this.collisionIndex.placeCollisionBox(a,V,A,R,z,S,w,he,G.predicate,Ae,we,_e);if((!ye||this.collisionIndex.placeCollisionBox(ye,V,A,R,z,S,w,ue,G.predicate,Ae,we,_e).placeable)&&Be.placeable){let Ye;if(this.prevPlacement&&this.prevPlacement.variableOffsets[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID].text&&(Ye=this.prevPlacement.variableOffsets[$.crossTileID].anchor),$.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[$.crossTileID]={textOffset:Pe,width:u,height:d,anchor:Ee,textBoxScale:x,prevAnchor:Ye},this.markUsedJustification(ee,Ee,$,ce),ee.allowVerticalPlacement&&(this.markUsedOrientation(ee,ce,$),this.placedOrientations[$.crossTileID]=ce),{shift:we,placedGlyphBoxes:Be}}}placeLayerBucketPart(t,a,u){const{bucket:d,layout:x,translationText:w,translationIcon:S,unwrappedTileID:A,pitchedLabelPlaneMatrix:R,textPixelRatio:z,holdingForFade:G,collisionBoxArray:V,partiallyEvaluatedTextSize:$,collisionGroup:ee}=t.parameters,ce=x.get("text-optional"),he=x.get("icon-optional"),ue=o.aQ(x,"text-overlap","text-allow-overlap"),ye=ue==="always",Ae=o.aQ(x,"icon-overlap","icon-allow-overlap"),_e=Ae==="always",Ee=x.get("text-rotation-alignment")==="map",Pe=x.get("text-pitch-alignment")==="map",we=x.get("icon-text-fit")!=="none",Be=x.get("symbol-z-order")==="viewport-y",Ye=ye&&(_e||!d.hasIconData()||he),je=_e&&(ye||!d.hasTextData()||ce);!d.collisionArrays&&V&&d.deserializeCollisionBoxes(V);const Xe=this.retainedQueryData[d.bucketInstanceId].tileID,Ze=this._getTerrainElevationFunc(Xe),bt=this.transform.getFastPathSimpleProjectionMatrix(Xe),wt=(dt,Mt,ai)=>{var Vi,sn;if(a[dt.crossTileID])return;if(G)return void(this.placements[dt.crossTileID]=new Gi(!1,!1,!1));let $i=!1,un=!1,Yi=!0,yn=null,hn={box:null,placeable:!1,offscreen:null,occluded:!1},jn={placeable:!1},In=null,En=null,Qn=null,na=0,Ls=0,vs=0;Mt.textFeatureIndex?na=Mt.textFeatureIndex:dt.useRuntimeCollisionCircles&&(na=dt.featureIndex),Mt.verticalTextFeatureIndex&&(Ls=Mt.verticalTextFeatureIndex);const Ar=Mt.textBox;if(Ar){const Zr=Qi=>{let Ki=o.az.horizontal;if(d.allowVerticalPlacement&&!Qi&&this.prevPlacement){const Bn=this.prevPlacement.placedOrientations[dt.crossTileID];Bn&&(this.placedOrientations[dt.crossTileID]=Bn,Ki=Bn,this.markUsedOrientation(d,Ki,dt))}return Ki},bs=(Qi,Ki)=>{if(d.allowVerticalPlacement&&dt.numVerticalGlyphVertices>0&&Mt.verticalTextBox){for(const Bn of d.writingModes)if(Bn===o.az.vertical?(hn=Ki(),jn=hn):hn=Qi(),hn&&hn.placeable)break}else hn=Qi()},ls=dt.textAnchorOffsetStartIndex,cs=dt.textAnchorOffsetEndIndex;if(cs===ls){const Qi=(Ki,Bn)=>{const kn=this.collisionIndex.placeCollisionBox(Ki,ue,z,Xe,A,Pe,Ee,w,ee.predicate,Ze,void 0,bt);return kn&&kn.placeable&&(this.markUsedOrientation(d,Bn,dt),this.placedOrientations[dt.crossTileID]=Bn),kn};bs((()=>Qi(Ar,o.az.horizontal)),(()=>{const Ki=Mt.verticalTextBox;return d.allowVerticalPlacement&&dt.numVerticalGlyphVertices>0&&Ki?Qi(Ki,o.az.vertical):{box:null,offscreen:null}})),Zr(hn&&hn.placeable)}else{let Qi=o.aP[(sn=(Vi=this.prevPlacement)===null||Vi===void 0?void 0:Vi.variableOffsets[dt.crossTileID])===null||sn===void 0?void 0:sn.anchor];const Ki=(kn,af,of)=>{const Ha=kn.x2-kn.x1,Jp=kn.y2-kn.y1,lf=dt.textBoxScale,yh=we&&Ae==="never"?af:null;let ra=null,sa=ue==="never"?1:2,aa="never";Qi&&sa++;for(let xh=0;xh<sa;xh++){for(let vh=ls;vh<cs;vh++){const Ic=d.textAnchorOffsets.get(vh);if(Qi&&Ic.textAnchor!==Qi)continue;const Rc=this.attemptAnchorPlacement(Ic,kn,Ha,Jp,lf,Ee,Pe,z,Xe,A,ee,aa,dt,d,of,w,S,yh,Ze);if(Rc&&(ra=Rc.placedGlyphBoxes,ra&&ra.placeable))return $i=!0,yn=Rc.shift,ra}Qi?Qi=null:aa=ue}return u&&!ra&&(ra={box:this.collisionIndex.placeCollisionBox(Ar,"always",z,Xe,A,Pe,Ee,w,ee.predicate,Ze,void 0,bt).box,offscreen:!1,placeable:!1,occluded:!1}),ra};bs((()=>Ki(Ar,Mt.iconBox,o.az.horizontal)),(()=>{const kn=Mt.verticalTextBox;return d.allowVerticalPlacement&&(!hn||!hn.placeable)&&dt.numVerticalGlyphVertices>0&&kn?Ki(kn,Mt.verticalIconBox,o.az.vertical):{box:null,occluded:!0,offscreen:null}})),hn&&($i=hn.placeable,Yi=hn.offscreen);const Bn=Zr(hn&&hn.placeable);if(!$i&&this.prevPlacement){const kn=this.prevPlacement.variableOffsets[dt.crossTileID];kn&&(this.variableOffsets[dt.crossTileID]=kn,this.markUsedJustification(d,kn.anchor,dt,Bn))}}}if(In=hn,$i=In&&In.placeable,Yi=In&&In.offscreen,dt.useRuntimeCollisionCircles&&dt.centerJustifiedTextSymbolIndex>=0){const Zr=d.text.placedSymbolArray.get(dt.centerJustifiedTextSymbolIndex),bs=o.aA(d.textSizeData,$,Zr),ls=x.get("text-padding");En=this.collisionIndex.placeCollisionCircles(ue,Zr,d.lineVertexArray,d.glyphOffsetArray,bs,A,R,u,Pe,ee.predicate,dt.collisionCircleDiameter,ls,w,Ze),En.circles.length&&En.collisionDetected&&!u&&o.w("Collisions detected, but collision boxes are not shown"),$i=ye||En.circles.length>0&&!En.collisionDetected,Yi=Yi&&En.offscreen}if(Mt.iconFeatureIndex&&(vs=Mt.iconFeatureIndex),Mt.iconBox){const Zr=bs=>this.collisionIndex.placeCollisionBox(bs,Ae,z,Xe,A,Pe,Ee,S,ee.predicate,Ze,we&&yn?yn:void 0,bt);jn&&jn.placeable&&Mt.verticalIconBox?(Qn=Zr(Mt.verticalIconBox),un=Qn.placeable):(Qn=Zr(Mt.iconBox),un=Qn.placeable),Yi=Yi&&Qn.offscreen}const Va=ce||dt.numHorizontalGlyphVertices===0&&dt.numVerticalGlyphVertices===0,Al=he||dt.numIconVertices===0;Va||Al?Al?Va||(un=un&&$i):$i=un&&$i:un=$i=un&&$i;const Ga=un&&Qn.placeable;if($i&&In.placeable&&this.collisionIndex.insertCollisionBox(In.box,ue,x.get("text-ignore-placement"),d.bucketInstanceId,jn&&jn.placeable&&Ls?Ls:na,ee.ID),Ga&&this.collisionIndex.insertCollisionBox(Qn.box,Ae,x.get("icon-ignore-placement"),d.bucketInstanceId,vs,ee.ID),En&&$i&&this.collisionIndex.insertCollisionCircles(En.circles,ue,x.get("text-ignore-placement"),d.bucketInstanceId,na,ee.ID),u&&this.storeCollisionData(d.bucketInstanceId,ai,Mt,In,Qn,En),dt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(d.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[dt.crossTileID]=new Gi(($i||Ye)&&!In?.occluded,(un||je)&&!Qn?.occluded,Yi||d.justReloaded),a[dt.crossTileID]=!0};if(Be){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const dt=d.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Mt=dt.length-1;Mt>=0;--Mt){const ai=dt[Mt];wt(d.symbolInstances.get(ai),d.collisionArrays[ai],ai)}}else for(let dt=t.symbolInstanceStart;dt<t.symbolInstanceEnd;dt++)wt(d.symbolInstances.get(dt),d.collisionArrays[dt],dt);d.justReloaded=!1}storeCollisionData(t,a,u,d,x,w){if(u.textBox||u.iconBox){let S,A;this.collisionBoxArrays.has(t)?S=this.collisionBoxArrays.get(t):(S=new Map,this.collisionBoxArrays.set(t,S)),S.has(a)?A=S.get(a):(A={text:null,icon:null},S.set(a,A)),u.textBox&&(A.text=d.box),u.iconBox&&(A.icon=x.box)}if(w){let S=this.collisionCircleArrays[t];S===void 0&&(S=this.collisionCircleArrays[t]=[]);for(let A=0;A<w.circles.length;A+=4)S.push(w.circles[A+0]-Wt),S.push(w.circles[A+1]-Wt),S.push(w.circles[A+2]),S.push(w.collisionDetected?1:0)}}markUsedJustification(t,a,u,d){let x;x=d===o.az.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[o.aR(a)];const w=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const S of w)S>=0&&(t.text.placedSymbolArray.get(S).crossTileID=x>=0&&S!==x?0:u.crossTileID)}markUsedOrientation(t,a,u){const d=a===o.az.horizontal||a===o.az.horizontalOnly?a:0,x=a===o.az.vertical?a:0,w=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(const S of w)t.text.placedSymbolArray.get(S).placedOrientation=d;u.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=x)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let u=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const d=a?a.symbolFadeChange(t):1,x=a?a.opacities:{},w=a?a.variableOffsets:{},S=a?a.placedOrientations:{};for(const A in this.placements){const R=this.placements[A],z=x[A];z?(this.opacities[A]=new Wi(z,d,R.text,R.icon),u=u||R.text!==z.text.placed||R.icon!==z.icon.placed):(this.opacities[A]=new Wi(null,d,R.text,R.icon,R.skipFade),u=u||R.text||R.icon)}for(const A in x){const R=x[A];if(!this.opacities[A]){const z=new Wi(R,d,!1,!1);z.isHidden()||(this.opacities[A]=z,u=u||R.text.placed||R.icon.placed)}}for(const A in w)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=w[A]);for(const A in S)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=S[A]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");u?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a){const u={};for(const d of a){const x=d.getBucket(t);x&&d.latestFeatureIndex&&t.id===x.layerIds[0]&&this.updateBucketOpacities(x,d.tileID,u,d.collisionBoxArray)}}updateBucketOpacities(t,a,u,d){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const x=t.layers[0],w=x.layout,S=new Wi(null,0,!1,!1,!0),A=w.get("text-allow-overlap"),R=w.get("icon-allow-overlap"),z=x._unevaluatedLayout.hasValue("text-variable-anchor")||x._unevaluatedLayout.hasValue("text-variable-anchor-offset"),G=w.get("text-rotation-alignment")==="map",V=w.get("text-pitch-alignment")==="map",$=w.get("icon-text-fit")!=="none",ee=new Wi(null,0,A&&(R||!t.hasIconData()||w.get("icon-optional")),R&&(A||!t.hasTextData()||w.get("text-optional")),!0);!t.collisionArrays&&d&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(d);const ce=(ue,ye,Ae)=>{for(let _e=0;_e<ye/4;_e++)ue.opacityVertexArray.emplaceBack(Ae);ue.hasVisibleVertices=ue.hasVisibleVertices||Ae!==Lr},he=this.collisionBoxArrays.get(t.bucketInstanceId);for(let ue=0;ue<t.symbolInstances.length;ue++){const ye=t.symbolInstances.get(ue),{numHorizontalGlyphVertices:Ae,numVerticalGlyphVertices:_e,crossTileID:Ee}=ye;let Pe=this.opacities[Ee];u[Ee]?Pe=S:Pe||(Pe=ee,this.opacities[Ee]=Pe),u[Ee]=!0;const we=ye.numIconVertices>0,Be=this.placedOrientations[ye.crossTileID],Ye=Be===o.az.vertical,je=Be===o.az.horizontal||Be===o.az.horizontalOnly;if(Ae>0||_e>0){const Ze=Ma(Pe.text);ce(t.text,Ae,Ye?Lr:Ze),ce(t.text,_e,je?Lr:Ze);const bt=Pe.text.isHidden();[ye.rightJustifiedTextSymbolIndex,ye.centerJustifiedTextSymbolIndex,ye.leftJustifiedTextSymbolIndex].forEach((Mt=>{Mt>=0&&(t.text.placedSymbolArray.get(Mt).hidden=bt||Ye?1:0)})),ye.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(ye.verticalPlacedTextSymbolIndex).hidden=bt||je?1:0);const wt=this.variableOffsets[ye.crossTileID];wt&&this.markUsedJustification(t,wt.anchor,ye,Be);const dt=this.placedOrientations[ye.crossTileID];dt&&(this.markUsedJustification(t,"left",ye,dt),this.markUsedOrientation(t,dt,ye))}if(we){const Ze=Ma(Pe.icon),bt=!($&&ye.verticalPlacedIconSymbolIndex&&Ye);ye.placedIconSymbolIndex>=0&&(ce(t.icon,ye.numIconVertices,bt?Ze:Lr),t.icon.placedSymbolArray.get(ye.placedIconSymbolIndex).hidden=Pe.icon.isHidden()),ye.verticalPlacedIconSymbolIndex>=0&&(ce(t.icon,ye.numVerticalIconVertices,bt?Lr:Ze),t.icon.placedSymbolArray.get(ye.verticalPlacedIconSymbolIndex).hidden=Pe.icon.isHidden())}const Xe=he&&he.has(ue)?he.get(ue):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ze=t.collisionArrays[ue];if(Ze){let bt=new o.P(0,0);if(Ze.textBox||Ze.verticalTextBox){let wt=!0;if(z){const dt=this.variableOffsets[Ee];dt?(bt=Ei(dt.anchor,dt.width,dt.height,dt.textOffset,dt.textBoxScale),G&&bt._rotate(V?-this.transform.bearingInRadians:this.transform.bearingInRadians)):wt=!1}if(Ze.textBox||Ze.verticalTextBox){let dt;Ze.textBox&&(dt=Ye),Ze.verticalTextBox&&(dt=je),_s(t.textCollisionBox.collisionVertexArray,Pe.text.placed,!wt||dt,Xe.text,bt.x,bt.y)}}if(Ze.iconBox||Ze.verticalIconBox){const wt=!!(!je&&Ze.verticalIconBox);let dt;Ze.iconBox&&(dt=wt),Ze.verticalIconBox&&(dt=!wt),_s(t.iconCollisionBox.collisionVertexArray,Pe.icon.placed,dt,Xe.icon,$?bt.x:0,$?bt.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const u=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*u>t}setStale(){this.stale=!0}}function _s(y,t,a,u,d,x){u&&u.length!==0||(u=[0,0,0,0]);const w=u[0]-Wt,S=u[1]-Wt,A=u[2]-Wt,R=u[3]-Wt;y.emplaceBack(t?1:0,a?1:0,d||0,x||0,w,S),y.emplaceBack(t?1:0,a?1:0,d||0,x||0,A,S),y.emplaceBack(t?1:0,a?1:0,d||0,x||0,A,R),y.emplaceBack(t?1:0,a?1:0,d||0,x||0,w,R)}const Kn=Math.pow(2,25),Is=Math.pow(2,24),qi=Math.pow(2,17),Fn=Math.pow(2,16),Jn=Math.pow(2,9),Gn=Math.pow(2,8),Pn=Math.pow(2,1);function Ma(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const t=y.placed?1:0,a=Math.floor(127*y.opacity);return a*Kn+t*Is+a*qi+t*Fn+a*Jn+t*Gn+a*Pn+t}const Lr=0;class Zs{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,a,u,d,x){const w=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(w,d,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort(((S,A)=>S.sortKey-A.sortKey)));this._currentPartIndex<w.length;)if(a.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,x())return!0;return!1}}class co{constructor(t,a,u,d,x,w,S,A){this.placement=new Yn(t,a,w,S,A),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(t,a,u){const d=J(),x=()=>!this._forceFullPlacement&&J()-d>2;for(;this._currentPlacementIndex>=0;){const w=a[t[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=S)&&(!w.maxzoom||w.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new Zs(w)),this._inProgressLayer.continuePlacement(u[w.source],this.placement,this._showCollisionBoxes,w,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const mi=512/o.a5/2;class Pu{constructor(t,a,u){this.tileID=t,this.bucketInstanceId=u,this._symbolsByKey={};const d=new Map;for(let x=0;x<a.length;x++){const w=a.get(x),S=w.key,A=d.get(S);A?A.push(w):d.set(S,[w])}for(const[x,w]of d){const S={positions:w.map((A=>({x:Math.floor(A.anchorX*mi),y:Math.floor(A.anchorY*mi)}))),crossTileIDs:w.map((A=>A.crossTileID))};if(S.positions.length>128){const A=new o.aT(S.positions.length,16,Uint16Array);for(const{x:R,y:z}of S.positions)A.add(R,z);A.finish(),delete S.positions,S.index=A}this._symbolsByKey[x]=S}}getScaledCoordinates(t,a){const{x:u,y:d,z:x}=this.tileID.canonical,{x:w,y:S,z:A}=a.canonical,R=mi/Math.pow(2,A-x),z=(S*o.a5+t.anchorY)*R,G=d*o.a5*mi;return{x:Math.floor((w*o.a5+t.anchorX)*R-u*o.a5*mi),y:Math.floor(z-G)}}findMatches(t,a,u){const d=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let x=0;x<t.length;x++){const w=t.get(x);if(w.crossTileID)continue;const S=this._symbolsByKey[w.key];if(!S)continue;const A=this.getScaledCoordinates(w,a);if(S.index){const R=S.index.range(A.x-d,A.y-d,A.x+d,A.y+d).sort();for(const z of R){const G=S.crossTileIDs[z];if(!u[G]){u[G]=!0,w.crossTileID=G;break}}}else if(S.positions)for(let R=0;R<S.positions.length;R++){const z=S.positions[R],G=S.crossTileIDs[R];if(Math.abs(z.x-A.x)<=d&&Math.abs(z.y-A.y)<=d&&!u[G]){u[G]=!0,w.crossTileID=G;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:t})=>t))}}class Cp{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Iu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(a!==0)for(const u in this.indexes){const d=this.indexes[u],x={};for(const w in d){const S=d[w];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+a),x[S.tileID.key]=S}this.indexes[u]=x}this.lng=t}addBucket(t,a,u){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let x=0;x<a.symbolInstances.length;x++)a.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const d=this.usedCrossTileIDs[t.overscaledZ];for(const x in this.indexes){const w=this.indexes[x];if(Number(x)>t.overscaledZ)for(const S in w){const A=w[S];A.tileID.isChildOf(t)&&A.findMatches(a.symbolInstances,t,d)}else{const S=w[t.scaledTo(Number(x)).key];S&&S.findMatches(a.symbolInstances,t,d)}}for(let x=0;x<a.symbolInstances.length;x++){const w=a.symbolInstances.get(x);w.crossTileID||(w.crossTileID=u.generate(),d[w.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Pu(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const u of a.getCrossTileIDsLists())for(const d of u)delete this.usedCrossTileIDs[t][d]}removeStaleBuckets(t){let a=!1;for(const u in this.indexes){const d=this.indexes[u];for(const x in d)t[d[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,d[x]),delete d[x],a=!0)}return a}}class Mr{constructor(){this.layerIndexes={},this.crossTileIDs=new Cp,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,u){let d=this.layerIndexes[t.id];d===void 0&&(d=this.layerIndexes[t.id]=new Iu);let x=!1;const w={};d.handleWrapJump(u);for(const S of a){const A=S.getBucket(t);A&&t.id===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(S.tileID,A,this.crossTileIDs)&&(x=!0),w[A.bucketInstanceId]=!0)}return d.removeStaleBuckets(w)&&(x=!0),x}pruneUnusedLayers(t){const a={};t.forEach((u=>{a[u]=!0}));for(const u in this.layerIndexes)a[u]||delete this.layerIndexes[u]}}var ar="void main() {fragColor=vec4(1.0);}";const pn={prelude:ii(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:ii("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:ii("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:ii(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:ii(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ii(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ii(ar,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:ii(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:ii(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ii("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ii("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:ii(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:ii("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:ii(ar,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:ii(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:ii(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:ii(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:ii(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ii(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ii(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ii(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ii(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:ii(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ii(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ii(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ii(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:ii(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:ii(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:ii(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ii(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ii(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ii("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:ii("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:ii("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:ii("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:ii(`#ifdef GL_ES
precision highp float;
#endif
in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:ii("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function ii(y,t){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=t.match(/in ([\w]+) ([\w]+)/g),d=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=x?x.concat(d):d,S={};return{fragmentSource:y=y.replace(a,((A,R,z,G,V)=>(S[V]=!0,R==="define"?`
#ifndef HAS_UNIFORM_u_${V}
in ${z} ${G} ${V};
#else
uniform ${z} ${G} u_${V};
#endif
`:`
#ifdef HAS_UNIFORM_u_${V}
    ${z} ${G} ${V} = u_${V};
#endif
`))),vertexSource:t=t.replace(a,((A,R,z,G,V)=>{const $=G==="float"?"vec2":"vec4",ee=V.match(/color/)?"color":$;return S[V]?R==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
in ${z} ${$} a_${V};
out ${z} ${G} ${V};
#else
uniform ${z} ${G} u_${V};
#endif
`:ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = a_${V};
#else
    ${z} ${G} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = unpack_mix_${ee}(a_${V}, u_${V}_t);
#else
    ${z} ${G} ${V} = u_${V};
#endif
`:R==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
in ${z} ${$} a_${V};
#else
uniform ${z} ${G} u_${V};
#endif
`:ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${z} ${G} ${V} = a_${V};
#else
    ${z} ${G} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${z} ${G} ${V} = unpack_mix_${ee}(a_${V}, u_${V}_t);
#else
    ${z} ${G} ${V} = u_${V};
#endif
`})),staticAttributes:u,staticUniforms:w}}class Xi{constructor(t,a,u){this.vertexBuffer=t,this.indexBuffer=a,this.segments=u}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var $s=o.aU([{name:"a_pos",type:"Int16",components:2}]);const gr="#define PROJECTION_MERCATOR",Fr="mercator";class _r{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Fr}get shaderDefine(){return gr}get shaderPreludeCode(){return pn.projectionMercator}get vertexShaderPreludeCode(){return pn.projectionMercator.vertexSource}get subdivisionGranularity(){return o.aV.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,a,u,d,x){if(this._cachedMesh)return this._cachedMesh;const w=new o.aW;w.emplaceBack(0,0),w.emplaceBack(o.a5,0),w.emplaceBack(0,o.a5),w.emplaceBack(o.a5,o.a5);const S=t.createVertexBuffer(w,$s.members),A=o.aX.simpleSegment(0,0,4,2),R=new o.aY;R.emplaceBack(1,0,2),R.emplaceBack(1,2,3);const z=t.createIndexBuffer(R);return this._cachedMesh=new Xi(S,z,A),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class uo{constructor(t=0,a=0,u=0,d=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(u)||u<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=u,this.right=d}interpolate(t,a,u){return a.top!=null&&t.top!=null&&(this.top=o.G.number(t.top,a.top,u)),a.bottom!=null&&t.bottom!=null&&(this.bottom=o.G.number(t.bottom,a.bottom,u)),a.left!=null&&t.left!=null&&(this.left=o.G.number(t.left,a.left,u)),a.right!=null&&t.right!=null&&(this.right=o.G.number(t.right,a.right,u)),this}getCenter(t,a){const u=o.an((this.left+t-this.right)/2,0,t),d=o.an((this.top+a-this.bottom)/2,0,a);return new o.P(u,d)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new uo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ys(y,t){if(!y.renderWorldCopies||y.lngRange)return;const a=t.lng-y.center.lng;t.lng+=a>180?-360:a<-180?360:0}function Tn(y){return Math.max(0,Math.floor(y))}class Ea{constructor(t,a){var u;this.applyConstrain=(d,x)=>this._constrainOverride!==null?this._constrainOverride(d,x):this._callbacks.defaultConstrain(d,x),this._callbacks=t,this._tileSize=512,this._renderWorldCopies=a?.renderWorldCopies===void 0||!!a?.renderWorldCopies,this._minZoom=a?.minZoom||0,this._maxZoom=a?.maxZoom||22,this._minPitch=a?.minPitch==null?0:a?.minPitch,this._maxPitch=a?.maxPitch==null?60:a?.maxPitch,this._constrainOverride=(u=a?.constrainOverride)!==null&&u!==void 0?u:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new o.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Tn(this._zoom),this._scale=o.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new uo,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,a,u){this._constrainOverride=t.constrainOverride,this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=Tn(this._zoom),this._scale=o.aq(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new uo(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!u&&t.autoCalculateNearFarZ,a&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get constrainOverride(){return this._constrainOverride}setConstrainOverride(t){t===void 0&&(t=null),this._constrainOverride!==t&&(this._constrainOverride=t,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const a=o.W(t,-180,180)*Math.PI/180;var u,d,x,w,S,A,R,z,G;this._bearingInRadians!==a&&(this._unmodified=!1,this._bearingInRadians=a,this._calcMatrices(),this._rotationMatrix=C(),u=this._rotationMatrix,x=-this._bearingInRadians,w=(d=this._rotationMatrix)[0],S=d[1],A=d[2],R=d[3],z=Math.sin(x),G=Math.cos(x),u[0]=w*G+A*z,u[1]=S*G+R*z,u[2]=w*-z+A*G,u[3]=S*-z+R*G)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const a=o.an(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==a&&(this._unmodified=!1,this._pitchInRadians=a,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const a=t/180*Math.PI;this._rollInRadians!==a&&(this._unmodified=!1,this._rollInRadians=a,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return o.aZ(this._fovInRadians)}setFov(t){t=o.an(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=o.ap(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const a=this.applyConstrain(this._center,t).zoom;this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this._tileZoom=Math.max(0,Math.floor(a)),this._scale=o.aq(a),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,a){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=a,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,u){this._unmodified=!1,this._edgeInsets.interpolate(t,a,u),this.constrainInternal(),this._calcMatrices()}resize(t,a,u=!0){this._width=t,this._height=a,u&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new ui([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-o.ao,o.ao])}getCameraQueryGeometry(t,a){if(a.length===1)return[a[0],t];{const{minX:u,minY:d,maxX:x,maxY:w}=o.aa.fromPoints(a).extend(t);return[new o.P(u,d),new o.P(x,d),new o.P(x,w),new o.P(u,w),new o.P(u,d)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:a,zoom:u}=this.applyConstrain(this.center,this.zoom);this.setCenter(a),this.setZoom(u),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=o.ar(new Float64Array(16));o.Q(t,t,[this._width/2,-this._height/2,1]),o.O(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=o.ar(new Float64Array(16)),o.Q(t,t,[1,-1,1]),o.O(t,t,[-1,-1,0]),o.Q(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,a,u,d){const x=u!==void 0?u:this.bearing,w=d=d!==void 0?d:this.pitch,{distanceToCenter:S,clampedElevation:A}=this._distanceToCenterFromAltElevationPitch(a,this.elevation,w),{x:R,y:z}=Ve(w,x),G=o.a9.fromLngLat(t,a);let V,$,ee=o.a_(1,G.y),ce=0;do{if(ce+=1,ce>10)break;$=S/ee,V=new o.a9(G.x+R*$,G.y+z*$),ee=1/V.meterInMercatorCoordinateUnits()}while(Math.abs(S-$*ee)>1e-12);return{center:V.toLngLat(),elevation:A,zoom:o.at(this.height/2/Math.tan(this.fovInRadians/2)/$/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const a=1/this.worldSize,u=o.as(1,this.center.lat)*this.worldSize,d=o.a9.fromLngLat(this.center,this.elevation),x=d.x/a,w=d.y/a,S=d.z/a,A=this.pitch,R=this.bearing,{x:z,y:G,z:V}=Ve(A,R),$=this.cameraToCenterDistance,ee=x+$*-z,ce=w+$*-G,he=S+$*V,{distanceToCenter:ue,clampedElevation:ye}=this._distanceToCenterFromAltElevationPitch(he/u,t,A),Ae=ue*u,_e=new o.a9((ee+z*Ae)*a,(ce+G*Ae)*a,0).toLngLat(),Ee=o.as(1,_e.lat),Pe=o.at(this.height/2/Math.tan(this.fovInRadians/2)/ue/Ee/this.tileSize);this._elevation=ye,this._center=_e,this.setZoom(Pe)}_distanceToCenterFromAltElevationPitch(t,a,u){const d=-Math.cos(o.ap(u)),x=t-a;let w,S=a;return d*x>=0||Math.abs(d)<.1?(w=1e4,S=t+w*d):w=-x/d,{distanceToCenter:w,clampedElevation:S}}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=o.as(1,this.center.lat)*this.worldSize;return oe(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const a=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/a,t.canonical.y/a,1/a/o.a5,1/a/o.a5]}}class ys{constructor(t,a){this.min=t,this.max=a,this.center=o.a$([],o.b0([],this.min,this.max),.5)}quadrant(t){const a=[t%2==0,t<2],u=o.b1(this.min),d=o.b1(this.max);for(let x=0;x<a.length;x++)u[x]=a[x]?this.min[x]:this.center[x],d[x]=a[x]?this.center[x]:this.max[x];return d[2]=this.max[2],new ys(u,d)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let a=!0;for(let u=0;u<t.planes.length;u++){const d=this.intersectsPlane(t.planes[u]);if(d===0)return 0;d===1&&(a=!1)}return a?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let a=t[3],u=t[3];for(let d=0;d<3;d++)t[d]>0?(a+=t[d]*this.min[d],u+=t[d]*this.max[d]):(u+=t[d]*this.min[d],a+=t[d]*this.max[d]);return a>=0?2:u<0?0:1}}class $l{distanceToTile2d(t,a,u,d){const x=d.distanceX([t,a]),w=d.distanceY([t,a]);return Math.hypot(x,w)}getWrap(t,a,u){return u}getTileBoundingVolume(t,a,u,d){var x,w;let S=0,A=0;if(d?.terrain){const z=new o.a2(t.z,a,t.z,t.x,t.y),G=d.terrain.getMinMaxElevation(z);S=(x=G.minElevation)!==null&&x!==void 0?x:Math.min(0,u),A=(w=G.maxElevation)!==null&&w!==void 0?w:Math.max(0,u)}const R=1<<t.z;return new ys([a+t.x/R,t.y/R,S],[a+(t.x+1)/R,(t.y+1)/R,A])}allowVariableZoom(t,a){const u=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,d=o.an(78.5-u/2,0,60);return!!a.terrain||t.pitch>d}allowWorldCopies(){return!0}prepareNextFrame(){}}class Er{constructor(t,a,u){this.points=t,this.planes=a,this.aabb=u}static fromInvProjectionMatrix(t,a=1,u=0,d,x){const w=x?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],S=Math.pow(2,u),A=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((V=>(function($,ee,ce,he){const ue=o.aH([],$,ee),ye=1/ue[3]/ce*he;return o.b6(ue,ue,[ye,ye,1/ue[3],ye])})(V,t,a,S)));d&&(function(V,$,ee,ce){const he=ce?4:0,ue=ce?0:4;let ye=0;const Ae=[],_e=[];for(let we=0;we<4;we++){const Be=o.b2([],V[we+ue],V[we+he]),Ye=o.b7(Be);o.a$(Be,Be,1/Ye),Ae.push(Ye),_e.push(Be)}for(let we=0;we<4;we++){const Be=o.b8(V[we+he],_e[we],ee);ye=Be!==null&&Be>=0?Math.max(ye,Be):Math.max(ye,Ae[we])}const Ee=(function(we,Be){const Ye=o.b2([],we[Be[0]],we[Be[1]]),je=o.b2([],we[Be[2]],we[Be[1]]),Xe=[0,0,0,0];return o.b3(Xe,o.b4([],Ye,je)),Xe[3]=-o.b5(Xe,we[Be[0]]),Xe})(V,$),Pe=(function(we,Be){const Ye=o.b9(we),je=o.ba([],we,1/Ye),Xe=o.b2([],Be,o.a$([],je,o.b5(Be,je))),Ze=o.b9(Xe);if(Ze>0){const bt=Math.sqrt(1-je[3]*je[3]),wt=o.a$([],je,-je[3]),dt=o.b0([],wt,o.a$([],Xe,bt/Ze));return o.bb(Be,dt)}return null})(ee,Ee);if(Pe!==null){const we=Pe/o.b5(_e[0],Ee);ye=Math.min(ye,we)}for(let we=0;we<4;we++){const Be=Math.min(ye,Ae[we]);V[we+ue]=[V[we+he][0]+_e[we][0]*Be,V[we+he][1]+_e[we][1]*Be,V[we+he][2]+_e[we][2]*Be,1]}})(A,w[0],d,x);const R=w.map((V=>{const $=o.b2([],A[V[0]],A[V[1]]),ee=o.b2([],A[V[2]],A[V[1]]),ce=o.b3([],o.b4([],$,ee)),he=-o.b5(ce,A[V[1]]);return ce.concat(he)})),z=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],G=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const V of A)for(let $=0;$<3;$++)z[$]=Math.min(z[$],V[$]),G[$]=Math.max(G[$],V[$]);return new Er(A,R,new ys(z,G))}}class Aa{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,u){return this._helper.interpolatePadding(t,a,u)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a,u=!0){this._helper.resize(t,a,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,a){}constructor(t){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(a,u)=>{u=o.an(+u,this.minZoom,this.maxZoom);const d={center:new o.V(a.lng,a.lat),zoom:u};let x=this._helper._lngRange;if(!this._helper._renderWorldCopies&&x===null){const _e=179.9999999999;x=[-_e,_e]}const w=this.tileSize*o.aq(d.zoom);let S=0,A=w,R=0,z=w,G=0,V=0;const{x:$,y:ee}=this.size;if(this._helper._latRange){const _e=this._helper._latRange;S=o.X(_e[1])*w,A=o.X(_e[0])*w,A-S<ee&&(G=ee/(A-S))}x&&(R=o.W(o.Y(x[0])*w,0,w),z=o.W(o.Y(x[1])*w,0,w),z<R&&(z+=w),z-R<$&&(V=$/(z-R)));const{x:ce,y:he}=te(w,a);let ue,ye;const Ae=Math.max(V||0,G||0);if(Ae){const _e=new o.P(V?(z+R)/2:ce,G?(A+S)/2:he);return d.center=Ce(w,_e).wrap(),d.zoom+=o.at(Ae),d}if(this._helper._latRange){const _e=ee/2;he-_e<S&&(ye=S+_e),he+_e>A&&(ye=A-_e)}if(x){const _e=(R+z)/2;let Ee=ce;this._helper._renderWorldCopies&&(Ee=o.W(ce,_e-w/2,_e+w/2));const Pe=$/2;Ee-Pe<R&&(ue=R+Pe),Ee+Pe>z&&(ue=z-Pe)}if(ue!==void 0||ye!==void 0){const _e=new o.P(ue??ce,ye??he);d.center=Ce(w,_e).wrap()}return d},this.applyConstrain=(a,u)=>this._helper.applyConstrain(a,u),this._helper=new Ea({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,u)=>this.defaultConstrain(a,u)},t),this._coveringTilesDetailsProvider=new $l}clone(){const t=new Aa;return t.apply(this,!1),t}apply(t,a,u){this._helper.apply(t,a,u)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const a=[new o.bc(0,t)];if(this._helper._renderWorldCopies){const u=this.screenPointToMercatorCoordinate(new o.P(0,0)),d=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,0)),x=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,this._helper._height)),w=this.screenPointToMercatorCoordinate(new o.P(0,this._helper._height)),S=Math.floor(Math.min(u.x,d.x,x.x,w.x)),A=Math.floor(Math.max(u.x,d.x,x.x,w.x)),R=1;for(let z=S-R;z<=A+R;z++)z!==0&&a.push(new o.bc(z,t))}return a}getCameraFrustum(){return Er.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const a=this.screenPointToLocation(this.centerPoint,t),u=t?t.getElevationForLngLatZoom(a,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(u)}setLocationAtPoint(t,a){const u=o.as(this.elevation,this.center.lat),d=this.screenPointToMercatorCoordinateAtZ(a,u),x=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,u),w=o.a9.fromLngLat(t),S=new o.a9(w.x-(d.x-x.x),w.y-(d.y-x.y));this.setCenter(S?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,a){return a?this.coordinatePoint(o.a9.fromLngLat(t),a.getElevationForLngLat(t,this),this._pixelMatrix3D):this.coordinatePoint(o.a9.fromLngLat(t))}screenPointToLocation(t,a){var u;return(u=this.screenPointToMercatorCoordinate(t,a))===null||u===void 0?void 0:u.toLngLat()}screenPointToMercatorCoordinate(t,a){if(a){const u=a.pointCoordinate(t);if(u!=null)return u}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,a){const u=a||0,d=[t.x,t.y,0,1],x=[t.x,t.y,1,1];o.aH(d,d,this._pixelMatrixInverse),o.aH(x,x,this._pixelMatrixInverse);const w=d[3],S=x[3],A=d[1]/w,R=x[1]/S,z=d[2]/w,G=x[2]/S,V=z===G?0:(u-z)/(G-z);return new o.a9(o.G.number(d[0]/w,x[0]/S,V)/this.worldSize,o.G.number(A,R,V)/this.worldSize,u)}coordinatePoint(t,a=0,u=this._pixelMatrix){const d=[t.x*this.worldSize,t.y*this.worldSize,a,1];return o.aH(d,d,u),new o.P(d[0]/d[3],d[1]/d[3])}getBounds(){const t=Math.max(0,this._helper._height/2-Ne(this));return new ui().extend(this.screenPointToLocation(new o.P(0,t))).extend(this.screenPointToLocation(new o.P(this._helper._width,t))).extend(this.screenPointToLocation(new o.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new o.P(0,this._helper._height)))}isPointOnMapSurface(t,a){return a?a.pointCoordinate(t)!=null:t.y>this.height/2-Ne(this)}calculatePosMatrix(t,a=!1,u){var d;const x=(d=t.key)!==null&&d!==void 0?d:o.bd(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),w=a?this._alignedPosMatrixCache:this._posMatrixCache;if(w.has(x)){const R=w.get(x);return u?R.f32:R.f64}const S=ze(t,this.worldSize);o.S(S,a?this._alignedProjMatrix:this._viewProjMatrix,S);const A={f64:S,f32:new Float32Array(S)};return w.set(x,A),u?A.f32:A.f64}calculateFogMatrix(t){const a=t.key,u=this._fogMatrixCacheF32;if(u.has(a))return u.get(a);const d=ze(t,this.worldSize);return o.S(d,this._fogMatrix,d),u.set(a,new Float32Array(d)),u.get(a)}calculateCenterFromCameraLngLatAlt(t,a,u,d){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,u,d)}_calculateNearFarZIfNeeded(t,a,u){if(!this._helper.autoCalculateNearFarZ)return;const d=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),x=t-d*this._helper._pixelPerMeter/Math.cos(a),w=d<0?x:t,S=Math.PI/2+this.pitchInRadians,A=o.ap(this.fov)*(Math.abs(Math.cos(o.ap(this.roll)))*this.height+Math.abs(Math.sin(o.ap(this.roll)))*this.width)/this.height*(.5+u.y/this.height),R=Math.sin(A)*w/Math.sin(o.an(Math.PI-S-A,.01,Math.PI-.01)),z=Ne(this),G=Math.atan(z/this._helper.cameraToCenterDistance),V=o.ap(.75),$=G>V?2*G*(.5+u.y/(2*z)):V,ee=Math.sin($)*w/Math.sin(o.an(Math.PI-S-$,.01,Math.PI-.01)),ce=Math.min(R,ee);this._helper._farZ=1.01*(Math.cos(Math.PI/2-a)*ce+w),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,a=te(this.worldSize,this.center),u=a.x,d=a.y;this._helper._pixelPerMeter=o.as(1,this.center.lat)*this.worldSize;const x=o.ap(Math.min(this.pitch,Fe)),w=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(x));let S;this._calculateNearFarZIfNeeded(w,x,t),S=new Float64Array(16),o.be(S,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),o.aB(this._invProjMatrix,S),S[8]=2*-t.x/this._helper._width,S[9]=2*t.y/this._helper._height,this._projectionMatrix=o.bf(S),o.Q(S,S,[1,-1,1]),o.O(S,S,[0,0,-this._helper.cameraToCenterDistance]),o.bg(S,S,-this.rollInRadians),o.bh(S,S,this.pitchInRadians),o.bg(S,S,-this.bearingInRadians),o.O(S,S,[-u,-d,0]),this._mercatorMatrix=o.Q([],S,[this.worldSize,this.worldSize,this.worldSize]),o.Q(S,S,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=o.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,S),o.O(S,S,[0,0,-this.elevation]),this._viewProjMatrix=S,this._invViewProjMatrix=o.aB([],S);const A=[0,0,-1,1];o.aH(A,A,this._invViewProjMatrix),this._cameraPosition=[A[0]/A[3],A[1]/A[3],A[2]/A[3]],this._fogMatrix=new Float64Array(16),o.be(this._fogMatrix,this.fovInRadians,this.width/this.height,w,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,o.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),o.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),o.bg(this._fogMatrix,this._fogMatrix,-this.rollInRadians),o.bh(this._fogMatrix,this._fogMatrix,this.pitchInRadians),o.bg(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),o.O(this._fogMatrix,this._fogMatrix,[-u,-d,0]),o.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),o.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=o.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,S);const R=this._helper._width%2/2,z=this._helper._height%2/2,G=Math.cos(this.bearingInRadians),V=Math.sin(-this.bearingInRadians),$=u-Math.round(u)+G*R+V*z,ee=d-Math.round(d)+G*z+V*R,ce=new Float64Array(S);if(o.O(ce,ce,[$>.5?$-1:$,ee>.5?ee-1:ee,0]),this._alignedProjMatrix=ce,S=o.aB(new Float64Array(16),this._pixelMatrix),!S)throw new Error("failed to invert matrix");this._pixelMatrixInverse=S,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new o.P(0,0)),a=[t.x*this.worldSize,t.y*this.worldSize,0,1];return o.aH(a,a,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=o.as(1,this.center.lat)*this.worldSize;return oe(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,a){const u=o.a9.fromLngLat(t),d=[u.x*this.worldSize,u.y*this.worldSize,a,1];return o.aH(d,d,this._viewProjMatrix),d[2]/d[3]}getProjectionData(t){const{overscaledTileID:a,aligned:u,applyTerrainMatrix:d}=t,x=this._helper.getMercatorTileCoordinates(a),w=a?this.calculatePosMatrix(a,u,!0):null;let S;return S=a&&a.terrainRttPosMatrix32f&&d?a.terrainRttPosMatrix32f:w||o.bi(),{mainMatrix:S,tileMercatorCoords:x,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:S}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,a,u){return 1}transformLightDirection(t){return o.b1(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,a,u,d){const x=this.calculatePosMatrix(u);let w;d?(w=[t,a,d(t,a),1],o.aH(w,w,x)):(w=[t,a,0,1],Kt(w,w,x));const S=w[3];return{point:new o.P(w[0]/S,w[1]/S),signedDistanceFromCamera:S,isOccluded:!1}}populateCache(t){for(const a of t)this.calculatePosMatrix(a)}getMatrixForModel(t,a){const u=o.a9.fromLngLat(t,a),d=u.meterInMercatorCoordinateUnits(),x=o.bj();return o.O(x,x,[u.x,u.y,u.z]),o.bg(x,x,Math.PI),o.bh(x,x,Math.PI/2),o.Q(x,x,[-d,d,d]),x}getProjectionDataForCustomLayer(t=!0){const a=new o.a2(0,0,0,0,0),u=this.getProjectionData({overscaledTileID:a,applyGlobeMatrix:t}),d=ze(a,this.worldSize);o.S(d,this._viewProjMatrix,d),u.tileMercatorCoords=[0,0,1,1];const x=[o.a5,o.a5,this.worldSize/this._helper.pixelsPerMeter],w=o.bk();return o.Q(w,d,x),u.fallbackMatrix=w,u.mainMatrix=w,u}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function Rs(){o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function dd(y){if(y.useSlerp)if(y.k<1){const t=o.bl(y.startEulerAngles.roll,y.startEulerAngles.pitch,y.startEulerAngles.bearing),a=o.bl(y.endEulerAngles.roll,y.endEulerAngles.pitch,y.endEulerAngles.bearing),u=new Float64Array(4);o.bm(u,t,a,y.k);const d=o.bn(u);y.tr.setRoll(d.roll),y.tr.setPitch(d.pitch),y.tr.setBearing(d.bearing)}else y.tr.setRoll(y.endEulerAngles.roll),y.tr.setPitch(y.endEulerAngles.pitch),y.tr.setBearing(y.endEulerAngles.bearing);else y.tr.setRoll(o.G.number(y.startEulerAngles.roll,y.endEulerAngles.roll,y.k)),y.tr.setPitch(o.G.number(y.startEulerAngles.pitch,y.endEulerAngles.pitch,y.k)),y.tr.setBearing(o.G.number(y.startEulerAngles.bearing,y.endEulerAngles.bearing,y.k))}function Ru(y,t,a,u,d){const x=d.padding,w=te(d.worldSize,a.getNorthWest()),S=te(d.worldSize,a.getNorthEast()),A=te(d.worldSize,a.getSouthEast()),R=te(d.worldSize,a.getSouthWest()),z=o.ap(-u),G=w.rotate(z),V=S.rotate(z),$=A.rotate(z),ee=R.rotate(z),ce=new o.P(Math.max(G.x,V.x,ee.x,$.x),Math.max(G.y,V.y,ee.y,$.y)),he=new o.P(Math.min(G.x,V.x,ee.x,$.x),Math.min(G.y,V.y,ee.y,$.y)),ue=ce.sub(he),ye=(d.width-(x.left+x.right+t.left+t.right))/ue.x,Ae=(d.height-(x.top+x.bottom+t.top+t.bottom))/ue.y;if(Ae<0||ye<0)return void Rs();const _e=Math.min(o.at(d.scale*Math.min(ye,Ae)),y.maxZoom),Ee=o.P.convert(y.offset),Pe=new o.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(o.ap(u)),we=Ee.add(Pe).mult(d.scale/o.aq(_e));return{center:Ce(d.worldSize,w.add(A).div(2).sub(we)),zoom:_e,bearing:u}}class Ca{get useGlobeControls(){return!1}handlePanInertia(t,a){const u=t.mag(),d=Math.abs(Ne(a));return{easingOffset:t.mult(Math.min(.75*d/u,1)),easingCenter:a.center}}handleMapControlsRollPitchBearingZoom(t,a){t.bearingDelta&&a.setBearing(a.bearing+t.bearingDelta),t.pitchDelta&&a.setPitch(a.pitch+t.pitchDelta),t.rollDelta&&a.setRoll(a.roll+t.rollDelta),t.zoomDelta&&a.setZoom(a.zoom+t.zoomDelta)}handleMapControlsPan(t,a,u){t.around.distSqr(a.centerPoint)<.01||a.setLocationAtPoint(u,t.around)}cameraForBoxAndBearing(t,a,u,d,x){return Ru(t,a,u,d,x)}handleJumpToCenterZoom(t,a){t.zoom!==(a.zoom!==void 0?+a.zoom:t.zoom)&&t.setZoom(+a.zoom),a.center!==void 0&&t.setCenter(o.V.convert(a.center))}handleEaseTo(t,a){const u=t.zoom,d=t.padding,x={roll:t.roll,pitch:t.pitch,bearing:t.bearing},w={roll:a.roll===void 0?t.roll:a.roll,pitch:a.pitch===void 0?t.pitch:a.pitch,bearing:a.bearing===void 0?t.bearing:a.bearing},S=a.zoom!==void 0,A=!t.isPaddingEqual(a.padding);let R=!1;const z=S?+a.zoom:t.zoom;let G=t.centerPoint.add(a.offsetAsPoint);const V=t.screenPointToLocation(G),{center:$,zoom:ee}=t.applyConstrain(o.V.convert(a.center||V),z??u);Ys(t,$);const ce=te(t.worldSize,V),he=te(t.worldSize,$).sub(ce),ue=o.aq(ee-u);return R=ee!==u,{easeFunc:ye=>{if(R&&t.setZoom(o.G.number(u,ee,ye)),o.bo(x,w)||dd({startEulerAngles:x,endEulerAngles:w,tr:t,k:ye,useSlerp:x.roll!=w.roll}),A&&(t.interpolatePadding(d,a.padding,ye),G=t.centerPoint.add(a.offsetAsPoint)),a.around)t.setLocationAtPoint(a.around,a.aroundPoint);else{const Ae=o.aq(t.zoom-u),_e=ee>u?Math.min(2,ue):Math.max(.5,ue),Ee=Math.pow(_e,1-ye),Pe=Ce(t.worldSize,ce.add(he.mult(ye*Ee)).mult(Ae));t.setLocationAtPoint(t.renderWorldCopies?Pe.wrap():Pe,G)}},isZooming:R,elevationCenter:$}}handleFlyTo(t,a){const u=a.zoom!==void 0,d=t.zoom,x=t.applyConstrain(o.V.convert(a.center||a.locationAtOffset),u?+a.zoom:d),w=x.center,S=x.zoom;Ys(t,w);const A=te(t.worldSize,a.locationAtOffset),R=te(t.worldSize,w).sub(A),z=R.mag(),G=o.aq(S-d);let V;if(a.minZoom!==void 0){const $=Math.min(+a.minZoom,d,S),ee=t.applyConstrain(w,$).zoom;V=o.aq(ee-d)}return{easeFunc:($,ee,ce,he)=>{t.setZoom($===1?S:d+o.at(ee));const ue=$===1?w:Ce(t.worldSize,A.add(R.mult(ce)).mult(ee));t.setLocationAtPoint(t.renderWorldCopies?ue.wrap():ue,he)},scaleOfZoom:G,targetCenter:w,scaleOfMinZoom:V,pixelPathLength:z}}}class Zi{constructor(t,a,u){this.blendFunction=t,this.blendColor=a,this.mask=u}}Zi.Replace=[1,0],Zi.disabled=new Zi(Zi.Replace,o.bp.transparent,[!1,!1,!1,!1]),Zi.unblended=new Zi(Zi.Replace,o.bp.transparent,[!0,!0,!0,!0]),Zi.alphaBlended=new Zi([1,771],o.bp.transparent,[!0,!0,!0,!0]);const ho=2305;class Ai{constructor(t,a,u){this.enable=t,this.mode=a,this.frontFace=u}}Ai.disabled=new Ai(!1,1029,ho),Ai.backCCW=new Ai(!0,1029,ho),Ai.frontCCW=new Ai(!0,1028,ho);class di{constructor(t,a,u){this.func=t,this.mask=a,this.range=u}}di.ReadOnly=!1,di.ReadWrite=!0,di.disabled=new di(519,di.ReadOnly,[0,1]);const fo=7680;class Pi{constructor(t,a,u,d,x,w){this.test=t,this.ref=a,this.mask=u,this.fail=d,this.depthFail=x,this.pass=w}}Pi.disabled=new Pi({func:519,mask:0},0,0,fo,fo,fo);const Yo=new WeakMap;function jr(y){var t;if(Yo.has(y))return Yo.get(y);{const a=(t=y.getParameter(y.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Yo.set(y,a),a}}class po{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const a=t.context,u=a.gl;this._texFormat=u.RGBA,this._texType=u.UNSIGNED_BYTE;const d=new o.aW;d.emplaceBack(-1,-1),d.emplaceBack(2,-1),d.emplaceBack(-1,2);const x=new o.aY;x.emplaceBack(0,1,2),this._fullscreenTriangle=new Xi(a.createVertexBuffer(d,$s.members),a.createIndexBuffer(x),o.aX.simpleSegment(0,0,d.length,x.length)),this._resultBuffer=new Uint8Array(4),a.activeTexture.set(u.TEXTURE1);const w=u.createTexture();u.bindTexture(u.TEXTURE_2D,w),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.NEAREST),u.texImage2D(u.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=a.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(w),jr(u)&&(this._pbo=u.createBuffer(),u.bindBuffer(u.PIXEL_PACK_BUFFER,this._pbo),u.bufferData(u.PIXEL_PACK_BUFFER,4,u.STREAM_READ),u.bindBuffer(u.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,a){const u=this._updateCount;return this._readbackQueue?u>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():u>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,a),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,a=t.gl;t.activeTexture.set(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,a){const u=this._cachedRenderContext.context,d=u.gl;if(this._bindFramebuffer(),u.viewport.set([0,0,this._texWidth,this._texHeight]),u.clear({color:o.bp.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(u,d.TRIANGLES,di.disabled,Pi.disabled,Zi.unblended,Ai.disabled,((x,w)=>({u_input:x,u_output_expected:w}))(t,a),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&jr(d)){d.bindBuffer(d.PIXEL_PACK_BUFFER,this._pbo),d.readBuffer(d.COLOR_ATTACHMENT0),d.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),d.bindBuffer(d.PIXEL_PACK_BUFFER,null);const x=d.fenceSync(d.SYNC_GPU_COMMANDS_COMPLETE,0);d.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:x}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&jr(t)){const a=t.clientWaitSync(this._readbackQueue.sync,0,0);if(a===t.WAIT_FAILED)return o.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(a===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=po._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let a=0;return a+=t[0]/256,a+=t[1]/65536,a+=t[2]/16777216,t[3]<127&&(a=-a),a/128}}const Ks=o.a5/128;function fd(y,t){const a=y.granularity!==void 0?Math.max(y.granularity,1):1,u=a+(y.generateBorders?2:0),d=a+(y.extendToNorthPole||y.generateBorders?1:0)+(y.extendToSouthPole||y.generateBorders?1:0),x=u+1,w=d+1,S=y.generateBorders?-1:0,A=y.generateBorders||y.extendToNorthPole?-1:0,R=a+(y.generateBorders?1:0),z=a+(y.generateBorders||y.extendToSouthPole?1:0),G=x*w,V=u*d*6,$=x*w>65536;if($&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const ee=$||t==="32bit",ce=new Int16Array(2*G);let he=0;for(let Ae=A;Ae<=z;Ae++)for(let _e=S;_e<=R;_e++){let Ee=_e/a*o.a5;_e===-1&&(Ee=-Ks),_e===a+1&&(Ee=o.a5+Ks);let Pe=Ae/a*o.a5;Ae===-1&&(Pe=y.extendToNorthPole?o.br:-Ks),Ae===a+1&&(Pe=y.extendToSouthPole?o.bs:o.a5+Ks),ce[he++]=Ee,ce[he++]=Pe}const ue=ee?new Uint32Array(V):new Uint16Array(V);let ye=0;for(let Ae=0;Ae<d;Ae++)for(let _e=0;_e<u;_e++){const Ee=_e+1+Ae*x,Pe=_e+(Ae+1)*x,we=_e+1+(Ae+1)*x;ue[ye++]=_e+Ae*x,ue[ye++]=Pe,ue[ye++]=Ee,ue[ye++]=Ee,ue[ye++]=Pe,ue[ye++]=we}return{vertices:ce.buffer.slice(0),indices:ue.buffer.slice(0),uses32bitIndices:ee}}const Ko=new o.aV({fill:new o.bt(128,2),line:new o.bt(512,0),tile:new o.bt(128,32),stencil:new o.bt(128,1),circle:3});class Du{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return pn.projectionGlobe}get vertexShaderPreludeCode(){return pn.projectionMercator.vertexSource}get subdivisionGranularity(){return Ko}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new po(t));const a=o.X(this._errorQueryLatitudeDegrees),u=2*Math.atan(Math.exp(Math.PI-a*Math.PI*2))-.5*Math.PI,d=this._errorMeasurement.updateErrorLoop(a,u),x=J();d!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=d,this._errorMeasurementLastChangeTime=x);const w=Math.min(Math.max((x-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=o.bu(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,o.bv(w))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,a,u,d,x){const w=(x==="stencil"?Ko.stencil:Ko.tile).getGranularityForZoomLevel(a.z);return this._getMesh(t,{granularity:w,generateBorders:u,extendToNorthPole:a.y===0&&d,extendToSouthPole:a.y===(1<<a.z)-1&&d})}_getMesh(t,a){const u=this._getMeshKey(a);if(u in this._tileMeshCache)return this._tileMeshCache[u];const d=(function(x,w){const S=fd(w,"16bit"),A=o.aW.deserialize({arrayBuffer:S.vertices,length:S.vertices.byteLength/2/2}),R=o.aY.deserialize({arrayBuffer:S.indices,length:S.indices.byteLength/2/3});return new Xi(x.createVertexBuffer(A,$s.members),x.createIndexBuffer(R),o.aX.simpleSegment(0,0,A.length,R.length))})(t,a);return this._tileMeshCache[u]=d,d}recalculate(t){}hasTransition(){const t=J();let a=!1;return a=a||(t-this._errorMeasurementLastChangeTime)/1e3<.7,a=a||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,a}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const Pp=new o.t({type:new o.D(o.u.projection.type)});class pd extends o.E{constructor(t){super(),this._transitionable=new o.x(Pp,void 0),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.H(0)),this._mercatorProjection=new _r,this._verticalPerspectiveProjection=new Du}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof o.bw){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,a,u,d,x){return this.currentProjection.getMeshFromTileID(t,a,u,d,x)}setProjection(t){this._transitionable.setValue("type",t?.type||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function yr(y){const t=Pa(y.worldSize,y.center.lat);return 2*Math.PI*t}function xs(y,t,a,u,d){const x=1/(1<<d),w=t/o.a5*x+u*x,S=o.bz((y/o.a5*x+a*x)*Math.PI*2+Math.PI,2*Math.PI),A=2*Math.atan(Math.exp(Math.PI-w*Math.PI*2))-.5*Math.PI,R=Math.cos(A),z=new Float64Array(3);return z[0]=Math.sin(S)*R,z[1]=Math.sin(A),z[2]=Math.cos(S)*R,z}function cn(y){return(function(t,a){const u=Math.cos(a),d=new Float64Array(3);return d[0]=Math.sin(t)*u,d[1]=Math.sin(a),d[2]=Math.cos(t)*u,d})(y.lng*Math.PI/180,y.lat*Math.PI/180)}function Pa(y,t){return y/(2*Math.PI)/Math.cos(t*Math.PI/180)}function Lu(y){const t=Math.asin(y[1])/Math.PI*180,a=Math.sqrt(y[0]*y[0]+y[2]*y[2]);if(a>1e-6){const u=y[0]/a,d=Math.acos(y[2]/a),x=(u>0?d:-d)/Math.PI*180;return new o.V(o.W(x,-180,180),t)}return new o.V(0,t)}function Jo(y){return Math.cos(y*Math.PI/180)}function _n(y,t){const a=Jo(y),u=Jo(t);return o.at(u/a)}function md(y,t){const a=y.rotate(t.bearingInRadians),u=t.zoom+_n(t.center.lat,0),d=o.bu(1/Jo(t.center.lat),1/Jo(Math.min(Math.abs(t.center.lat),60)),o.bx(u,7,3,0,1)),x=360/yr({worldSize:t.worldSize,center:{lat:t.center.lat}});return new o.V(t.center.lng-a.x*x*d,o.an(t.center.lat+a.y*x,-o.ao,o.ao))}function Fu(y){const t=.5*y,a=Math.sin(t),u=Math.cos(t);return Math.log(a+u)-Math.log(u-a)}function gd(y,t,a,u){const d=y.lat+a*u;if(Math.abs(a)>1){const x=(Math.sign(y.lat+a)!==Math.sign(y.lat)?-Math.abs(y.lat):Math.abs(y.lat))*Math.PI/180,w=Math.abs(y.lat+a)*Math.PI/180,S=Fu(x+u*(w-x)),A=Fu(x),R=Fu(w);return new o.V(y.lng+t*((S-A)/(R-A)),d)}return new o.V(y.lng+t*u,d)}class Ip{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,a,u,d){const x=`${t.z}_${t.x}_${t.y}_${d?.terrain?"t":""}`,w=this._cache.get(x);if(w)return w;const S=this._cachePrevious.get(x);if(S)return this._cache.set(x,S),S;const A=this._boundingVolumeFactory(t,a,u,d);return this._cache.set(x,A),this._hadAnyChanges=!0,A}}class mo{constructor(t,a,u,d){this.min=u,this.max=d,this.points=t,this.planes=a}static fromAabb(t,a){const u=[];for(let d=0;d<8;d++)u.push([1&~d?t[0]:a[0],(d>>1&1)==1?a[1]:t[1],(d>>2&1)==1?a[2]:t[2]]);return new mo(u,[[-1,0,0,a[0]],[1,0,0,-t[0]],[0,-1,0,a[1]],[0,1,0,-t[1]],[0,0,-1,a[2]],[0,0,1,-t[2]]],t,a)}static fromCenterSizeAngles(t,a,u){const d=o.bB([],u[0],u[1],u[2]),x=o.bC([],[a[0],0,0],d),w=o.bC([],[0,a[1],0],d),S=o.bC([],[0,0,a[2]],d),A=[...t],R=[...t];for(let G=0;G<8;G++)for(let V=0;V<3;V++){const $=t[V]+x[V]*(1&~G?-1:1)+w[V]*((G>>1&1)==1?1:-1)+S[V]*((G>>2&1)==1?1:-1);A[V]=Math.min(A[V],$),R[V]=Math.max(R[V],$)}const z=[];for(let G=0;G<8;G++){const V=[...t];o.b0(V,V,o.a$([],x,1&~G?-1:1)),o.b0(V,V,o.a$([],w,(G>>1&1)==1?1:-1)),o.b0(V,V,o.a$([],S,(G>>2&1)==1?1:-1)),z.push(V)}return new mo(z,[[...x,-o.b5(x,z[0])],[...w,-o.b5(w,z[0])],[...S,-o.b5(S,z[0])],[-x[0],-x[1],-x[2],-o.b5(x,z[7])],[-w[0],-w[1],-w[2],-o.b5(w,z[7])],[-S[0],-S[1],-S[2],-o.b5(S,z[7])]],A,R)}intersectsFrustum(t){let a=!0;const u=this.points.length,d=this.planes.length,x=t.planes.length,w=t.points.length;for(let S=0;S<x;S++){const A=t.planes[S];let R=0;for(let z=0;z<u;z++){const G=this.points[z];A[0]*G[0]+A[1]*G[1]+A[2]*G[2]+A[3]>=0&&R++}if(R===0)return 0;R<u&&(a=!1)}if(a)return 2;for(let S=0;S<d;S++){const A=this.planes[S];let R=0;for(let z=0;z<w;z++){const G=t.points[z];A[0]*G[0]+A[1]*G[1]+A[2]*G[2]+A[3]>=0&&R++}if(R===0)return 0}return 1}intersectsPlane(t){const a=this.points.length;let u=0;for(let d=0;d<a;d++){const x=this.points[d];t[0]*x[0]+t[1]*x[1]+t[2]*x[2]+t[3]>=0&&u++}return u===a?2:u===0?0:1}}function Yl(y,t,a){const u=y-t;return u<0?-u:Math.max(0,u-a)}function go(y,t,a,u,d){const x=y-a;let w;return w=x<0?Math.min(-x,1+x-d):x>1?Math.min(Math.max(x-d,0),1-x):0,Math.max(w,Yl(t,u,d))}class zu{constructor(){this._boundingVolumeCache=new Ip(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,a,u,d){const x=1<<u.z,w=1/x,S=u.x/x,A=u.y/x;let R=2;return R=Math.min(R,go(t,a,S,A,w)),R=Math.min(R,go(t,a,S+.5,-A-w,w)),R=Math.min(R,go(t,a,S+.5,2-A-w,w)),R}getWrap(t,a,u){const d=1<<a.z,x=1/d,w=a.x/d,S=Yl(t.x,w,x),A=Yl(t.x,w-1,x),R=Yl(t.x,w+1,x),z=Math.min(S,A,R);return z===R?1:z===A?-1:0}allowVariableZoom(t,a){return $t(t,a)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,a,u,d){return this._boundingVolumeCache.getTileBoundingVolume(t,a,u,d)}_computeTileBoundingVolume(t,a,u,d){var x,w;let S=0,A=0;if(d?.terrain){const R=new o.a2(t.z,a,t.z,t.x,t.y),z=d.terrain.getMinMaxElevation(R);S=(x=z.minElevation)!==null&&x!==void 0?x:Math.min(0,u),A=(w=z.maxElevation)!==null&&w!==void 0?w:Math.max(0,u)}if(S/=o.bE,A/=o.bE,S+=1,A+=1,t.z<=0)return mo.fromAabb([-A,-A,-A],[A,A,A]);if(t.z===1)return mo.fromAabb([t.x===0?-A:0,t.y===0?0:-A,-A],[t.x===0?0:A,t.y===0?A:0,A]);{const R=[xs(0,0,t.x,t.y,t.z),xs(o.a5,0,t.x,t.y,t.z),xs(o.a5,o.a5,t.x,t.y,t.z),xs(0,o.a5,t.x,t.y,t.z)],z=[];for(const Xe of R)z.push(o.a$([],Xe,A));if(A!==S)for(const Xe of R)z.push(o.a$([],Xe,S));t.y===0&&z.push([0,1,0]),t.y===(1<<t.z)-1&&z.push([0,-1,0]);const G=[1,1,1],V=[-1,-1,-1];for(const Xe of z)for(let Ze=0;Ze<3;Ze++)G[Ze]=Math.min(G[Ze],Xe[Ze]),V[Ze]=Math.max(V[Ze],Xe[Ze]);const $=xs(o.a5/2,o.a5/2,t.x,t.y,t.z),ee=o.b4([],[0,1,0],$);o.b3(ee,ee);const ce=o.b4([],$,ee);o.b3(ce,ce);const he=o.b4([],R[2],R[1]);o.b3(he,he);const ue=o.b4([],R[0],R[3]);o.b3(ue,ue),z.push(o.a$([],$,A)),t.y>=(1<<t.z)/2&&z.push(o.a$([],xs(o.a5/2,0,t.x,t.y,t.z),A)),t.y<(1<<t.z)/2&&z.push(o.a$([],xs(o.a5/2,o.a5,t.x,t.y,t.z),A));const ye=Qo($,z),Ae=Qo(ce,z),_e=[-$[0],-$[1],-$[2],ye.max],Ee=[$[0],$[1],$[2],-ye.min],Pe=[-ce[0],-ce[1],-ce[2],Ae.max],we=[ce[0],ce[1],ce[2],-Ae.min],Be=[...he,0],Ye=[...ue,0],je=[];return t.y===0?je.push(o.bD(Ye,Be,_e),o.bD(Ye,Be,Ee)):je.push(o.bD(Pe,Be,_e),o.bD(Pe,Be,Ee),o.bD(Pe,Ye,_e),o.bD(Pe,Ye,Ee)),t.y===(1<<t.z)-1?je.push(o.bD(Ye,Be,_e),o.bD(Ye,Be,Ee)):je.push(o.bD(we,Be,_e),o.bD(we,Be,Ee),o.bD(we,Ye,_e),o.bD(we,Ye,Ee)),new mo(je,[_e,Ee,Pe,we,Be,Ye],G,V)}}}function Qo(y,t){let a=1/0,u=-1/0;for(const d of t){const x=o.b5(y,d);a=Math.min(a,x),u=Math.max(u,x)}return{min:a,max:u}}class _o{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,u){return this._helper.interpolatePadding(t,a,u)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a){this._helper.resize(t,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(t){this._cachedClippingPlane=o.bF(),this._projectionMatrix=o.bj(),this._globeViewProjMatrix32f=o.bi(),this._globeViewProjMatrixNoCorrection=o.bj(),this._globeViewProjMatrixNoCorrectionInverted=o.bj(),this._globeProjMatrixInverted=o.bj(),this._cameraPosition=o.bA(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(a,u)=>{const d=o.an(a.lat,-o.ao,o.ao),x=o.an(+u,this.minZoom+_n(0,d),this.maxZoom);return{center:new o.V(a.lng,d),zoom:x}},this.applyConstrain=(a,u)=>this._helper.applyConstrain(a,u),this._helper=new Ea({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,u)=>this.defaultConstrain(a,u)},t),this._coveringTilesDetailsProvider=new zu}clone(){const t=new _o;return t.apply(this,!1),t}apply(t,a,u){this._globeLatitudeErrorCorrectionRadians=u||0,this._helper.apply(t,a)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=o.bA();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:a,applyGlobeMatrix:u}=t,d=this._helper.getMercatorTileCoordinates(a);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:d,clippingPlane:this._cachedClippingPlane,projectionTransition:u?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const a=this.pitchInRadians,u=this.cameraToCenterDistance/t,d=Math.sin(a)*u,x=Math.cos(a)*u+1,w=1/Math.sqrt(d*d+x*x)*1;let S=-d,A=x;const R=Math.sqrt(S*S+A*A);S/=R,A/=R;const z=[0,S,A];o.bG(z,z,[0,0,0],-this.bearingInRadians),o.bH(z,z,[0,0,0],-1*this.center.lat*Math.PI/180),o.bI(z,z,[0,0,0],this.center.lng*Math.PI/180);const G=1/o.b7(z);return o.a$(z,z,G),[...z,-w*G]}isLocationOccluded(t){return!this.isSurfacePointVisible(cn(t))}transformLightDirection(t){const a=this._helper._center.lng*Math.PI/180,u=this._helper._center.lat*Math.PI/180,d=Math.cos(u),x=[Math.sin(a)*d,Math.sin(u),Math.cos(a)*d],w=[x[2],0,-x[0]],S=[0,0,0];o.b4(S,w,x),o.b3(w,w),o.b3(S,S);const A=[0,0,0];return o.b3(A,[w[0]*t[0]+S[0]*t[1]+x[0]*t[2],w[1]*t[0]+S[1]*t[1]+x[1]*t[2],w[2]*t[0]+S[2]*t[1]+x[2]*t[2]]),A}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,a,u){const d=(function(S,A,R){const z=1/(1<<R.z);return new o.a9(S/o.a5*z+R.x*z,A/o.a5*z+R.y*z)})(t,a,u.canonical),x=(w=d.y,[o.bz(d.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-w*Math.PI*2))-.5*Math.PI]);var w;return this.getCircleRadiusCorrection()/Math.cos(x[1])}projectTileCoordinates(t,a,u,d){const x=u.canonical,w=xs(t,a,x.x,x.y,x.z),S=1+(d?d(t,a):0)/o.bE,A=[w[0]*S,w[1]*S,w[2]*S,1];o.aH(A,A,this._globeViewProjMatrixNoCorrection);const R=this._cachedClippingPlane,z=R[0]*w[0]+R[1]*w[1]+R[2]*w[2]+R[3]<0;return{point:new o.P(A[0]/A[3],A[1]/A[3]),signedDistanceFromCamera:A[3],isOccluded:z}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=Pa(this.worldSize,this.center.lat),a=o.bk(),u=o.bk();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),o.be(a,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const d=this.centerOffset;a[8]=2*-d.x/this._helper._width,a[9]=2*d.y/this._helper._height,this._projectionMatrix=o.bf(a),this._globeProjMatrixInverted=o.bk(),o.aB(this._globeProjMatrixInverted,a),o.O(a,a,[0,0,-this.cameraToCenterDistance]),o.bg(a,a,this.rollInRadians),o.bh(a,a,-this.pitchInRadians),o.bg(a,a,this.bearingInRadians),o.O(a,a,[0,0,-t]);const x=o.bA();x[0]=t,x[1]=t,x[2]=t,o.bh(u,a,this.center.lat*Math.PI/180),o.bJ(u,u,-this.center.lng*Math.PI/180),o.Q(u,u,x),this._globeViewProjMatrixNoCorrection=u,o.bh(a,a,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),o.bJ(a,a,-this.center.lng*Math.PI/180),o.Q(a,a,x),this._globeViewProjMatrix32f=new Float32Array(a),this._globeViewProjMatrixNoCorrectionInverted=o.bk(),o.aB(this._globeViewProjMatrixNoCorrectionInverted,u);const w=o.bA();this._cameraPosition=o.bA(),this._cameraPosition[2]=this.cameraToCenterDistance/t,o.bG(this._cameraPosition,this._cameraPosition,w,-this.rollInRadians),o.bH(this._cameraPosition,this._cameraPosition,w,this.pitchInRadians),o.bG(this._cameraPosition,this._cameraPosition,w,-this.bearingInRadians),o.b0(this._cameraPosition,this._cameraPosition,[0,0,1]),o.bH(this._cameraPosition,this._cameraPosition,w,-this.center.lat*Math.PI/180),o.bI(this._cameraPosition,this._cameraPosition,w,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const S=o.bf(this._globeViewProjMatrixNoCorrectionInverted);o.Q(S,S,[1,1,-1]),this._cachedFrustum=Er.fromInvProjectionMatrix(S,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){o.w("calculateFogMatrix is not supported on globe projection.");const a=o.bk();return o.ar(a),a}getVisibleUnwrappedCoordinates(t){return[new o.bc(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&o.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,a){if(!this._globeViewProjMatrixNoCorrection)return 1;const u=cn(t);o.a$(u,u,1+a/o.bE);const d=o.bF();return o.aH(d,[u[0],u[1],u[2],1],this._globeViewProjMatrixNoCorrection),d[2]/d[3]}populateCache(t){}getBounds(){const t=.5*this.width,a=.5*this.height,u=[new o.P(0,0),new o.P(t,0),new o.P(this.width,0),new o.P(this.width,a),new o.P(this.width,this.height),new o.P(t,this.height),new o.P(0,this.height),new o.P(0,a)],d=[];for(const G of u)d.push(this.unprojectScreenPoint(G));let x=0,w=0,S=0,A=0;const R=this.center;for(const G of d){const V=o.bK(R.lng,G.lng),$=o.bK(R.lat,G.lat);V<w&&(w=V),V>x&&(x=V),$<A&&(A=$),$>S&&(S=$)}const z=[R.lng+w,R.lat+A,R.lng+x,R.lat+S];return this.isSurfacePointOnScreen([0,1,0])&&(z[3]=90,z[0]=-180,z[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(z[1]=-90,z[0]=-180,z[2]=180),new ui(z)}calculateCenterFromCameraLngLatAlt(t,a,u,d){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,u,d)}setLocationAtPoint(t,a){const u=cn(this.unprojectScreenPoint(a)),d=cn(t),x=o.bA();o.bL(x);const w=o.bA();o.bI(w,u,x,-this.center.lng*Math.PI/180),o.bH(w,w,x,this.center.lat*Math.PI/180);const S=d[0]*d[0]+d[2]*d[2],A=w[0]*w[0];if(S<A)return;const R=Math.sqrt(S-A),z=-R,G=o.bM(d[0],d[2],w[0],R),V=o.bM(d[0],d[2],w[0],z),$=o.bA();o.bI($,d,x,-G);const ee=o.bM($[1],$[2],w[1],w[2]),ce=o.bA();o.bI(ce,d,x,-V);const he=o.bM(ce[1],ce[2],w[1],w[2]),ue=.5*Math.PI,ye=ee>=-ue&&ee<=ue,Ae=he>=-ue&&he<=ue;let _e,Ee;if(ye&&Ae){const Ye=this.center.lng*Math.PI/180,je=this.center.lat*Math.PI/180;o.bN(G,Ye)+o.bN(ee,je)<o.bN(V,Ye)+o.bN(he,je)?(_e=G,Ee=ee):(_e=V,Ee=he)}else if(ye)_e=G,Ee=ee;else{if(!Ae)return;_e=V,Ee=he}const Pe=_e/Math.PI*180,we=Ee/Math.PI*180,Be=this.center.lat;this.setCenter(new o.V(Pe,o.an(we,-90,90))),this.setZoom(this.zoom+_n(Be,this.center.lat))}locationToScreenPoint(t,a){const u=cn(t);if(a){const d=a.getElevationForLngLatZoom(t,this._helper._tileZoom);o.a$(u,u,1+d/o.bE)}return this._projectSurfacePointToScreen(u)}_projectSurfacePointToScreen(t){const a=o.bF();return o.aH(a,[...t,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],new o.P((.5*a[0]+.5)*this.width,(.5*-a[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,a){if(a){const u=a.pointCoordinate(t);if(u)return u}return o.a9.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,a){var u;return(u=this.screenPointToMercatorCoordinate(t,a))===null||u===void 0?void 0:u.toLngLat()}isPointOnMapSurface(t,a){const u=this._cameraPosition,d=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(u,d)}getRayDirectionFromPixel(t){const a=o.bF();a[0]=t.x/this.width*2-1,a[1]=-1*(t.y/this.height*2-1),a[2]=1,a[3]=1,o.aH(a,a,this._globeViewProjMatrixNoCorrectionInverted),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3];const u=o.bA();u[0]=a[0]-this._cameraPosition[0],u[1]=a[1]-this._cameraPosition[1],u[2]=a[2]-this._cameraPosition[2];const d=o.bA();return o.b3(d,u),d}isSurfacePointVisible(t){const a=this._cachedClippingPlane;return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]+a[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const a=o.bF();return o.aH(a,[...t,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3],a[0]>-1&&a[0]<1&&a[1]>-1&&a[1]<1&&a[2]>-1&&a[2]<1}rayPlanetIntersection(t,a){const u=o.b5(t,a),d=o.bA(),x=o.bA();o.a$(x,a,u),o.b2(d,t,x);const w=1-o.b5(d,d);if(w<0)return null;const S=o.b5(t,t)-1,A=-u+(u<0?1:-1)*Math.sqrt(w),R=S/A,z=A;return{tMin:Math.min(R,z),tMax:Math.max(R,z)}}unprojectScreenPoint(t){const a=this._cameraPosition,u=this.getRayDirectionFromPixel(t),d=this.rayPlanetIntersection(a,u);if(d){const z=o.bA();o.b0(z,a,[u[0]*d.tMin,u[1]*d.tMin,u[2]*d.tMin]);const G=o.bA();return o.b3(G,z),Lu(G)}const x=this._cachedClippingPlane,w=x[0]*u[0]+x[1]*u[1]+x[2]*u[2],S=-o.bb(x,a)/w,A=o.bA();if(S>0)o.b0(A,a,[u[0]*S,u[1]*S,u[2]*S]);else{const z=o.bA();o.b0(z,a,[2*u[0],2*u[1],2*u[2]]);const G=o.bb(this._cachedClippingPlane,z);o.b2(A,z,[this._cachedClippingPlane[0]*G,this._cachedClippingPlane[1]*G,this._cachedClippingPlane[2]*G])}const R=(function(z){const G=o.bA();return G[0]=z[0]*-z[3],G[1]=z[1]*-z[3],G[2]=z[2]*-z[3],{center:G,radius:Math.sqrt(1-z[3]*z[3])}})(x);return Lu((function(z,G,V){const $=o.bA();o.b2($,V,z);const ee=o.bA();return o.by(ee,z,$,G/o.b9($)),ee})(R.center,R.radius,A))}getMatrixForModel(t,a){const u=o.V.convert(t),d=1/o.bE,x=o.bj();return o.bJ(x,x,u.lng/180*Math.PI),o.bh(x,x,-u.lat/180*Math.PI),o.O(x,x,[0,0,1+a/o.bE]),o.bh(x,x,.5*Math.PI),o.Q(x,x,[d,d,d]),x}getProjectionDataForCustomLayer(t=!0){const a=this.getProjectionData({overscaledTileID:new o.a2(0,0,0,0,0),applyGlobeMatrix:t});return a.tileMercatorCoords=[0,0,1,1],a}getFastPathSimpleProjectionMatrix(t){}}class yo{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,u){return this._helper.interpolatePadding(t,a,u)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a,u=!0){this._helper.resize(t,a,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,a){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=a,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(t){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(a,u)=>this.currentTransform.defaultConstrain(a,u),this.applyConstrain=(a,u)=>this._helper.applyConstrain(a,u),this._helper=new Ea({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,u)=>this.defaultConstrain(a,u)},t),this._globeness=1,this._mercatorTransform=new Aa,this._verticalPerspectiveTransform=new _o}clone(){const t=new yo;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this,!1),t}apply(t,a){this._helper.apply(t,a),this._mercatorTransform.apply(this,!1),this._verticalPerspectiveTransform.apply(this,!1,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const a=this._mercatorTransform.getProjectionData(t),u=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?u.mainMatrix:a.mainMatrix,clippingPlane:u.clippingPlane,tileMercatorCoords:u.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:a.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return o.bu(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return o.bu(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,a,u){const d=this._mercatorTransform.getPitchedTextCorrection(t,a,u),x=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,a,u);return o.bu(d,x,this._globeness)}projectTileCoordinates(t,a,u,d){return this.currentTransform.projectTileCoordinates(t,a,u,d)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,!1,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,a){return this.currentTransform.lngLatToCameraDepth(t,a)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(t,a,u,d){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,u,d)}setLocationAtPoint(t,a){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,a),void this.apply(this._mercatorTransform,!1);this._verticalPerspectiveTransform.setLocationAtPoint(t,a),this.apply(this._verticalPerspectiveTransform,!1)}locationToScreenPoint(t,a){return this.currentTransform.locationToScreenPoint(t,a)}screenPointToMercatorCoordinate(t,a){return this.currentTransform.screenPointToMercatorCoordinate(t,a)}screenPointToLocation(t,a){return this.currentTransform.screenPointToLocation(t,a)}isPointOnMapSurface(t,a){return this.currentTransform.isPointOnMapSurface(t,a)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,a){return this.currentTransform.getMatrixForModel(t,a)}getProjectionDataForCustomLayer(t=!0){const a=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return a;const u=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return u.fallbackMatrix=a.mainMatrix,u}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class zn{get useGlobeControls(){return!0}handlePanInertia(t,a){const u=md(t,a);return Math.abs(u.lng-a.center.lng)>180&&(u.lng=a.center.lng+179.5*Math.sign(u.lng-a.center.lng)),{easingCenter:u,easingOffset:new o.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,a){const u=t.around,d=a.screenPointToLocation(u);t.bearingDelta&&a.setBearing(a.bearing+t.bearingDelta),t.pitchDelta&&a.setPitch(a.pitch+t.pitchDelta),t.rollDelta&&a.setRoll(a.roll+t.rollDelta);const x=a.zoom;t.zoomDelta&&a.setZoom(a.zoom+t.zoomDelta);const w=a.zoom-x;if(w===0)return;const S=o.bK(a.center.lng,d.lng),A=S/(Math.abs(S/180)+1),R=o.bK(a.center.lat,d.lat),z=a.getRayDirectionFromPixel(u),G=a.cameraPosition,V=-1*o.b5(G,z),$=o.bA();o.b0($,G,[z[0]*V,z[1]*V,z[2]*V]);const ee=o.b7($)-1,ce=Math.exp(.5*-Math.max(ee-.3,0)),he=Pa(a.worldSize,a.center.lat)/Math.min(a.width,a.height),ue=o.bx(he,.9,.5,1,.25),ye=(1-o.aq(-w))*Math.min(ce,ue),Ae=a.center.lat,_e=a.zoom,Ee=new o.V(a.center.lng+A*ye,o.an(a.center.lat+R*ye,-o.ao,o.ao));a.setLocationAtPoint(d,u);const Pe=a.center,we=o.bx(Math.abs(S),45,85,0,1),Be=o.bx(he,.75,.35,0,1),Ye=Math.pow(Math.max(we,Be),.25),je=o.bK(Pe.lng,Ee.lng),Xe=o.bK(Pe.lat,Ee.lat);a.setCenter(new o.V(Pe.lng+je*Ye,Pe.lat+Xe*Ye).wrap()),a.setZoom(_e+_n(Ae,a.center.lat))}handleMapControlsPan(t,a,u){if(!t.panDelta)return;const d=a.center.lat,x=a.zoom;a.setCenter(md(t.panDelta,a).wrap()),a.setZoom(x+_n(d,a.center.lat))}cameraForBoxAndBearing(t,a,u,d,x){const w=Ru(t,a,u,d,x),S=a.left/x.width*2-1,A=(x.width-a.right)/x.width*2-1,R=a.top/x.height*-2+1,z=(x.height-a.bottom)/x.height*-2+1,G=o.bK(u.getWest(),u.getEast())<0,V=G?u.getEast():u.getWest(),$=G?u.getWest():u.getEast(),ee=Math.max(u.getNorth(),u.getSouth()),ce=Math.min(u.getNorth(),u.getSouth()),he=V+.5*o.bK(V,$),ue=ee+.5*o.bK(ee,ce),ye=x.clone();ye.setCenter(w.center),ye.setBearing(w.bearing),ye.setPitch(0),ye.setRoll(0),ye.setZoom(w.zoom);const Ae=ye.modelViewProjectionMatrix,_e=[cn(u.getNorthWest()),cn(u.getNorthEast()),cn(u.getSouthWest()),cn(u.getSouthEast()),cn(new o.V($,ue)),cn(new o.V(V,ue)),cn(new o.V(he,ee)),cn(new o.V(he,ce))],Ee=cn(w.center);let Pe=Number.POSITIVE_INFINITY;for(const we of _e)S<0&&(Pe=zn.getLesserNonNegativeNonNull(Pe,zn.solveVectorScale(we,Ee,Ae,"x",S))),A>0&&(Pe=zn.getLesserNonNegativeNonNull(Pe,zn.solveVectorScale(we,Ee,Ae,"x",A))),R>0&&(Pe=zn.getLesserNonNegativeNonNull(Pe,zn.solveVectorScale(we,Ee,Ae,"y",R))),z<0&&(Pe=zn.getLesserNonNegativeNonNull(Pe,zn.solveVectorScale(we,Ee,Ae,"y",z)));if(Number.isFinite(Pe)&&Pe!==0)return w.zoom=ye.zoom+o.at(Pe),w;Rs()}handleJumpToCenterZoom(t,a){const u=t.center.lat,d=t.applyConstrain(a.center?o.V.convert(a.center):t.center,t.zoom).center;t.setCenter(d.wrap());const x=a.zoom!==void 0?+a.zoom:t.zoom+_n(u,d.lat);t.zoom!==x&&t.setZoom(x)}handleEaseTo(t,a){const u=t.zoom,d=t.center,x=t.padding,w={roll:t.roll,pitch:t.pitch,bearing:t.bearing},S={roll:a.roll===void 0?t.roll:a.roll,pitch:a.pitch===void 0?t.pitch:a.pitch,bearing:a.bearing===void 0?t.bearing:a.bearing},A=a.zoom!==void 0,R=!t.isPaddingEqual(a.padding);let z=!1;const G=a.center?o.V.convert(a.center):d,V=t.applyConstrain(G,u).center;Ys(t,V);const $=t.clone();$.setCenter(V),$.setZoom(A?+a.zoom:u+_n(d.lat,G.lat)),$.setBearing(a.bearing);const ee=new o.P(o.an(t.centerPoint.x+a.offsetAsPoint.x,0,t.width),o.an(t.centerPoint.y+a.offsetAsPoint.y,0,t.height));$.setLocationAtPoint(V,ee);const ce=(a.offset&&a.offsetAsPoint.mag())>0?$.center:V,he=A?+a.zoom:u+_n(d.lat,ce.lat),ue=u+_n(d.lat,0),ye=he+_n(ce.lat,0),Ae=o.bK(d.lng,ce.lng),_e=o.bK(d.lat,ce.lat),Ee=o.aq(ye-ue);return z=he!==u,{easeFunc:Pe=>{if(o.bo(w,S)||dd({startEulerAngles:w,endEulerAngles:S,tr:t,k:Pe,useSlerp:w.roll!=S.roll}),R&&t.interpolatePadding(x,a.padding,Pe),a.around)o.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(a.around,a.aroundPoint);else{const we=ye>ue?Math.min(2,Ee):Math.max(.5,Ee),Be=Math.pow(we,1-Pe),Ye=gd(d,Ae,_e,Pe*Be);t.setCenter(Ye.wrap())}if(z){const we=o.G.number(ue,ye,Pe)+_n(0,t.center.lat);t.setZoom(we)}},isZooming:z,elevationCenter:ce}}handleFlyTo(t,a){const u=a.zoom!==void 0,d=t.center,x=t.zoom,w=t.padding,S=!t.isPaddingEqual(a.padding),A=t.applyConstrain(o.V.convert(a.center||a.locationAtOffset),x).center,R=u?+a.zoom:t.zoom+_n(t.center.lat,A.lat),z=t.clone();z.setCenter(A),z.setZoom(R),z.setBearing(a.bearing);const G=new o.P(o.an(t.centerPoint.x+a.offsetAsPoint.x,0,t.width),o.an(t.centerPoint.y+a.offsetAsPoint.y,0,t.height));z.setLocationAtPoint(A,G);const V=z.center;Ys(t,V);const $=(function(_e,Ee,Pe){const we=cn(Ee),Be=cn(Pe),Ye=o.b5(we,Be),je=Math.acos(Ye),Xe=yr(_e);return je/(2*Math.PI)*Xe})(t,d,V),ee=x+_n(d.lat,0),ce=R+_n(V.lat,0),he=o.aq(ce-ee);let ue;if(typeof a.minZoom=="number"){const _e=+a.minZoom+_n(V.lat,0),Ee=Math.min(_e,ee,ce)+_n(0,V.lat),Pe=t.applyConstrain(V,Ee).zoom+_n(V.lat,0);ue=o.aq(Pe-ee)}const ye=o.bK(d.lng,V.lng),Ae=o.bK(d.lat,V.lat);return{easeFunc:(_e,Ee,Pe,we)=>{const Be=gd(d,ye,Ae,Pe);S&&t.interpolatePadding(w,a.padding,_e);const Ye=_e===1?V:Be;t.setCenter(Ye.wrap());const je=ee+o.at(Ee);t.setZoom(_e===1?R:je+_n(0,Ye.lat))},scaleOfZoom:he,targetCenter:V,scaleOfMinZoom:ue,pixelPathLength:$}}static solveVectorScale(t,a,u,d,x){const w=d==="x"?[u[0],u[4],u[8],u[12]]:[u[1],u[5],u[9],u[13]],S=[u[3],u[7],u[11],u[15]],A=t[0]*w[0]+t[1]*w[1]+t[2]*w[2],R=t[0]*S[0]+t[1]*S[1]+t[2]*S[2],z=a[0]*w[0]+a[1]*w[1]+a[2]*w[2],G=a[0]*S[0]+a[1]*S[1]+a[2]*S[2];return z+x*R===A+x*G||S[3]*(A-z)+w[3]*(G-R)+A*G==z*R?null:(z+w[3]-x*G-x*S[3])/(z-A-x*G+x*R)}static getLesserNonNegativeNonNull(t,a){return a!==null&&a>=0&&a<t?a:t}}class _d{constructor(t){this._globe=t,this._mercatorCameraHelper=new Ca,this._verticalPerspectiveCameraHelper=new zn}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,a){return this.currentHelper.handlePanInertia(t,a)}handleMapControlsRollPitchBearingZoom(t,a){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,a)}handleMapControlsPan(t,a,u){this.currentHelper.handleMapControlsPan(t,a,u)}cameraForBoxAndBearing(t,a,u,d,x){return this.currentHelper.cameraForBoxAndBearing(t,a,u,d,x)}handleJumpToCenterZoom(t,a){this.currentHelper.handleJumpToCenterZoom(t,a)}handleEaseTo(t,a){return this.currentHelper.handleEaseTo(t,a)}handleFlyTo(t,a){return this.currentHelper.handleFlyTo(t,a)}}const xo=(y,t)=>o.B(y,t&&t.filter((a=>a.identifier!=="source.canvas"))),el=o.bO();class Ia extends o.E{constructor(t,a={}){var u,d;super(),this._rtlPluginLoaded=()=>{for(const w in this.tileManagers){const S=this.tileManagers[w].getSource().type;S!=="vector"&&S!=="geojson"||this.tileManagers[w].reload()}},this.map=t,this.dispatcher=new Gt(ni(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",((w,S)=>this.getGlyphs(w,S))),this.dispatcher.registerMessageHandler("GI",((w,S)=>this.getImages(w,S))),this.dispatcher.registerMessageHandler("GDA",((w,S)=>this.getDashes(w,S))),this.imageManager=new tt,this.imageManager.setEventedParent(this);const x=((u=t._container)===null||u===void 0?void 0:u.lang)||typeof document<"u"&&((d=document.documentElement)===null||d===void 0?void 0:d.lang)||void 0;this.glyphManager=new Je(t._requestManager,a.localIdeographFontFamily,x),this.lineAtlas=new ti(256,512),this.crossTileSymbolIndex=new Mr,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",o.bP()),U().on(Et,this._rtlPluginLoaded),this.on("data",(w=>{if(w.dataType!=="source"||w.sourceDataType!=="metadata")return;const S=this.tileManagers[w.sourceId];if(!S)return;const A=S.getSource();if(A&&A.vectorLayerIds)for(const R in this._layers){const z=this._layers[R];z.source===A.id&&this._validateLayer(z)}}))}_setInitialValues(){var t;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new o.bQ,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((t=this.crossTileSymbolIndex)===null||t===void 0?void 0:t.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(t,a){var u,d,x;this._checkLoaded();const w=a===null?(x=(d=(u=this.stylesheet.state)===null||u===void 0?void 0:u[t])===null||d===void 0?void 0:d.default)!==null&&x!==void 0?x:null:a;if(o.bR(w,this._globalState[t]))return this;this._globalState[t]=w,this._applyGlobalStateChanges([t])}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const a=[];for(const u in t)!o.bR(this._globalState[u],t[u].default)&&(a.push(u),this._globalState[u]=t[u].default);this._applyGlobalStateChanges(a)}_applyGlobalStateChanges(t){if(t.length===0)return;const a=new Set,u={};for(const d of t){u[d]=this._globalState[d];for(const x in this._layers){const w=this._layers[x],S=w.getLayoutAffectingGlobalStateRefs(),A=w.getPaintAffectingGlobalStateRefs(),R=w.getVisibilityAffectingGlobalStateRefs();if(S.has(d)&&a.add(w.source),A.has(d))for(const{name:z,value:G}of A.get(d))this._updatePaintProperty(w,z,G);R?.has(d)&&(w.recalculateVisibility(),this._updateLayer(w))}}this.dispatcher.broadcast("UGS",u);for(const d in this.tileManagers)a.has(d)&&(this._reloadSource(d),this._changed=!0)}loadURL(t,a={},u){this.fire(new o.l("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;const d=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const x=this._loadStyleRequest;o.j(d,this._loadStyleRequest).then((w=>{this._loadStyleRequest=null,this._load(w.data,a,u)})).catch((w=>{this._loadStyleRequest=null,w&&!x.signal.aborted&&this.fire(new o.k(w))}))}loadJSON(t,a={},u){this.fire(new o.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,j.frameAsync(this._frameRequest,this.map._ownerWindow).then((()=>{this._frameRequest=null,a.validate=a.validate!==!1,this._load(t,a,u)})).catch((()=>{}))}loadEmpty(){this.fire(new o.l("dataloading",{dataType:"style"})),this._load(el,{validate:!1})}_load(t,a,u){var d,x;let w=a.transformStyle?a.transformStyle(u,t):t;if(!a.validate||!xo(this,o.C(w))){w=Object.assign({},w),this._loaded=!0,this.stylesheet=w;for(const S in w.sources)this.addSource(S,w.sources[S],{validate:!1});w.sprite?this._loadSprite(w.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(w.glyphs),this._createLayers(),this.light=new At(this.stylesheet.light),this._setProjectionInternal(((d=this.stylesheet.projection)===null||d===void 0?void 0:d.type)||"mercator"),this.sky=new oi(this.stylesheet.sky),this.map.setTerrain((x=this.stylesheet.terrain)!==null&&x!==void 0?x:null),this.fire(new o.l("data",{dataType:"style"})),this.fire(new o.l("style.load"))}}_createLayers(){var t,a,u;const d=o.bS(this.stylesheet.layers);this.setGlobalState((t=this.stylesheet.state)!==null&&t!==void 0?t:null),this.dispatcher.broadcast("SL",d),this._order=d.map((x=>x.id)),this._layers={},this._serializedLayers=null;for(const x of d){const w=o.bT(x,this._globalState);if(w.setEventedParent(this,{layer:{id:x.id}}),this._layers[x.id]=w,o.bU(w)&&this.tileManagers[w.source]){const S=(u=(a=x.paint)===null||a===void 0?void 0:a["raster-fade-duration"])!==null&&u!==void 0?u:w.paint.get("raster-fade-duration");this.tileManagers[w.source].setRasterFadeDuration(S)}}}_loadSprite(t,a=!1,u=void 0){this.imageManager.setLoaded(!1);const d=new AbortController;let x;this._spriteRequest=d,(function(w,S,A,R){return o._(this,void 0,void 0,(function*(){const z=re(w),G=A>1?"@2x":"",V={},$={};for(const{id:ee,url:ce}of z){const he=S.transformRequest(fe(ce,G,".json"),"SpriteJSON");V[ee]=o.j(he,R);const ue=S.transformRequest(fe(ce,G,".png"),"SpriteImage");$[ee]=Ie.getImage(ue,R)}return yield Promise.all([...Object.values(V),...Object.values($)]),(function(ee,ce){return o._(this,void 0,void 0,(function*(){const he={};for(const ue in ee){he[ue]={};const ye=j.getImageCanvasContext((yield ce[ue]).data),Ae=(yield ee[ue]).data;for(const _e in Ae){const{width:Ee,height:Pe,x:we,y:Be,sdf:Ye,pixelRatio:je,stretchX:Xe,stretchY:Ze,content:bt,textFitWidth:wt,textFitHeight:dt}=Ae[_e];he[ue][_e]={data:null,pixelRatio:je,sdf:Ye,stretchX:Xe,stretchY:Ze,content:bt,textFitWidth:wt,textFitHeight:dt,spriteData:{width:Ee,height:Pe,x:we,y:Be,context:ye}}}}return he}))})(V,$)}))})(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((w=>{if(this._spriteRequest=null,w)for(const S in w){this._spritesImagesIds[S]=[];const A=this._spritesImagesIds[S]?this._spritesImagesIds[S].filter((R=>!(R in w))):[];for(const R of A)this.imageManager.removeImage(R),this._changedImages[R]=!0;for(const R in w[S]){const z=S==="default"?R:`${S}:${R}`;this._spritesImagesIds[S].push(z),z in this.imageManager.images?this.imageManager.updateImage(z,w[S][R],!1):this.imageManager.addImage(z,w[S][R]),a&&(this._changedImages[z]=!0)}}})).catch((w=>{this._spriteRequest=null,x=w,d.signal.aborted||this.fire(new o.k(x))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"})),u&&u(x)}))}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}_validateLayer(t){const a=this.tileManagers[t.source];if(!a)return;const u=t.sourceLayer;if(!u)return;const d=a.getSource();(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(u)===-1)&&this.fire(new o.k(new Error(`Source layer "${u}" does not exist on source "${d.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.tileManagers)if(!this.tileManagers[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,a=!1){const u=this._serializedAllLayers();if(!t||t.length===0)return Object.values(a?o.bV(u):u);const d=[];for(const x of t)if(u[x]){const w=a?o.bV(u[x]):u[x];d.push(w)}return d}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const a=Object.keys(this._layers);for(const u of a){const d=this._layers[u];d.type!=="custom"&&(t[u]=d.serialize())}return t}hasTransitions(){var t,a,u;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((a=this.sky)===null||a===void 0)&&a.hasTransition()||!((u=this.projection)===null||u===void 0)&&u.hasTransition())return!0;for(const d in this.tileManagers)if(this.tileManagers[d].hasTransition())return!0;for(const d in this._layers)if(this._layers[d].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const a=this._changed;if(a){const d=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(d.length||x.length)&&this._updateWorkerLayers(d,x);for(const w in this._updatedSources){const S=this._updatedSources[w];if(S==="reload")this._reloadSource(w);else{if(S!=="clear")throw new Error(`Invalid action ${S}`);this._clearSource(w)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const u={};for(const d in this.tileManagers){const x=this.tileManagers[d];u[d]=x.used,x.used=!1}for(const d of this._order){const x=this._layers[d];x.recalculate(t,this._availableImages),!x.isHidden(t.zoom)&&x.source&&(this.tileManagers[x.source].used=!0)}for(const d in u){const x=this.tileManagers[d];!!u[d]!=!!x.used&&x.fire(new o.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:d}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,a&&this.fire(new o.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const a in this.tileManagers)this.tileManagers[a].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.tileManagers)this.tileManagers[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,a){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,a={}){var u;this._checkLoaded();const d=this.serialize();if(t=a.transformStyle?a.transformStyle(d,t):t,((u=a.validate)===null||u===void 0||u)&&xo(this,o.C(t)))return!1;(t=o.bV(t)).layers=o.bS(t.layers);const x=o.bW(d,t),w=this._getOperationsToPerform(x);if(w.unimplemented.length>0)throw new Error(`Unimplemented: ${w.unimplemented.join(", ")}.`);if(w.operations.length===0)return!1;for(const S of w.operations)S();return this.stylesheet=t,this._serializedLayers=null,this.fire(new o.l("style.load",{style:this})),!0}_getOperationsToPerform(t){const a=[],u=[];for(const d of t)switch(d.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":a.push((()=>this.addLayer.apply(this,d.args)));break;case"removeLayer":a.push((()=>this.removeLayer.apply(this,d.args)));break;case"setPaintProperty":a.push((()=>this.setPaintProperty.apply(this,d.args)));break;case"setLayoutProperty":a.push((()=>this.setLayoutProperty.apply(this,d.args)));break;case"setFilter":a.push((()=>this.setFilter.apply(this,d.args)));break;case"addSource":a.push((()=>this.addSource.apply(this,d.args)));break;case"removeSource":a.push((()=>this.removeSource.apply(this,d.args)));break;case"setLayerZoomRange":a.push((()=>this.setLayerZoomRange.apply(this,d.args)));break;case"setLight":a.push((()=>this.setLight.apply(this,d.args)));break;case"setGeoJSONSourceData":a.push((()=>this.setGeoJSONSourceData.apply(this,d.args)));break;case"setGlyphs":a.push((()=>this.setGlyphs.apply(this,d.args)));break;case"setSprite":a.push((()=>this.setSprite.apply(this,d.args)));break;case"setTerrain":a.push((()=>this.map.setTerrain.apply(this,d.args)));break;case"setSky":a.push((()=>this.setSky.apply(this,d.args)));break;case"setProjection":this.setProjection.apply(this,d.args);break;case"setGlobalState":a.push((()=>this.setGlobalState.apply(this,d.args)));break;case"setTransition":a.push((()=>{}));break;default:u.push(d.command)}return{operations:a,unimplemented:u}}addImage(t,a){if(this.getImage(t))return this.fire(new o.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,a),this._afterImageUpdated(t)}updateImage(t,a){this.imageManager.updateImage(t,a)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new o.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,a,u={}){if(this._checkLoaded(),this.tileManagers[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(o.C.source,`sources.${t}`,a,null,u))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const d=this.tileManagers[t]=new Un(t,a,this.dispatcher);d.style=this,d.setEventedParent(this,(()=>({isSourceLoaded:d.loaded(),source:d.serialize(),sourceId:t}))),d.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error("There is no source with this ID");for(const u in this._layers)if(this._layers[u].source===t)return this.fire(new o.k(new Error(`Source "${t}" cannot be removed while layer "${u}" is using it.`)));const a=this.tileManagers[t];delete this.tileManagers[t],delete this._updatedSources[t],a.fire(new o.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,a){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const u=this.tileManagers[t].getSource();if(u.type!=="geojson")throw new Error(`geojsonSource.type is ${u.type}, which is !== 'geojson`);u.setData(a),this._changed=!0}getSource(t){return this.tileManagers[t]&&this.tileManagers[t].getSource()}addLayer(t,a,u={}){this._checkLoaded();const d=t.id;if(this.getLayer(d))return void this.fire(new o.k(new Error(`Layer "${d}" already exists on this map.`)));let x;if(t.type==="custom"){if(xo(this,o.bX(t)))return;x=o.bT(t,this._globalState)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(d,t.source),t=o.bV(t),t=o.e(t,{source:d})),this._validate(o.C.layer,`layers.${d}`,t,{arrayIndex:-1},u))return;x=o.bT(t,this._globalState),this._validateLayer(x),x.setEventedParent(this,{layer:{id:d}})}const w=a?this._order.indexOf(a):this._order.length;if(a&&w===-1)this.fire(new o.k(new Error(`Cannot add layer "${d}" before non-existing layer "${a}".`)));else{if(this._order.splice(w,0,d),this._layerOrderChanged=!0,this._layers[d]=x,this._removedLayers[d]&&x.source&&x.type!=="custom"){const S=this._removedLayers[d];delete this._removedLayers[d],S.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",this.tileManagers[x.source].pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map)}}moveLayer(t,a){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new o.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===a)return;const u=this._order.indexOf(t);this._order.splice(u,1);const d=a?this._order.indexOf(a):this._order.length;a&&d===-1?this.fire(new o.k(new Error(`Cannot move layer "${t}" before non-existing layer "${a}".`))):(this._order.splice(d,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const a=this._layers[t];if(!a)return void this.fire(new o.k(new Error(`Cannot remove non-existing layer "${t}".`)));a.setEventedParent(null);const u=this._order.indexOf(t);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=a,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],a.onRemove&&a.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,a,u){this._checkLoaded();const d=this.getLayer(t);d?d.minzoom===a&&d.maxzoom===u||(a!=null&&(d.minzoom=a),u!=null&&(d.maxzoom=u),this._updateLayer(d)):this.fire(new o.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,a,u={}){this._checkLoaded();const d=this.getLayer(t);if(d){if(!o.bR(d.filter,a))return a==null?(d.setFilter(void 0),void this._updateLayer(d)):void(this._validate(o.C.filter,`layers.${d.id}.filter`,a,null,u)||(d.setFilter(o.bV(a)),this._updateLayer(d)))}else this.fire(new o.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return o.bV(this.getLayer(t).filter)}setLayoutProperty(t,a,u,d={}){this._checkLoaded();const x=this.getLayer(t);x?o.bR(x.getLayoutProperty(a),u)||(x.setLayoutProperty(a,u,d),this._updateLayer(x)):this.fire(new o.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,a){const u=this.getLayer(t);if(u)return u.getLayoutProperty(a);this.fire(new o.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,a,u,d={}){this._checkLoaded();const x=this.getLayer(t);x?o.bR(x.getPaintProperty(a),u)||this._updatePaintProperty(x,a,u,d):this.fire(new o.k(new Error(`Cannot style non-existing layer "${t}".`)))}_updatePaintProperty(t,a,u,d={}){t.setPaintProperty(a,u,d)&&this._updateLayer(t),o.bU(t)&&a==="raster-fade-duration"&&this.tileManagers[t.source].setRasterFadeDuration(u),this._changed=!0,this._updatedPaintProps[t.id]=!0,this._serializedLayers=null}getPaintProperty(t,a){return this.getLayer(t).getPaintProperty(a)}setFeatureState(t,a){this._checkLoaded();const u=t.source,d=t.sourceLayer,x=this.tileManagers[u];if(x===void 0)return void this.fire(new o.k(new Error(`The source '${u}' does not exist in the map's style.`)));const w=x.getSource().type;w==="geojson"&&d?this.fire(new o.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):w!=="vector"||d?(t.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),x.setFeatureState(d,t.id,a)):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,a){this._checkLoaded();const u=t.source,d=this.tileManagers[u];if(d===void 0)return void this.fire(new o.k(new Error(`The source '${u}' does not exist in the map's style.`)));const x=d.getSource().type,w=x==="vector"?t.sourceLayer:void 0;x!=="vector"||w?a&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new o.k(new Error("A feature id is required to remove its specific state property."))):d.removeFeatureState(w,t.id,a):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const a=t.source,u=t.sourceLayer,d=this.tileManagers[a];if(d!==void 0)return d.getSource().type!=="vector"||u?(t.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),d.getFeatureState(u,t.id)):void this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.k(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=o.bY(this.tileManagers,(x=>x.serialize())),a=this._serializeByIds(this._order,!0),u=this.map.getTerrain()||void 0,d=this.stylesheet;return o.bZ({version:d.version,name:d.name,metadata:d.metadata,light:d.light,sky:d.sky,center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch,sprite:d.sprite,glyphs:d.glyphs,transition:d.transition,projection:d.projection,sources:t,layers:a,terrain:u},(x=>x!==void 0))}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.tileManagers[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.tileManagers[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const a=w=>this._layers[w].type==="fill-extrusion",u={},d=[];for(let w=this._order.length-1;w>=0;w--){const S=this._order[w];if(a(S)){u[S]=w;for(const A of t){const R=A[S];if(R)for(const z of R)d.push(z)}}}d.sort(((w,S)=>S.intersectionZ-w.intersectionZ));const x=[];for(let w=this._order.length-1;w>=0;w--){const S=this._order[w];if(a(S))for(let A=d.length-1;A>=0;A--){const R=d[A].feature;if(u[R.layer.id]<w)break;x.push(R),d.pop()}else for(const A of t){const R=A[S];if(R)for(const z of R)x.push(z.feature)}}return x}queryRenderedFeatures(t,a,u){a&&a.filter&&this._validate(o.C.filter,"queryRenderedFeatures.filter",a.filter,null,a);const d={};if(a&&a.layers){if(!(Array.isArray(a.layers)||a.layers instanceof Set))return this.fire(new o.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const R of a.layers){const z=this._layers[R];if(!z)return this.fire(new o.k(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];d[z.source]=!0}}const x=[];a.availableImages=this._availableImages;const w=this._serializedAllLayers(),S=a.layers instanceof Set?a.layers:Array.isArray(a.layers)?new Set(a.layers):null,A=Object.assign(Object.assign({},a),{layers:S,globalState:this._globalState});for(const R in this.tileManagers)a.layers&&!d[R]||x.push(xi(this.tileManagers[R],this._layers,w,t,A,u,this.map.terrain?(z,G,V)=>this.map.terrain.getElevation(z,G,V):void 0));return this.placement&&x.push((function(R,z,G,V,$,ee,ce){const he={},ue=ee.queryRenderedSymbols(V),ye=[];for(const Ae of Object.keys(ue).map(Number))ye.push(ce[Ae]);ye.sort(ci);for(const Ae of ye){const _e=Ae.featureIndex.lookupSymbolFeatures(ue[Ae.bucketInstanceId],z,Ae.bucketIndex,Ae.sourceLayerIndex,{filterSpec:$.filter,globalState:$.globalState},$.layers,$.availableImages,R);for(const Ee in _e){const Pe=he[Ee]=he[Ee]||[],we=_e[Ee];we.sort(((Be,Ye)=>{const je=Ae.featureSortOrder;if(je){const Xe=je.indexOf(Be.featureIndex);return je.indexOf(Ye.featureIndex)-Xe}return Ye.featureIndex-Be.featureIndex}));for(const Be of we)Pe.push(Be)}}return(function(Ae,_e,Ee){for(const Pe in Ae)for(const we of Ae[Pe])vi(we,Ee[_e[Pe].source]);return Ae})(he,R,G)})(this._layers,w,this.tileManagers,t,A,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(t,a){a?.filter&&this._validate(o.C.filter,"querySourceFeatures.filter",a.filter,null,a);const u=this.tileManagers[t];return u?(function(d,x){const w=d.getRenderableIds().map((R=>d.getTileByID(R))),S=[],A={};for(let R=0;R<w.length;R++){const z=w[R],G=z.tileID.canonical.key;A[G]||(A[G]=!0,z.querySourceFeatures(S,x))}return S})(u,a?Object.assign(Object.assign({},a),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(t,a={}){this._checkLoaded();const u=this.light.getLight();let d=!1;for(const w in t)if(!o.bR(t[w],u[w])){d=!0;break}if(!d)return;const x={now:J(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,a),this.light.updateTransitions(x)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.stylesheet.projection=t,this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,a={}){this._checkLoaded();const u=this.getSky();let d=!1;if(!t&&!u)return;if(t&&!u)d=!0;else if(!t&&u)d=!0;else for(const w in t)if(!o.bR(t[w],u[w])){d=!0;break}if(!d)return;const x={now:J(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,a),this.sky.updateTransitions(x)}_setProjectionInternal(t){const a=(function(u,d){const x={constrainOverride:d};if(Array.isArray(u)){const w=new pd({type:u});return{projection:w,transform:new yo(x),cameraHelper:new _d(w)}}switch(u){case"mercator":return{projection:new _r,transform:new Aa(x),cameraHelper:new Ca};case"globe":{const w=new pd({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:w,transform:new yo(x),cameraHelper:new _d(w)}}case"vertical-perspective":return{projection:new Du,transform:new _o(x),cameraHelper:new zn};default:return o.w(`Unknown projection name: ${u}. Falling back to mercator projection.`),{projection:new _r,transform:new Aa(x),cameraHelper:new Ca}}})(t,this.map.transformConstrain);this.projection=a.projection,this.map.migrateProjection(a.transform,a.cameraHelper);for(const u in this.tileManagers)this.tileManagers[u].reload()}_validate(t,a,u,d,x={}){return(!x||x.validate!==!1)&&xo(this,t.call(o.C,o.e({key:a,style:this.serialize(),value:u,styleSpec:o.u},d)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),U().off(Et,this._rtlPluginLoaded);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.tileManagers){const u=this.tileManagers[a];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.tileManagers[t].clearTiles()}_reloadSource(t){this.tileManagers[t].resume(),this.tileManagers[t].reload()}_updateSources(t){for(const a in this.tileManagers)this.tileManagers[a].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.tileManagers)this._reloadSource(t)}_updatePlacement(t,a,u,d,x=!1){let w=!1,S=!1;const A={};for(const R of this._order){const z=this._layers[R];if(z.type!=="symbol")continue;if(!A[z.source]){const V=this.tileManagers[z.source];A[z.source]=V.getRenderableIds(!0).map(($=>V.getTileByID($))).sort((($,ee)=>ee.tileID.overscaledZ-$.tileID.overscaledZ||($.tileID.isLessThan(ee.tileID)?-1:1)))}const G=this.crossTileSymbolIndex.addLayer(z,A[z.source],t.center.lng);w=w||G}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((x=x||this._layerOrderChanged||u===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(J(),t.zoom))&&(this.pauseablePlacement=new co(t,this.map.terrain,this._order,x,a,u,d,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(J()),S=!0),w&&this.pauseablePlacement.placement.setStale()),S||w)for(const R of this._order){const z=this._layers[R];z.type==="symbol"&&this.placement.updateLayerOpacities(z,A[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(J())}_releaseSymbolFadeTiles(){for(const t in this.tileManagers)this.tileManagers[t].releaseSymbolFadeTiles()}getImages(t,a){return o._(this,void 0,void 0,(function*(){const u=yield this.imageManager.getImages(a.icons);this._updateTilesForChangedImages();const d=this.tileManagers[a.source];return d&&d.setDependencies(a.tileID.key,a.type,a.icons),u}))}getGlyphs(t,a){return o._(this,void 0,void 0,(function*(){const u=yield this.glyphManager.getGlyphs(a.stacks),d=this.tileManagers[a.source];return d&&d.setDependencies(a.tileID.key,a.type,[""]),u}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,a={}){this._checkLoaded(),t&&this._validate(o.C.glyphs,"glyphs",t,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}getDashes(t,a){return o._(this,void 0,void 0,(function*(){const u={};for(const[d,x]of Object.entries(a.dashes))u[d]=this.lineAtlas.getDash(x.dasharray,x.round);return u}))}addSprite(t,a,u={},d){this._checkLoaded();const x=[{id:t,url:a}],w=[...re(this.stylesheet.sprite),...x];this._validate(o.C.sprite,"sprite",w,null,u)||(this.stylesheet.sprite=w,this._loadSprite(x,!0,d))}removeSprite(t){this._checkLoaded();const a=re(this.stylesheet.sprite);if(a.find((u=>u.id===t))){if(this._spritesImagesIds[t])for(const u of this._spritesImagesIds[t])this.imageManager.removeImage(u),this._changedImages[u]=!0;a.splice(a.findIndex((u=>u.id===t)),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}else this.fire(new o.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return re(this.stylesheet.sprite)}setSprite(t,a={},u){this._checkLoaded(),t&&this._validate(o.C.sprite,"sprite",t,null,a)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,u):(this._unloadSprite(),u&&u(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const t in this.tileManagers){const a=this.tileManagers[t];a.setEventedParent(null),a.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const t in this._layers){const a=this._layers[t];a.setEventedParent(null),a.onRemove&&a.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var Rp=o.aU([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Kl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,a,u,d,x,w,S,A,R){this.context=t;let z=this.boundPaintVertexBuffers.length!==d.length;for(let G=0;!z&&G<d.length;G++)this.boundPaintVertexBuffers[G]!==d[G]&&(z=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==u||z||this.boundIndexBuffer!==x||this.boundVertexOffset!==w||this.boundDynamicVertexBuffer!==S||this.boundDynamicVertexBuffer2!==A||this.boundDynamicVertexBuffer3!==R?this.freshBind(a,u,d,x,w,S,A,R):(t.bindVertexArray.set(this.vao),S&&S.bind(),x&&x.dynamicDraw&&x.bind(),A&&A.bind(),R&&R.bind())}freshBind(t,a,u,d,x,w,S,A){const R=t.numAttributes,z=this.context,G=z.gl;this.vao&&this.destroy(),this.vao=z.createVertexArray(),z.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=d,this.boundVertexOffset=x,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=S,this.boundDynamicVertexBuffer3=A,a.enableAttributes(G,t);for(const V of u)V.enableAttributes(G,t);w&&w.enableAttributes(G,t),S&&S.enableAttributes(G,t),A&&A.enableAttributes(G,t),a.bind(),a.setVertexAttribPointers(G,t,x);for(const V of u)V.bind(),V.setVertexAttribPointers(G,t,x);w&&(w.bind(),w.setVertexAttribPointers(G,t,x)),d&&d.bind(),S&&(S.bind(),S.setVertexAttribPointers(G,t,x)),A&&(A.bind(),A.setVertexAttribPointers(G,t,x)),z.currentNumAttributes=R}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Dp=(y,t,a,u,d)=>({u_texture:0,u_ele_delta:y,u_fog_matrix:t,u_fog_color:a?a.properties.get("fog-color"):o.bp.white,u_fog_ground_blend:a?a.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:d?0:a?a.calculateFogBlendOpacity(u):0,u_horizon_color:a?a.properties.get("horizon-color"):o.bp.white,u_horizon_fog_blend:a?a.properties.get("horizon-fog-blend"):1,u_is_globe_mode:d?1:0}),vo={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Jl(y){const t=[];for(let a=0;a<y.length;a++){if(y[a]===null)continue;const u=y[a].split(" ");t.push(u.pop())}return t}class yd{constructor(t,a,u,d,x,w,S,A,R=[]){const z=t.gl;this.program=z.createProgram();const G=Jl(a.staticAttributes),V=u?u.getBinderAttributes():[],$=G.concat(V),ee=pn.prelude.staticUniforms?Jl(pn.prelude.staticUniforms):[],ce=S.staticUniforms?Jl(S.staticUniforms):[],he=a.staticUniforms?Jl(a.staticUniforms):[],ue=u?u.getBinderUniforms():[],ye=ee.concat(ce).concat(he).concat(ue),Ae=[];for(const je of ye)Ae.indexOf(je)<0&&Ae.push(je);const _e=u?u.defines():[];jr(z)&&_e.unshift("#version 300 es"),x&&_e.push("#define OVERDRAW_INSPECTOR;"),w&&_e.push("#define TERRAIN3D;"),A&&_e.push(A),R&&_e.push(...R);let Ee=_e.concat(pn.prelude.fragmentSource,S.fragmentSource,a.fragmentSource).join(`
`),Pe=_e.concat(pn.prelude.vertexSource,S.vertexSource,a.vertexSource).join(`
`);jr(z)||(Ee=(function(je){return je.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(Ee),Pe=(function(je){return je.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(Pe));const we=z.createShader(z.FRAGMENT_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);if(z.shaderSource(we,Ee),z.compileShader(we),!z.getShaderParameter(we,z.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${z.getShaderInfoLog(we)}`);z.attachShader(this.program,we);const Be=z.createShader(z.VERTEX_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);if(z.shaderSource(Be,Pe),z.compileShader(Be),!z.getShaderParameter(Be,z.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${z.getShaderInfoLog(Be)}`);z.attachShader(this.program,Be),this.attributes={};const Ye={};this.numAttributes=$.length;for(let je=0;je<this.numAttributes;je++)$[je]&&(z.bindAttribLocation(this.program,je,$[je]),this.attributes[$[je]]=je);if(z.linkProgram(this.program),!z.getProgramParameter(this.program,z.LINK_STATUS))throw new Error(`Program failed to link: ${z.getProgramInfoLog(this.program)}`);z.deleteShader(Be),z.deleteShader(we);for(let je=0;je<Ae.length;je++){const Xe=Ae[je];if(Xe&&!Ye[Xe]){const Ze=z.getUniformLocation(this.program,Xe);Ze&&(Ye[Xe]=Ze)}}this.fixedUniforms=d(t,Ye),this.terrainUniforms=((je,Xe)=>({u_depth:new o.b_(je,Xe.u_depth),u_terrain:new o.b_(je,Xe.u_terrain),u_terrain_dim:new o.bq(je,Xe.u_terrain_dim),u_terrain_matrix:new o.c0(je,Xe.u_terrain_matrix),u_terrain_unpack:new o.c1(je,Xe.u_terrain_unpack),u_terrain_exaggeration:new o.bq(je,Xe.u_terrain_exaggeration)}))(t,Ye),this.projectionUniforms=((je,Xe)=>({u_projection_matrix:new o.c0(je,Xe.u_projection_matrix),u_projection_tile_mercator_coords:new o.c1(je,Xe.u_projection_tile_mercator_coords),u_projection_clipping_plane:new o.c1(je,Xe.u_projection_clipping_plane),u_projection_transition:new o.bq(je,Xe.u_projection_transition),u_projection_fallback_matrix:new o.c0(je,Xe.u_projection_fallback_matrix)}))(t,Ye),this.binderUniforms=u?u.getUniforms(t,Ye):[]}draw(t,a,u,d,x,w,S,A,R,z,G,V,$,ee,ce,he,ue,ye,Ae){const _e=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(u),t.setStencilMode(d),t.setColorMode(x),t.setCullFace(w),A){t.activeTexture.set(_e.TEXTURE2),_e.bindTexture(_e.TEXTURE_2D,A.depthTexture),t.activeTexture.set(_e.TEXTURE3),_e.bindTexture(_e.TEXTURE_2D,A.texture);for(const Pe in this.terrainUniforms)this.terrainUniforms[Pe].set(A[Pe])}if(R)for(const Pe in R)this.projectionUniforms[vo[Pe]].set(R[Pe]);if(S)for(const Pe in this.fixedUniforms)this.fixedUniforms[Pe].set(S[Pe]);he&&he.setUniforms(t,this.binderUniforms,ee,{zoom:ce});let Ee=0;switch(a){case _e.LINES:Ee=2;break;case _e.TRIANGLES:Ee=3;break;case _e.LINE_STRIP:Ee=1}for(const Pe of $.get()){const we=Pe.vaos||(Pe.vaos={});(we[z]||(we[z]=new Kl)).bind(t,this,G,he?he.getPaintVertexBuffers():[],V,Pe.vertexOffset,ue,ye,Ae),_e.drawElements(a,Pe.primitiveLength*Ee,_e.UNSIGNED_SHORT,Pe.primitiveOffset*Ee*2)}}}function xd(y,t,a){const u=1/o.aN(a,1,t.transform.tileZoom),d=Math.pow(2,a.tileID.overscaledZ),x=a.tileSize*Math.pow(2,t.transform.tileZoom)/d,w=x*(a.tileID.canonical.x+a.tileID.wrap*d),S=x*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[u,y.fromScale,y.toScale],u_fade:y.t,u_pixel_coord_upper:[w>>16,S>>16],u_pixel_coord_lower:[65535&w,65535&S]}}const Ou=(y,t,a,u)=>{const d=y.style.light,x=d.properties.get("position"),w=[x.x,x.y,x.z],S=o.c4();d.properties.get("anchor")==="viewport"&&o.c5(S,y.transform.bearingInRadians),o.c6(w,w,S);const A=y.transform.transformLightDirection(w),R=d.properties.get("color");return{u_lightpos:w,u_lightpos_globe:A,u_lightintensity:d.properties.get("intensity"),u_lightcolor:[R.r,R.g,R.b],u_vertical_gradient:+t,u_opacity:a,u_fill_translate:u}},Nu=(y,t,a,u,d,x,w)=>o.e(Ou(y,t,a,u),xd(x,y,w),{u_height_factor:-Math.pow(2,d.overscaledZ)/w.tileSize/8}),Bu=(y,t,a,u)=>o.e(xd(t,y,a),{u_fill_translate:u}),vd=(y,t)=>({u_world:y,u_fill_translate:t}),bd=(y,t,a,u,d)=>o.e(Bu(y,t,a,d),{u_world:u}),wd=(y,t,a,u,d)=>{const x=y.transform;let w,S,A=0;if(a.paint.get("circle-pitch-alignment")==="map"){const R=o.aN(t,1,x.zoom);w=!0,S=[R,R],A=R/(o.a5*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*d}else w=!1,S=x.pixelsToGLUnits;return{u_camera_to_center_distance:x.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+w,u_device_pixel_ratio:y.pixelRatio,u_extrude_scale:S,u_globe_extrude_scale:A,u_translate:u}},Ra=y=>({u_pixel_extrude_scale:[1/y.width,1/y.height]}),Td=y=>({u_viewport_size:[y.width,y.height]}),ku=(y,t=1)=>({u_color:y,u_overlay:0,u_overlay_scale:t}),bo=(y,t,a,u)=>{const d=o.aN(y,1,t)/(o.a5*Math.pow(2,y.tileID.overscaledZ))*2*Math.PI*u;return{u_extrude_scale:o.aN(y,1,t),u_intensity:a,u_globe_extrude_scale:d}},Sd=(y,t,a,u)=>{const d=o.N();o.c7(d,0,y.width,y.height,0,0,1);const x=y.context.gl;return{u_matrix:d,u_world:[x.drawingBufferWidth,x.drawingBufferHeight],u_image:a,u_color_ramp:u,u_opacity:t.paint.get("heatmap-opacity")}},Ql=(y,t,a)=>{const u=a.paint.get("hillshade-accent-color");let d;switch(a.paint.get("hillshade-method")){case"basic":d=4;break;case"combined":d=1;break;case"igor":d=2;break;case"multidirectional":d=3;break;default:d=0}const x=a.getIlluminationProperties();for(let w=0;w<x.directionRadians.length;w++)a.paint.get("hillshade-illumination-anchor")==="viewport"&&(x.directionRadians[w]+=y.transform.bearingInRadians);return{u_image:0,u_latrange:Fp(0,t.tileID),u_exaggeration:a.paint.get("hillshade-exaggeration"),u_altitudes:x.altitudeRadians,u_azimuths:x.directionRadians,u_accent:u,u_method:d,u_highlights:x.highlightColor,u_shadows:x.shadowColor}},Lp=(y,t)=>{const a=t.stride,u=o.N();return o.c7(u,0,o.a5,-o.a5,0,0,1),o.O(u,u,[0,-o.a5,0]),{u_matrix:u,u_image:1,u_dimension:[a,a],u_zoom:y.overscaledZ,u_unpack:t.getUnpackVector()}};function Fp(y,t){const a=Math.pow(2,t.canonical.z),u=t.canonical.y;return[new o.a9(0,u/a).toLngLat().lat,new o.a9(0,(u+1)/a).toLngLat().lat]}const Md=(y,t,a=0)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:a,u_opacity:y.paint.get("color-relief-opacity")}),tl=(y,t,a,u)=>{const d=y.transform;return{u_translation:tc(y,t,a),u_ratio:u/o.aN(t,1,d.zoom),u_device_pixel_ratio:y.pixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},Ed=(y,t,a,u,d)=>o.e(tl(y,t,a,u),{u_image:0,u_image_height:d}),Uu=(y,t,a,u,d)=>{const x=y.transform,w=ns(t,x);return{u_translation:tc(y,t,a),u_texsize:t.imageAtlasTexture.size,u_ratio:u/o.aN(t,1,x.zoom),u_device_pixel_ratio:y.pixelRatio,u_image:0,u_scale:[w,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},Ad=(y,t,a,u,d)=>{const x=ns(t,y.transform);return o.e(tl(y,t,a,u),{u_tileratio:x,u_crossfade_from:d.fromScale,u_crossfade_to:d.toScale,u_image:0,u_mix:d.t,u_lineatlas_width:y.lineAtlas.width,u_lineatlas_height:y.lineAtlas.height})},ec=(y,t,a,u,d,x)=>{const w=ns(t,y.transform);return o.e(tl(y,t,a,u),{u_image:0,u_image_height:x,u_tileratio:w,u_crossfade_from:d.fromScale,u_crossfade_to:d.toScale,u_image_dash:1,u_mix:d.t,u_lineatlas_width:y.lineAtlas.width,u_lineatlas_height:y.lineAtlas.height})};function ns(y,t){return 1/o.aN(y,1,t.tileZoom)}function tc(y,t,a){return o.aO(y.transform,t,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const Vu=(y,t,a,u,d)=>{return{u_tl_parent:y,u_scale_parent:t,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(w=u.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(x=u.paint.get("raster-contrast"),x>0?1/(1-x):1+x),u_spin_weights:Gu(u.paint.get("raster-hue-rotate")),u_coords_top:[d[0].x,d[0].y,d[1].x,d[1].y],u_coords_bottom:[d[3].x,d[3].y,d[2].x,d[2].y]};var x,w};function Gu(y){y*=Math.PI/180;const t=Math.sin(y),a=Math.cos(y);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const Hu=(y,t,a,u,d,x,w,S,A,R,z,G,V)=>{const $=w.transform;return{u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:$.cameraToCenterDistance,u_pitch:$.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:$.width/$.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_label_plane_matrix:S,u_coord_matrix:A,u_is_text:+z,u_pitch_with_map:+u,u_is_along_line:d,u_is_variable_anchor:x,u_texsize:G,u_texture:0,u_translation:R,u_pitched_scale:V}},ic=(y,t,a,u,d,x,w,S,A,R,z,G,V,$)=>{const ee=w.transform;return o.e(Hu(y,t,a,u,d,x,w,S,A,R,z,G,$),{u_gamma_scale:u?Math.cos(ee.pitch*Math.PI/180)*ee.cameraToCenterDistance:1,u_device_pixel_ratio:w.pixelRatio,u_is_halo:1})},Da=(y,t,a,u,d,x,w,S,A,R,z,G,V)=>o.e(ic(y,t,a,u,d,x,w,S,A,R,!0,z,0,V),{u_texsize_icon:G,u_texture_icon:1}),ju=(y,t)=>({u_opacity:y,u_color:t}),zp=(y,t,a,u,d)=>o.e((function(x,w,S,A){const R=S.imageManager.getPattern(x.from.toString()),z=S.imageManager.getPattern(x.to.toString()),{width:G,height:V}=S.imageManager.getPixelSize(),$=Math.pow(2,A.tileID.overscaledZ),ee=A.tileSize*Math.pow(2,S.transform.tileZoom)/$,ce=ee*(A.tileID.canonical.x+A.tileID.wrap*$),he=ee*A.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:R.tl,u_pattern_br_a:R.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[G,V],u_mix:w.t,u_pattern_size_a:R.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/o.aN(A,1,S.transform.tileZoom),u_pixel_coord_upper:[ce>>16,he>>16],u_pixel_coord_lower:[65535&ce,65535&he]}})(a,d,t,u),{u_opacity:y}),Cd=(y,t)=>{},Op={fillExtrusion:(y,t)=>({u_lightpos:new o.c2(y,t.u_lightpos),u_lightpos_globe:new o.c2(y,t.u_lightpos_globe),u_lightintensity:new o.bq(y,t.u_lightintensity),u_lightcolor:new o.c2(y,t.u_lightcolor),u_vertical_gradient:new o.bq(y,t.u_vertical_gradient),u_opacity:new o.bq(y,t.u_opacity),u_fill_translate:new o.c3(y,t.u_fill_translate)}),fillExtrusionPattern:(y,t)=>({u_lightpos:new o.c2(y,t.u_lightpos),u_lightpos_globe:new o.c2(y,t.u_lightpos_globe),u_lightintensity:new o.bq(y,t.u_lightintensity),u_lightcolor:new o.c2(y,t.u_lightcolor),u_vertical_gradient:new o.bq(y,t.u_vertical_gradient),u_height_factor:new o.bq(y,t.u_height_factor),u_opacity:new o.bq(y,t.u_opacity),u_fill_translate:new o.c3(y,t.u_fill_translate),u_image:new o.b_(y,t.u_image),u_texsize:new o.c3(y,t.u_texsize),u_pixel_coord_upper:new o.c3(y,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.c3(y,t.u_pixel_coord_lower),u_scale:new o.c2(y,t.u_scale),u_fade:new o.bq(y,t.u_fade)}),fill:(y,t)=>({u_fill_translate:new o.c3(y,t.u_fill_translate)}),fillPattern:(y,t)=>({u_image:new o.b_(y,t.u_image),u_texsize:new o.c3(y,t.u_texsize),u_pixel_coord_upper:new o.c3(y,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.c3(y,t.u_pixel_coord_lower),u_scale:new o.c2(y,t.u_scale),u_fade:new o.bq(y,t.u_fade),u_fill_translate:new o.c3(y,t.u_fill_translate)}),fillOutline:(y,t)=>({u_world:new o.c3(y,t.u_world),u_fill_translate:new o.c3(y,t.u_fill_translate)}),fillOutlinePattern:(y,t)=>({u_world:new o.c3(y,t.u_world),u_image:new o.b_(y,t.u_image),u_texsize:new o.c3(y,t.u_texsize),u_pixel_coord_upper:new o.c3(y,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.c3(y,t.u_pixel_coord_lower),u_scale:new o.c2(y,t.u_scale),u_fade:new o.bq(y,t.u_fade),u_fill_translate:new o.c3(y,t.u_fill_translate)}),circle:(y,t)=>({u_camera_to_center_distance:new o.bq(y,t.u_camera_to_center_distance),u_scale_with_map:new o.b_(y,t.u_scale_with_map),u_pitch_with_map:new o.b_(y,t.u_pitch_with_map),u_extrude_scale:new o.c3(y,t.u_extrude_scale),u_device_pixel_ratio:new o.bq(y,t.u_device_pixel_ratio),u_globe_extrude_scale:new o.bq(y,t.u_globe_extrude_scale),u_translate:new o.c3(y,t.u_translate)}),collisionBox:(y,t)=>({u_pixel_extrude_scale:new o.c3(y,t.u_pixel_extrude_scale)}),collisionCircle:(y,t)=>({u_viewport_size:new o.c3(y,t.u_viewport_size)}),debug:(y,t)=>({u_color:new o.b$(y,t.u_color),u_overlay:new o.b_(y,t.u_overlay),u_overlay_scale:new o.bq(y,t.u_overlay_scale)}),depth:Cd,clippingMask:Cd,heatmap:(y,t)=>({u_extrude_scale:new o.bq(y,t.u_extrude_scale),u_intensity:new o.bq(y,t.u_intensity),u_globe_extrude_scale:new o.bq(y,t.u_globe_extrude_scale)}),heatmapTexture:(y,t)=>({u_matrix:new o.c0(y,t.u_matrix),u_world:new o.c3(y,t.u_world),u_image:new o.b_(y,t.u_image),u_color_ramp:new o.b_(y,t.u_color_ramp),u_opacity:new o.bq(y,t.u_opacity)}),hillshade:(y,t)=>({u_image:new o.b_(y,t.u_image),u_latrange:new o.c3(y,t.u_latrange),u_exaggeration:new o.bq(y,t.u_exaggeration),u_altitudes:new o.c9(y,t.u_altitudes),u_azimuths:new o.c9(y,t.u_azimuths),u_accent:new o.b$(y,t.u_accent),u_method:new o.b_(y,t.u_method),u_shadows:new o.c8(y,t.u_shadows),u_highlights:new o.c8(y,t.u_highlights)}),hillshadePrepare:(y,t)=>({u_matrix:new o.c0(y,t.u_matrix),u_image:new o.b_(y,t.u_image),u_dimension:new o.c3(y,t.u_dimension),u_zoom:new o.bq(y,t.u_zoom),u_unpack:new o.c1(y,t.u_unpack)}),colorRelief:(y,t)=>({u_image:new o.b_(y,t.u_image),u_unpack:new o.c1(y,t.u_unpack),u_dimension:new o.c3(y,t.u_dimension),u_elevation_stops:new o.b_(y,t.u_elevation_stops),u_color_stops:new o.b_(y,t.u_color_stops),u_color_ramp_size:new o.b_(y,t.u_color_ramp_size),u_opacity:new o.bq(y,t.u_opacity)}),line:(y,t)=>({u_translation:new o.c3(y,t.u_translation),u_ratio:new o.bq(y,t.u_ratio),u_device_pixel_ratio:new o.bq(y,t.u_device_pixel_ratio),u_units_to_pixels:new o.c3(y,t.u_units_to_pixels)}),lineGradient:(y,t)=>({u_translation:new o.c3(y,t.u_translation),u_ratio:new o.bq(y,t.u_ratio),u_device_pixel_ratio:new o.bq(y,t.u_device_pixel_ratio),u_units_to_pixels:new o.c3(y,t.u_units_to_pixels),u_image:new o.b_(y,t.u_image),u_image_height:new o.bq(y,t.u_image_height)}),linePattern:(y,t)=>({u_translation:new o.c3(y,t.u_translation),u_texsize:new o.c3(y,t.u_texsize),u_ratio:new o.bq(y,t.u_ratio),u_device_pixel_ratio:new o.bq(y,t.u_device_pixel_ratio),u_image:new o.b_(y,t.u_image),u_units_to_pixels:new o.c3(y,t.u_units_to_pixels),u_scale:new o.c2(y,t.u_scale),u_fade:new o.bq(y,t.u_fade)}),lineSDF:(y,t)=>({u_translation:new o.c3(y,t.u_translation),u_ratio:new o.bq(y,t.u_ratio),u_device_pixel_ratio:new o.bq(y,t.u_device_pixel_ratio),u_units_to_pixels:new o.c3(y,t.u_units_to_pixels),u_image:new o.b_(y,t.u_image),u_mix:new o.bq(y,t.u_mix),u_tileratio:new o.bq(y,t.u_tileratio),u_crossfade_from:new o.bq(y,t.u_crossfade_from),u_crossfade_to:new o.bq(y,t.u_crossfade_to),u_lineatlas_width:new o.bq(y,t.u_lineatlas_width),u_lineatlas_height:new o.bq(y,t.u_lineatlas_height)}),lineGradientSDF:(y,t)=>({u_translation:new o.c3(y,t.u_translation),u_ratio:new o.bq(y,t.u_ratio),u_device_pixel_ratio:new o.bq(y,t.u_device_pixel_ratio),u_units_to_pixels:new o.c3(y,t.u_units_to_pixels),u_image:new o.b_(y,t.u_image),u_image_height:new o.bq(y,t.u_image_height),u_tileratio:new o.bq(y,t.u_tileratio),u_crossfade_from:new o.bq(y,t.u_crossfade_from),u_crossfade_to:new o.bq(y,t.u_crossfade_to),u_image_dash:new o.b_(y,t.u_image_dash),u_mix:new o.bq(y,t.u_mix),u_lineatlas_width:new o.bq(y,t.u_lineatlas_width),u_lineatlas_height:new o.bq(y,t.u_lineatlas_height)}),raster:(y,t)=>({u_tl_parent:new o.c3(y,t.u_tl_parent),u_scale_parent:new o.bq(y,t.u_scale_parent),u_buffer_scale:new o.bq(y,t.u_buffer_scale),u_fade_t:new o.bq(y,t.u_fade_t),u_opacity:new o.bq(y,t.u_opacity),u_image0:new o.b_(y,t.u_image0),u_image1:new o.b_(y,t.u_image1),u_brightness_low:new o.bq(y,t.u_brightness_low),u_brightness_high:new o.bq(y,t.u_brightness_high),u_saturation_factor:new o.bq(y,t.u_saturation_factor),u_contrast_factor:new o.bq(y,t.u_contrast_factor),u_spin_weights:new o.c2(y,t.u_spin_weights),u_coords_top:new o.c1(y,t.u_coords_top),u_coords_bottom:new o.c1(y,t.u_coords_bottom)}),symbolIcon:(y,t)=>({u_is_size_zoom_constant:new o.b_(y,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.b_(y,t.u_is_size_feature_constant),u_size_t:new o.bq(y,t.u_size_t),u_size:new o.bq(y,t.u_size),u_camera_to_center_distance:new o.bq(y,t.u_camera_to_center_distance),u_pitch:new o.bq(y,t.u_pitch),u_rotate_symbol:new o.b_(y,t.u_rotate_symbol),u_aspect_ratio:new o.bq(y,t.u_aspect_ratio),u_fade_change:new o.bq(y,t.u_fade_change),u_label_plane_matrix:new o.c0(y,t.u_label_plane_matrix),u_coord_matrix:new o.c0(y,t.u_coord_matrix),u_is_text:new o.b_(y,t.u_is_text),u_pitch_with_map:new o.b_(y,t.u_pitch_with_map),u_is_along_line:new o.b_(y,t.u_is_along_line),u_is_variable_anchor:new o.b_(y,t.u_is_variable_anchor),u_texsize:new o.c3(y,t.u_texsize),u_texture:new o.b_(y,t.u_texture),u_translation:new o.c3(y,t.u_translation),u_pitched_scale:new o.bq(y,t.u_pitched_scale)}),symbolSDF:(y,t)=>({u_is_size_zoom_constant:new o.b_(y,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.b_(y,t.u_is_size_feature_constant),u_size_t:new o.bq(y,t.u_size_t),u_size:new o.bq(y,t.u_size),u_camera_to_center_distance:new o.bq(y,t.u_camera_to_center_distance),u_pitch:new o.bq(y,t.u_pitch),u_rotate_symbol:new o.b_(y,t.u_rotate_symbol),u_aspect_ratio:new o.bq(y,t.u_aspect_ratio),u_fade_change:new o.bq(y,t.u_fade_change),u_label_plane_matrix:new o.c0(y,t.u_label_plane_matrix),u_coord_matrix:new o.c0(y,t.u_coord_matrix),u_is_text:new o.b_(y,t.u_is_text),u_pitch_with_map:new o.b_(y,t.u_pitch_with_map),u_is_along_line:new o.b_(y,t.u_is_along_line),u_is_variable_anchor:new o.b_(y,t.u_is_variable_anchor),u_texsize:new o.c3(y,t.u_texsize),u_texture:new o.b_(y,t.u_texture),u_gamma_scale:new o.bq(y,t.u_gamma_scale),u_device_pixel_ratio:new o.bq(y,t.u_device_pixel_ratio),u_is_halo:new o.b_(y,t.u_is_halo),u_translation:new o.c3(y,t.u_translation),u_pitched_scale:new o.bq(y,t.u_pitched_scale)}),symbolTextAndIcon:(y,t)=>({u_is_size_zoom_constant:new o.b_(y,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.b_(y,t.u_is_size_feature_constant),u_size_t:new o.bq(y,t.u_size_t),u_size:new o.bq(y,t.u_size),u_camera_to_center_distance:new o.bq(y,t.u_camera_to_center_distance),u_pitch:new o.bq(y,t.u_pitch),u_rotate_symbol:new o.b_(y,t.u_rotate_symbol),u_aspect_ratio:new o.bq(y,t.u_aspect_ratio),u_fade_change:new o.bq(y,t.u_fade_change),u_label_plane_matrix:new o.c0(y,t.u_label_plane_matrix),u_coord_matrix:new o.c0(y,t.u_coord_matrix),u_is_text:new o.b_(y,t.u_is_text),u_pitch_with_map:new o.b_(y,t.u_pitch_with_map),u_is_along_line:new o.b_(y,t.u_is_along_line),u_is_variable_anchor:new o.b_(y,t.u_is_variable_anchor),u_texsize:new o.c3(y,t.u_texsize),u_texsize_icon:new o.c3(y,t.u_texsize_icon),u_texture:new o.b_(y,t.u_texture),u_texture_icon:new o.b_(y,t.u_texture_icon),u_gamma_scale:new o.bq(y,t.u_gamma_scale),u_device_pixel_ratio:new o.bq(y,t.u_device_pixel_ratio),u_is_halo:new o.b_(y,t.u_is_halo),u_translation:new o.c3(y,t.u_translation),u_pitched_scale:new o.bq(y,t.u_pitched_scale)}),background:(y,t)=>({u_opacity:new o.bq(y,t.u_opacity),u_color:new o.b$(y,t.u_color)}),backgroundPattern:(y,t)=>({u_opacity:new o.bq(y,t.u_opacity),u_image:new o.b_(y,t.u_image),u_pattern_tl_a:new o.c3(y,t.u_pattern_tl_a),u_pattern_br_a:new o.c3(y,t.u_pattern_br_a),u_pattern_tl_b:new o.c3(y,t.u_pattern_tl_b),u_pattern_br_b:new o.c3(y,t.u_pattern_br_b),u_texsize:new o.c3(y,t.u_texsize),u_mix:new o.bq(y,t.u_mix),u_pattern_size_a:new o.c3(y,t.u_pattern_size_a),u_pattern_size_b:new o.c3(y,t.u_pattern_size_b),u_scale_a:new o.bq(y,t.u_scale_a),u_scale_b:new o.bq(y,t.u_scale_b),u_pixel_coord_upper:new o.c3(y,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.c3(y,t.u_pixel_coord_lower),u_tile_units_to_pixels:new o.bq(y,t.u_tile_units_to_pixels)}),terrain:(y,t)=>({u_texture:new o.b_(y,t.u_texture),u_ele_delta:new o.bq(y,t.u_ele_delta),u_fog_matrix:new o.c0(y,t.u_fog_matrix),u_fog_color:new o.b$(y,t.u_fog_color),u_fog_ground_blend:new o.bq(y,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new o.bq(y,t.u_fog_ground_blend_opacity),u_horizon_color:new o.b$(y,t.u_horizon_color),u_horizon_fog_blend:new o.bq(y,t.u_horizon_fog_blend),u_is_globe_mode:new o.bq(y,t.u_is_globe_mode)}),terrainDepth:(y,t)=>({u_ele_delta:new o.bq(y,t.u_ele_delta)}),terrainCoords:(y,t)=>({u_texture:new o.b_(y,t.u_texture),u_terrain_coords_id:new o.bq(y,t.u_terrain_coords_id),u_ele_delta:new o.bq(y,t.u_ele_delta)}),projectionErrorMeasurement:(y,t)=>({u_input:new o.bq(y,t.u_input),u_output_expected:new o.bq(y,t.u_output_expected)}),atmosphere:(y,t)=>({u_sun_pos:new o.c2(y,t.u_sun_pos),u_atmosphere_blend:new o.bq(y,t.u_atmosphere_blend),u_globe_position:new o.c2(y,t.u_globe_position),u_globe_radius:new o.bq(y,t.u_globe_radius),u_inv_proj_matrix:new o.c0(y,t.u_inv_proj_matrix)}),sky:(y,t)=>({u_sky_color:new o.b$(y,t.u_sky_color),u_horizon_color:new o.b$(y,t.u_horizon_color),u_horizon:new o.c3(y,t.u_horizon),u_horizon_normal:new o.c3(y,t.u_horizon_normal),u_sky_horizon_blend:new o.bq(y,t.u_sky_horizon_blend),u_sky_blend:new o.bq(y,t.u_sky_blend)})};class Np{constructor(t,a,u){this.context=t;const d=t.gl;this.buffer=d.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Pd={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Bp{constructor(t,a,u,d){this.length=a.length,this.attributes=u,this.itemSize=a.bytesPerElement,this.dynamicDraw=d,this.context=t;const x=t.gl;this.buffer=x.createBuffer(),t.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let u=0;u<this.attributes.length;u++){const d=a.attributes[this.attributes[u].name];d!==void 0&&t.enableVertexAttribArray(d)}}setVertexAttribPointers(t,a,u){for(let d=0;d<this.attributes.length;d++){const x=this.attributes[d],w=a.attributes[x.name];w!==void 0&&t.vertexAttribPointer(w,x.components,t[Pd[x.type]],!1,this.itemSize,x.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Oi{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class nc extends Oi{getDefault(){return o.bp.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class rc extends Oi{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class sc extends Oi{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Wu extends Oi{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class La extends Oi{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class il extends Oi{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class wo extends Oi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Wr extends Oi{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Id extends Oi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class Rd extends Oi{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class qu extends Oi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class Fa extends Oi{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class ac extends Oi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class oc extends Oi{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class nl extends Oi{getDefault(){return o.bp.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class lc extends Oi{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Dd extends Oi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class To extends Oi{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class So extends Oi{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Ld extends Oi{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Xu extends Oi{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class _i extends Oi{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class cc extends Oi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class kp extends Oi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Fd extends Oi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class rl extends Oi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Up extends Oi{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Vp extends Oi{getDefault(){return null}set(t){var a;if(t===this.current&&!this.dirty)return;const u=this.gl;jr(u)?u.bindVertexArray(t):(a=u.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class zd extends Oi{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Gp extends Oi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Zu extends Oi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Mo extends Oi{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class sl extends Mo{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class uc extends Mo{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class $u extends Mo{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const Yu="Framebuffer is not complete";class hc{constructor(t,a,u,d,x){this.context=t,this.width=a,this.height=u;const w=t.gl,S=this.framebuffer=w.createFramebuffer();if(this.colorAttachment=new sl(t,S),d)this.depthAttachment=x?new $u(t,S):new uc(t,S);else if(x)throw new Error("Stencil cannot be set without depth");if(w.checkFramebufferStatus(w.FRAMEBUFFER)!==w.FRAMEBUFFER_COMPLETE)throw new Error(Yu)}destroy(){const t=this.context.gl,a=this.colorAttachment.get();if(a&&t.deleteTexture(a),this.depthAttachment){const u=this.depthAttachment.get();u&&t.deleteRenderbuffer(u)}t.deleteFramebuffer(this.framebuffer)}}class dc{constructor(t){var a,u;if(this.gl=t,this.clearColor=new nc(this),this.clearDepth=new rc(this),this.clearStencil=new sc(this),this.colorMask=new Wu(this),this.depthMask=new La(this),this.stencilMask=new il(this),this.stencilFunc=new wo(this),this.stencilOp=new Wr(this),this.stencilTest=new Id(this),this.depthRange=new Rd(this),this.depthTest=new qu(this),this.depthFunc=new Fa(this),this.blend=new ac(this),this.blendFunc=new oc(this),this.blendColor=new nl(this),this.blendEquation=new lc(this),this.cullFace=new Dd(this),this.cullFaceSide=new To(this),this.frontFace=new So(this),this.program=new Ld(this),this.activeTexture=new Xu(this),this.viewport=new _i(this),this.bindFramebuffer=new cc(this),this.bindRenderbuffer=new kp(this),this.bindTexture=new Fd(this),this.bindVertexBuffer=new rl(this),this.bindElementBuffer=new Up(this),this.bindVertexArray=new Vp(this),this.pixelStoreUnpack=new zd(this),this.pixelStoreUnpackPremultiplyAlpha=new Gp(this),this.pixelStoreUnpackFlipY=new Zu(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),jr(t)){this.HALF_FLOAT=t.HALF_FLOAT;const d=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=t.RGBA16F)!==null&&a!==void 0?a:d?.RGBA16F_EXT,this.RGB16F=(u=t.RGB16F)!==null&&u!==void 0?u:d?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const d=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=d?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a){return new Np(this,t,a)}createVertexBuffer(t,a,u){return new Bp(this,t,a,u)}createRenderbuffer(t,a,u){const d=this.gl,x=d.createRenderbuffer();return this.bindRenderbuffer.set(x),d.renderbufferStorage(d.RENDERBUFFER,t,a,u),this.bindRenderbuffer.set(null),x}createFramebuffer(t,a,u,d){return new hc(this,t,a,u,d)}clear({color:t,depth:a,stencil:u}){const d=this.gl;let x=0;t&&(x|=d.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(x|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),u!==void 0&&(x|=d.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),d.clear(x)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){o.bR(t.blendFunction,Zi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return jr(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var a;return jr(this.gl)?this.gl.deleteVertexArray(t):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let Js;function za(y,t,a,u,d){const x=y.context,w=y.transform,S=x.gl,A=y.useProgram("collisionBox"),R=[];let z=0,G=0;for(let ue=0;ue<u.length;ue++){const ye=u[ue],Ae=t.getTile(ye).getBucket(a);if(!Ae)continue;const _e=d?Ae.textCollisionBox:Ae.iconCollisionBox,Ee=Ae.collisionCircleArray;Ee.length>0&&(R.push({circleArray:Ee,circleOffset:G,coord:ye}),z+=Ee.length/4,G=z),_e&&A.draw(x,S.LINES,di.disabled,Pi.disabled,y.colorModeForRenderPass(),Ai.disabled,Ra(y.transform),y.style.map.terrain&&y.style.map.terrain.getTerrainData(ye),w.getProjectionData({overscaledTileID:ye,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),a.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,null,y.transform.zoom,null,null,_e.collisionVertexBuffer)}if(!d||!R.length)return;const V=y.useProgram("collisionCircle"),$=new o.ca;$.resize(4*z),$._trim();let ee=0;for(const ue of R)for(let ye=0;ye<ue.circleArray.length/4;ye++){const Ae=4*ye,_e=ue.circleArray[Ae+0],Ee=ue.circleArray[Ae+1],Pe=ue.circleArray[Ae+2],we=ue.circleArray[Ae+3];$.emplace(ee++,_e,Ee,Pe,we,0),$.emplace(ee++,_e,Ee,Pe,we,1),$.emplace(ee++,_e,Ee,Pe,we,2),$.emplace(ee++,_e,Ee,Pe,we,3)}(!Js||Js.length<2*z)&&(Js=(function(ue){const ye=2*ue,Ae=new o.cc;Ae.resize(ye),Ae._trim();for(let _e=0;_e<ye;_e++){const Ee=6*_e;Ae.uint16[Ee+0]=4*_e+0,Ae.uint16[Ee+1]=4*_e+1,Ae.uint16[Ee+2]=4*_e+2,Ae.uint16[Ee+3]=4*_e+2,Ae.uint16[Ee+4]=4*_e+3,Ae.uint16[Ee+5]=4*_e+0}return Ae})(z));const ce=x.createIndexBuffer(Js,!0),he=x.createVertexBuffer($,o.cb.members,!0);for(const ue of R){const ye=Td(y.transform);V.draw(x,S.TRIANGLES,di.disabled,Pi.disabled,y.colorModeForRenderPass(),Ai.disabled,ye,y.style.map.terrain&&y.style.map.terrain.getTerrainData(ue.coord),null,a.id,he,ce,o.aX.simpleSegment(0,2*ue.circleOffset,ue.circleArray.length,ue.circleArray.length/2),null,y.transform.zoom,null,null,null)}he.destroy(),ce.destroy()}const Ku=o.ar(new Float32Array(16));function Hp(y,t,a,u,d,x){const{horizontalAlign:w,verticalAlign:S}=o.aS(y);return new o.P((-(w-.5)*t/d+u[0])*x,(-(S-.5)*a/d+u[1])*x)}function al(y,t,a,u,d,x){const w=t.tileAnchorPoint.add(new o.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let S=u.mult(x);a||(S=S.rotate(-d));const A=w.add(S);return li(A.x,A.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(a){const S=Ge(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(y),A=Math.atan(S.y/S.x)+(S.x<0?Math.PI:0);return y.add(u.rotate(A))}return y.add(u)}function jp(y,t,a,u,d,x,w,S,A,R,z,G){const V=y.text.placedSymbolArray,$=y.text.dynamicLayoutVertexArray,ee=y.icon.dynamicLayoutVertexArray,ce={};$.clear();for(let he=0;he<V.length;he++){const ue=V.get(he),ye=ue.hidden||!ue.crossTileID||y.allowVerticalPlacement&&!ue.placedOrientation?null:u[ue.crossTileID];if(ye){const Ae=new o.P(ue.anchorX,ue.anchorY),_e={getElevation:G,width:d.width,height:d.height,pitchedLabelPlaneMatrix:x,pitchWithMap:a,transform:d,tileAnchorPoint:Ae,translation:R,unwrappedTileID:z},Ee=a?Pt(Ae.x,Ae.y,_e):Ge(Ae.x,Ae.y,_e),Pe=wa(d.cameraToCenterDistance,Ee.signedDistanceFromCamera);let we=o.aA(y.textSizeData,S,ue)*Pe/o.aM;a&&(we*=y.tilePixelRatio/w);const{width:Be,height:Ye,anchor:je,textOffset:Xe,textBoxScale:Ze}=ye,bt=Hp(je,Be,Ye,Xe,Ze,we),wt=d.getPitchedTextCorrection(Ae.x+R[0],Ae.y+R[1],z),dt=al(Ee.point,_e,t,bt,-d.bearingInRadians,wt),Mt=y.allowVerticalPlacement&&ue.placedOrientation===o.az.vertical?Math.PI/2:0;for(let ai=0;ai<ue.numGlyphs;ai++)o.aG($,dt,Mt);A&&ue.associatedIconIndex>=0&&(ce[ue.associatedIconIndex]={shiftedAnchor:dt,angle:Mt})}else Jt(ue.numGlyphs,$)}if(A){ee.clear();const he=y.icon.placedSymbolArray;for(let ue=0;ue<he.length;ue++){const ye=he.get(ue);if(ye.hidden)Jt(ye.numGlyphs,ee);else{const Ae=ce[ue];if(Ae)for(let _e=0;_e<ye.numGlyphs;_e++)o.aG(ee,Ae.shiftedAnchor,Ae.angle);else Jt(ye.numGlyphs,ee)}}y.icon.dynamicLayoutVertexBuffer.updateData(ee)}y.text.dynamicLayoutVertexBuffer.updateData($)}function Od(y,t,a){return a.iconsInText&&t?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function ol(y,t,a,u,d,x,w,S,A,R,z,G,V){const $=y.context,ee=$.gl,ce=y.transform,he=S==="map",ue=A==="map",ye=S!=="viewport"&&a.layout.get("symbol-placement")!=="point",Ae=he&&!ue&&!ye,_e=!a.layout.get("symbol-sort-key").isConstant();let Ee=!1;const Pe=y.getDepthModeForSublayer(0,di.ReadOnly),we=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Be=[],Ye=ce.getCircleRadiusCorrection();for(const je of u){const Xe=t.getTile(je),Ze=Xe.getBucket(a);if(!Ze)continue;const bt=d?Ze.text:Ze.icon;if(!bt||!bt.segments.get().length||!bt.hasVisibleVertices)continue;const wt=bt.programConfigurations.get(a.id),dt=d||Ze.sdfIcons,Mt=d?Ze.textSizeData:Ze.iconSizeData,ai=ue||ce.pitch!==0,Vi=y.useProgram(Od(dt,d,Ze),wt),sn=o.ay(Mt,ce.zoom),$i=y.style.map.terrain&&y.style.map.terrain.getTerrainData(je);let un,Yi,yn,hn,jn=[0,0],In=null;if(d)Yi=Xe.glyphAtlasTexture,yn=ee.LINEAR,un=Xe.glyphAtlasTexture.size,Ze.iconsInText&&(jn=Xe.imageAtlasTexture.size,In=Xe.imageAtlasTexture,hn=ai||y.options.rotating||y.options.zooming||Mt.kind==="composite"||Mt.kind==="camera"?ee.LINEAR:ee.NEAREST);else{const Qi=a.layout.get("icon-size").constantOr(0)!==1||Ze.iconsNeedLinear;Yi=Xe.imageAtlasTexture,yn=dt||y.options.rotating||y.options.zooming||Qi||ai?ee.LINEAR:ee.NEAREST,un=Xe.imageAtlasTexture.size}const En=o.aN(Xe,1,y.transform.zoom),Qn=Vn(he,y.transform,En),na=o.N();o.aB(na,Qn);const Ls=ba(ue,he,y.transform,En),vs=o.aO(ce,Xe,x,w),Ar=ce.getProjectionData({overscaledTileID:je,applyGlobeMatrix:!V,applyTerrainMatrix:!0}),Va=we&&Ze.hasTextData(),Al=a.layout.get("icon-text-fit")!=="none"&&Va&&Ze.hasIconData();if(ye){const Qi=y.style.map.terrain?(Bn,kn)=>y.style.map.terrain.getElevation(je,Bn,kn):null,Ki=a.layout.get("text-rotation-alignment")==="map";lo(Ze,y,d,Qn,na,ue,R,Ki,je.toUnwrapped(),ce.width,ce.height,vs,Qi)}const Ga=d&&we||Al,Zr=ye||Ga?Ku:ue?Qn:y.transform.clipSpaceToPixelsMatrix,bs=dt&&a.paint.get(d?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ls;ls=dt?Ze.iconsInText?Da(Mt.kind,sn,Ae,ue,ye,Ga,y,Zr,Ls,vs,un,jn,Ye):ic(Mt.kind,sn,Ae,ue,ye,Ga,y,Zr,Ls,vs,d,un,0,Ye):Hu(Mt.kind,sn,Ae,ue,ye,Ga,y,Zr,Ls,vs,d,un,Ye);const cs={program:Vi,buffers:bt,uniformValues:ls,projectionData:Ar,atlasTexture:Yi,atlasTextureIcon:In,atlasInterpolation:yn,atlasInterpolationIcon:hn,isSDF:dt,hasHalo:bs};if(_e&&Ze.canOverlap){Ee=!0;const Qi=bt.segments.get();for(const Ki of Qi)Be.push({segments:new o.aX([Ki]),sortKey:Ki.sortKey,state:cs,terrainData:$i})}else Be.push({segments:bt.segments,sortKey:0,state:cs,terrainData:$i})}Ee&&Be.sort(((je,Xe)=>je.sortKey-Xe.sortKey));for(const je of Be){const Xe=je.state;if($.activeTexture.set(ee.TEXTURE0),Xe.atlasTexture.bind(Xe.atlasInterpolation,ee.CLAMP_TO_EDGE),Xe.atlasTextureIcon&&($.activeTexture.set(ee.TEXTURE1),Xe.atlasTextureIcon&&Xe.atlasTextureIcon.bind(Xe.atlasInterpolationIcon,ee.CLAMP_TO_EDGE)),Xe.isSDF){const Ze=Xe.uniformValues;Xe.hasHalo&&(Ze.u_is_halo=1,fc(Xe.buffers,je.segments,a,y,Xe.program,Pe,z,G,Ze,Xe.projectionData,je.terrainData)),Ze.u_is_halo=0}fc(Xe.buffers,je.segments,a,y,Xe.program,Pe,z,G,Xe.uniformValues,Xe.projectionData,je.terrainData)}}function fc(y,t,a,u,d,x,w,S,A,R,z){const G=u.context;d.draw(G,G.gl.TRIANGLES,x,w,S,Ai.backCCW,A,z,R,a.id,y.layoutVertexBuffer,y.indexBuffer,t,a.paint,u.transform.zoom,y.programConfigurations.get(a.id),y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer)}function Nd(y,t,a,u,d){const x=y.context,w=x.gl,S=Pi.disabled,A=new Zi([w.ONE,w.ONE],o.bp.transparent,[!0,!0,!0,!0]),R=t.getBucket(a);if(!R)return;const z=u.key;let G=a.heatmapFbos.get(z);G||(G=ll(x,t.tileSize,t.tileSize),a.heatmapFbos.set(z,G)),x.bindFramebuffer.set(G.framebuffer),x.viewport.set([0,0,t.tileSize,t.tileSize]),x.clear({color:o.bp.transparent});const V=R.programConfigurations.get(a.id),$=y.useProgram("heatmap",V,!d),ee=y.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ce=y.style.map.terrain.getTerrainData(u);$.draw(x,w.TRIANGLES,di.disabled,S,A,Ai.disabled,bo(t,y.transform.zoom,a.paint.get("heatmap-intensity"),1),ce,ee,a.id,R.layoutVertexBuffer,R.indexBuffer,R.segments,a.paint,y.transform.zoom,V)}function Bd(y,t,a,u,d){const x=y.context,w=x.gl,S=y.transform;x.setColorMode(y.colorModeForRenderPass());const A=pc(x,t),R=a.key,z=t.heatmapFbos.get(R);if(!z)return;x.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,z.colorAttachment.get()),x.activeTexture.set(w.TEXTURE1),A.bind(w.LINEAR,w.CLAMP_TO_EDGE);const G=S.getProjectionData({overscaledTileID:a,applyTerrainMatrix:d,applyGlobeMatrix:!u});y.useProgram("heatmapTexture").draw(x,w.TRIANGLES,di.disabled,Pi.disabled,y.colorModeForRenderPass(),Ai.disabled,Sd(y,t,0,1),null,G,t.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments,t.paint,S.zoom),z.destroy(),t.heatmapFbos.delete(R)}function ll(y,t,a){var u,d;const x=y.gl,w=x.createTexture();x.bindTexture(x.TEXTURE_2D,w),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,x.LINEAR),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,x.LINEAR);const S=(u=y.HALF_FLOAT)!==null&&u!==void 0?u:x.UNSIGNED_BYTE,A=(d=y.RGBA16F)!==null&&d!==void 0?d:x.RGBA;x.texImage2D(x.TEXTURE_2D,0,A,t,a,0,x.RGBA,S,null);const R=y.createFramebuffer(t,a,!1,!1);return R.colorAttachment.set(w),R}function pc(y,t){return t.colorRampTexture||(t.colorRampTexture=new o.T(y,t.colorRamp,y.gl.RGBA)),t.colorRampTexture}function kd(y,t,a,u,d,x,w,S){let A=256;if(d.stepInterpolant){const R=t.getSource().maxzoom,z=w.canonical.z===R?Math.ceil(1<<y.transform.maxZoom-w.canonical.z):1;A=o.an(o.ce(x.maxLineLength/o.a5*1024*z),256,a.maxTextureSize)}return S.gradient=o.cf({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:A,image:S.gradient||void 0,clips:x.lineClipsArray}),S.texture?S.texture.update(S.gradient):S.texture=new o.T(a,S.gradient,u.RGBA),S.version=d.gradientVersion,S.texture}function Ud(y,t,a,u,d){y.activeTexture.set(t.TEXTURE0),a.imageAtlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE),u.updatePaintBuffers(d)}function Sn(y,t,a,u,d,x){(d||y.lineAtlas.dirty)&&(t.activeTexture.set(a.TEXTURE0),y.lineAtlas.bind(t)),u.updatePaintBuffers(x)}function Oa(y,t,a,u,d,x,w){const S=x.gradients[d.id];let A=S.texture;d.gradientVersion!==S.version&&(A=kd(y,t,a,u,d,x,w,S)),a.activeTexture.set(u.TEXTURE0),A.bind(d.stepInterpolant?u.NEAREST:u.LINEAR,u.CLAMP_TO_EDGE)}function zr(y,t,a,u,d,x,w,S,A){const R=x.gradients[d.id];let z=R.texture;d.gradientVersion!==R.version&&(z=kd(y,t,a,u,d,x,w,R)),a.activeTexture.set(u.TEXTURE0),z.bind(d.stepInterpolant?u.NEAREST:u.LINEAR,u.CLAMP_TO_EDGE),a.activeTexture.set(u.TEXTURE1),y.lineAtlas.bind(a),S.updatePaintBuffers(A)}function mc(y,t,a,u,d){if(!a||!u||!u.imageAtlas)return;const x=u.imageAtlas.patternPositions;let w=x[a.to.toString()],S=x[a.from.toString()];if(!w&&S&&(w=S),!S&&w&&(S=w),!w||!S){const A=d.getPaintProperty(t);w=x[A],S=x[A]}w&&S&&y.setConstantPatternPositions(w,S)}function cl(y,t,a,u,d,x,w,S){const A=y.context.gl,R="fill-pattern",z=a.paint.get(R),G=z&&z.constantOr(1),V=a.getCrossfadeParameters();let $,ee,ce,he,ue;const ye=y.transform,Ae=a.paint.get("fill-translate"),_e=a.paint.get("fill-translate-anchor");w?(ee=G&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",$=A.LINES):(ee=G?"fillPattern":"fill",$=A.TRIANGLES);const Ee=z.constantOr(null);for(const Pe of u){const we=t.getTile(Pe);if(G&&!we.patternsLoaded())continue;const Be=we.getBucket(a);if(!Be)continue;const Ye=Be.programConfigurations.get(a.id),je=y.useProgram(ee,Ye),Xe=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Pe);G&&(y.context.activeTexture.set(A.TEXTURE0),we.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),Ye.updatePaintBuffers(V)),mc(Ye,R,Ee,we,a);const Ze=ye.getProjectionData({overscaledTileID:Pe,applyGlobeMatrix:!S,applyTerrainMatrix:!0}),bt=o.aO(ye,we,Ae,_e);if(w){he=Be.indexBuffer2,ue=Be.segments2;const dt=[A.drawingBufferWidth,A.drawingBufferHeight];ce=ee==="fillOutlinePattern"&&G?bd(y,V,we,dt,bt):vd(dt,bt)}else he=Be.indexBuffer,ue=Be.segments,ce=G?Bu(y,V,we,bt):{u_fill_translate:bt};const wt=y.stencilModeForClipping(Pe);je.draw(y.context,$,d,wt,x,Ai.backCCW,ce,Xe,Ze,a.id,Be.layoutVertexBuffer,he,ue,a.paint,y.transform.zoom,Ye)}}function gc(y,t,a,u,d,x,w,S){const A=y.context,R=A.gl,z="fill-extrusion-pattern",G=a.paint.get(z),V=G.constantOr(1),$=a.getCrossfadeParameters(),ee=a.paint.get("fill-extrusion-opacity"),ce=G.constantOr(null),he=y.transform;for(const ue of u){const ye=t.getTile(ue),Ae=ye.getBucket(a);if(!Ae)continue;const _e=y.style.map.terrain&&y.style.map.terrain.getTerrainData(ue),Ee=Ae.programConfigurations.get(a.id),Pe=y.useProgram(V?"fillExtrusionPattern":"fillExtrusion",Ee);V&&(y.context.activeTexture.set(R.TEXTURE0),ye.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),Ee.updatePaintBuffers($));const we=he.getProjectionData({overscaledTileID:ue,applyGlobeMatrix:!S,applyTerrainMatrix:!0});mc(Ee,z,ce,ye,a);const Be=o.aO(he,ye,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Ye=a.paint.get("fill-extrusion-vertical-gradient"),je=V?Nu(y,Ye,ee,Be,ue,$,ye):Ou(y,Ye,ee,Be);Pe.draw(A,A.gl.TRIANGLES,d,x,w,Ai.backCCW,je,_e,we,a.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,a.paint,y.transform.zoom,Ee,y.style.map.terrain&&Ae.centroidVertexBuffer)}}function Qs(y,t,a,u,d,x,w,S,A){var R;const z=y.style.projection,G=y.context,V=y.transform,$=G.gl,ee=[`#define NUM_ILLUMINATION_SOURCES ${a.paint.get("hillshade-highlight-color").values.length}`],ce=y.useProgram("hillshade",null,!1,ee),he=!y.options.moving;for(const ue of u){const ye=t.getTile(ue),Ae=ye.fbo;if(!Ae)continue;const _e=z.getMeshFromTileID(G,ue.canonical,S,!0,"raster"),Ee=(R=y.style.map.terrain)===null||R===void 0?void 0:R.getTerrainData(ue);G.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,Ae.colorAttachment.get());const Pe=V.getProjectionData({overscaledTileID:ue,aligned:he,applyGlobeMatrix:!A,applyTerrainMatrix:!0});ce.draw(G,$.TRIANGLES,x,d[ue.overscaledZ],w,Ai.backCCW,Ql(y,ye,a),Ee,Pe,a.id,_e.vertexBuffer,_e.indexBuffer,_e.segments)}}function ul(y,t,a,u,d,x,w,S,A){var R;const z=y.style.projection,G=y.context,V=y.transform,$=G.gl,ee=y.useProgram("colorRelief"),ce=!y.options.moving;let he=!0,ue=0;for(const ye of u){const Ae=t.getTile(ye),_e=Ae.dem;if(he){const je=$.getParameter($.MAX_TEXTURE_SIZE),{elevationTexture:Xe,colorTexture:Ze}=a.getColorRampTextures(G,je,_e.getUnpackVector());G.activeTexture.set($.TEXTURE1),Xe.bind($.NEAREST,$.CLAMP_TO_EDGE),G.activeTexture.set($.TEXTURE4),Ze.bind($.LINEAR,$.CLAMP_TO_EDGE),he=!1,ue=Xe.size[0]}if(!_e||!_e.data)continue;const Ee=_e.stride,Pe=_e.getPixels();if(G.activeTexture.set($.TEXTURE0),G.pixelStoreUnpackPremultiplyAlpha.set(!1),Ae.demTexture=Ae.demTexture||y.getTileTexture(Ee),Ae.demTexture){const je=Ae.demTexture;je.update(Pe,{premultiply:!1}),je.bind($.LINEAR,$.CLAMP_TO_EDGE)}else Ae.demTexture=new o.T(G,Pe,$.RGBA,{premultiply:!1}),Ae.demTexture.bind($.LINEAR,$.CLAMP_TO_EDGE);const we=z.getMeshFromTileID(G,ye.canonical,S,!0,"raster"),Be=(R=y.style.map.terrain)===null||R===void 0?void 0:R.getTerrainData(ye),Ye=V.getProjectionData({overscaledTileID:ye,aligned:ce,applyGlobeMatrix:!A,applyTerrainMatrix:!0});ee.draw(G,$.TRIANGLES,x,d[ye.overscaledZ],w,Ai.backCCW,Md(a,Ae.dem,ue),Be,Ye,a.id,we.vertexBuffer,we.indexBuffer,we.segments)}}const Na=[new o.P(0,0),new o.P(o.a5,0),new o.P(o.a5,o.a5),new o.P(0,o.a5)];function Eo(y,t,a,u,d,x,w,S,A=!1,R=!1){const z=u[u.length-1].overscaledZ,G=y.context,V=G.gl,$=y.useProgram("raster"),ee=y.transform,ce=y.style.projection,he=y.colorModeForRenderPass(),ue=!y.options.moving,ye=a.paint.get("raster-opacity"),Ae=a.paint.get("raster-resampling"),_e=a.paint.get("raster-fade-duration"),Ee=!!y.style.map.terrain;for(const Pe of u){const we=y.getDepthModeForSublayer(Pe.overscaledZ-z,ye===1?di.ReadWrite:di.ReadOnly,V.LESS),Be=t.getTile(Pe),Ye=Ae==="nearest"?V.NEAREST:V.LINEAR;G.activeTexture.set(V.TEXTURE0),Be.texture.bind(Ye,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST),G.activeTexture.set(V.TEXTURE1);const{parentTile:je,parentScaleBy:Xe,parentTopLeft:Ze,fadeValues:bt}=Vd(Be,t,_e,Ee);Be.fadeOpacity=bt.tileOpacity,je?(je.fadeOpacity=bt.parentTileOpacity,je.texture.bind(Ye,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST)):Be.texture.bind(Ye,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST),Be.texture.useMipmap&&G.extTextureFilterAnisotropic&&y.transform.pitch>20&&V.texParameterf(V.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax);const wt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Pe),dt=ee.getProjectionData({overscaledTileID:Pe,aligned:ue,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),Mt=Vu(Ze,Xe,bt.fadeMix,a,S),ai=ce.getMeshFromTileID(G,Pe.canonical,x,w,"raster");$.draw(G,V.TRIANGLES,we,d?d[Pe.overscaledZ]:Pi.disabled,he,A?Ai.frontCCW:Ai.backCCW,Mt,wt,dt,a.id,ai.vertexBuffer,ai.indexBuffer,ai.segments)}}function Vd(y,t,a,u){const d={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(a===0||u)return d;if(y.fadingParentID){const x=t.getLoadedTile(y.fadingParentID);if(!x)return d;const w=Math.pow(2,x.tileID.overscaledZ-y.tileID.overscaledZ),S=[y.tileID.canonical.x*w%1,y.tileID.canonical.y*w%1],A=(function(R,z,G){const V=J(),$=(V-z.timeAdded)/G,ee=R.fadingDirection===ae.Incoming,ce=o.an((V-R.timeAdded)/G,0,1),he=o.an(1-$,0,1),ue=ee?ce:he;return{tileOpacity:ue,parentTileOpacity:ee?he:ce,fadeMix:{opacity:1,mix:1-ue}}})(y,x,a);return{parentTile:x,parentScaleBy:w,parentTopLeft:S,fadeValues:A}}if(y.selfFading){const x=(function(w,S){const A=(J()-w.timeAdded)/S,R=o.an(A,0,1);return{tileOpacity:R,fadeMix:{opacity:R,mix:0}}})(y,a);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:x}}return d}const Gd=new o.bp(1,0,0,1),Hd=new o.bp(0,1,0,1),jd=new o.bp(0,0,1,1),Wd=new o.bp(1,0,1,1),ea=new o.bp(0,1,1,1);function Ju(y,t,a,u){hl(y,0,t+a/2,y.transform.width,a,u)}function Qu(y,t,a,u){hl(y,t-a/2,0,a,y.transform.height,u)}function hl(y,t,a,u,d,x){const w=y.context,S=w.gl;S.enable(S.SCISSOR_TEST),S.scissor(t*y.pixelRatio,a*y.pixelRatio,u*y.pixelRatio,d*y.pixelRatio),w.clear({color:x}),S.disable(S.SCISSOR_TEST)}function qd(y,t,a){const u=y.context,d=u.gl,x=y.useProgram("debug"),w=di.disabled,S=Pi.disabled,A=y.colorModeForRenderPass(),R="$debug",z=y.style.map.terrain&&y.style.map.terrain.getTerrainData(a);u.activeTexture.set(d.TEXTURE0);const G=t.getTileByID(a.key).latestRawTileData,V=Math.floor((G&&G.byteLength||0)/1024),$=t.getTile(a).tileSize,ee=512/Math.min($,512)*(a.overscaledZ/y.transform.zoom)*.5;let ce=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(ce+=` => ${a.overscaledZ}`),(function(ue,ye){ue.initDebugOverlayCanvas();const Ae=ue.debugOverlayCanvas,_e=ue.context.gl,Ee=ue.debugOverlayCanvas.getContext("2d");Ee.clearRect(0,0,Ae.width,Ae.height),Ee.shadowColor="white",Ee.shadowBlur=2,Ee.lineWidth=1.5,Ee.strokeStyle="white",Ee.textBaseline="top",Ee.font="bold 36px Open Sans, sans-serif",Ee.fillText(ye,5,5),Ee.strokeText(ye,5,5),ue.debugOverlayTexture.update(Ae),ue.debugOverlayTexture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE)})(y,`${ce} ${V}kB`);const he=y.transform.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!0,applyTerrainMatrix:!0});x.draw(u,d.TRIANGLES,w,S,Zi.alphaBlended,Ai.disabled,ku(o.bp.transparent,ee),null,he,R,y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),x.draw(u,d.LINE_STRIP,w,S,A,Ai.disabled,ku(o.bp.red),z,he,R,y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}function eh(y,t,a,u){const{isRenderingGlobe:d}=u,x=y.context,w=x.gl,S=y.transform,A=y.colorModeForRenderPass(),R=y.getDepthModeFor3D(),z=y.useProgram("terrain");x.bindFramebuffer.set(null),x.viewport.set([0,0,y.width,y.height]);for(const G of a){const V=t.getTerrainMesh(G.tileID),$=y.renderToTexture.getTexture(G),ee=t.getTerrainData(G.tileID);x.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,$.texture);const ce=t.getMeshFrameDelta(S.zoom),he=S.calculateFogMatrix(G.tileID.toUnwrapped()),ue=Dp(ce,he,y.style.sky,S.pitch,d),ye=S.getProjectionData({overscaledTileID:G.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});z.draw(x,w.TRIANGLES,R,Pi.disabled,A,Ai.backCCW,ue,ee,ye,"terrain",V.vertexBuffer,V.indexBuffer,V.segments)}}function th(y,t){if(!t.mesh){const a=new o.aW;a.emplaceBack(-1,-1),a.emplaceBack(1,-1),a.emplaceBack(1,1),a.emplaceBack(-1,1);const u=new o.aY;u.emplaceBack(0,1,2),u.emplaceBack(0,2,3),t.mesh=new Xi(y.createVertexBuffer(a,$s.members),y.createIndexBuffer(u),o.aX.simpleSegment(0,0,a.length,u.length))}return t.mesh}class Xd{constructor(t,a){this.context=new dc(t),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Un.maxOverzooming+Un.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Mr}resize(t,a,u){if(this.width=Math.floor(t*u),this.height=Math.floor(a*u),this.pixelRatio=u,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style._order)this.style._layers[d].resize()}setup(){const t=this.context,a=new o.aW;a.emplaceBack(0,0),a.emplaceBack(o.a5,0),a.emplaceBack(0,o.a5),a.emplaceBack(o.a5,o.a5),this.tileExtentBuffer=t.createVertexBuffer(a,$s.members),this.tileExtentSegments=o.aX.simpleSegment(0,0,4,2);const u=new o.aW;u.emplaceBack(0,0),u.emplaceBack(o.a5,0),u.emplaceBack(0,o.a5),u.emplaceBack(o.a5,o.a5),this.debugBuffer=t.createVertexBuffer(u,$s.members),this.debugSegments=o.aX.simpleSegment(0,0,4,5);const d=new o.ch;d.emplaceBack(0,0,0,0),d.emplaceBack(o.a5,0,o.a5,0),d.emplaceBack(0,o.a5,0,o.a5),d.emplaceBack(o.a5,o.a5,o.a5,o.a5),this.rasterBoundsBuffer=t.createVertexBuffer(d,Rp.members),this.rasterBoundsSegments=o.aX.simpleSegment(0,0,4,2);const x=new o.aW;x.emplaceBack(0,0),x.emplaceBack(o.a5,0),x.emplaceBack(0,o.a5),x.emplaceBack(o.a5,o.a5),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(x,$s.members),this.rasterBoundsSegmentsPosOnly=o.aX.simpleSegment(0,0,4,5);const w=new o.aW;w.emplaceBack(0,0),w.emplaceBack(1,0),w.emplaceBack(0,1),w.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(w,$s.members),this.viewportSegments=o.aX.simpleSegment(0,0,4,2);const S=new o.ci;S.emplaceBack(0),S.emplaceBack(1),S.emplaceBack(3),S.emplaceBack(2),S.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(S);const A=new o.aY;A.emplaceBack(1,0,2),A.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(A);const R=this.context.gl;this.stencilClearMode=new Pi({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.tileExtentMesh=new Xi(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,a=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const u=o.N();o.c7(u,0,this.width,this.height,0,0,1),o.Q(u,u,[a.drawingBufferWidth,a.drawingBufferHeight,0]);const d={mainMatrix:u,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:u};this.useProgram("clippingMask",null,!0).draw(t,a.TRIANGLES,di.disabled,this.stencilClearMode,Zi.disabled,Ai.disabled,null,null,d,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,a,u){if(this.currentStencilSource===t.source||!t.isTileClipped()||!a||!a.length)return;this.currentStencilSource=t.source,this.nextStencilID+a.length>256&&this.clearStencil();const d=this.context;d.setColorMode(Zi.disabled),d.setDepthMode(di.disabled);const x={};for(const w of a)x[w.key]=this.nextStencilID++;this._renderTileMasks(x,a,u,!0),this._renderTileMasks(x,a,u,!1),this._tileClippingMaskIDs=x}_renderTileMasks(t,a,u,d){const x=this.context,w=x.gl,S=this.style.projection,A=this.transform,R=this.useProgram("clippingMask");for(const z of a){const G=t[z.key],V=this.style.map.terrain&&this.style.map.terrain.getTerrainData(z),$=S.getMeshFromTileID(this.context,z.canonical,d,!0,"stencil"),ee=A.getProjectionData({overscaledTileID:z,applyGlobeMatrix:!u,applyTerrainMatrix:!0});R.draw(x,w.TRIANGLES,di.disabled,new Pi({func:w.ALWAYS,mask:0},G,255,w.KEEP,w.KEEP,w.REPLACE),Zi.disabled,u?Ai.disabled:Ai.backCCW,null,V,ee,"$clipping",$.vertexBuffer,$.indexBuffer,$.segments)}}_renderTilesDepthBuffer(){const t=this.context,a=t.gl,u=this.style.projection,d=this.transform,x=this.useProgram("depth"),w=this.getDepthModeFor3D(),S=Di(d,{tileSize:d.tileSize});for(const A of S){const R=this.style.map.terrain&&this.style.map.terrain.getTerrainData(A),z=u.getMeshFromTileID(this.context,A.canonical,!0,!0,"raster"),G=d.getProjectionData({overscaledTileID:A,applyGlobeMatrix:!0,applyTerrainMatrix:!0});x.draw(t,a.TRIANGLES,w,Pi.disabled,Zi.disabled,Ai.backCCW,null,R,G,"$clipping",z.vertexBuffer,z.indexBuffer,z.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new Pi({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){const a=this.context.gl;return new Pi({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const a=this.context.gl,u=t.sort(((w,S)=>S.overscaledZ-w.overscaledZ)),d=u[u.length-1].overscaledZ,x=u[0].overscaledZ-d+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const w={};for(let S=0;S<x;S++)w[S+d]=new Pi({func:a.GEQUAL,mask:255},S+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=x,[w,u]}return[{[d]:Pi.disabled},u]}stencilConfigForOverlapTwoPass(t){const a=this.context.gl,u=t.sort(((w,S)=>S.overscaledZ-w.overscaledZ)),d=u[u.length-1].overscaledZ,x=u[0].overscaledZ-d+1;if(this.clearStencil(),x>1){const w={},S={};for(let A=0;A<x;A++)w[A+d]=new Pi({func:a.GREATER,mask:255},x+1+A,255,a.KEEP,a.KEEP,a.REPLACE),S[A+d]=new Pi({func:a.GREATER,mask:255},1+A,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID=2*x+1,[w,S,u]}return this.nextStencilID=3,[{[d]:new Pi({func:a.GREATER,mask:255},2,255,a.KEEP,a.KEEP,a.REPLACE)},{[d]:new Pi({func:a.GREATER,mask:255},1,255,a.KEEP,a.KEEP,a.REPLACE)},u]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Zi([t.CONSTANT_COLOR,t.ONE],new o.bp(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Zi.unblended:Zi.alphaBlended}getDepthModeForSublayer(t,a,u){if(!this.opaquePassEnabledForLayer())return di.disabled;const d=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new di(u||this.context.gl.LEQUAL,a,[d,d])}getDepthModeFor3D(){return new di(this.context.gl.LEQUAL,di.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,a){var u,d;this.style=t,this.options=a,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(J()),this.imageManager.beginFrame();const x=this.style._order,w=this.style.tileManagers,S={},A={},R={},z={isRenderingToTexture:!1,isRenderingGlobe:((u=t.projection)===null||u===void 0?void 0:u.transitionState)>0};for(const V in w){const $=w[V];$.used&&$.prepare(this.context),S[V]=$.getVisibleCoordinates(!1),A[V]=S[V].slice().reverse(),R[V]=$.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let V=0;V<x.length;V++)if(this.style._layers[x[V]].is3D()){this.opaquePassCutoff=V;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const V of x){const $=this.style._layers[V];if(!$.hasOffscreenPass()||$.isHidden(this.transform.zoom))continue;const ee=A[$.source];($.type==="custom"||ee.length)&&this.renderLayer(this,w[$.source],$,ee,z)}if((d=this.style.projection)===null||d===void 0||d.updateGPUdependent({context:this.context,useProgram:V=>this.useProgram(V)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?o.bp.black:o.bp.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(V,$){const ee=V.context,ce=ee.gl,he=((Pe,we,Be)=>{const Ye=Math.cos(we.rollInRadians),je=Math.sin(we.rollInRadians),Xe=Ne(we),Ze=we.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Pe.properties.get("sky-color"),u_horizon_color:Pe.properties.get("horizon-color"),u_horizon:[(we.width/2-Xe*je)*Be,(we.height/2+Xe*Ye)*Be],u_horizon_normal:[-je,Ye],u_sky_horizon_blend:Pe.properties.get("sky-horizon-blend")*we.height/2*Be,u_sky_blend:Ze}})($,V.style.map.transform,V.pixelRatio),ue=new di(ce.LEQUAL,di.ReadWrite,[0,1]),ye=Pi.disabled,Ae=V.colorModeForRenderPass(),_e=V.useProgram("sky"),Ee=th(ee,$);_e.draw(ee,ce.TRIANGLES,ue,ye,Ae,Ai.disabled,he,null,void 0,"sky",Ee.vertexBuffer,Ee.indexBuffer,Ee.segments)})(this,this.style.sky),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){const V=this.style._layers[x[this.currentLayer]],$=w[V.source],ee=S[V.source];this._renderTileClippingMasks(V,ee,!1),this.renderLayer(this,$,V,ee,z)}this.renderPass="translucent";let G=!1;for(this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){const V=this.style._layers[x[this.currentLayer]],$=w[V.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(V,z))continue;this.opaquePassEnabledForLayer()||G||(G=!0,z.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const ee=(V.type==="symbol"?R:A)[V.source];this._renderTileClippingMasks(V,S[V.source],!!this.renderToTexture),this.renderLayer(this,$,V,ee,z)}if(z.isRenderingGlobe&&(function(V,$,ee){const ce=V.context,he=ce.gl,ue=V.useProgram("atmosphere"),ye=new di(he.LEQUAL,di.ReadOnly,[0,1]),Ae=V.transform,_e=(function(Ze,bt){const wt=Ze.properties.get("position"),dt=[-wt.x,-wt.y,-wt.z],Mt=o.ar(new Float64Array(16));return Ze.properties.get("anchor")==="map"&&(o.bg(Mt,Mt,bt.rollInRadians),o.bh(Mt,Mt,-bt.pitchInRadians),o.bg(Mt,Mt,bt.bearingInRadians),o.bh(Mt,Mt,bt.center.lat*Math.PI/180),o.bJ(Mt,Mt,-bt.center.lng*Math.PI/180)),o.cg(dt,dt,Mt),dt})(ee,V.transform),Ee=Ae.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Pe=$.properties.get("atmosphere-blend")*Ee.projectionTransition;if(Pe===0)return;const we=Pa(Ae.worldSize,Ae.center.lat),Be=Ae.inverseProjectionMatrix,Ye=new Float64Array(4);Ye[3]=1,o.aH(Ye,Ye,Ae.modelViewProjectionMatrix),Ye[0]/=Ye[3],Ye[1]/=Ye[3],Ye[2]/=Ye[3],Ye[3]=1,o.aH(Ye,Ye,Be),Ye[0]/=Ye[3],Ye[1]/=Ye[3],Ye[2]/=Ye[3],Ye[3]=1;const je=((Ze,bt,wt,dt,Mt)=>({u_sun_pos:Ze,u_atmosphere_blend:bt,u_globe_position:wt,u_globe_radius:dt,u_inv_proj_matrix:Mt}))(_e,Pe,[Ye[0],Ye[1],Ye[2]],we,Be),Xe=th(ce,$);ue.draw(ce,he.TRIANGLES,ye,Pi.disabled,Zi.alphaBlended,Ai.disabled,je,null,null,"atmosphere",Xe.vertexBuffer,Xe.indexBuffer,Xe.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const V=(function($,ee){let ce=null;const he=Object.values($._layers).flatMap((_e=>_e.source&&!_e.isHidden(ee)?[$.tileManagers[_e.source]]:[])),ue=he.filter((_e=>_e.getSource().type==="vector")),ye=he.filter((_e=>_e.getSource().type!=="vector")),Ae=_e=>{(!ce||ce.getSource().maxzoom<_e.getSource().maxzoom)&&(ce=_e)};return ue.forEach((_e=>Ae(_e))),ce||ye.forEach((_e=>Ae(_e))),ce})(this.style,this.transform.zoom);V&&(function($,ee,ce){for(let he=0;he<ce.length;he++)qd($,ee,ce[he])})(this,V,V.getVisibleCoordinates())}this.options.showPadding&&(function(V){const $=V.transform.padding;Ju(V,V.transform.height-($.top||0),3,Gd),Ju(V,$.bottom||0,3,Hd),Qu(V,$.left||0,3,jd),Qu(V,V.transform.width-($.right||0),3,Wd);const ee=V.transform.centerPoint;(function(ce,he,ue,ye){hl(ce,he-1,ue-10,2,20,ye),hl(ce,he-10,ue-1,20,2,ye)})(V,ee.x,V.transform.height-ee.y,ea)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const a=this.terrainFacilitator.matrix,u=this.transform.modelViewProjectionMatrix;let d=this.terrainFacilitator.dirty;d||(d=t?!o.cj(a,u):!o.ck(a,u)),d||(d=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),d&&(o.cl(a,u),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(x,w){const S=x.context,A=S.gl,R=x.transform,z=Zi.unblended,G=new di(A.LEQUAL,di.ReadWrite,[0,1]),V=w.tileManager.getRenderableTiles(),$=x.useProgram("terrainDepth");S.bindFramebuffer.set(w.getFramebuffer("depth").framebuffer),S.viewport.set([0,0,x.width/devicePixelRatio,x.height/devicePixelRatio]),S.clear({color:o.bp.transparent,depth:1});for(const ee of V){const ce=w.getTerrainMesh(ee.tileID),he=w.getTerrainData(ee.tileID),ue=R.getProjectionData({overscaledTileID:ee.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),ye={u_ele_delta:w.getMeshFrameDelta(R.zoom)};$.draw(S,A.TRIANGLES,G,Pi.disabled,z,Ai.backCCW,ye,he,ue,"terrain",ce.vertexBuffer,ce.indexBuffer,ce.segments)}S.bindFramebuffer.set(null),S.viewport.set([0,0,x.width,x.height])})(this,this.style.map.terrain),(function(x,w){const S=x.context,A=S.gl,R=x.transform,z=Zi.unblended,G=new di(A.LEQUAL,di.ReadWrite,[0,1]),V=w.getCoordsTexture(),$=w.tileManager.getRenderableTiles(),ee=x.useProgram("terrainCoords");S.bindFramebuffer.set(w.getFramebuffer("coords").framebuffer),S.viewport.set([0,0,x.width/devicePixelRatio,x.height/devicePixelRatio]),S.clear({color:o.bp.transparent,depth:1}),w.coordsIndex=[];for(const ce of $){const he=w.getTerrainMesh(ce.tileID),ue=w.getTerrainData(ce.tileID);S.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,V.texture);const ye={u_terrain_coords_id:(255-w.coordsIndex.length)/255,u_texture:0,u_ele_delta:w.getMeshFrameDelta(R.zoom)},Ae=R.getProjectionData({overscaledTileID:ce.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});ee.draw(S,A.TRIANGLES,G,Pi.disabled,z,Ai.backCCW,ye,ue,Ae,"terrain",he.vertexBuffer,he.indexBuffer,he.segments),w.coordsIndex.push(ce.tileID.key)}S.bindFramebuffer.set(null),S.viewport.set([0,0,x.width,x.height])})(this,this.style.map.terrain))}renderLayer(t,a,u,d,x){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="custom"||(d||[]).length)&&(this.id=u.id,o.cm(u)?(function(w,S,A,R,z,G){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:V}=G,$=Pi.disabled,ee=w.colorModeForRenderPass();(A._unevaluatedLayout.hasValue("text-variable-anchor")||A._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(ce,he,ue,ye,Ae,_e,Ee,Pe,we){const Be=he.transform,Ye=he.style.map.terrain,je=Ae==="map",Xe=_e==="map";for(const Ze of ce){const bt=ye.getTile(Ze),wt=bt.getBucket(ue);if(!wt||!wt.text||!wt.text.segments.get().length)continue;const dt=o.ay(wt.textSizeData,Be.zoom),Mt=o.aN(bt,1,he.transform.zoom),ai=Vn(je,he.transform,Mt),Vi=ue.layout.get("icon-text-fit")!=="none"&&wt.hasIconData();if(dt){const sn=Math.pow(2,Be.zoom-bt.tileID.overscaledZ),$i=Ye?(un,Yi)=>Ye.getElevation(Ze,un,Yi):null;jp(wt,je,Xe,we,Be,ai,sn,dt,Vi,o.aO(Be,bt,Ee,Pe),Ze.toUnwrapped(),$i)}}})(R,w,A,S,A.layout.get("text-rotation-alignment"),A.layout.get("text-pitch-alignment"),A.paint.get("text-translate"),A.paint.get("text-translate-anchor"),z),A.paint.get("icon-opacity").constantOr(1)!==0&&ol(w,S,A,R,!1,A.paint.get("icon-translate"),A.paint.get("icon-translate-anchor"),A.layout.get("icon-rotation-alignment"),A.layout.get("icon-pitch-alignment"),A.layout.get("icon-keep-upright"),$,ee,V),A.paint.get("text-opacity").constantOr(1)!==0&&ol(w,S,A,R,!0,A.paint.get("text-translate"),A.paint.get("text-translate-anchor"),A.layout.get("text-rotation-alignment"),A.layout.get("text-pitch-alignment"),A.layout.get("text-keep-upright"),$,ee,V),S.map.showCollisionBoxes&&(za(w,S,A,R,!0),za(w,S,A,R,!1))})(t,a,u,d,this.style.placement.variableOffsets,x):o.cn(u)?(function(w,S,A,R,z){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:G}=z,V=A.paint.get("circle-opacity"),$=A.paint.get("circle-stroke-width"),ee=A.paint.get("circle-stroke-opacity"),ce=!A.layout.get("circle-sort-key").isConstant();if(V.constantOr(1)===0&&($.constantOr(1)===0||ee.constantOr(1)===0))return;const he=w.context,ue=he.gl,ye=w.transform,Ae=w.getDepthModeForSublayer(0,di.ReadOnly),_e=Pi.disabled,Ee=w.colorModeForRenderPass(),Pe=[],we=ye.getCircleRadiusCorrection();for(let Be=0;Be<R.length;Be++){const Ye=R[Be],je=S.getTile(Ye),Xe=je.getBucket(A);if(!Xe)continue;const Ze=A.paint.get("circle-translate"),bt=A.paint.get("circle-translate-anchor"),wt=o.aO(ye,je,Ze,bt),dt=Xe.programConfigurations.get(A.id),Mt=w.useProgram("circle",dt),ai=Xe.layoutVertexBuffer,Vi=Xe.indexBuffer,sn=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ye),$i={programConfiguration:dt,program:Mt,layoutVertexBuffer:ai,indexBuffer:Vi,uniformValues:wd(w,je,A,wt,we),terrainData:sn,projectionData:ye.getProjectionData({overscaledTileID:Ye,applyGlobeMatrix:!G,applyTerrainMatrix:!0})};if(ce){const un=Xe.segments.get();for(const Yi of un)Pe.push({segments:new o.aX([Yi]),sortKey:Yi.sortKey,state:$i})}else Pe.push({segments:Xe.segments,sortKey:0,state:$i})}ce&&Pe.sort(((Be,Ye)=>Be.sortKey-Ye.sortKey));for(const Be of Pe){const{programConfiguration:Ye,program:je,layoutVertexBuffer:Xe,indexBuffer:Ze,uniformValues:bt,terrainData:wt,projectionData:dt}=Be.state;je.draw(he,ue.TRIANGLES,Ae,_e,Ee,Ai.backCCW,bt,wt,dt,A.id,Xe,Ze,Be.segments,A.paint,w.transform.zoom,Ye)}})(t,a,u,d,x):o.co(u)?(function(w,S,A,R,z){if(A.paint.get("heatmap-opacity")===0)return;const G=w.context,{isRenderingToTexture:V,isRenderingGlobe:$}=z;if(w.style.map.terrain){for(const ee of R){const ce=S.getTile(ee);S.hasRenderableParent(ee)||(w.renderPass==="offscreen"?Nd(w,ce,A,ee,$):w.renderPass==="translucent"&&Bd(w,A,ee,V,$))}G.viewport.set([0,0,w.width,w.height])}else w.renderPass==="offscreen"?(function(ee,ce,he,ue){const ye=ee.context,Ae=ye.gl,_e=ee.transform,Ee=Pi.disabled,Pe=new Zi([Ae.ONE,Ae.ONE],o.bp.transparent,[!0,!0,!0,!0]);(function(we,Be,Ye){const je=we.gl;we.activeTexture.set(je.TEXTURE1),we.viewport.set([0,0,Be.width/4,Be.height/4]);let Xe=Ye.heatmapFbos.get(o.cd);Xe?(je.bindTexture(je.TEXTURE_2D,Xe.colorAttachment.get()),we.bindFramebuffer.set(Xe.framebuffer)):(Xe=ll(we,Be.width/4,Be.height/4),Ye.heatmapFbos.set(o.cd,Xe))})(ye,ee,he),ye.clear({color:o.bp.transparent});for(let we=0;we<ue.length;we++){const Be=ue[we];if(ce.hasRenderableParent(Be))continue;const Ye=ce.getTile(Be),je=Ye.getBucket(he);if(!je)continue;const Xe=je.programConfigurations.get(he.id),Ze=ee.useProgram("heatmap",Xe),bt=_e.getProjectionData({overscaledTileID:Be,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),wt=_e.getCircleRadiusCorrection();Ze.draw(ye,Ae.TRIANGLES,di.disabled,Ee,Pe,Ai.backCCW,bo(Ye,_e.zoom,he.paint.get("heatmap-intensity"),wt),null,bt,he.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,he.paint,_e.zoom,Xe)}ye.viewport.set([0,0,ee.width,ee.height])})(w,S,A,R):w.renderPass==="translucent"&&(function(ee,ce){const he=ee.context,ue=he.gl;he.setColorMode(ee.colorModeForRenderPass());const ye=ce.heatmapFbos.get(o.cd);ye&&(he.activeTexture.set(ue.TEXTURE0),ue.bindTexture(ue.TEXTURE_2D,ye.colorAttachment.get()),he.activeTexture.set(ue.TEXTURE1),pc(he,ce).bind(ue.LINEAR,ue.CLAMP_TO_EDGE),ee.useProgram("heatmapTexture").draw(he,ue.TRIANGLES,di.disabled,Pi.disabled,ee.colorModeForRenderPass(),Ai.disabled,Sd(ee,ce,0,1),null,null,ce.id,ee.viewportBuffer,ee.quadTriangleIndexBuffer,ee.viewportSegments,ce.paint,ee.transform.zoom))})(w,A)})(t,a,u,d,x):o.cp(u)?(function(w,S,A,R,z){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:G}=z,V=A.paint.get("line-opacity"),$=A.paint.get("line-width");if(V.constantOr(1)===0||$.constantOr(1)===0)return;const ee=w.getDepthModeForSublayer(0,di.ReadOnly),ce=w.colorModeForRenderPass(),he=A.paint.get("line-dasharray"),ue=he.constantOr(1),ye=A.paint.get("line-pattern"),Ae=ye.constantOr(1),_e=A.paint.get("line-gradient"),Ee=A.getCrossfadeParameters();let Pe;Pe=Ae?"linePattern":ue&&_e?"lineGradientSDF":ue?"lineSDF":_e?"lineGradient":"line";const we=w.context,Be=we.gl,Ye=w.transform;let je=!0;for(const Xe of R){const Ze=S.getTile(Xe);if(Ae&&!Ze.patternsLoaded())continue;const bt=Ze.getBucket(A);if(!bt)continue;const wt=bt.programConfigurations.get(A.id),dt=w.context.program.get(),Mt=w.useProgram(Pe,wt),ai=je||Mt.program!==dt,Vi=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Xe),sn=ye.constantOr(null),$i=he&&he.constantOr(null);if(sn&&Ze.imageAtlas){const jn=Ze.imageAtlas,In=jn.patternPositions[sn.to.toString()],En=jn.patternPositions[sn.from.toString()];In&&En&&wt.setConstantPatternPositions(In,En)}else if($i){const jn=A.layout.get("line-cap")==="round",In=w.lineAtlas.getDash($i.to,jn),En=w.lineAtlas.getDash($i.from,jn);wt.setConstantDashPositions(In,En)}const un=Ye.getProjectionData({overscaledTileID:Xe,applyGlobeMatrix:!G,applyTerrainMatrix:!0}),Yi=Ye.getPixelScale();let yn;Ae?(yn=Uu(w,Ze,A,Yi,Ee),Ud(we,Be,Ze,wt,Ee)):ue&&_e?(yn=ec(w,Ze,A,Yi,Ee,bt.lineClipsArray.length),zr(w,S,we,Be,A,bt,Xe,wt,Ee)):ue?(yn=Ad(w,Ze,A,Yi,Ee),Sn(w,we,Be,wt,ai,Ee)):_e?(yn=Ed(w,Ze,A,Yi,bt.lineClipsArray.length),Oa(w,S,we,Be,A,bt,Xe)):yn=tl(w,Ze,A,Yi);const hn=w.stencilModeForClipping(Xe);Mt.draw(we,Be.TRIANGLES,ee,hn,ce,Ai.disabled,yn,Vi,un,A.id,bt.layoutVertexBuffer,bt.indexBuffer,bt.segments,A.paint,w.transform.zoom,wt,bt.layoutVertexBuffer2),je=!1}})(t,a,u,d,x):o.cq(u)?(function(w,S,A,R,z){const G=A.paint.get("fill-color"),V=A.paint.get("fill-opacity");if(V.constantOr(1)===0)return;const{isRenderingToTexture:$}=z,ee=w.colorModeForRenderPass(),ce=A.paint.get("fill-pattern"),he=w.opaquePassEnabledForLayer()&&!ce.constantOr(1)&&G.constantOr(o.bp.transparent).a===1&&V.constantOr(0)===1?"opaque":"translucent";if(w.renderPass===he){const ue=w.getDepthModeForSublayer(1,w.renderPass==="opaque"?di.ReadWrite:di.ReadOnly);cl(w,S,A,R,ue,ee,!1,$)}if(w.renderPass==="translucent"&&A.paint.get("fill-antialias")){const ue=w.getDepthModeForSublayer(A.getPaintProperty("fill-outline-color")?2:0,di.ReadOnly);cl(w,S,A,R,ue,ee,!0,$)}})(t,a,u,d,x):o.cr(u)?(function(w,S,A,R,z){const G=A.paint.get("fill-extrusion-opacity");if(G===0)return;const{isRenderingToTexture:V}=z;if(w.renderPass==="translucent"){const $=new di(w.context.gl.LEQUAL,di.ReadWrite,w.depthRangeFor3D);if(G!==1||A.paint.get("fill-extrusion-pattern").constantOr(1))gc(w,S,A,R,$,Pi.disabled,Zi.disabled,V),gc(w,S,A,R,$,w.stencilModeFor3D(),w.colorModeForRenderPass(),V);else{const ee=w.colorModeForRenderPass();gc(w,S,A,R,$,Pi.disabled,ee,V)}}})(t,a,u,d,x):o.cs(u)?(function(w,S,A,R,z){if(w.renderPass!=="offscreen"&&w.renderPass!=="translucent")return;const{isRenderingToTexture:G}=z,V=w.context,$=w.style.projection.useSubdivision,ee=w.getDepthModeForSublayer(0,di.ReadOnly),ce=w.colorModeForRenderPass();if(w.renderPass==="offscreen")(function(he,ue,ye,Ae,_e,Ee,Pe){const we=he.context,Be=we.gl;for(const Ye of ye){const je=ue.getTile(Ye),Xe=je.dem;if(!Xe||!Xe.data||!je.needsHillshadePrepare)continue;const Ze=Xe.dim,bt=Xe.stride,wt=Xe.getPixels();if(we.activeTexture.set(Be.TEXTURE1),we.pixelStoreUnpackPremultiplyAlpha.set(!1),je.demTexture=je.demTexture||he.getTileTexture(bt),je.demTexture){const Mt=je.demTexture;Mt.update(wt,{premultiply:!1}),Mt.bind(Be.NEAREST,Be.CLAMP_TO_EDGE)}else je.demTexture=new o.T(we,wt,Be.RGBA,{premultiply:!1}),je.demTexture.bind(Be.NEAREST,Be.CLAMP_TO_EDGE);we.activeTexture.set(Be.TEXTURE0);let dt=je.fbo;if(!dt){const Mt=new o.T(we,{width:Ze,height:Ze,data:null},Be.RGBA);Mt.bind(Be.LINEAR,Be.CLAMP_TO_EDGE),dt=je.fbo=we.createFramebuffer(Ze,Ze,!0,!1),dt.colorAttachment.set(Mt.texture)}we.bindFramebuffer.set(dt.framebuffer),we.viewport.set([0,0,Ze,Ze]),he.useProgram("hillshadePrepare").draw(we,Be.TRIANGLES,_e,Ee,Pe,Ai.disabled,Lp(je.tileID,Xe),null,null,Ae.id,he.rasterBoundsBuffer,he.quadTriangleIndexBuffer,he.rasterBoundsSegments),je.needsHillshadePrepare=!1}})(w,S,R,A,ee,Pi.disabled,ce),V.viewport.set([0,0,w.width,w.height]);else if(w.renderPass==="translucent")if($){const[he,ue,ye]=w.stencilConfigForOverlapTwoPass(R);Qs(w,S,A,ye,he,ee,ce,!1,G),Qs(w,S,A,ye,ue,ee,ce,!0,G)}else{const[he,ue]=w.getStencilConfigForOverlapAndUpdateStencilID(R);Qs(w,S,A,ue,he,ee,ce,!1,G)}})(t,a,u,d,x):o.ct(u)?(function(w,S,A,R,z){if(w.renderPass!=="translucent"||!R.length)return;const{isRenderingToTexture:G}=z,V=w.style.projection.useSubdivision,$=w.getDepthModeForSublayer(0,di.ReadOnly),ee=w.colorModeForRenderPass();if(V){const[ce,he,ue]=w.stencilConfigForOverlapTwoPass(R);ul(w,S,A,ue,ce,$,ee,!1,G),ul(w,S,A,ue,he,$,ee,!0,G)}else{const[ce,he]=w.getStencilConfigForOverlapAndUpdateStencilID(R);ul(w,S,A,he,ce,$,ee,!1,G)}})(t,a,u,d,x):o.bU(u)?(function(w,S,A,R,z){if(w.renderPass!=="translucent"||A.paint.get("raster-opacity")===0||!R.length)return;const{isRenderingToTexture:G}=z,V=S.getSource(),$=w.style.projection.useSubdivision;if(V instanceof ke)Eo(w,S,A,R,null,!1,!1,V.tileCoords,V.flippedWindingOrder,G);else if($){const[ee,ce,he]=w.stencilConfigForOverlapTwoPass(R);Eo(w,S,A,he,ee,!1,!0,Na,!1,G),Eo(w,S,A,he,ce,!0,!0,Na,!1,G)}else{const[ee,ce]=w.getStencilConfigForOverlapAndUpdateStencilID(R);Eo(w,S,A,ce,ee,!1,!0,Na,!1,G)}})(t,a,u,d,x):o.cu(u)?(function(w,S,A,R,z){const G=A.paint.get("background-color"),V=A.paint.get("background-opacity");if(V===0)return;const{isRenderingToTexture:$}=z,ee=w.context,ce=ee.gl,he=w.style.projection,ue=w.transform,ye=ue.tileSize,Ae=A.paint.get("background-pattern");if(w.isPatternMissing(Ae))return;const _e=!Ae&&G.a===1&&V===1&&w.opaquePassEnabledForLayer()?"opaque":"translucent";if(w.renderPass!==_e)return;const Ee=Pi.disabled,Pe=w.getDepthModeForSublayer(0,_e==="opaque"?di.ReadWrite:di.ReadOnly),we=w.colorModeForRenderPass(),Be=w.useProgram(Ae?"backgroundPattern":"background"),Ye=R||Di(ue,{tileSize:ye,terrain:w.style.map.terrain});Ae&&(ee.activeTexture.set(ce.TEXTURE0),w.imageManager.bind(w.context));const je=A.getCrossfadeParameters();for(const Xe of Ye){const Ze=ue.getProjectionData({overscaledTileID:Xe,applyGlobeMatrix:!$,applyTerrainMatrix:!0}),bt=Ae?zp(V,w,Ae,{tileID:Xe,tileSize:ye},je):ju(V,G),wt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Xe),dt=he.getMeshFromTileID(ee,Xe.canonical,!1,!0,"raster");Be.draw(ee,ce.TRIANGLES,Pe,Ee,we,Ai.backCCW,bt,wt,Ze,A.id,dt.vertexBuffer,dt.indexBuffer,dt.segments)}})(t,0,u,d,x):o.cv(u)&&(function(w,S,A,R){const{isRenderingGlobe:z}=R,G=w.context,V=A.implementation,$=w.style.projection,ee=w.transform,ce=ee.getProjectionDataForCustomLayer(z),he={farZ:ee.farZ,nearZ:ee.nearZ,fov:ee.fov*Math.PI/180,modelViewProjectionMatrix:ee.modelViewProjectionMatrix,projectionMatrix:ee.projectionMatrix,shaderData:{variantName:$.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${$.shaderPreludeCode.vertexSource}`,define:$.shaderDefine},defaultProjectionData:ce},ue=V.renderingMode?V.renderingMode:"2d";if(w.renderPass==="offscreen"){const ye=V.prerender;ye&&(w.setCustomLayerDefaults(),G.setColorMode(w.colorModeForRenderPass()),ye.call(V,G.gl,he),G.setDirty(),w.setBaseState())}else if(w.renderPass==="translucent"){w.setCustomLayerDefaults(),G.setColorMode(w.colorModeForRenderPass()),G.setStencilMode(Pi.disabled);const ye=ue==="3d"?w.getDepthModeFor3D():w.getDepthModeForSublayer(0,di.ReadOnly);G.setDepthMode(ye),V.render(G.gl,he),G.setDirty(),w.setBaseState(),G.bindFramebuffer.set(null)}})(t,0,u,x))}saveTileTexture(t){const a=this._tileTextures[t.size[0]];a?a.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const a=this.imageManager.getPattern(t.from.toString()),u=this.imageManager.getPattern(t.to.toString());return!a||!u}useProgram(t,a,u=!1,d=[]){this.cache=this.cache||{};const x=!!this.style.map.terrain,w=this.style.projection,S=u?pn.projectionMercator:w.shaderPreludeCode,A=u?gr:w.shaderDefine,R=t+(a?a.cacheKey:"")+`/${u?Fr:w.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(x?"/terrain":"")+(d?`/${d.join("/")}`:"");return this.cache[R]||(this.cache[R]=new yd(this.context,pn[t],a,Op[t],this._showOverdrawInspector,x,S,A,d)),this.cache[R]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var t,a;if(this._tileTextures){for(const u in this._tileTextures){const d=this._tileTextures[u];if(d)for(const x of d)x.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((t=this.tileExtentMesh.vertexBuffer)===null||t===void 0||t.destroy()),this.tileExtentMesh&&((a=this.tileExtentMesh.indexBuffer)===null||a===void 0||a.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const u in this.cache){const d=this.cache[u];d&&d.program&&this.context.gl.deleteProgram(d.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:a}=this.context.gl;return this.width!==t||this.height!==a}}function ih(y,t){let a,u=!1,d=null,x=null;const w=()=>{d=null,u&&(y.apply(x,a),d=setTimeout(w,t),u=!1)};return(...S)=>(u=!0,x=this,a=S,d||w(),d)}class nh{constructor(t){this._getCurrentHash=()=>{const a=window.location.hash.replace("#","");if(this._hashName){let u;return a.split("&").map((d=>d.split("="))).forEach((d=>{d[0]===this._hashName&&(u=d)})),(u&&u[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{const a=this._getCurrentHash();if(!this._isValidHash(a))return!1;const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:u,pitch:+(a[4]||0)}),!0},this._updateHashUnthrottled=()=>{const a=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,a)},this._removeHash=()=>{const a=this._getCurrentHash();if(a.length===0)return;const u=a.join("/");let d=u;d.split("&").length>0&&(d=d.split("&")[0]),this._hashName&&(d=`${this._hashName}=${u}`);let x=window.location.hash.replace(d,"");x.startsWith("#&")?x=x.slice(0,1)+x.slice(2):x==="#"&&(x="");let w=window.location.href.replace(/(#.+)?$/,x);w=w.replace("&&","&"),window.history.replaceState(window.history.state,null,w)},this._updateHash=ih(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const a=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,d=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,d),w=Math.round(a.lng*x)/x,S=Math.round(a.lat*x)/x,A=this._map.getBearing(),R=this._map.getPitch();let z="";if(z+=t?`/${w}/${S}/${u}`:`${u}/${S}/${w}`,(A||R)&&(z+="/"+Math.round(10*A)/10),R&&(z+=`/${Math.round(R)}`),this._hashName){const G=this._hashName;let V=!1;const $=window.location.hash.slice(1).split("&").map((ee=>{const ce=ee.split("=")[0];return ce===G?(V=!0,`${ce}=${z}`):ee})).filter((ee=>ee));return V||$.push(`${G}=${z}`),`#${$.join("&")}`}return`#${z}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new o.V(+t[2],+t[1])}catch{return!1}const a=+t[0],u=+(t[3]||0),d=+(t[4]||0);return a>=this._map.getMinZoom()&&a<=this._map.getMaxZoom()&&u>=-180&&u<=180&&d>=this._map.getMinPitch()&&d<=this._map.getMaxPitch()}}const ta={linearity:.3,easing:o.cw(0,0,.3,1)},Zd=o.e({deceleration:2500,maxSpeed:1400},ta),qr=o.e({deceleration:20,maxSpeed:1400},ta),rs=o.e({deceleration:1e3,maxSpeed:360},ta),$d=o.e({deceleration:1e3,maxSpeed:90},ta),ss=o.e({deceleration:1e3,maxSpeed:360},ta);class Wp{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:J(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=J();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,roll:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)a.zoom+=x.zoomDelta||0,a.bearing+=x.bearingDelta||0,a.pitch+=x.pitchDelta||0,a.roll+=x.rollDelta||0,x.panDelta&&a.pan._add(x.panDelta),x.around&&(a.around=x.around),x.pinchAround&&(a.pinchAround=x.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,d={};if(a.pan.mag()){const x=fl(a.pan.mag(),u,o.e({},Zd,t||{})),w=a.pan.mult(x.amount/a.pan.mag()),S=this._map.cameraHelper.handlePanInertia(w,this._map.transform);d.center=S.easingCenter,d.offset=S.easingOffset,dl(d,x)}if(a.zoom){const x=fl(a.zoom,u,qr),w=o.cx(this._map.transform.zoom+x.amount,this._map.getZoomSnap(),x.amount);d.zoom=w,dl(d,x)}if(a.bearing){const x=fl(a.bearing,u,rs);d.bearing=this._map.transform.bearing+o.an(x.amount,-179,179),dl(d,x)}if(a.pitch){const x=fl(a.pitch,u,$d);d.pitch=this._map.transform.pitch+x.amount,dl(d,x)}if(a.roll){const x=fl(a.roll,u,ss);d.roll=this._map.transform.roll+o.an(x.amount,-179,179),dl(d,x)}if(d.zoom||d.bearing){const x=a.pinchAround===void 0?a.around:a.pinchAround;d.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),o.e(d,{noMoveStart:!0})}}function dl(y,t){(!y.duration||y.duration<t.duration)&&(y.duration=t.duration,y.easing=t.easing)}function fl(y,t,a){const{maxSpeed:u,linearity:d,deceleration:x}=a,w=o.an(y*d/(t/1e3),-u,u),S=Math.abs(w)/(x*d);return{easing:a.easing,duration:1e3*S,amount:w*(S/2)}}class Hn extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,u,d={}){u=u instanceof MouseEvent?u:new MouseEvent(t,u);const x=N.mousePos(a.getCanvas(),u),w=a.unproject(x);super(t,o.e({point:x,lngLat:w,originalEvent:u},d)),this._defaultPrevented=!1,this.target=a}}class pl extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,u){const d=t==="touchend"?u.changedTouches:u.touches,x=N.touchPos(a.getCanvasContainer(),d),w=x.map((A=>a.unproject(A))),S=x.reduce(((A,R,z,G)=>A.add(R.div(G.length))),new o.P(0,0));super(t,{points:x,point:S,lngLats:w,lngLat:a.unproject(S),originalEvent:u}),this._defaultPrevented=!1}}class Yd extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,u){super(t,{originalEvent:u}),this._defaultPrevented=!1}}class qp{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Yd(t.type,this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new Hn(t.type,this._map,t))}mouseup(t){this._map.fire(new Hn(t.type,this._map,t))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new Hn(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Hn(t.type,this._map,t))}mouseover(t){this._map.fire(new Hn(t.type,this._map,t))}mouseout(t){this._map.fire(new Hn(t.type,this._map,t))}touchstart(t){return this._firePreventable(new pl(t.type,this._map,t))}touchmove(t){this._map.fire(new pl(t.type,this._map,t))}touchend(t){this._map.fire(new pl(t.type,this._map,t))}touchcancel(t){this._map.fire(new pl(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Xp{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Hn(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Hn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Hn(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ao{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(o.P.convert(t),this._map.terrain)}}class Co{constructor(t,a){this._map=t,this._tr=new Ao(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(N.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const u=a;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;const d=this._startPos;this._lastPos=u,this._box||(this._box=N.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const x=Math.min(d.x,u.x),w=Math.max(d.x,u.x),S=Math.min(d.y,u.y),A=Math.max(d.y,u.y);N.setTransform(this._box,`translate(${x}px,${S}px)`),this._box.style.width=w-x+"px",this._box.style.height=A-S+"px"}mouseupWindow(t,a){if(!this._active||t.button!==0)return;const u=this._startPos,d=a;if(this.reset(),N.suppressClick(),u.x!==d.x||u.y!==d.y)return this._map.fire(new o.l("boxzoomend",{originalEvent:t})),{cameraAnimation:x=>x.fitScreenCoordinates(u,d,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(N.remove(this._box),this._box=null),N.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new o.l(t,{originalEvent:a}))}}function as(y,t){if(y.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${y.length}, points ${t.length}`);const a={};for(let u=0;u<y.length;u++)a[y[u].identifier]=t[u];return a}class Ft{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,a,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),u.length===this.numTouches&&(this.centroid=(function(d){const x=new o.P(0,0);for(const w of d)x._add(w);return x.div(d.length)})(a),this.touches=as(u,a)))}touchmove(t,a,u){if(this.aborted||!this.centroid)return;const d=as(u,a);for(const x in this.touches){const w=d[x];(!w||w.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(t,a,u){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const d=!this.aborted&&this.centroid;if(this.reset(),d)return d}}}class _c{constructor(t){this.singleTap=new Ft(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,a,u){this.singleTap.touchstart(t,a,u)}touchmove(t,a,u){this.singleTap.touchmove(t,a,u)}touchend(t,a,u){const d=this.singleTap.touchend(t,a,u);if(d){const x=t.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(d)<30;if(x&&w||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}}}class rh{constructor(t){this._tr=new Ao(t),this._zoomIn=new _c({numTouches:1,numTaps:2}),this._zoomOut=new _c({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,u){this._zoomIn.touchstart(t,a,u),this._zoomOut.touchstart(t,a,u)}touchmove(t,a,u){this._zoomIn.touchmove(t,a,u),this._zoomOut.touchmove(t,a,u)}touchend(t,a,u){const d=this._zoomIn.touchend(t,a,u),x=this._zoomOut.touchend(t,a,u),w=this._tr;return d?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:o.cx(w.zoom+1,S.getZoomSnap()),around:w.unproject(d)},{originalEvent:t})}):x?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:o.cx(w.zoom-1,S.getZoomSnap()),around:w.unproject(x)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Po{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const a=this._moveFunction(...t);if(a.bearingDelta||a.pitchDelta||a.rollDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(t,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(a)?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,a){if(!this.isEnabled())return;const u=this._lastPoint;if(!u)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const d=Array.isArray(a)?a[0]:a;return!this._moved&&d.dist(u)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=d,this._move(u,d))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&N.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const ml=0,gl=2,sh={[ml]:1,[gl]:2};class _l{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const a=N.mouseButton(t);this._eventButton=a}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!(function(a,u){const d=sh[u];return a.buttons===void 0||(a.buttons&d)!==d})(t,this._eventButton)}isValidEndEvent(t){return N.mouseButton(t)===this._eventButton}}class ah{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class Kd{constructor(t=new _l({checkCorrectEvent:()=>!0}),a=new ah){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=a}_executeRelevantHandler(t,a,u){return t instanceof MouseEvent?a(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?u(t):void 0}startMove(t){this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.startMove(a)),(a=>this.oneFingerTouchMoveStateManager.startMove(a)))}endMove(t){this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.endMove(a)),(a=>this.oneFingerTouchMoveStateManager.endMove(a)))}isValidStartEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidStartEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidStartEvent(a)))}isValidMoveEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidMoveEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(a)))}isValidEndEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidEndEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidEndEvent(a)))}}const Io=y=>{y.mousedown=y.dragStart,y.mousemoveWindow=y.dragMove,y.mouseup=y.dragEnd,y.contextmenu=t=>{t.preventDefault()}};class Zp{constructor(t,a){this._clickTolerance=t.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,a,u){return this._calculateTransform(t,a,u)}touchmove(t,a,u){if(this._active){if(!this._shouldBePrevented(u.length))return t.preventDefault(),this._calculateTransform(t,a,u);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,a,u){this._calculateTransform(t,a,u),this._active&&this._shouldBePrevented(u.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,u){u.length>0&&(this._active=!0);const d=as(u,a),x=new o.P(0,0),w=new o.P(0,0);let S=0;for(const R in d){const z=d[R],G=this._touches[R];G&&(x._add(z),w._add(z.sub(G)),S++,d[R]=z)}if(this._touches=d,this._shouldBePrevented(S)||!w.mag())return;const A=w.div(S);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(S),panDelta:A}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yc{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,a,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,u){if(!this._firstTwoTouches)return;t.preventDefault();const[d,x]=this._firstTwoTouches,w=xc(u,a,d),S=xc(u,a,x);if(!w||!S)return;const A=this._aroundCenter?null:w.add(S).div(2);return this._move([w,S],A,t)}touchend(t,a,u){if(!this._firstTwoTouches)return;const[d,x]=this._firstTwoTouches,w=xc(u,a,d),S=xc(u,a,x);w&&S||(this._active&&N.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function xc(y,t,a){for(let u=0;u<y.length;u++)if(y[u].identifier===a)return t[u]}function Jd(y,t){return Math.log(y/t)/Math.LN2}class oh extends yc{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const u=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Jd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Jd(this._distance,u),pinchAround:a}}}function Qd(y,t){return 180*y.angleWith(t)/Math.PI}class lh extends yc{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a,u){const d=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Qd(this._vector,d),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,u=Qd(t,this._startVector);return Math.abs(u)<a}}function ch(y){return Math.abs(y.y)>Math.abs(y.x)}class ef extends yc{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,a,u){super.touchstart(t,a,u),this._currentTouchCount=u.length}_start(t){this._lastPoints=t,ch(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,u){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const d=t[0].sub(this._lastPoints[0]),x=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(d,x,u.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(d.y+x.y)/2*-.5}):void 0}gestureBeginsVertically(t,a,u){if(this._valid!==void 0)return this._valid;const d=t.mag()>=2,x=a.mag()>=2;if(!d&&!x)return;if(!d||!x)return this._firstMove===void 0&&(this._firstMove=u),u-this._firstMove<100&&void 0;const w=t.y>0==a.y>0;return ch(t)&&ch(a)&&w}}const ia={panStep:100,bearingStep:15,pitchStep:10};class ji{constructor(t){this._tr=new Ao(t);const a=ia;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,u=0,d=0,x=0,w=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?u=-1:(t.preventDefault(),x=-1);break;case 39:t.shiftKey?u=1:(t.preventDefault(),x=1);break;case 38:t.shiftKey?d=1:(t.preventDefault(),w=-1);break;case 40:t.shiftKey?d=-1:(t.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(u=0,d=0),{cameraAnimation:S=>{const A=this._tr;S.easeTo({duration:300,easeId:"keyboardHandler",easing:$p,zoom:a?o.cx(A.zoom+a*(t.shiftKey?2:1),S.getZoomSnap()):A.zoom,bearing:A.bearing+u*this._bearingStep,pitch:A.pitch+d*this._pitchStep,offset:[-x*this._panStep,-w*this._panStep],center:A.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function $p(y){return y*(2-y)}const yl=4.000244140625,vc=1/450;class bc{constructor(t,a){this._onTimeout=u=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)},this._map=t,this._tr=new Ao(t),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=vc}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let a=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const u=J(),d=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,a!==0&&a%yl==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(d*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=N.mousePos(this._map.getCanvas(),t),u=this._tr;this._aroundPoint=this._aroundCenter?u.transform.locationToScreenPoint(o.V.convert(u.center)):a,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const S=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=S),typeof this._targetZoom=="number"&&(this._targetZoom+=S)}if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>yl?this._wheelZoomRate:this._defaultZoomRate;let A=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&A!==0&&(A=1/A);const R=typeof this._targetZoom!="number"?t.scale:o.aq(this._targetZoom),z=t.applyConstrain(t.getCameraLngLat(),o.at(R*A)).zoom,G=this._map.getZoomSnap();if(this._type==="wheel"&&G>0){const V=o.cx(t.zoom,G);this._targetZoom=o.cx(z,G,z-V)}else this._targetZoom=z;this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,u=this._startZoom,d=this._easing;let x,w=!1;if(this._type==="wheel"&&u&&d){const S=J()-this._lastWheelEventTime,A=Math.min((S+5)/200,1),R=d(A);x=o.G.number(u,a,R),A<1?this._frameId||(this._frameId=!0):w=!0}else x=a,w=!0;return this._active=!0,w&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=x,{noInertia:!0,needsRenderFrame:!w,zoomDelta:x-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=o.cz;if(this._prevEase){const u=this._prevEase,d=(J()-u.start)/u.duration,x=u.easing(d+.01)-u.easing(d),w=.27/Math.sqrt(x*x+1e-4)*.01,S=Math.sqrt(.0729-w*w);a=o.cw(w,S,.25,1)}return this._prevEase={start:J(),duration:t,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class uh{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class tf{constructor(t){this._tr=new Ao(t),this.reset()}reset(){this._active=!1}dblclick(t,a){return t.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:o.cx(this._tr.zoom+(t.shiftKey?-1:1),u.getZoomSnap()),around:this._tr.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class nf{constructor(){this._tap=new _c({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,a,u){if(!this._swipePoint)if(this._tapTime){const d=a[0],x=t.timeStamp-this._tapTime<500,w=this._tapPoint.dist(d)<30;x&&w?u.length>0&&(this._swipePoint=d,this._swipeTouch=u[0].identifier):this.reset()}else this._tap.touchstart(t,a,u)}touchmove(t,a,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const d=a[0],x=d.y-this._swipePoint.y;return this._swipePoint=d,t.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(t,a,u)}touchend(t,a,u){if(this._tapTime)this._swipePoint&&u.length===0&&this.reset();else{const d=this._tap.touchend(t,a,u);d&&(this._tapTime=t.timeStamp,this._tapPoint=d)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class rf{constructor(t,a,u){this._el=t,this._mousePan=a,this._touchPan=u}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class os{constructor(t,a,u,d){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=a,this._mousePitch=u,this._mouseRoll=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class xl{constructor(t,a,u,d){this._el=t,this._touchZoom=a,this._touchRotate=u,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Ht{constructor(t,a){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=a,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=N.create("div","maplibregl-cooperative-gesture-screen",t);let a=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(a=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const u=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),d=document.createElement("div");d.className="maplibregl-desktop-message",d.textContent=a,this._container.appendChild(d);const x=document.createElement("div");x.className="maplibregl-mobile-message",x.textContent=u,this._container.appendChild(x),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(N.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,a){this._enabled&&(this._map.fire(new o.l("cooperativegestureprevented",{gestureType:t,originalEvent:a})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const Zt=y=>y.zoom||y.drag||y.roll||y.pitch||y.rotate;class vl extends o.l{}function wc(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta||y.rollDelta}class Tc{get _ownerDocument(){var t;return((t=this._el)===null||t===void 0?void 0:t.ownerDocument)||document}get _ownerWindow(){var t,a;return((a=(t=this._el)===null||t===void 0?void 0:t.ownerDocument)===null||a===void 0?void 0:a.defaultView)||window}constructor(t,a){this.handleWindowEvent=d=>{this.handleEvent(d,`${d.type}Window`)},this.handleEvent=(d,x)=>{if(d.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const w=d.type==="renderFrame"?void 0:d,S={needsRenderFrame:!1},A={},R={};for(const{handlerName:V,handler:$,allowed:ee}of this._handlers){if(!$.isEnabled())continue;let ce;if(this._blockedByActive(R,ee,V))$.reset();else if($[x||d.type]){if(o.cA(d,x||d.type)){const he=N.mousePos(this._map.getCanvas(),d);ce=$[x||d.type](d,he)}else if(o.cB(d,x||d.type)){const he=this._getMapTouches(d.touches),ue=N.touchPos(this._map.getCanvas(),he);ce=$[x||d.type](d,ue,he)}else o.cC(x||d.type)||(ce=$[x||d.type](d));this.mergeHandlerResult(S,A,ce,V,w),ce&&ce.needsRenderFrame&&this._triggerRenderFrame()}(ce||$.isActive())&&(R[V]=$)}const z={};for(const V in this._previousActiveHandlers)R[V]||(z[V]=w);this._previousActiveHandlers=R,(Object.keys(z).length||wc(S))&&(this._changes.push([S,A,z]),this._triggerRenderFrame()),(Object.keys(R).length||wc(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:G}=S;G&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],G(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Wp(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[this._ownerDocument,"mousemove",{capture:!0}],[this._ownerDocument,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[this._ownerWindow,"blur",void 0]];for(const[d,x,w]of this._listeners)N.addEventListener(d,x,d===this._ownerDocument?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[t,a,u]of this._listeners)N.removeEventListener(t,a,t===this._ownerDocument?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(t){const a=this._map,u=a.getCanvasContainer();this._add("mapEvent",new qp(a,t));const d=a.boxZoom=new Co(a,t);this._add("boxZoom",d),t.interactive&&t.boxZoom&&d.enable();const x=a.cooperativeGestures=new Ht(a,t.cooperativeGestures);this._add("cooperativeGestures",x),t.cooperativeGestures&&x.enable();const w=new rh(a),S=new tf(a);a.doubleClickZoom=new uh(S,w),this._add("tapZoom",w),this._add("clickZoom",S),t.interactive&&t.doubleClickZoom&&a.doubleClickZoom.enable();const A=new nf;this._add("tapDragZoom",A);const R=a.touchPitch=new ef(a);this._add("touchPitch",R),t.interactive&&t.touchPitch&&a.touchPitch.enable(t.touchPitch);const z=()=>a.project(a.getCenter()),G=(function({enable:_e,clickTolerance:Ee,aroundCenter:Pe=!0,minPixelCenterThreshold:we=100,rotateDegreesPerPixelMoved:Be=.8},Ye){const je=new _l({checkCorrectEvent:Xe=>N.mouseButton(Xe)===0&&Xe.ctrlKey||N.mouseButton(Xe)===2&&!Xe.ctrlKey});return new Po({clickTolerance:Ee,move:(Xe,Ze)=>{const bt=Ye();if(Pe&&Math.abs(bt.y-Xe.y)>we)return{bearingDelta:o.cy(new o.P(Xe.x,Ze.y),Ze,bt)};let wt=(Ze.x-Xe.x)*Be;return Pe&&Ze.y<bt.y&&(wt=-wt),{bearingDelta:wt}},moveStateManager:je,enable:_e,assignEvents:Io})})(t,z),V=(function({enable:_e,clickTolerance:Ee,pitchDegreesPerPixelMoved:Pe=-.5}){const we=new _l({checkCorrectEvent:Be=>N.mouseButton(Be)===0&&Be.ctrlKey||N.mouseButton(Be)===2});return new Po({clickTolerance:Ee,move:(Be,Ye)=>({pitchDelta:(Ye.y-Be.y)*Pe}),moveStateManager:we,enable:_e,assignEvents:Io})})(t),$=(function({enable:_e,clickTolerance:Ee,rollDegreesPerPixelMoved:Pe=.3},we){const Be=new _l({checkCorrectEvent:Ye=>N.mouseButton(Ye)===2&&Ye.ctrlKey});return new Po({clickTolerance:Ee,move:(Ye,je)=>{const Xe=we();let Ze=(je.x-Ye.x)*Pe;return je.y<Xe.y&&(Ze=-Ze),{rollDelta:Ze}},moveStateManager:Be,enable:_e,assignEvents:Io})})(t,z);a.dragRotate=new os(t,G,V,$),this._add("mouseRotate",G,["mousePitch"]),this._add("mousePitch",V,["mouseRotate","mouseRoll"]),this._add("mouseRoll",$,["mousePitch"]),t.interactive&&t.dragRotate&&a.dragRotate.enable();const ee=(function({enable:_e,clickTolerance:Ee}){const Pe=new _l({checkCorrectEvent:we=>N.mouseButton(we)===0&&!we.ctrlKey});return new Po({clickTolerance:Ee,move:(we,Be)=>({around:Be,panDelta:Be.sub(we)}),activateOnStart:!0,moveStateManager:Pe,enable:_e,assignEvents:Io})})(t),ce=new Zp(t,a);a.dragPan=new rf(u,ee,ce),this._add("mousePan",ee),this._add("touchPan",ce,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&a.dragPan.enable(t.dragPan);const he=new lh,ue=new oh;a.touchZoomRotate=new xl(u,ue,he,A),this._add("touchRotate",he,["touchPan","touchZoom"]),this._add("touchZoom",ue,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&a.touchZoomRotate.enable(t.touchZoomRotate),this._add("blockableMapEvent",new Xp(a));const ye=a.scrollZoom=new bc(a,(()=>this._triggerRenderFrame()));this._add("scrollZoom",ye,["mousePan"]),t.interactive&&t.scrollZoom&&a.scrollZoom.enable(t.scrollZoom);const Ae=a.keyboard=new ji(a);this._add("keyboard",Ae),t.interactive&&t.keyboard&&a.keyboard.enable()}_add(t,a,u){this._handlers.push({handlerName:t,handler:a,allowed:u}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Zt(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,a,u){for(const d in t)if(d!==u&&(!a||a.indexOf(d)<0))return!0;return!1}_getMapTouches(t){const a=[];for(const u of t)this._el.contains(u.target)&&a.push(u);return a}mergeHandlerResult(t,a,u,d,x){if(!u)return;o.e(t,u);const w={handlerName:d,originalEvent:u.originalEvent||x};u.zoomDelta!==void 0&&(a.zoom=w),u.panDelta!==void 0&&(a.drag=w),u.rollDelta!==void 0&&(a.roll=w),u.pitchDelta!==void 0&&(a.pitch=w),u.bearingDelta!==void 0&&(a.rotate=w)}_applyChanges(){const t={},a={},u={};for(const[d,x,w]of this._changes)d.panDelta&&(t.panDelta=(t.panDelta||new o.P(0,0))._add(d.panDelta)),d.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+d.zoomDelta),d.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+d.bearingDelta),d.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+d.pitchDelta),d.rollDelta&&(t.rollDelta=(t.rollDelta||0)+d.rollDelta),d.around!==void 0&&(t.around=d.around),d.pinchAround!==void 0&&(t.pinchAround=d.pinchAround),d.noInertia&&(t.noInertia=d.noInertia),o.e(a,x),o.e(u,w);this._updateMapTransform(t,a,u),this._changes=[]}_updateMapTransform(t,a,u){const d=this._map,x=d._getTransformForUpdate(),w=d.terrain;if(!(wc(t)||w&&this._terrainMovement))return this._fireEvents(a,u,!0);d._stop(!0);let{panDelta:S,zoomDelta:A,bearingDelta:R,pitchDelta:z,rollDelta:G,around:V,pinchAround:$}=t;$!==void 0&&(V=$),V=V||d.transform.centerPoint,w&&!x.isPointOnMapSurface(V)&&(V=x.centerPoint);const ee={panDelta:S,zoomDelta:A,rollDelta:G,pitchDelta:z,bearingDelta:R,around:V};this._map.cameraHelper.useGlobeControls&&!x.isPointOnMapSurface(V)&&(V=x.centerPoint);const ce=V.distSqr(x.centerPoint)<.01?x.center:x.screenPointToLocation(S?V.sub(S):V);this._handleMapControls({terrain:w,tr:x,deltasForHelper:ee,preZoomAroundLoc:ce,combinedEventsInProgress:a,panDelta:S}),d._applyUpdatedTransform(x),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,u,!0)}_handleMapControls({terrain:t,tr:a,deltasForHelper:u,preZoomAroundLoc:d,combinedEventsInProgress:x,panDelta:w}){const S=this._map.cameraHelper;if(S.handleMapControlsRollPitchBearingZoom(u,a),t)return S.useGlobeControls?(this._terrainMovement||!x.drag&&!x.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void S.handleMapControlsPan(u,a,d)):this._terrainMovement||!x.drag&&!x.zoom?void(x.drag&&this._terrainMovement&&w?a.setCenter(a.screenPointToLocation(a.centerPoint.sub(w))):S.handleMapControlsPan(u,a,d)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void S.handleMapControlsPan(u,a,d));S.handleMapControlsPan(u,a,d)}_fireEvents(t,a,u){const d=Zt(this._eventsInProgress),x=Zt(t),w={};for(const G in t){const{originalEvent:V}=t[G];this._eventsInProgress[G]||(w[`${G}start`]=V),this._eventsInProgress[G]=t[G]}!d&&x&&this._fireEvent("movestart",x.originalEvent);for(const G in w)this._fireEvent(G,w[G]);x&&this._fireEvent("move",x.originalEvent);for(const G in t){const{originalEvent:V}=t[G];this._fireEvent(G,V)}const S={};let A;for(const G in this._eventsInProgress){const{handlerName:V,originalEvent:$}=this._eventsInProgress[G];this._handlersById[V].isActive()||(delete this._eventsInProgress[G],A=a[V]||$,S[`${G}end`]=A)}for(const G in S)this._fireEvent(G,S[G]);const R=Zt(this._eventsInProgress),z=(d||x)&&!R;if(z&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const G=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&G.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(G)}if(u&&z){this._updatingCamera=!0;const G=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),V=$=>$!==0&&-this._bearingSnap<$&&$<this._bearingSnap;!G||!G.essential&&j.prefersReducedMotion?(this._map.fire(new o.l("moveend",{originalEvent:A})),V(this._map.getBearing())&&this._map.resetNorth()):(V(G.bearing||this._map.getBearing())&&(G.bearing=0),G.freezeElevation=!0,this._map.easeTo(G,{originalEvent:A})),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new o.l(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{delete this._frameId,this.handleEvent(new vl("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class xr extends o.E{constructor(t,a,u){super(),this._renderFrameCallback=()=>{const d=Math.min((J()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(d)),d<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=u.bearingSnap,this._zoomSnap=u.zoomSnap,this.cameraHelper=a,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(t,a){t.apply(this.transform,!0),this.transform=t,this.cameraHelper=a}getCenter(){return new o.V(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,a){return this.jumpTo({elevation:t},a),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,a,u){return t=o.P.convert(t).mult(-1),this.panTo(this.transform.center,o.e({offset:t},a),u)}panTo(t,a,u){return this.easeTo(o.e({center:t},a),u)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,u){return this.easeTo(o.e({zoom:t},a),u)}zoomIn(t,a){return this.zoomTo(o.cx(this.getZoom()+1,this._zoomSnap),t,a),this}zoomOut(t,a){return this.zoomTo(o.cx(this.getZoom()-1,this._zoomSnap),t,a),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,a){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new o.l("movestart",a)).fire(new o.l("move",a)).fire(new o.l("moveend",a))),this}getBearing(){return this.transform.bearing}setZoomSnap(t){return this._zoomSnap=t,this}getZoomSnap(){return this._zoomSnap}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,u){return this.easeTo(o.e({bearing:t},a),u)}resetNorth(t,a){return this.rotateTo(0,o.e({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(o.e({bearing:0,pitch:0,roll:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}getRoll(){return this.transform.roll}setRoll(t,a){return this.jumpTo({roll:t},a),this}cameraForBounds(t,a){t=ui.convert(t).adjustAntiMeridian();const u=a&&a.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),u,a)}_cameraForBoxAndBearing(t,a,u,d){const x={top:0,bottom:0,right:0,left:0};if(typeof(d=o.e({padding:x,offset:[0,0],maxZoom:this.transform.maxZoom},d)).padding=="number"){const R=d.padding;d.padding={top:R,bottom:R,right:R,left:R}}const w=o.e(x,d.padding);d.padding=w;const S=this.transform,A=new ui(t,a);return this.cameraHelper.cameraForBoxAndBearing(d,w,A,u,S)}fitBounds(t,a,u){return this._fitInternal(this.cameraForBounds(t,a),a,u)}fitScreenCoordinates(t,a,u,d,x){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(o.P.convert(t)),this.transform.screenPointToLocation(o.P.convert(a)),u,d),d,x)}_fitInternal(t,a,u){return t?(delete(a=o.e(t,a)).padding,a.linear?this.easeTo(a,u):this.flyTo(a,u)):this}jumpTo(t,a){this.stop();const u=this._getTransformForUpdate();let d=!1,x=!1,w=!1;const S=u.zoom;this.cameraHelper.handleJumpToCenterZoom(u,t);const A=u.zoom!==S;return"elevation"in t&&u.elevation!==+t.elevation&&u.setElevation(+t.elevation),"bearing"in t&&u.bearing!==+t.bearing&&(d=!0,u.setBearing(+t.bearing)),"pitch"in t&&u.pitch!==+t.pitch&&(x=!0,u.setPitch(+t.pitch)),"roll"in t&&u.roll!==+t.roll&&(w=!0,u.setRoll(+t.roll)),t.padding==null||u.isPaddingEqual(t.padding)||u.setPadding(t.padding),this._applyUpdatedTransform(u),this.fire(new o.l("movestart",a)).fire(new o.l("move",a)),A&&this.fire(new o.l("zoomstart",a)).fire(new o.l("zoom",a)).fire(new o.l("zoomend",a)),d&&this.fire(new o.l("rotatestart",a)).fire(new o.l("rotate",a)).fire(new o.l("rotateend",a)),x&&this.fire(new o.l("pitchstart",a)).fire(new o.l("pitch",a)).fire(new o.l("pitchend",a)),w&&this.fire(new o.l("rollstart",a)).fire(new o.l("roll",a)).fire(new o.l("rollend",a)),this.fire(new o.l("moveend",a))}calculateCameraOptionsFromTo(t,a,u,d=0){const x=o.a9.fromLngLat(t,a),w=o.a9.fromLngLat(u,d),S=w.x-x.x,A=w.y-x.y,R=w.z-x.z,z=Math.hypot(S,A,R);if(z===0)throw new Error("Can't calculate camera options with same From and To");const G=Math.hypot(S,A),V=o.at(this.transform.cameraToCenterDistance/z/this.transform.tileSize),$=180*Math.atan2(S,-A)/Math.PI;let ee=180*Math.acos(G/z)/Math.PI;return ee=R<0?90-ee:90+ee,{center:w.toLngLat(),elevation:d,zoom:V,pitch:ee,bearing:$}}calculateCameraOptionsFromCameraLngLatAltRotation(t,a,u,d,x){const w=this.transform.calculateCenterFromCameraLngLatAlt(t,a,u,d);return{center:w.center,elevation:w.elevation,zoom:w.zoom,bearing:u,pitch:d,roll:x}}easeTo(t,a){this._stop(!1,t.easeId),((t=o.e({offset:[0,0],duration:500,easing:o.cz},t)).animate===!1||!t.essential&&j.prefersReducedMotion)&&(t.duration=0);const u=this._getTransformForUpdate(),d=this.getBearing(),x=u.pitch,w=u.roll,S="bearing"in t?this._normalizeBearing(t.bearing,d):d,A="pitch"in t?+t.pitch:x,R="roll"in t?this._normalizeBearing(t.roll,w):w,z="padding"in t?t.padding:u.padding,G=o.P.convert(t.offset);let V,$;t.around&&(V=o.V.convert(t.around),$=u.locationToScreenPoint(V));const ee={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},ce=this.cameraHelper.handleEaseTo(u,{bearing:S,pitch:A,roll:R,padding:z,around:V,aroundPoint:$,offsetAsPoint:G,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||d!==S,this._pitching=this._pitching||A!==x,this._rolling=this._rolling||R!==w,this._padding=!u.isPaddingEqual(z),this._zooming=this._zooming||ce.isZooming,this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,ee),this.terrain&&this._prepareElevation(ce.elevationCenter),this._ease((he=>{ce.easeFunc(he),this.terrain&&!t.freezeElevation&&this._updateElevation(he),this._applyUpdatedTransform(u),this._fireMoveEvents(a)}),(he=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(a,he)}),t),this}_prepareEase(t,a,u={}){this._moving=!0,a||u.moving||this.fire(new o.l("movestart",t)),this._zooming&&!u.zooming&&this.fire(new o.l("zoomstart",t)),this._rotating&&!u.rotating&&this.fire(new o.l("rotatestart",t)),this._pitching&&!u.pitching&&this.fire(new o.l("pitchstart",t)),this._rolling&&!u.rolling&&this.fire(new o.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&a!==this._elevationTarget){const u=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(u-(a-(u*t+this._elevationStart))/(1-t)),this._elevationTarget=a}this.transform.setElevation(o.G.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const a=t.getCameraLngLat(),u=t.getCameraAltitude(),d=this.terrain?this.terrain.getElevationForLngLatZoom(a,t.zoom):0;if(u<d){const x=this.calculateCameraOptionsFromTo(a,d,t.center,t.elevation);return{pitch:x.pitch,zoom:x.zoom}}return{}}_applyUpdatedTransform(t){const a=[];if(a.push((d=>this._elevateCameraIfInsideTerrain(d))),this.transformCameraUpdate&&a.push((d=>this.transformCameraUpdate(d))),!a.length)return;const u=t.clone();for(const d of a){const x=u.clone(),{center:w,zoom:S,roll:A,pitch:R,bearing:z,elevation:G}=d(x);w&&x.setCenter(w),G!==void 0&&x.setElevation(G),S!==void 0&&x.setZoom(S),A!==void 0&&x.setRoll(A),R!==void 0&&x.setPitch(R),z!==void 0&&x.setBearing(z),u.apply(x,!1)}this.transform.apply(u,!1)}_fireMoveEvents(t){this.fire(new o.l("move",t)),this._zooming&&this.fire(new o.l("zoom",t)),this._rotating&&this.fire(new o.l("rotate",t)),this._pitching&&this.fire(new o.l("pitch",t)),this._rolling&&this.fire(new o.l("roll",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;const u=this._zooming,d=this._rotating,x=this._pitching,w=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,u&&this.fire(new o.l("zoomend",t)),d&&this.fire(new o.l("rotateend",t)),x&&this.fire(new o.l("pitchend",t)),w&&this.fire(new o.l("rollend",t)),this.fire(new o.l("moveend",t))}flyTo(t,a){if(!t.essential&&j.prefersReducedMotion){const Ze=o.U(t,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(Ze,a)}this.stop(),t=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.cz},t);const u=this._getTransformForUpdate(),d=u.bearing,x=u.pitch,w=u.roll,S=u.padding,A="bearing"in t?this._normalizeBearing(t.bearing,d):d,R="pitch"in t?+t.pitch:x,z="roll"in t?this._normalizeBearing(t.roll,w):w,G="padding"in t?t.padding:u.padding,V=o.P.convert(t.offset);let $=u.centerPoint.add(V);const ee=u.screenPointToLocation($),ce=this.cameraHelper.handleFlyTo(u,{bearing:A,pitch:R,roll:z,padding:G,locationAtOffset:ee,offsetAsPoint:V,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let he=t.curve;const ue=Math.max(u.width,u.height),ye=ue/ce.scaleOfZoom,Ae=ce.pixelPathLength;typeof ce.scaleOfMinZoom=="number"&&(he=Math.sqrt(ue/ce.scaleOfMinZoom/Ae*2));const _e=he*he;function Ee(Ze){const bt=(ye*ye-ue*ue+(Ze?-1:1)*_e*_e*Ae*Ae)/(2*(Ze?ye:ue)*_e*Ae);return Math.log(Math.sqrt(bt*bt+1)-bt)}function Pe(Ze){return(Math.exp(Ze)-Math.exp(-Ze))/2}function we(Ze){return(Math.exp(Ze)+Math.exp(-Ze))/2}const Be=Ee(!1);let Ye=function(Ze){return we(Be)/we(Be+he*Ze)},je=function(Ze){return ue*((we(Be)*(Pe(bt=Be+he*Ze)/we(bt))-Pe(Be))/_e)/Ae;var bt},Xe=(Ee(!0)-Be)/he;if(Math.abs(Ae)<2e-6||!isFinite(Xe)){if(Math.abs(ue-ye)<1e-6)return this.easeTo(t,a);const Ze=ye<ue?-1:1;Xe=Math.abs(Math.log(ye/ue))/he,je=()=>0,Ye=bt=>Math.exp(Ze*he*bt)}return t.duration="duration"in t?+t.duration:1e3*Xe/("screenSpeed"in t?+t.screenSpeed/he:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=d!==A,this._pitching=R!==x,this._rolling=z!==w,this._padding=!u.isPaddingEqual(G),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(ce.targetCenter),this._ease((Ze=>{const bt=Ze*Xe,wt=1/Ye(bt),dt=je(bt);this._rotating&&u.setBearing(o.G.number(d,A,Ze)),this._pitching&&u.setPitch(o.G.number(x,R,Ze)),this._rolling&&u.setRoll(o.G.number(w,z,Ze)),this._padding&&(u.interpolatePadding(S,G,Ze),$=u.centerPoint.add(V)),ce.easeFunc(Ze,wt,dt,$),this.terrain&&!t.freezeElevation&&this._updateElevation(Ze),this._applyUpdatedTransform(u),this._fireMoveEvents(a)}),(()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(a)}),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,a){var u;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const d=this._onEaseEnd;delete this._onEaseEnd,d.call(this,a)}return t||(u=this.handlers)===null||u===void 0||u.stop(!1),this}_ease(t,a,u){u.animate===!1||u.duration===0?(t(1),a()):(this._easeStart=J(),this._easeOptions=u,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,a){t=o.W(t,-180,180);const u=Math.abs(t-a);return Math.abs(t-360-a)<u&&(t-=360),Math.abs(t+360-a)<u&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLat(o.V.convert(t),this.transform):null}}const Xr={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class hh{constructor(t=Xr){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=N.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=N.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=N.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){N.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,a){const u=this._map._getUIString(`AttributionControl.${a}`);t.title=u,t.setAttribute("aria-label",u)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((d=>typeof d!="string"?"":d))):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}const a=this._map.style.tileManagers;for(const d in a){const x=a[d];if(x.used||x.usedForTerrain){const w=x.getSource();w.attribution&&t.indexOf(w.attribution)<0&&t.push(w.attribution)}}t=t.filter((d=>String(d).trim())),t.sort(((d,x)=>d.length-x.length)),t=t.filter(((d,x)=>{for(let w=x+1;w<t.length;w++)if(t[w].indexOf(d)>=0)return!1;return!0}));const u=t.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,t.length?(this._innerContainer.innerHTML=N.sanitize(u),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class sf{constructor(t={}){this._updateCompact=()=>{const a=this._container.children;if(a.length){const u=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&u.classList.add("maplibregl-compact"):u.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=N.create("div","maplibregl-ctrl");const a=N.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){N.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Yp{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,u=a?this._queue.concat(a):this._queue;for(const d of u)if(d.id===t)return void(d.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const u of a)if(!u.cancelled&&(u.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Kp=o.aU([{name:"a_pos3d",type:"Int16",components:3}]);class bl extends o.E{constructor(t){super(),this._lastTilesetChange=J(),this.tileManager=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(t,a){this.tileManager.update(t,a),this._renderableTilesKeys=[];const u={};for(const d of Di(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a,calculateTileZoom:this.tileManager._source.calculateTileZoom}))u[d.key]=!0,this._renderableTilesKeys.push(d.key),this._tiles[d.key]||(d.terrainRttPosMatrix32f=new Float64Array(16),o.c7(d.terrainRttPosMatrix32f,0,o.a5,o.a5,0,0,1),this._tiles[d.key]=new pe(d,this.tileSize),this._lastTilesetChange=J());for(const d in this._tiles)u[d]||delete this._tiles[d]}freeRtt(t){for(const a in this._tiles){const u=this._tiles[a];(!t||u.tileID.equals(t)||u.tileID.isChildOf(t)||t.isChildOf(u.tileID))&&(u.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((t=>this.getTileByID(t)))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,a){return a?this._getTerrainCoordsForTileRanges(t,a):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const a={};for(const u of this._renderableTilesKeys){const d=this._tiles[u].tileID,x=t.clone(),w=o.bk();if(d.canonical.equals(t.canonical))o.c7(w,0,o.a5,o.a5,0,0,1);else if(d.canonical.isChildOf(t.canonical)){const S=d.canonical.z-t.canonical.z,A=d.canonical.x-(d.canonical.x>>S<<S),R=d.canonical.y-(d.canonical.y>>S<<S),z=o.a5>>S;o.c7(w,0,z,z,0,0,1),o.O(w,w,[-A*z,-R*z,0])}else{if(!t.canonical.isChildOf(d.canonical))continue;{const S=t.canonical.z-d.canonical.z,A=t.canonical.x-(t.canonical.x>>S<<S),R=t.canonical.y-(t.canonical.y>>S<<S),z=o.a5>>S;o.c7(w,0,o.a5,o.a5,0,0,1),o.O(w,w,[A*z,R*z,0]),o.Q(w,w,[1/2**S,1/2**S,0])}}x.terrainRttPosMatrix32f=new Float32Array(w),a[u]=x}return a}_getTerrainCoordsForTileRanges(t,a){const u={};for(const d of this._renderableTilesKeys){const x=this._tiles[d].tileID;if(!this._isWithinTileRanges(x,a))continue;const w=t.clone(),S=o.bk();if(x.canonical.z===t.canonical.z){const A=t.canonical.x-x.canonical.x+t.wrap*(1<<t.canonical.z),R=t.canonical.y-x.canonical.y;o.c7(S,0,o.a5,o.a5,0,0,1),o.O(S,S,[A*o.a5,R*o.a5,0])}else if(x.canonical.z>t.canonical.z){const A=x.canonical.z-t.canonical.z,R=x.canonical.x-(x.canonical.x>>A<<A)+t.wrap*(1<<x.canonical.z),z=x.canonical.y-(x.canonical.y>>A<<A),G=t.canonical.x-(x.canonical.x>>A),V=t.canonical.y-(x.canonical.y>>A),$=o.a5>>A;o.c7(S,0,$,$,0,0,1),o.O(S,S,[-R*$+G*o.a5,-z*$+V*o.a5,0])}else{const A=t.canonical.z-x.canonical.z,R=t.canonical.x-(t.canonical.x>>A<<A)+t.wrap*(1<<t.canonical.z),z=t.canonical.y-(t.canonical.y>>A<<A),G=(t.canonical.x>>A)-x.canonical.x,V=(t.canonical.y>>A)-x.canonical.y,$=o.a5<<A;o.c7(S,0,$,$,0,0,1),o.O(S,S,[R*o.a5+G*$,z*o.a5+V*$,0])}w.terrainRttPosMatrix32f=new Float32Array(S),u[d]=w}return u}getSourceTile(t,a){const u=this.tileManager._source;let d=t.overscaledZ-this.deltaZoom;if(d>u.maxzoom&&(d=u.maxzoom),d<u.minzoom)return;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(d).key);let x=this.findTileInCaches(this._sourceTileCache[t.key]);if(!x?.dem&&a)for(;d>=u.minzoom&&!x?.dem;)x=this.findTileInCaches(t.scaledTo(d--).key);return x}findTileInCaches(t){let a=this.tileManager.getTileByID(t);return a||(a=this.tileManager._outOfViewCache.getByKey(t),a)}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,a){const u=a[t.canonical.z];return!!u&&(t.wrap>u.minWrap||t.wrap<u.maxWrap||t.canonical.x>=u.minTileXWrapped&&t.canonical.x<=u.maxTileXWrapped&&t.canonical.y>=u.minTileY&&t.canonical.y<=u.maxTileY)}}class mn{constructor(t,a,u){this._meshCache={},this.painter=t,this.tileManager=new bl(a),this.options=u,this.exaggeration=typeof u.exaggeration=="number"?u.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,a,u,d=o.a5){var x;const w=t.normalizeCoordinates(a,u,d);if(!w)return 0;const S=this.getTerrainData(w.tileID),A=(x=S.tile)===null||x===void 0?void 0:x.dem;if(!A)return 0;const R=o.cD([],[w.x/d*o.a5,w.y/d*o.a5],S.u_terrain_matrix),z=[R[0]*A.dim,R[1]*A.dim],G=Math.floor(z[0]),V=Math.floor(z[1]),$=z[0]-G,ee=z[1]-V;return A.get(G,V)*(1-$)*(1-ee)+A.get(G+1,V)*$*(1-ee)+A.get(G,V+1)*(1-$)*ee+A.get(G+1,V+1)*$*ee}getElevationForLngLatZoom(t,a){if(!o.cE(a,t.wrap()))return 0;const{tileID:u,mercatorX:d,mercatorY:x}=this._getOverscaledTileIDFromLngLatZoom(t,a);return this.getElevation(u,d%o.a5,x%o.a5,o.a5)}getElevationForLngLat(t,a){const u=Di(a,{maxzoom:this.tileManager.maxzoom,minzoom:this.tileManager.minzoom,tileSize:512,terrain:this});let d=0;for(const x of u)x.canonical.z>d&&(d=Math.min(x.canonical.z,this.tileManager.maxzoom));return this.getElevationForLngLatZoom(t,d)}getElevation(t,a,u,d=o.a5){return this.getDEMElevation(t,a,u,d)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const d=this.painter.context,x=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new o.T(d,x,d.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new o.T(d,new o.R({width:1,height:1}),d.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.ar([])}const a=this.tileManager.getSourceTile(t,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const d=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new o.T(d,a.dem.getPixels(),d.gl.RGBA,{premultiply:!1}),a.demTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const u=a&&a.toString()+a.tileID.key+t.key;if(u&&!this._demMatrixCache[u]){const d=this.tileManager.getSource().maxzoom;let x=t.canonical.z-a.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=d?x=t.canonical.z-d:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const w=t.canonical.x-(t.canonical.x>>x<<x),S=t.canonical.y-(t.canonical.y>>x<<x),A=o.cF(new Float64Array(16),[1/(o.a5<<x),1/(o.a5<<x),0]);o.O(A,A,[w*o.a5,S*o.a5,0]),this._demMatrixCache[t.key]={matrix:A,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:u?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(t){const a=this.painter,u=a.width/devicePixelRatio,d=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===u&&this._fbo.height===d||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new o.T(a.context,{width:u,height:d,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new o.T(a.context,{width:u,height:d,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(u,d,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,u,d))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let x=0,w=0;x<this._coordsTextureSize;x++)for(let S=0;S<this._coordsTextureSize;S++,w+=4)a[w+0]=255&S,a[w+1]=255&x,a[w+2]=S>>8<<4|x>>8,a[w+3]=0;const u=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),d=new o.T(t,u,t.gl.RGBA,{premultiply:!1});return d.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=d,d}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const a=new Uint8Array(4),u=this.painter.context,d=u.gl,x=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),w=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),S=Math.round(this.painter.height/devicePixelRatio);u.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),d.readPixels(x,S-w-1,1,1,d.RGBA,d.UNSIGNED_BYTE,a),u.bindFramebuffer.set(null);const A=a[0]+(a[2]>>4<<8),R=a[1]+((15&a[2])<<8),z=this.coordsIndex[255-a[3]],G=z&&this.tileManager.getTileByID(z);if(!G)return null;const V=this._coordsTextureSize,$=(1<<G.tileID.canonical.z)*V;return new o.a9((G.tileID.canonical.x*V+A)/$+G.tileID.wrap,(G.tileID.canonical.y*V+R)/$,this.getElevation(G.tileID,A,R,V))}depthAtPoint(t){const a=new Uint8Array(4),u=this.painter.context,d=u.gl;return u.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),d.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,d.RGBA,d.UNSIGNED_BYTE,a),u.bindFramebuffer.set(null),(a[0]/16777216+a[1]/65536+a[2]/256+a[3])/256}getTerrainMesh(t){var a;const u=((a=this.painter.style.projection)===null||a===void 0?void 0:a.transitionState)>0,d=u&&t.canonical.y===0,x=u&&t.canonical.y===(1<<t.canonical.z)-1,w=`m_${d?"n":""}_${x?"s":""}`;if(this._meshCache[w])return this._meshCache[w];const S=this.painter.context,A=new o.cG,R=new o.aY,z=this.meshSize,G=o.a5/z,V=z*z;for(let we=0;we<=z;we++)for(let Be=0;Be<=z;Be++)A.emplaceBack(Be*G,we*G,0);for(let we=0;we<V;we+=z+1)for(let Be=0;Be<z;Be++)R.emplaceBack(Be+we,z+Be+we+1,z+Be+we+2),R.emplaceBack(Be+we,z+Be+we+2,Be+we+1);const $=A.length,ee=$+(z+1),ce=(z+1)*z,he=d?o.br:0,ue=d?0:1,ye=x?o.bs:o.a5,Ae=x?0:1;for(let we=0;we<=z;we++)A.emplaceBack(we*G,he,ue);for(let we=0;we<=z;we++)A.emplaceBack(we*G,ye,Ae);for(let we=0;we<z;we++)R.emplaceBack(ce+we,ee+we,ee+we+1),R.emplaceBack(ce+we,ee+we+1,ce+we+1),R.emplaceBack(0+we,$+we+1,$+we),R.emplaceBack(0+we,0+we+1,$+we+1);const _e=A.length,Ee=_e+2*(z+1);for(const we of[0,1])for(let Be=0;Be<=z;Be++)for(const Ye of[0,1])A.emplaceBack(we*o.a5,Be*G,Ye);for(let we=0;we<2*z;we+=2)R.emplaceBack(_e+we,_e+we+1,_e+we+3),R.emplaceBack(_e+we,_e+we+3,_e+we+2),R.emplaceBack(Ee+we,Ee+we+3,Ee+we+1),R.emplaceBack(Ee+we,Ee+we+2,Ee+we+3);const Pe=new Xi(S.createVertexBuffer(A,Kp.members),S.createIndexBuffer(R),o.aX.simpleSegment(0,0,A.length,R.length));return this._meshCache[w]=Pe,Pe}getMeshFrameDelta(t){return 2*Math.PI*o.bE/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,a){var u;if(!o.cE(a,t.wrap()))return 0;const{tileID:d}=this._getOverscaledTileIDFromLngLatZoom(t,a);return(u=this.getMinMaxElevation(d).minElevation)!==null&&u!==void 0?u:0}getMinMaxElevation(t){const a=this.getTerrainData(t).tile,u={minElevation:null,maxElevation:null};return a&&a.dem&&(u.minElevation=a.dem.min*this.exaggeration,u.maxElevation=a.dem.max*this.exaggeration),u}_getOverscaledTileIDFromLngLatZoom(t,a){const u=o.a9.fromLngLat(t.wrap()),d=(1<<a)*o.a5,x=u.x*d,w=u.y*d,S=Math.floor(x/o.a5),A=Math.floor(w/o.a5);return{tileID:new o.a2(a,0,a,S,A),mercatorX:x,mercatorY:w}}}class Mn{constructor(t,a,u){this._context=t,this._size=a,this._tileSize=u,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),u=new o.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return u.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(u.texture),{id:t,fbo:a,texture:u,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((a=>t.id!==a)),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((t=>!t.inUse))===!1}}const Ba={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class wl{constructor(t,a){this.painter=t,this.terrain=a,this.pool=new Mn(t.context,30,a.tileManager.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,a){var u,d;this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=t._order.filter((x=>!t._layers[x].isHidden(a))),this._coordsAscending={};for(const x in t.tileManagers){this._coordsAscending[x]={};const w=t.tileManagers[x].getVisibleCoordinates(),S=t.tileManagers[x].getSource(),A=S instanceof ke?S.terrainTileRanges:null;for(const R of w){const z=this.terrain.tileManager.getTerrainCoords(R,A);for(const G in z)this._coordsAscending[x][G]||(this._coordsAscending[x][G]=[]),this._coordsAscending[x][G].push(z[G])}}this._rttFingerprints={};for(const x of t._order){const w=t._layers[x],S=w.source;if(Ba[w.type]&&!this._rttFingerprints[S]){this._rttFingerprints[S]={};const A=(d=(u=t.tileManagers[S])===null||u===void 0?void 0:u.getState().revision)!==null&&d!==void 0?d:0;for(const R in this._coordsAscending[S])this._rttFingerprints[S][R]=`${this._coordsAscending[S][R].map((z=>z.key)).sort().join()}#${A}`}}for(const x of this._renderableTiles)for(const w in this._rttFingerprints){const S=this._rttFingerprints[w][x.tileID.key];S&&S!==x.rttFingerprint[w]&&(x.rtt=[])}}renderLayer(t,a){if(t.isHidden(this.painter.transform.zoom))return!1;const u=Object.assign(Object.assign({},a),{isRenderingToTexture:!0}),d=t.type,x=this.painter,w=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Ba[d]&&(this._prevType&&Ba[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(t.id),!w))return!0;if(Ba[this._prevType]||Ba[d]&&w){this._prevType=d;const S=this._stacks.length-1,A=this._stacks[S]||[];for(const R of this._renderableTiles){if(this.pool.isFull()&&(eh(this.painter,this.terrain,this._rttTiles,u),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(R),R.rtt[S]){const G=this.pool.getObjectForId(R.rtt[S].id);if(G.stamp===R.rtt[S].stamp){this.pool.useObject(G);continue}}const z=this.pool.getOrCreateFreeObject();this.pool.useObject(z),this.pool.stampObject(z),R.rtt[S]={id:z.id,stamp:z.stamp},x.context.bindFramebuffer.set(z.fbo.framebuffer),x.context.clear({color:o.bp.transparent,stencil:0}),x.currentStencilSource=void 0;for(let G=0;G<A.length;G++){const V=x.style._layers[A[G]],$=V.source?this._coordsAscending[V.source][R.tileID.key]:[R.tileID];x.context.viewport.set([0,0,z.fbo.width,z.fbo.height]),x._renderTileClippingMasks(V,$,!0),x.renderLayer(x,x.style.tileManagers[V.source],V,$,u),V.source&&(R.rttFingerprint[V.source]=this._rttFingerprints[V.source][R.tileID.key])}}return eh(this.painter,this.terrain,this._rttTiles,u),this._rttTiles=[],this.pool.freeAllObjects(),Ba[d]}return!1}}const Sc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Drag to rotate map, click to reset north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},dh=M,Mc={hash:!1,interactive:!0,bearingSnap:7,zoomSnap:0,attributionControl:Xr,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},fh={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Tl{constructor(t,a,u=!1){this.mousedown=x=>{this.startMove(x,N.mousePos(this.element,x)),N.addEventListener(window,"mousemove",this.mousemove),N.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=x=>{this.move(x,N.mousePos(this.element,x))},this.mouseup=x=>{this._rotatePitchHandler.dragEnd(x),this.offTemp()},this.touchstart=x=>{x.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=N.touchPos(this.element,x.targetTouches)[0],this.startMove(x,this._startPos),N.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),N.addEventListener(window,"touchend",this.touchend))},this.touchmove=x=>{x.targetTouches.length!==1?this.reset():(this._lastPos=N.touchPos(this.element,x.targetTouches)[0],this.move(x,this._lastPos))},this.touchend=x=>{x.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=a;const d=new Kd;this._rotatePitchHandler=new Po({clickTolerance:3,move:(x,w)=>{const S=a.getBoundingClientRect(),A=new o.P((S.bottom-S.top)/2,(S.right-S.left)/2);return{bearingDelta:o.cy(new o.P(x.x,w.y),w,A),pitchDelta:u?-.5*(w.y-x.y):void 0}},moveStateManager:d,enable:!0,assignEvents:()=>{}}),this.map=t,N.addEventListener(a,"mousedown",this.mousedown),N.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),N.addEventListener(a,"touchcancel",this.reset)}startMove(t,a){this._rotatePitchHandler.dragStart(t,a),N.disableDrag()}move(t,a){const u=this.map,{bearingDelta:d,pitchDelta:x}=this._rotatePitchHandler.dragMove(t,a)||{};d&&u.setBearing(u.getBearing()+d),x&&u.setPitch(u.getPitch()+x)}off(){const t=this.element;N.removeEventListener(t,"mousedown",this.mousedown),N.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),N.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),N.removeEventListener(window,"touchend",this.touchend),N.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){N.enableDrag(),N.removeEventListener(window,"mousemove",this.mousemove),N.removeEventListener(window,"mouseup",this.mouseup),N.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),N.removeEventListener(window,"touchend",this.touchend)}}let Ds;function Ec(y,t,a,u=!1){if(u||!a.getCoveringTilesDetailsProvider().allowWorldCopies())return y?.wrap();const d=new o.V(y.lng,y.lat);if(y=new o.V(y.lng,y.lat),t){const x=new o.V(y.lng-360,y.lat),w=new o.V(y.lng+360,y.lat),S=a.locationToScreenPoint(y).distSqr(t);a.locationToScreenPoint(x).distSqr(t)<S?y=x:a.locationToScreenPoint(w).distSqr(t)<S&&(y=w)}for(;Math.abs(y.lng-a.center.lng)>180;){const x=a.locationToScreenPoint(y);if(x.x>=0&&x.y>=0&&x.x<=a.width&&x.y<=a.height)break;y.lng>a.center.lng?y.lng-=360:y.lng+=360}return y.lng!==d.lng&&a.isPointOnMapSurface(a.locationToScreenPoint(y))?y:d}const Sl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ac(y,t,a){const u=y.classList;for(const d in Sl)u.remove(`maplibregl-${a}-anchor-${d}`);u.add(`maplibregl-${a}-anchor-${t}`)}class Ml extends o.E{constructor(t){if(super(),this._onClick=a=>{this.fire(new o.l("click",{originalEvent:a}))},this._onKeyPress=a=>{const u=a.code,d=a.charCode||a.keyCode;u!=="Space"&&u!=="Enter"&&d!==32&&d!==13||this.togglePopup()},this._onMapClick=a=>{const u=a.originalEvent.target,d=this._element;this._popup&&(u===d||d.contains(u))&&this.togglePopup()},this._update=a=>{if(!this._map)return;const u=this._map.loaded()&&!this._map.isMoving();(a?.type==="terrain"||a?.type==="render"&&!u)&&this._map.once("render",this._update),this._lngLat=Ec(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(d=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let x="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?x="rotateX(0deg)":this._pitchAlignment==="map"&&(x=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||a&&a.type!=="moveend"||(this._pos=this._pos.round()),N.setTransform(this._element,`${Sl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${x} ${d}`),j.frameAsync(new AbortController,this._map._ownerWindow).then((()=>{this._updateOpacity(a&&a.type==="moveend")})).catch((()=>{}))},this._onMove=a=>{if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.l("dragstart"))),this.fire(new o.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.l("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t?.opacity,t?.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=o.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=N.create("div");const a=N.createNS("http://www.w3.org/2000/svg","svg"),u=41,d=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${u}px`),a.setAttributeNS(null,"width",`${d}px`),a.setAttributeNS(null,"viewBox",`0 0 ${d} ${u}`);const x=N.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"stroke","none"),x.setAttributeNS(null,"stroke-width","1"),x.setAttributeNS(null,"fill","none"),x.setAttributeNS(null,"fill-rule","evenodd");const w=N.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"fill-rule","nonzero");const S=N.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"transform","translate(3.0, 29.0)"),S.setAttributeNS(null,"fill","#000000");const A=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ue of A){const ye=N.createNS("http://www.w3.org/2000/svg","ellipse");ye.setAttributeNS(null,"opacity","0.04"),ye.setAttributeNS(null,"cx","10.5"),ye.setAttributeNS(null,"cy","5.80029008"),ye.setAttributeNS(null,"rx",ue.rx),ye.setAttributeNS(null,"ry",ue.ry),S.appendChild(ye)}const R=N.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill",this._color);const z=N.createNS("http://www.w3.org/2000/svg","path");z.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),R.appendChild(z);const G=N.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"opacity","0.25"),G.setAttributeNS(null,"fill","#000000");const V=N.createNS("http://www.w3.org/2000/svg","path");V.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),G.appendChild(V);const $=N.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"transform","translate(6.0, 7.0)"),$.setAttributeNS(null,"fill","#FFFFFF");const ee=N.createNS("http://www.w3.org/2000/svg","g");ee.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ce=N.createNS("http://www.w3.org/2000/svg","circle");ce.setAttributeNS(null,"fill","#000000"),ce.setAttributeNS(null,"opacity","0.25"),ce.setAttributeNS(null,"cx","5.5"),ce.setAttributeNS(null,"cy","5.5"),ce.setAttributeNS(null,"r","5.4999962");const he=N.createNS("http://www.w3.org/2000/svg","circle");he.setAttributeNS(null,"fill","#FFFFFF"),he.setAttributeNS(null,"cx","5.5"),he.setAttributeNS(null,"cy","5.5"),he.setAttributeNS(null,"r","5.4999962"),ee.appendChild(ce),ee.appendChild(he),w.appendChild(S),w.appendChild(R),w.appendChild(G),w.appendChild($),w.appendChild(ee),a.appendChild(w),a.setAttributeNS(null,"height",u*this._scale+"px"),a.setAttributeNS(null,"width",d*this._scale+"px"),this._element.appendChild(a),this._offset=o.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(a=>{a.preventDefault()})),this._element.addEventListener("mousedown",(a=>{a.preventDefault()})),Ac(this._element,this._anchor,"marker"),this._element.addEventListener("click",this._onClick),t&&t.className)for(const a of t.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),N.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=o.V.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const d=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(38.1-13.5+d)],"bottom-right":[-d,-1*(38.1-13.5+d)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var a,u;const d=(a=this._map)===null||a===void 0?void 0:a.terrain,x=this._map.transform.isLocationOccluded(this._lngLat);if(!d||x){const $=x?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==$&&(this._element.style.opacity=$))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const w=this._map,S=w.terrain.depthAtPoint(this._pos),A=w.terrain.getElevationForLngLat(this._lngLat,w.transform);if(w.transform.lngLatToCameraDepth(this._lngLat,A)-S<.006)return void(this._element.style.opacity=this._opacity);const R=-this._offset.y/w.transform.pixelsPerMeter,z=Math.sin(w.getPitch()*Math.PI/180)*R,G=w.terrain.depthAtPoint(new o.P(this._pos.x,this._pos.y-this._offset.y)),V=w.transform.lngLatToCameraDepth(this._lngLat,A+z)-G>.006;!((u=this._popup)===null||u===void 0)&&u.isOpen()&&V&&this._popup.remove(),this._element.style.opacity=V?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=o.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,a){return(this._opacity===void 0||t===void 0&&a===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),a!==void 0&&(this._opacityWhenCovered=a),this._map&&this._updateOpacity(!0),this}}const ph={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ro=0,ka=!1;const mh={maxWidth:100,unit:"metric"};function El(y,t,a){const u=a&&a.maxWidth||100,d=y._container.clientHeight/2,x=y._container.clientWidth/2,w=y.unproject([x-u/2,d]),S=y.unproject([x+u/2,d]),A=Math.round(y.project(S).x-y.project(w).x),R=Math.min(u,A,y._container.clientWidth),z=w.distanceTo(S);if(a&&a.unit==="imperial"){const G=3.2808*z;G>5280?Ua(t,R,G/5280,y._getUIString("ScaleControl.Miles")):Ua(t,R,G,y._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?Ua(t,R,z/1852,y._getUIString("ScaleControl.NauticalMiles")):z>=1e3?Ua(t,R,z/1e3,y._getUIString("ScaleControl.Kilometers")):Ua(t,R,z,y._getUIString("ScaleControl.Meters"))}function Ua(y,t,a,u){const d=(function(x){const w=Math.pow(10,`${Math.floor(x)}`.length-1);let S=x/w;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:(function(A){const R=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*R)/R})(S),w*S})(a);y.style.width=t*(d/a)+"px",y.innerHTML=`${d}&nbsp;${u}`}const gh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0,padding:void 0},Cc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Pc(y){if(y){if(typeof y=="number"){const t=Math.round(Math.abs(y)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,y),"top-left":new o.P(t,t),"top-right":new o.P(-t,t),bottom:new o.P(0,-y),"bottom-left":new o.P(t,-t),"bottom-right":new o.P(-t,-t),left:new o.P(y,0),right:new o.P(-y,0)}}if(y instanceof o.P||Array.isArray(y)){const t=o.P.convert(y);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:o.P.convert(y.center||[0,0]),top:o.P.convert(y.top||[0,0]),"top-left":o.P.convert(y["top-left"]||[0,0]),"top-right":o.P.convert(y["top-right"]||[0,0]),bottom:o.P.convert(y.bottom||[0,0]),"bottom-left":o.P.convert(y["bottom-left"]||[0,0]),"bottom-right":o.P.convert(y["bottom-right"]||[0,0]),left:o.P.convert(y.left||[0,0]),right:o.P.convert(y.right||[0,0])}}return Pc(new o.P(0,0))}const _h=M;_.AJAXError=o.cJ,_.EXTENT=o.a5,_.Event=o.l,_.Evented=o.E,_.LngLat=o.V,_.MercatorCoordinate=o.a9,_.Point=o.P,_.addProtocol=o.cK,_.config=o.c,_.removeProtocol=o.cL,_.AttributionControl=hh,_.BoxZoomHandler=Co,_.CanvasSource=yt,_.CooperativeGesturesHandler=Ht,_.DoubleClickZoomHandler=uh,_.DragPanHandler=rf,_.DragRotateHandler=os,_.EdgeInsets=uo,_.FullscreenControl=class extends o.E{constructor(y={}){var t;super(),this._onFullscreenChange=()=>{var a;let u=window.document.fullscreenElement||window.document.webkitFullscreenElement;for(;!((a=u?.shadowRoot)===null||a===void 0)&&a.fullscreenElement;)u=u.shadowRoot.fullscreenElement;u===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,this._pseudo=(t=y.pseudo)!==null&&t!==void 0&&t,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){N.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const y=this._fullscreenButton=N.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);N.create("span","maplibregl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.title=y}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new o.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){this._pseudo?this._togglePseudoFullScreen():window.document.exitFullscreen?window.document.exitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._pseudo?this._togglePseudoFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},_.GeoJSONSource=Q,_.GeolocateControl=class extends o.E{constructor(y){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new o.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const a=new o.V(t.coords.longitude,t.coords.latitude),u=t.coords.accuracy,d=this._map.getBearing(),x=o.e({bearing:d},this.options.fitBoundsOptions),w=ui.fromLngLat(a,u);this._map.fitBounds(w,x,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const a=new o.V(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=t.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&ka)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=N.create("button","maplibregl-ctrl-geolocate",this._container),N.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=N.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ml({element:this._dotElement}),this._circleElement=N.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ml({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(a=>{const u=a?.[0]instanceof ResizeObserverEntry;a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||u||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.l("trackuserlocationend")),this.fire(new o.l("userlocationlostfocus")))}))}},this.options=o.e({},ph,y)}onAdd(y){return this._map=y,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return o._(this,arguments,void 0,(function*(t=!1){if(Ds!==void 0&&!t)return Ds;if(window.navigator.permissions===void 0)return Ds=!!window.navigator.geolocation,Ds;try{Ds=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Ds=!!window.navigator.geolocation}return Ds}))})().then((t=>this._finishSetupUI(t))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),N.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,Ro=0,ka=!1}_isOutOfMapMaxBounds(y){const t=this._map.getMaxBounds(),a=y.coords;return t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const y=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&y))return;const t=this._map.project(y),a=this._map.unproject([t.x+100,t.y]),u=y.distanceTo(a)/100,d=2*this._accuracy/u;this._circleElement.style.width=`${d.toFixed(2)}px`,this._circleElement.style.height=`${d.toFixed(2)}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ro--,ka=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.l("trackuserlocationstart")),this.fire(new o.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ro++,Ro>1?(y={maximumAge:6e5,timeout:0},ka=!0):(y=this.options.positionOptions,ka=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,y)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},_.GlobeControl=class{constructor(){this._toggleProjection=()=>{var y;const t=(y=this._map.getProjection())===null||y===void 0?void 0:y.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var y;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((y=this._map.getProjection())===null||y===void 0?void 0:y.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(y){return this._map=y,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=N.create("button","maplibregl-ctrl-globe",this._container),N.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._map.on("projectiontransition",this._updateGlobeIcon),this._container}onRemove(){N.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._map.off("projectiontransition",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},_.Hash=nh,_.ImageSource=ke,_.KeyboardHandler=ji,_.LngLatBounds=ui,_.LogoControl=sf,_.Map=class extends xr{get _ownerWindow(){var y,t;return((t=(y=this._container)===null||y===void 0?void 0:y.ownerDocument)===null||t===void 0?void 0:t.defaultView)||window}constructor(y){var t,a;o.cH.mark(o.cI.create);const u=Object.assign(Object.assign(Object.assign({},Mc),y),{canvasContextAttributes:Object.assign(Object.assign({},Mc.canvasContextAttributes),y.canvasContextAttributes)});if(u.minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const d=new Aa,x=new Ca;u.minZoom!==void 0&&d.setMinZoom(u.minZoom),u.maxZoom!==void 0&&d.setMaxZoom(u.maxZoom),u.minPitch!==void 0&&d.setMinPitch(u.minPitch),u.maxPitch!==void 0&&d.setMaxPitch(u.maxPitch),u.renderWorldCopies!==void 0&&d.setRenderWorldCopies(u.renderWorldCopies),u.transformConstrain!==null&&d.setConstrainOverride(u.transformConstrain),super(d,x,{bearingSnap:u.bearingSnap,zoomSnap:u.zoomSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Yp,this._controls=[],this._mapId=o.af(),this._lostContextStyle={style:null,images:null},this._contextLost=S=>{if(S.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy(),this._lostContextStyle=this._getStyleAndImages(),this.style){for(const A of Object.values(this.style._layers))if(A.type==="custom"&&console.warn(`Custom layer with id '${A.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),A._listeners)for(const[R]of Object.entries(A._listeners))console.warn(`Custom layer with id '${A.id}' had event listeners for event '${R}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this.style.destroy(),this.style=null,this.fire(new o.l("webglcontextlost",{originalEvent:S}))}else this.fire(new o.l("webglcontextlost",{originalEvent:S}))},this._contextRestored=S=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._lostContextStyle={style:null,images:null},this._setupPainter(),this.resize(),this._update(),this._resizeInternal(),this.fire(new o.l("webglcontextrestored",{originalEvent:S}))},this._onMapScroll=S=>{if(S.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=u.interactive,this._maxTileCacheSize=u.maxTileCacheSize,this._maxTileCacheZoomLevels=u.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},u.canvasContextAttributes),this._trackResize=u.trackResize===!0,this._bearingSnap=u.bearingSnap,this._zoomSnap=u.zoomSnap,this._centerClampedToGround=u.centerClampedToGround,this._refreshExpiredTiles=u.refreshExpiredTiles===!0,this._fadeDuration=u.fadeDuration,this._crossSourceCollisions=u.crossSourceCollisions===!0,this._collectResourceTiming=u.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Sc),u.locale),this._clickTolerance=u.clickTolerance,this._overridePixelRatio=u.pixelRatio,this._maxCanvasSize=u.maxCanvasSize,this._zoomLevelsToOverscale=u.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=u.transformCameraUpdate,this.transformConstrain=u.transformConstrain,this.cancelPendingTileRequestsWhileZooming=u.cancelPendingTileRequestsWhileZooming===!0,u.reduceMotion!==void 0&&(j.prefersReducedMotion=u.reduceMotion),this._imageQueueHandle=Ie.addThrottleControl((()=>this.isMoving())),this._requestManager=new $e(u.transformRequest),this._container=this._resolveContainer(u.container),u.maxBounds&&this.setMaxBounds(u.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"&&(this._ownerWindow.addEventListener("online",this._onWindowOnline,!1),this._setupResizeObserver()),this.handlers=new Tc(this,u),this._hash=u.hash&&new nh(typeof u.hash=="string"&&u.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:u.center,elevation:u.elevation,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch,roll:u.roll}),u.bounds&&(this.resize(),this.fitBounds(u.bounds,o.e({},u.fitBoundsOptions,{duration:0}))));const w=typeof u.style=="string"||((a=(t=u.style)===null||t===void 0?void 0:t.projection)===null||a===void 0?void 0:a.type)!=="globe";this.resize(null,w),this._localIdeographFontFamily=u.localIdeographFontFamily,this._validateStyle=u.validateStyle,u.style&&this.setStyle(u.style,{localIdeographFontFamily:u.localIdeographFontFamily}),u.attributionControl&&this.addControl(new hh(typeof u.attributionControl=="boolean"?void 0:u.attributionControl)),u.maplibreLogo&&this.addControl(new sf,u.logoPosition),this.on("style.load",(()=>{if(w||this._resizeTransform(),this.transform.unmodified){const S=o.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(S)}})),this.on("data",(S=>{this._update(S.dataType==="style"),this.fire(new o.l(`${S.dataType}data`,S))})),this.on("dataloading",(S=>{this.fire(new o.l(`${S.dataType}dataloading`,S))})),this.on("dataabort",(S=>{this.fire(new o.l("sourcedataabort",S))}))}_getMapId(){return this._mapId}setGlobalStateProperty(y,t){return this.style.setGlobalStateProperty(y,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(y,t){if(t===void 0&&(t=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new o.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=y.onAdd(this);this._controls.push(y);const u=this._controlPositions[t];return t.indexOf("bottom")!==-1?u.insertBefore(a,u.firstChild):u.appendChild(a),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new o.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(y);return t>-1&&this._controls.splice(t,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}coveringTiles(y){return Di(this.transform,y)}calculateCameraOptionsFromTo(y,t,a,u){return u==null&&this.terrain&&(u=this.terrain.getElevationForLngLat(a,this.transform)),super.calculateCameraOptionsFromTo(y,t,a,u)}resize(y,t=!0){if(this._lostContextStyle.style!==null)return this;this._resizeInternal(t);const a=!this._moving;return a&&(this.stop(),this.fire(new o.l("movestart",y)).fire(new o.l("move",y))),this.fire(new o.l("resize",y)),a&&this.fire(new o.l("moveend",y)),this}_resizeInternal(y=!0){const[t,a]=this._containerDimensions(),u=this._getClampedPixelRatio(t,a);if(this._resizeCanvas(t,a,u),this.painter.resize(t,a,u),this.painter.overLimit()){const d=this.painter.context.gl;this._maxCanvasSize=[d.drawingBufferWidth,d.drawingBufferHeight];const x=this._getClampedPixelRatio(t,a);this._resizeCanvas(t,a,x),this.painter.resize(t,a,x)}this._resizeTransform(y)}_resizeTransform(y=!0){var t;const[a,u]=this._containerDimensions();this.transform.resize(a,u,y),(t=this._requestedCameraState)===null||t===void 0||t.resize(a,u,y)}_getClampedPixelRatio(y,t){const{0:a,1:u}=this._maxCanvasSize,d=this.getPixelRatio(),x=y*d,w=t*d;return Math.min(x>a?a/x:1,w>u?u/w:1)*d}getPixelRatio(){var y;return(y=this._overridePixelRatio)!==null&&y!==void 0?y:devicePixelRatio}setPixelRatio(y){this._overridePixelRatio=y,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(y){return this.transform.setMaxBounds(ui.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom){const t=this.transform.zoom,a=this._getTransformForUpdate();return a.setMinZoom(y),this._applyUpdatedTransform(a),this._update(),t!==this.transform.zoom&&this.fire(new o.l("zoomstart")).fire(new o.l("zoom")).fire(new o.l("zoomend")).fire(new o.l("movestart")).fire(new o.l("move")).fire(new o.l("moveend")),this}throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom){const t=this.transform.zoom,a=this._getTransformForUpdate();return a.setMaxZoom(y),this._applyUpdatedTransform(a),this._update(),t!==this.transform.zoom&&this.fire(new o.l("zoomstart")).fire(new o.l("zoom")).fire(new o.l("zoomend")).fire(new o.l("movestart")).fire(new o.l("move")).fire(new o.l("moveend")),this}throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch){const t=this.transform.pitch,a=this._getTransformForUpdate();return a.setMinPitch(y),this._applyUpdatedTransform(a),this._update(),t!==this.transform.pitch&&this.fire(new o.l("pitchstart")).fire(new o.l("pitch")).fire(new o.l("pitchend")).fire(new o.l("movestart")).fire(new o.l("move")).fire(new o.l("moveend")),this}throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(y>=this.transform.minPitch){const t=this.transform.pitch,a=this._getTransformForUpdate();return a.setMaxPitch(y),this._applyUpdatedTransform(a),this._update(),t!==this.transform.pitch&&this.fire(new o.l("pitchstart")).fire(new o.l("pitch")).fire(new o.l("pitchend")).fire(new o.l("movestart")).fire(new o.l("move")).fire(new o.l("moveend")),this}throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.setRenderWorldCopies(y),this._update()}setTransformConstrain(y){return this.transform.setConstrainOverride(y),this._update()}project(y){return this.transform.locationToScreenPoint(o.V.convert(y),this.style&&this.terrain)}unproject(y){return this.transform.screenPointToLocation(o.P.convert(y),this.terrain)}isMoving(){var y;return this._moving||((y=this.handlers)===null||y===void 0?void 0:y.isMoving())}isZooming(){var y;return this._zooming||((y=this.handlers)===null||y===void 0?void 0:y.isZooming())}isRotating(){var y;return this._rotating||((y=this.handlers)===null||y===void 0?void 0:y.isRotating())}_createDelegatedListener(y,t,a){if(y==="mouseenter"||y==="mouseover"){let u=!1;return{layers:t,listener:a,delegates:{mousemove:x=>{const w=t.filter((A=>this.getLayer(A))),S=w.length!==0?this.queryRenderedFeatures(x.point,{layers:w}):[];S.length?u||(u=!0,a.call(this,new Hn(y,this,x.originalEvent,{features:S}))):u=!1},mouseout:()=>{u=!1}}}}if(y==="mouseleave"||y==="mouseout"){let u=!1;return{layers:t,listener:a,delegates:{mousemove:w=>{const S=t.filter((A=>this.getLayer(A)));(S.length!==0?this.queryRenderedFeatures(w.point,{layers:S}):[]).length?u=!0:u&&(u=!1,a.call(this,new Hn(y,this,w.originalEvent)))},mouseout:w=>{u&&(u=!1,a.call(this,new Hn(y,this,w.originalEvent)))}}}}{const u=d=>{const x=t.filter((S=>this.getLayer(S))),w=x.length!==0?this.queryRenderedFeatures(d.point,{layers:x}):[];w.length&&(d.features=w,a.call(this,d),delete d.features)};return{layers:t,listener:a,delegates:{[y]:u}}}}_saveDelegatedListener(y,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(t)}_removeDelegatedListener(y,t,a){if(!this._delegatedListeners||!this._delegatedListeners[y])return;const u=this._delegatedListeners[y];for(let d=0;d<u.length;d++){const x=u[d];if(x.listener===a&&x.layers.length===t.length&&x.layers.every((w=>t.includes(w)))){for(const w in x.delegates)this.off(w,x.delegates[w]);return void u.splice(d,1)}}}on(y,t,a){if(a===void 0)return super.on(y,t);const u=typeof t=="string"?[t]:t,d=this._createDelegatedListener(y,u,a);this._saveDelegatedListener(y,d);for(const x in d.delegates)this.on(x,d.delegates[x]);return{unsubscribe:()=>{this._removeDelegatedListener(y,u,a)}}}once(y,t,a){if(a===void 0)return super.once(y,t);const u=typeof t=="string"?[t]:t,d=this._createDelegatedListener(y,u,a);for(const x in d.delegates){const w=d.delegates[x];d.delegates[x]=(...S)=>{this._removeDelegatedListener(y,u,a),w(...S)}}this._saveDelegatedListener(y,d);for(const x in d.delegates)this.once(x,d.delegates[x]);return this}off(y,t,a){return a===void 0?super.off(y,t):(this._removeDelegatedListener(y,typeof t=="string"?[t]:t,a),this)}queryRenderedFeatures(y,t){if(!this.style)return[];let a;const u=y instanceof o.P||Array.isArray(y),d=u?y:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(u?{}:y)||{},d instanceof o.P||typeof d[0]=="number")a=[o.P.convert(d)];else{const x=o.P.convert(d[0]),w=o.P.convert(d[1]);a=[x,new o.P(w.x,x.y),w,new o.P(x.x,w.y),x]}return this.style.queryRenderedFeatures(a,t,this.transform)}querySourceFeatures(y,t){return this.style.querySourceFeatures(y,t)}setStyle(y,t){return(t=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(y,t))}setTransformRequest(y){return this._requestManager.setTransformRequest(y),this}_getUIString(y){const t=this._locale[y];if(t==null)throw new Error(`Missing UI string '${y}'`);return t}_updateStyle(y,t){var a,u;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(y,t)));const d=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!y)),y?(this.style=new Ia(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y,t,d):this.style.loadJSON(y,t,d),this):((u=(a=this.style)===null||a===void 0?void 0:a.projection)===null||u===void 0||u.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Ia(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,t){if(typeof y=="string"){const a=this._requestManager.transformRequest(y,"Style");o.j(a,new AbortController).then((u=>{this._updateDiff(u.data,t)})).catch((u=>{u&&this.fire(new o.k(u))}))}else typeof y=="object"&&this._updateDiff(y,t)}_updateDiff(y,t){try{this.style.setState(y,t)&&this._update(!0)}catch(a){o.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(y,t)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(y,t){return this._lazyInitEmptyStyle(),this.style.addSource(y,t),this._update(!0)}isSourceLoaded(y){const t=this.style&&this.style.tileManagers[y];if(t!==void 0)return t.loaded();this.fire(new o.k(new Error(`There is no tile manager with ID '${y}'`)))}setTerrain(y){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),y){const t=this.style.tileManagers[y.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${y.source}`);this.terrain===null&&t.reload();for(const a in this.style._layers){const u=this.style._layers[a];u.type==="hillshade"&&u.source===y.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),u.type==="color-relief"&&u.source===y.source&&o.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new mn(this.painter,t,y),this.painter.renderToTexture=new wl(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=a=>{var u;a.dataType==="style"?this.terrain.tileManager.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==y.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((u=a.source)===null||u===void 0?void 0:u.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new o.l("terrain",{terrain:y})),this}getTerrain(){var y,t;return(t=(y=this.terrain)===null||y===void 0?void 0:y.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const y=this.style&&this.style.tileManagers;for(const t of Object.values(y))if(!t.areTilesLoaded())return!1;return!0}removeSource(y){return this.style.removeSource(y),this._update(!0)}getSource(y){return this.style.getSource(y)}setSourceTileLodParams(y,t,a){if(a){const u=this.getSource(a);if(!u)throw new Error(`There is no source with ID "${a}", cannot set LOD parameters`);u.calculateTileZoom=It(Math.max(1,y),Math.max(1,t))}else for(const u in this.style.tileManagers)this.style.tileManagers[u].getSource().calculateTileZoom=It(Math.max(1,y),Math.max(1,t));return this._update(!0),this}refreshTiles(y,t){const a=this.style.tileManagers[y];if(!a)throw new Error(`There is no tile manager with ID "${y}", cannot refresh tile`);t===void 0?a.reload(!0):a.refreshTiles(t.map((u=>new o.ac(u.z,u.x,u.y))))}addImage(y,t,a={}){const{pixelRatio:u=1,sdf:d=!1,stretchX:x,stretchY:w,content:S,textFitWidth:A,textFitHeight:R}=a;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||o.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:z,height:G,data:V}=t,$=t;return this.style.addImage(y,{data:new o.R({width:z,height:G},new Uint8Array(V)),pixelRatio:u,stretchX:x,stretchY:w,content:S,textFitWidth:A,textFitHeight:R,sdf:d,version:0,userImage:$}),$.onAdd&&$.onAdd(this,y),this}}{const{width:z,height:G,data:V}=j.getImageData(t);this.style.addImage(y,{data:new o.R({width:z,height:G},V),pixelRatio:u,stretchX:x,stretchY:w,content:S,textFitWidth:A,textFitHeight:R,sdf:d,version:0})}}updateImage(y,t){const a=this.style.getImage(y);if(!a)return this.fire(new o.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=t instanceof HTMLImageElement||o.b(t)?j.getImageData(t):t,{width:d,height:x,data:w}=u;if(d===void 0||x===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(d!==a.data.width||x!==a.data.height)return this.fire(new o.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const S=!(t instanceof HTMLImageElement||o.b(t));return a.data.replace(w,S),this.style.updateImage(y,a),this}getImage(y){return this.style.getImage(y)}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new o.k(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y){return Ie.getImage(this._requestManager.transformRequest(y,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(y,t){return this._lazyInitEmptyStyle(),this.style.addLayer(y,t),this._update(!0)}moveLayer(y,t){return this.style.moveLayer(y,t),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(y,t,a){return this.style.setLayerZoomRange(y,t,a),this._update(!0)}setFilter(y,t,a={}){return this.style.setFilter(y,t,a),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,t,a,u={}){return this.style.setPaintProperty(y,t,a,u),this._update(!0)}getPaintProperty(y,t){return this.style.getPaintProperty(y,t)}setLayoutProperty(y,t,a,u={}){return this.style.setLayoutProperty(y,t,a,u),this._update(!0)}getLayoutProperty(y,t){return this.style.getLayoutProperty(y,t)}setGlyphs(y,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(y,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(y,t,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(y,t,a,(u=>{u||this._update(!0)})),this}removeSprite(y){return this._lazyInitEmptyStyle(),this.style.removeSprite(y),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(y,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(y,t,(a=>{a||this._update(!0)})),this}setLight(y,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(y,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(y,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(y,t){return this.style.setFeatureState(y,t),this._update()}removeFeatureState(y,t){return this.style.removeFeatureState(y,t),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let y=0,t=0;return this._container&&(y=this._container.clientWidth||400,t=this._container.clientHeight||300),[y,t]}_setupResizeObserver(){var y;let t=!1;const a=ih((d=>{this._trackResize&&!this._removed&&(this.resize(d),this.redraw())}),50),u=(y=this._ownerWindow.ResizeObserver)!==null&&y!==void 0?y:ResizeObserver;this._resizeObserver=new u((d=>{t?a(d):t=!0})),this._resizeObserver.observe(this._container)}_resolveContainer(y){if(typeof y=="string"){const t=document.getElementById(y);if(!t)throw new Error(`Container '${y}' not found.`);return t}if(y instanceof HTMLElement||y&&typeof y=="object"&&y.nodeType===1)return y;throw new Error("Invalid type: 'container' must be a String or HTMLElement.")}_setupContainer(){const y=this._container;y.classList.add("maplibregl-map");const t=this._canvasContainer=N.create("div","maplibregl-canvas-container",y);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=N.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const a=this._containerDimensions(),u=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],u);const d=this._controlContainer=N.create("div","maplibregl-control-container",y),x=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((w=>{x[w]=N.create("div",`maplibregl-ctrl-${w} `,d)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,t,a){this._canvas.width=Math.floor(a*y),this._canvas.height=Math.floor(a*t),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const y=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",(u=>{t={requestedAttributes:y},u&&(t.statusMessage=u.statusMessage,t.type=u.type)}),{once:!0});let a=null;if(a=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,y):this._canvas.getContext("webgl2",y)||this._canvas.getContext("webgl",y),!a){const u="Failed to initialize WebGL";throw t?(t.message=u,new Error(JSON.stringify(t))):new Error(u)}this.painter=new Xd(a,this.transform),W.testSupport(a)}migrateProjection(y,t){super.migrateProjection(y,t),this.painter.transform=y,this.fire(new o.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_render(y){var t,a,u,d,x;const w=this._idleTriggered?this._fadeDuration:0,S=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),this._removed)return;let A=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const G=this.transform.zoom,V=J();this.style.zoomHistory.update(G,V);const $=new o.H(G,{now:V,fadeDuration:w,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ee=$.crossFadingFactor();ee===1&&ee===this._crossFadingFactor||(A=!0,this._crossFadingFactor=ee),this.style.update($)}const R=((a=this.style.projection)===null||a===void 0?void 0:a.transitionState)>0!==S;(u=this.style.projection)===null||u===void 0||u.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((d=this.style.projection)===null||d===void 0?void 0:d.transitionState,(x=this.style.projection)===null||x===void 0?void 0:x.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||R)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,w,this._crossSourceCollisions,R),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,showPadding:this.showPadding}),this.fire(new o.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.cH.mark(o.cI.load),this.fire(new o.l("load"))),this.style&&(this.style.hasTransitions()||A)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const z=this._sourcesDirty||this._styleDirty||this._placementDirty;return z||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.l("idle")),!this._loaded||this._fullyLoaded||z||(this._fullyLoaded=!0,o.cH.mark(o.cI.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var y;this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&this._ownerWindow.removeEventListener("online",this._onWindowOnline,!1),Ie.removeThrottleControl(this._imageQueueHandle),(y=this._resizeObserver)===null||y===void 0||y.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t?.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),N.remove(this._canvasContainer),N.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),o.cH.remove(),this._removed=!0,this.fire(new o.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,j.frame(this._frameRequest,(y=>{o.cH.recordStartOfFrameAt(y),this._frameRequest=null;try{this._render(y)}catch(t){if(!o.Z(t)&&!(function(a){return a.message===Yu})(t))throw t}}),(()=>{}),this._ownerWindow))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get version(){return dh}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(y){return this._lazyInitEmptyStyle(),this.style.setProjection(y),this._update(!0)}},_.MapMouseEvent=Hn,_.MapTouchEvent=pl,_.MapWheelEvent=Yd,_.Marker=Ml,_.NavigationControl=class{constructor(y){this._updateZoomButtons=()=>{const t=this._map.getZoom(),a=t===this._map.getMaxZoom(),u=t===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,a)=>{const u=this._map._getUIString(`NavigationControl.${a}`);t.title=u,t.setAttribute("aria-label",u)},this.options=o.e({},fh,y),this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(t=>this._map.zoomIn({},{originalEvent:t}))),N.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(t=>this._map.zoomOut({},{originalEvent:t}))),N.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})),this._compassIcon=N.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Tl(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){N.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(y,t){const a=N.create("button",y,this._container);return a.type="button",a.addEventListener("click",t),a}},_.Popup=class extends o.E{constructor(y){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&N.remove(this._content),this._container&&(N.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new o.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=N.create("div","maplibregl-popup",this._map.getContainer()),this._tip=N.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const w of this.options.className.split(" "))this._container.classList.add(w);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Ec(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const a=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let u=this.options.anchor;const d=Pc(this.options.offset);if(!u){const w=this._container.offsetWidth,S=this._container.offsetHeight,A=(function(z){var G,V,$,ee;return z?{top:(G=z.top)!==null&&G!==void 0?G:0,right:(V=z.right)!==null&&V!==void 0?V:0,bottom:($=z.bottom)!==null&&$!==void 0?$:0,left:(ee=z.left)!==null&&ee!==void 0?ee:0}:{top:0,right:0,bottom:0,left:0}})(this.options.padding);let R;R=a.y+d.bottom.y<S+A.top?["top"]:a.y>this._map.transform.height-S-A.bottom?["bottom"]:[],a.x<w/2+A.left?R.push("left"):a.x>this._map.transform.width-w/2-A.right&&R.push("right"),u=R.length===0?"bottom":R.join("-")}let x=a.add(d[u]);this.options.subpixelPositioning||(x=x.round()),N.setTransform(this._container,`${Sl[u]} translate(${x.x}px,${x.y}px)`),Ac(this._container,u,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(gh),y)}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=o.V.convert(y),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const t=document.createDocumentFragment(),a=document.createElement("body");let u;for(a.innerHTML=y;u=a.firstChild,u;)t.appendChild(u);return this.setDOMContent(t)}getMaxWidth(){var y;return(y=this._container)===null||y===void 0?void 0:y.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=N.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(y),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(y){return this._container&&this._container.classList.add(y),this}removeClassName(y){return this._container&&this._container.classList.remove(y),this}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){if(this._container)return this._container.classList.toggle(y)}setSubpixelPositioning(y){this.options.subpixelPositioning=y}setPadding(y){this.options.padding=y,this._update()}_createCloseButton(){this.options.closeButton&&(this._closeButton=N.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(Cc);y&&y.focus()}},_.RasterDEMTileSource=Ri,_.RasterTileSource=Si,_.ScaleControl=class{constructor(y){this._onMove=()=>{El(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,El(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},mh),y)}getDefaultPosition(){return"bottom-left"}onAdd(y){return this._map=y,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-scale",y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){N.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},_.ScrollZoomHandler=bc,_.Style=Ia,_.TerrainControl=class{constructor(y){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=y}onAdd(y){return this._map=y,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=N.create("button","maplibregl-ctrl-terrain",this._container),N.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){N.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},_.TwoFingersTouchPitchHandler=ef,_.TwoFingersTouchRotateHandler=lh,_.TwoFingersTouchZoomHandler=oh,_.TwoFingersTouchZoomRotateHandler=xl,_.VectorTileSource=Ji,_.VideoSource=ht,_.addSourceType=(y,t)=>o._(void 0,void 0,void 0,(function*(){if(jt(y))throw new Error(`A source type called "${y}" already exists.`);((a,u)=>{st[a]=u})(y,t)})),_.clearPrewarmedResources=function(){const y=mt;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(Ii),mt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},_.createTileMesh=fd,_.getMaxParallelImageRequests=function(){return o.c.MAX_PARALLEL_IMAGE_REQUESTS},_.getRTLTextPluginStatus=function(){return U().getRTLTextPluginStatus()},_.getVersion=function(){return _h},_.getWorkerCount=function(){return yi.workerCount},_.getWorkerUrl=function(){return o.c.WORKER_URL},_.importScriptInWorkers=function(y){return pi().broadcast("IS",y)},_.isTimeFrozen=function(){return K.isFrozen()},_.now=J,_.prewarm=function(){ni().acquire(Ii)},_.restoreNow=function(){K.restoreNow()},_.setMaxParallelImageRequests=function(y){o.c.MAX_PARALLEL_IMAGE_REQUESTS=y},_.setNow=function(y){K.setNow(y)},_.setRTLTextPlugin=function(y,t){return U().setRTLTextPlugin(y,t)},_.setWorkerCount=function(y){yi.workerCount=y},_.setWorkerUrl=function(y){o.c.WORKER_URL=y}}));var v=s;return v}))})(op)),op.exports}var Ng=MT(),ms=Uint8Array,du=Uint16Array,ET=Int32Array,Zv=new ms([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),$v=new ms([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),AT=new ms([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Yv=function(m,i){for(var s=new du(31),c=0;c<31;++c)s[c]=i+=1<<m[c-1];for(var f=new ET(s[30]),c=1;c<30;++c)for(var v=s[c];v<s[c+1];++v)f[v]=v-s[c]<<5|c;return{b:s,r:f}},Kv=Yv(Zv,2),Jv=Kv.b,CT=Kv.r;Jv[28]=258,CT[258]=28;var PT=Yv($v,0),IT=PT.b,Bg=new du(32768);for(var bn=0;bn<32768;++bn){var ko=(bn&43690)>>1|(bn&21845)<<1;ko=(ko&52428)>>2|(ko&13107)<<2,ko=(ko&61680)>>4|(ko&3855)<<4,Bg[bn]=((ko&65280)>>8|(ko&255)<<8)>>1}var Jh=(function(m,i,s){for(var c=m.length,f=0,v=new du(i);f<c;++f)m[f]&&++v[m[f]-1];var _=new du(i);for(f=1;f<i;++f)_[f]=_[f-1]+v[f-1]<<1;var o;if(s){o=new du(1<<i);var M=15-i;for(f=0;f<c;++f)if(m[f])for(var C=f<<4|m[f],D=i-m[f],F=_[m[f]-1]++<<D,O=F|(1<<D)-1;F<=O;++F)o[Bg[F]>>M]=C}else for(o=new du(c),f=0;f<c;++f)m[f]&&(o[f]=Bg[_[m[f]-1]++]>>15-m[f]);return o}),cd=new ms(288);for(var bn=0;bn<144;++bn)cd[bn]=8;for(var bn=144;bn<256;++bn)cd[bn]=9;for(var bn=256;bn<280;++bn)cd[bn]=7;for(var bn=280;bn<288;++bn)cd[bn]=8;var Qv=new ms(32);for(var bn=0;bn<32;++bn)Qv[bn]=5;var RT=Jh(cd,9,1),DT=Jh(Qv,5,1),Km=function(m){for(var i=m[0],s=1;s<m.length;++s)m[s]>i&&(i=m[s]);return i},ks=function(m,i,s){var c=i/8|0;return(m[c]|m[c+1]<<8)>>(i&7)&s},Jm=function(m,i){var s=i/8|0;return(m[s]|m[s+1]<<8|m[s+2]<<16)>>(i&7)},LT=function(m){return(m+7)/8|0},FT=function(m,i,s){return(s==null||s>m.length)&&(s=m.length),new ms(m.subarray(i,s))},zT=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ps=function(m,i,s){var c=new Error(i||zT[m]);if(c.code=m,Error.captureStackTrace&&Error.captureStackTrace(c,ps),!s)throw c;return c},B_=function(m,i,s,c){var f=m.length,v=0;if(!f||i.f&&!i.l)return s||new ms(0);var _=!s,o=_||i.i!=2,M=i.i;_&&(s=new ms(f*3));var C=function(pi){var Ti=s.length;if(pi>Ti){var xi=new ms(Math.max(Ti*2,pi));xi.set(s),s=xi}},D=i.f||0,F=i.p||0,O=i.b||0,j=i.l,K=i.d,J=i.m,N=i.n,W=f*8;do{if(!j){D=ks(m,F,1);var ge=ks(m,F+1,3);if(F+=3,ge)if(ge==1)j=RT,K=DT,J=9,N=5;else if(ge==2){var De=ks(m,F,31)+257,Ie=ks(m,F+10,15)+4,$e=De+ks(m,F+5,31)+1;F+=14;for(var re=new ms($e),fe=new ms(19),Oe=0;Oe<Ie;++Oe)fe[AT[Oe]]=ks(m,F+Oe*3,7);F+=Ie*3;for(var tt=Km(fe),Qe=(1<<tt)-1,pt=Jh(fe,tt,1),Oe=0;Oe<$e;){var ct=pt[ks(m,F,Qe)];F+=ct&15;var de=ct>>4;if(de<16)re[Oe++]=de;else{var nt=0,Je=0;for(de==16?(Je=3+ks(m,F,3),F+=2,nt=re[Oe-1]):de==17?(Je=3+ks(m,F,7),F+=3):de==18&&(Je=11+ks(m,F,127),F+=7);Je--;)re[Oe++]=nt}}var ut=re.subarray(0,De),xt=re.subarray(De);J=Km(ut),N=Km(xt),j=Jh(ut,J,1),K=Jh(xt,N,1)}else ps(1);else{var de=LT(F)+4,ve=m[de-4]|m[de-3]<<8,Me=de+ve;if(Me>f){M&&ps(0);break}o&&C(O+ve),s.set(m.subarray(de,Me),O),i.b=O+=ve,i.p=F=Me*8,i.f=D;continue}if(F>W){M&&ps(0);break}}o&&C(O+131072);for(var At=(1<<J)-1,Rt=(1<<N)-1,oi=F;;oi=F){var nt=j[Jm(m,F)&At],ti=nt>>4;if(F+=nt&15,F>W){M&&ps(0);break}if(nt||ps(2),ti<256)s[O++]=ti;else if(ti==256){oi=F,j=null;break}else{var Ii=ti-254;if(ti>264){var Oe=ti-257,yi=Zv[Oe];Ii=ks(m,F,(1<<yi)-1)+Jv[Oe],F+=yi}var ot=K[Jm(m,F)&Rt],mt=ot>>4;ot||ps(3),F+=ot&15;var xt=IT[mt];if(mt>3){var yi=$v[mt];xt+=Jm(m,F)&(1<<yi)-1,F+=yi}if(F>W){M&&ps(0);break}o&&C(O+131072);var Dt=O+Ii;if(O<xt){var ni=v-xt,Gt=Math.min(xt,Dt);for(ni+O<0&&ps(3);O<Gt;++O)s[O]=c[ni+O]}for(;O<Dt;++O)s[O]=s[O-xt]}}i.l=j,i.p=oi,i.b=O,i.f=D,j&&(D=1,i.m=J,i.d=K,i.n=N)}while(!D);return O!=s.length&&_?FT(s,0,O):s.subarray(0,O)},OT=new ms(0),NT=function(m){(m[0]!=31||m[1]!=139||m[2]!=8)&&ps(6,"invalid gzip data");var i=m[3],s=10;i&4&&(s+=(m[10]|m[11]<<8)+2);for(var c=(i>>3&1)+(i>>4&1);c>0;c-=!m[s++]);return s+(i&2)},BT=function(m){var i=m.length;return(m[i-4]|m[i-3]<<8|m[i-2]<<16|m[i-1]<<24)>>>0},kT=function(m,i){return((m[0]&15)!=8||m[0]>>4>7||(m[0]<<8|m[1])%31)&&ps(6,"invalid zlib data"),(m[1]>>5&1)==1&&ps(6,"invalid zlib data: "+(m[1]&32?"need":"unexpected")+" dictionary"),(m[1]>>3&4)+2};function UT(m,i){return B_(m,{i:2},i,i)}function VT(m,i){var s=NT(m);return s+8>m.length&&ps(6,"invalid gzip data"),B_(m.subarray(s,-8),{i:2},new ms(BT(m)),i)}function GT(m,i){return B_(m.subarray(kT(m),-4),{i:2},i,i)}function HT(m,i){return m[0]==31&&m[1]==139&&m[2]==8?VT(m,i):(m[0]&15)!=8||m[0]>>4>7||(m[0]<<8|m[1])%31?UT(m,i):GT(m,i)}var jT=typeof TextDecoder<"u"&&new TextDecoder,WT=0;try{jT.decode(OT,{stream:!0}),WT=1}catch{}var qT=Object.defineProperty,XT=Math.pow,an=(m,i)=>qT(m,"name",{value:i,configurable:!0}),fr=(m,i,s)=>new Promise((c,f)=>{var v=M=>{try{o(s.next(M))}catch(C){f(C)}},_=M=>{try{o(s.throw(M))}catch(C){f(C)}},o=M=>M.done?c(M.value):Promise.resolve(M.value).then(v,_);o((s=s.apply(m,i)).next())});an((m,i)=>{let s=!1,c="",f=L.GridLayer.extend({createTile:an((v,_)=>{let o=document.createElement("img"),M=new AbortController,C=M.signal;return o.cancel=()=>{M.abort()},s||(m.getHeader().then(D=>{D.tileType===1?console.error("Error: archive contains MVT vector tiles, but leafletRasterLayer is for displaying raster tiles. See https://github.com/protomaps/PMTiles/tree/main/js for details."):D.tileType===2?c="image/png":D.tileType===3?c="image/jpeg":D.tileType===4?c="image/webp":D.tileType===5&&(c="image/avif")}),s=!0),m.getZxy(v.z,v.x,v.y,C).then(D=>{if(D){let F=new Blob([D.data],{type:c}),O=window.URL.createObjectURL(F);o.src=O}else o.style.display="none";o.cancel=void 0,_(void 0,o)}).catch(D=>{if(D.name!=="AbortError")throw D}),o},"createTile"),_removeTile:an(function(v){let _=this._tiles[v];_&&(_.el.cancel&&_.el.cancel(),_.el.width=0,_.el.height=0,_.el.deleted=!0,L.DomUtil.remove(_.el),delete this._tiles[v],this.fire("tileunload",{tile:_.el,coords:this._keyToTileCoords(v)}))},"_removeTile")});return new f(i)},"leafletRasterLayer");var ZT=an(m=>(i,s)=>{if(s instanceof AbortController)return m(i,s);let c=new AbortController;return m(i,c).then(f=>s(void 0,f.data,f.cacheControl||"",f.expires||""),f=>s(f)).catch(f=>s(f)),{cancel:an(()=>c.abort(),"cancel")}},"v3compat"),eb=class{constructor(i){this.tilev4=an((s,c)=>fr(this,null,function*(){if(s.type==="json"){let j=s.url.substr(10),K=this.tiles.get(j);if(K||(K=new M0(j),this.tiles.set(j,K)),this.metadata){let N=yield K.getTileJson(s.url);return c.signal.throwIfAborted(),{data:N}}let J=yield K.getHeader();return c.signal.throwIfAborted(),(J.minLon>=J.maxLon||J.minLat>=J.maxLat)&&console.error(`Bounds of PMTiles archive ${J.minLon},${J.minLat},${J.maxLon},${J.maxLat} are not valid.`),{data:{tiles:[`${s.url}/{z}/{x}/{y}`],minzoom:J.minZoom,maxzoom:J.maxZoom,bounds:[J.minLon,J.minLat,J.maxLon,J.maxLat]}}}let f=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),v=s.url.match(f);if(!v)throw new Error("Invalid PMTiles protocol URL");let _=v[1],o=this.tiles.get(_);o||(o=new M0(_),this.tiles.set(_,o));let M=v[2],C=v[3],D=v[4],F=yield o.getHeader(),O=yield o?.getZxy(+M,+C,+D,c.signal);if(c.signal.throwIfAborted(),O)return{data:new Uint8Array(O.data),cacheControl:O.cacheControl,expires:O.expires};if(F.tileType===1){if(this.errorOnMissingTile)throw new Error("Tile not found.");return{data:new Uint8Array}}return{data:null}}),"tilev4"),this.tile=ZT(this.tilev4),this.tiles=new Map,this.metadata=i?.metadata||!1,this.errorOnMissingTile=i?.errorOnMissingTile||!1}add(i){this.tiles.set(i.source.getKey(),i)}get(i){return this.tiles.get(i)}};an(eb,"Protocol");var $T=eb;function tb(m,i){return(i>>>0)*4294967296+(m>>>0)}an(tb,"toNum");function ib(m,i){let s=i.buf,c=s[i.pos++],f=(c&112)>>4;if(c<128||(c=s[i.pos++],f|=(c&127)<<3,c<128)||(c=s[i.pos++],f|=(c&127)<<10,c<128)||(c=s[i.pos++],f|=(c&127)<<17,c<128)||(c=s[i.pos++],f|=(c&127)<<24,c<128)||(c=s[i.pos++],f|=(c&1)<<31,c<128))return tb(m,f);throw new Error("Expected varint not more than 10 bytes")}an(ib,"readVarintRemainder");function hu(m){let i=m.buf,s=i[m.pos++],c=s&127;return s<128||(s=i[m.pos++],c|=(s&127)<<7,s<128)||(s=i[m.pos++],c|=(s&127)<<14,s<128)||(s=i[m.pos++],c|=(s&127)<<21,s<128)?c:(s=i[m.pos],c|=(s&15)<<28,ib(c,m))}an(hu,"readVarint");function k_(m,i,s,c,f){return f===0?c!==0?[m-1-s,m-1-i]:[s,i]:[i,s]}an(k_,"rotate");function nb(m,i,s){if(m>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");if(i>=1<<m||s>=1<<m)throw new Error("tile x/y outside zoom level bounds");let c=((1<<m)*(1<<m)-1)/3,f=m-1,[v,_]=[i,s];for(let o=1<<f;o>0;o>>=1){let M=v&o,C=_&o;c+=(3*M^C)*(1<<f),[v,_]=k_(o,v,_,M,C),f--}return c}an(nb,"zxyToTileId");function rb(m){let i=3*m+1;return i<4294967296?31-Math.clz32(i):63-Math.clz32(i/4294967296)}an(rb,"tileIdToZ");function YT(m){let i=rb(m)>>1;if(i>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");let s=((1<<i)*(1<<i)-1)/3,c=m-s,f=0,v=0,_=1<<i;for(let o=1;o<_;o<<=1){let M=o&c/2,C=o&(c^M);[f,v]=k_(o,f,v,M,C),c=c/2,f+=M,v+=C}return[i,f,v]}an(YT,"tileIdToZxy");var KT=(m=>(m[m.Unknown=0]="Unknown",m[m.None=1]="None",m[m.Gzip=2]="Gzip",m[m.Brotli=3]="Brotli",m[m.Zstd=4]="Zstd",m))(KT||{});function bp(m,i){return fr(this,null,function*(){if(i===1||i===0)return m;if(i===2){if(typeof globalThis.DecompressionStream>"u")return HT(new Uint8Array(m));let s=new Response(m).body;if(!s)throw new Error("Failed to read response stream");let c=s.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(c).arrayBuffer()}throw new Error("Compression method not supported")})}an(bp,"defaultDecompress");var JT=(m=>(m[m.Unknown=0]="Unknown",m[m.Mvt=1]="Mvt",m[m.Png=2]="Png",m[m.Jpeg=3]="Jpeg",m[m.Webp=4]="Webp",m[m.Avif=5]="Avif",m[m.Mlt=6]="Mlt",m))(JT||{});function sb(m){return m===1?".mvt":m===2?".png":m===3?".jpg":m===4?".webp":m===5?".avif":m===6?".mlt":""}an(sb,"tileTypeExt");var QT=127;function ab(m,i){let s=0,c=m.length-1;for(;s<=c;){let f=c+s>>1,v=i-m[f].tileId;if(v>0)s=f+1;else if(v<0)c=f-1;else return m[f]}return c>=0&&(m[c].runLength===0||i-m[c].tileId<m[c].runLength)?m[c]:null}an(ab,"findTile");var eS=class{constructor(i){this.file=i}getKey(){return this.file.name}getBytes(i,s){return fr(this,null,function*(){return{data:yield this.file.slice(i,i+s).arrayBuffer()}})}};an(eS,"FileSource");var ob=class{constructor(i,s=new Headers){var c,f;this.url=i,this.customHeaders=s,this.mustReload=!1;let v="";"navigator"in globalThis&&(v=(f=(c=globalThis.navigator)==null?void 0:c.userAgent)!=null?f:"");let _=v.indexOf("Windows")>-1,o=/Chrome|Chromium|Edg|OPR|Brave/.test(v);this.chromeWindowsNoCache=!1,_&&o&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(i){this.customHeaders=i}getBytes(i,s,c,f){return fr(this,null,function*(){let v,_;c?_=c:(v=new AbortController,_=v.signal);let o=new Headers(this.customHeaders);o.set("range",`bytes=${i}-${i+s-1}`);let M;this.mustReload?M="reload":this.chromeWindowsNoCache&&(M="no-store");let C=yield fetch(this.url,{signal:_,cache:M,headers:o});if(i===0&&C.status===416){let O=C.headers.get("Content-Range");if(!O||!O.startsWith("bytes */"))throw new Error("Missing content-length on 416 response");let j=+O.substr(8);C=yield fetch(this.url,{signal:_,cache:"reload",headers:{range:`bytes=0-${j-1}`}})}let D=C.headers.get("Etag");if(D!=null&&D.startsWith("W/")&&(D=null),C.status===416||f&&D&&D!==f)throw this.mustReload=!0,new kg(`Server returned non-matching ETag ${f} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(C.status>=300)throw new Error(`Bad response code: ${C.status}`);let F=C.headers.get("Content-Length");if(C.status===200&&(!F||+F>s))throw v&&v.abort(),new Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield C.arrayBuffer(),etag:D||void 0,cacheControl:C.headers.get("Cache-Control")||void 0,expires:C.headers.get("Expires")||void 0}})}};an(ob,"FetchSource");var tS=ob;function Ms(m,i){let s=m.getUint32(i+4,!0),c=m.getUint32(i+0,!0);return s*XT(2,32)+c}an(Ms,"getUint64");function lb(m,i){let s=new DataView(m),c=s.getUint8(7);if(c>3)throw new Error(`Archive is spec version ${c} but this library supports up to spec version 3`);return{specVersion:c,rootDirectoryOffset:Ms(s,8),rootDirectoryLength:Ms(s,16),jsonMetadataOffset:Ms(s,24),jsonMetadataLength:Ms(s,32),leafDirectoryOffset:Ms(s,40),leafDirectoryLength:Ms(s,48),tileDataOffset:Ms(s,56),tileDataLength:Ms(s,64),numAddressedTiles:Ms(s,72),numTileEntries:Ms(s,80),numTileContents:Ms(s,88),clustered:s.getUint8(96)===1,internalCompression:s.getUint8(97),tileCompression:s.getUint8(98),tileType:s.getUint8(99),minZoom:s.getUint8(100),maxZoom:s.getUint8(101),minLon:s.getInt32(102,!0)/1e7,minLat:s.getInt32(106,!0)/1e7,maxLon:s.getInt32(110,!0)/1e7,maxLat:s.getInt32(114,!0)/1e7,centerZoom:s.getUint8(118),centerLon:s.getInt32(119,!0)/1e7,centerLat:s.getInt32(123,!0)/1e7,etag:i}}an(lb,"bytesToHeader");function U_(m){let i={buf:new Uint8Array(m),pos:0},s=hu(i),c=[],f=0;for(let v=0;v<s;v++){let _=hu(i);c.push({tileId:f+_,offset:0,length:0,runLength:1}),f+=_}for(let v=0;v<s;v++)c[v].runLength=hu(i);for(let v=0;v<s;v++)c[v].length=hu(i);for(let v=0;v<s;v++){let _=hu(i);_===0&&v>0?c[v].offset=c[v-1].offset+c[v-1].length:c[v].offset=_-1}return c}an(U_,"deserializeIndex");var cb=class extends Error{};an(cb,"EtagMismatch");var kg=cb;function V_(m,i){return fr(this,null,function*(){let s=yield m.getBytes(0,16384);if(new DataView(s.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");let c=s.data.slice(0,QT),f=lb(c,s.etag),v=s.data.slice(f.rootDirectoryOffset,f.rootDirectoryOffset+f.rootDirectoryLength),_=`${m.getKey()}|${f.etag||""}|${f.rootDirectoryOffset}|${f.rootDirectoryLength}`,o=U_(yield i(v,f.internalCompression));return[f,[_,o.length,o]]})}an(V_,"getHeaderAndRoot");function G_(m,i,s,c,f){return fr(this,null,function*(){let v=yield m.getBytes(s,c,void 0,f.etag),_=yield i(v.data,f.internalCompression),o=U_(_);if(o.length===0)throw new Error("Empty directory is invalid");return o})}an(G_,"getDirectory");var iS=class{constructor(i=100,s=!0,c=bp){this.cache=new Map,this.maxCacheEntries=i,this.counter=1,this.decompress=c}getHeader(i){return fr(this,null,function*(){let s=i.getKey(),c=this.cache.get(s);if(c)return c.lastUsed=this.counter++,c.data;let f=yield V_(i,this.decompress);return f[1]&&this.cache.set(f[1][0],{lastUsed:this.counter++,data:f[1][2]}),this.cache.set(s,{lastUsed:this.counter++,data:f[0]}),this.prune(),f[0]})}getDirectory(i,s,c,f){return fr(this,null,function*(){let v=`${i.getKey()}|${f.etag||""}|${s}|${c}`,_=this.cache.get(v);if(_)return _.lastUsed=this.counter++,_.data;let o=yield G_(i,this.decompress,s,c,f);return this.cache.set(v,{lastUsed:this.counter++,data:o}),this.prune(),o})}prune(){if(this.cache.size>this.maxCacheEntries){let i=1/0,s;this.cache.forEach((c,f)=>{c.lastUsed<i&&(i=c.lastUsed,s=f)}),s&&this.cache.delete(s)}}invalidate(i){return fr(this,null,function*(){this.cache.delete(i.getKey())})}};an(iS,"ResolvedValueCache");var ub=class{constructor(i=100,s=!0,c=bp){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=i,this.counter=1,this.decompress=c}getHeader(i){return fr(this,null,function*(){let s=i.getKey(),c=this.cache.get(s);if(c)return c.lastUsed=this.counter++,yield c.data;let f=new Promise((v,_)=>{V_(i,this.decompress).then(o=>{o[1]&&this.cache.set(o[1][0],{lastUsed:this.counter++,data:Promise.resolve(o[1][2])}),v(o[0]),this.prune()}).catch(o=>{_(o)})});return this.cache.set(s,{lastUsed:this.counter++,data:f}),f})}getDirectory(i,s,c,f){return fr(this,null,function*(){let v=`${i.getKey()}|${f.etag||""}|${s}|${c}`,_=this.cache.get(v);if(_)return _.lastUsed=this.counter++,yield _.data;let o=new Promise((M,C)=>{G_(i,this.decompress,s,c,f).then(D=>{M(D),this.prune()}).catch(D=>{C(D)})});return this.cache.set(v,{lastUsed:this.counter++,data:o}),o})}prune(){if(this.cache.size>=this.maxCacheEntries){let i=1/0,s;this.cache.forEach((c,f)=>{c.lastUsed<i&&(i=c.lastUsed,s=f)}),s&&this.cache.delete(s)}}invalidate(i){return fr(this,null,function*(){let s=i.getKey();if(this.invalidations.get(s))return yield this.invalidations.get(s);this.cache.delete(i.getKey());let c=new Promise((f,v)=>{this.getHeader(i).then(_=>{f(),this.invalidations.delete(s)}).catch(_=>{v(_)})});this.invalidations.set(s,c)})}};an(ub,"SharedPromiseCache");var nS=ub,hb=class{constructor(i,s,c){typeof i=="string"?this.source=new tS(i):this.source=i,c?this.decompress=c:this.decompress=bp,s?this.cache=s:this.cache=new nS}getHeader(){return fr(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(i,s,c,f){return fr(this,null,function*(){let v=nb(i,s,c),_=yield this.cache.getHeader(this.source);if(i<_.minZoom||i>_.maxZoom)return;let o=_.rootDirectoryOffset,M=_.rootDirectoryLength;for(let C=0;C<=3;C++){let D=yield this.cache.getDirectory(this.source,o,M,_),F=ab(D,v);if(F){if(F.runLength>0){let O=yield this.source.getBytes(_.tileDataOffset+F.offset,F.length,f,_.etag);return{data:yield this.decompress(O.data,_.tileCompression),cacheControl:O.cacheControl,expires:O.expires}}o=_.leafDirectoryOffset+F.offset,M=F.length}else return}throw new Error("Maximum directory depth exceeded")})}getZxy(i,s,c,f){return fr(this,null,function*(){try{return yield this.getZxyAttempt(i,s,c,f)}catch(v){if(v instanceof kg)return this.cache.invalidate(this.source),yield this.getZxyAttempt(i,s,c,f);throw v}})}getMetadataAttempt(){return fr(this,null,function*(){let i=yield this.cache.getHeader(this.source),s=yield this.source.getBytes(i.jsonMetadataOffset,i.jsonMetadataLength,void 0,i.etag),c=yield this.decompress(s.data,i.internalCompression),f=new TextDecoder("utf-8");return JSON.parse(f.decode(c))})}getMetadata(){return fr(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(i){if(i instanceof kg)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw i}})}getTileJson(i){return fr(this,null,function*(){let s=yield this.getHeader(),c=yield this.getMetadata(),f=sb(s.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${i}/{z}/{x}/{y}${f}`],vector_layers:c.vector_layers,attribution:c.attribution,description:c.description,name:c.name,version:c.version,bounds:[s.minLon,s.minLat,s.maxLon,s.maxLat],center:[s.centerLon,s.centerLat,s.centerZoom],minzoom:s.minZoom,maxzoom:s.maxZoom}})}};an(hb,"PMTiles");var M0=hb;const rS=m=>{const{style:i,zoom:s,pitch:c,bearing:f,center:v}=m,_=new $T;return Ng.addProtocol("pmtiles",_.tile),{map:new Ng.Map({container:"map",center:v,style:i,zoom:s,pitch:c,bearing:f,attributionControl:{compact:!0},renderWorldCopies:!1,maplibreLogo:!0})}};const H_="182",sS=0,E0=1,aS=2,lp=1,oS=2,$h=3,ro=0,Qr=1,As=2,io=0,Xl=1,A0=2,C0=3,P0=4,lS=5,Hl=100,cS=101,uS=102,hS=103,dS=104,fS=200,pS=201,mS=202,gS=203,Ug=204,Vg=205,_S=206,yS=207,xS=208,vS=209,bS=210,wS=211,TS=212,SS=213,MS=214,Gg=0,Hg=1,jg=2,mu=3,Wg=4,qg=5,Xg=6,Zg=7,db=0,ES=1,AS=2,fa=0,fb=1,pb=2,mb=3,gb=4,_b=5,yb=6,xb=7,I0="attached",CS="detached",vb=300,Zl=301,gu=302,$g=303,Yg=304,wp=306,_u=1e3,ha=1001,mp=1002,ir=1003,bb=1004,Yh=1005,nr=1006,cp=1007,Qa=1008,gs=1009,wb=1010,Tb=1011,id=1012,j_=1013,ga=1014,Cs=1015,so=1016,W_=1017,q_=1018,nd=1020,Sb=35902,Mb=35899,Eb=1021,Ab=1022,Ps=1023,ao=1026,Wl=1027,X_=1028,Z_=1029,yu=1030,$_=1031,Y_=1033,up=33776,hp=33777,dp=33778,fp=33779,Kg=35840,Jg=35841,Qg=35842,e_=35843,t_=36196,i_=37492,n_=37496,r_=37488,s_=37489,a_=37490,o_=37491,l_=37808,c_=37809,u_=37810,h_=37811,d_=37812,f_=37813,p_=37814,m_=37815,g_=37816,__=37817,y_=37818,x_=37819,v_=37820,b_=37821,w_=36492,T_=36494,S_=36495,M_=36283,E_=36284,A_=36285,C_=36286,rd=2300,sd=2301,Qm=2302,R0=2400,D0=2401,L0=2402,PS=2500,IS=0,Cb=1,P_=2,RS=3200,Pb=0,DS=1,Xo="",Sr="srgb",Vr="srgb-linear",gp="linear",en="srgb",$c=7680,F0=519,LS=512,FS=513,zS=514,K_=515,OS=516,NS=517,J_=518,BS=519,I_=35044,z0="300 es",da=2e3,_p=2001;function Ib(m){for(let i=m.length-1;i>=0;--i)if(m[i]>=65535)return!0;return!1}function kS(m){return ArrayBuffer.isView(m)&&!(m instanceof DataView)}function ad(m){return document.createElementNS("http://www.w3.org/1999/xhtml",m)}function US(){const m=ad("canvas");return m.style.display="block",m}const O0={};function yp(...m){const i="THREE."+m.shift();console.log(i,...m)}function ei(...m){const i="THREE."+m.shift();console.warn(i,...m)}function hi(...m){const i="THREE."+m.shift();console.error(i,...m)}function od(...m){const i=m.join(" ");i in O0||(O0[i]=!0,ei(...m))}function VS(m,i,s){return new Promise(function(c,f){function v(){switch(m.clientWaitSync(i,m.SYNC_FLUSH_COMMANDS_BIT,0)){case m.WAIT_FAILED:f();break;case m.TIMEOUT_EXPIRED:setTimeout(v,s);break;default:c()}}setTimeout(v,s)})}class Su{addEventListener(i,s){this._listeners===void 0&&(this._listeners={});const c=this._listeners;c[i]===void 0&&(c[i]=[]),c[i].indexOf(s)===-1&&c[i].push(s)}hasEventListener(i,s){const c=this._listeners;return c===void 0?!1:c[i]!==void 0&&c[i].indexOf(s)!==-1}removeEventListener(i,s){const c=this._listeners;if(c===void 0)return;const f=c[i];if(f!==void 0){const v=f.indexOf(s);v!==-1&&f.splice(v,1)}}dispatchEvent(i){const s=this._listeners;if(s===void 0)return;const c=s[i.type];if(c!==void 0){i.target=this;const f=c.slice(0);for(let v=0,_=f.length;v<_;v++)f[v].call(this,i);i.target=null}}}const Rr=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let N0=1234567;const Qh=Math.PI/180,xu=180/Math.PI;function Ws(){const m=Math.random()*4294967295|0,i=Math.random()*4294967295|0,s=Math.random()*4294967295|0,c=Math.random()*4294967295|0;return(Rr[m&255]+Rr[m>>8&255]+Rr[m>>16&255]+Rr[m>>24&255]+"-"+Rr[i&255]+Rr[i>>8&255]+"-"+Rr[i>>16&15|64]+Rr[i>>24&255]+"-"+Rr[s&63|128]+Rr[s>>8&255]+"-"+Rr[s>>16&255]+Rr[s>>24&255]+Rr[c&255]+Rr[c>>8&255]+Rr[c>>16&255]+Rr[c>>24&255]).toLowerCase()}function Li(m,i,s){return Math.max(i,Math.min(s,m))}function Q_(m,i){return(m%i+i)%i}function GS(m,i,s,c,f){return c+(m-i)*(f-c)/(s-i)}function HS(m,i,s){return m!==i?(s-m)/(i-m):0}function ed(m,i,s){return(1-s)*m+s*i}function jS(m,i,s,c){return ed(m,i,1-Math.exp(-s*c))}function WS(m,i=1){return i-Math.abs(Q_(m,i*2)-i)}function qS(m,i,s){return m<=i?0:m>=s?1:(m=(m-i)/(s-i),m*m*(3-2*m))}function XS(m,i,s){return m<=i?0:m>=s?1:(m=(m-i)/(s-i),m*m*m*(m*(m*6-15)+10))}function ZS(m,i){return m+Math.floor(Math.random()*(i-m+1))}function $S(m,i){return m+Math.random()*(i-m)}function YS(m){return m*(.5-Math.random())}function KS(m){m!==void 0&&(N0=m);let i=N0+=1831565813;return i=Math.imul(i^i>>>15,i|1),i^=i+Math.imul(i^i>>>7,i|61),((i^i>>>14)>>>0)/4294967296}function JS(m){return m*Qh}function QS(m){return m*xu}function eM(m){return(m&m-1)===0&&m!==0}function tM(m){return Math.pow(2,Math.ceil(Math.log(m)/Math.LN2))}function iM(m){return Math.pow(2,Math.floor(Math.log(m)/Math.LN2))}function nM(m,i,s,c,f){const v=Math.cos,_=Math.sin,o=v(s/2),M=_(s/2),C=v((i+c)/2),D=_((i+c)/2),F=v((i-c)/2),O=_((i-c)/2),j=v((c-i)/2),K=_((c-i)/2);switch(f){case"XYX":m.set(o*D,M*F,M*O,o*C);break;case"YZY":m.set(M*O,o*D,M*F,o*C);break;case"ZXZ":m.set(M*F,M*O,o*D,o*C);break;case"XZX":m.set(o*D,M*K,M*j,o*C);break;case"YXY":m.set(M*j,o*D,M*K,o*C);break;case"ZYZ":m.set(M*K,M*j,o*D,o*C);break;default:ei("MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+f)}}function Hs(m,i){switch(i.constructor){case Float32Array:return m;case Uint32Array:return m/4294967295;case Uint16Array:return m/65535;case Uint8Array:return m/255;case Int32Array:return Math.max(m/2147483647,-1);case Int16Array:return Math.max(m/32767,-1);case Int8Array:return Math.max(m/127,-1);default:throw new Error("Invalid component type.")}}function tn(m,i){switch(i.constructor){case Float32Array:return m;case Uint32Array:return Math.round(m*4294967295);case Uint16Array:return Math.round(m*65535);case Uint8Array:return Math.round(m*255);case Int32Array:return Math.round(m*2147483647);case Int16Array:return Math.round(m*32767);case Int8Array:return Math.round(m*127);default:throw new Error("Invalid component type.")}}const rM={DEG2RAD:Qh,RAD2DEG:xu,generateUUID:Ws,clamp:Li,euclideanModulo:Q_,mapLinear:GS,inverseLerp:HS,lerp:ed,damp:jS,pingpong:WS,smoothstep:qS,smootherstep:XS,randInt:ZS,randFloat:$S,randFloatSpread:YS,seededRandom:KS,degToRad:JS,radToDeg:QS,isPowerOfTwo:eM,ceilPowerOfTwo:tM,floorPowerOfTwo:iM,setQuaternionFromProperEuler:nM,normalize:tn,denormalize:Hs};class Bi{constructor(i=0,s=0){Bi.prototype.isVector2=!0,this.x=i,this.y=s}get width(){return this.x}set width(i){this.x=i}get height(){return this.y}set height(i){this.y=i}set(i,s){return this.x=i,this.y=s,this}setScalar(i){return this.x=i,this.y=i,this}setX(i){return this.x=i,this}setY(i){return this.y=i,this}setComponent(i,s){switch(i){case 0:this.x=s;break;case 1:this.y=s;break;default:throw new Error("index is out of range: "+i)}return this}getComponent(i){switch(i){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+i)}}clone(){return new this.constructor(this.x,this.y)}copy(i){return this.x=i.x,this.y=i.y,this}add(i){return this.x+=i.x,this.y+=i.y,this}addScalar(i){return this.x+=i,this.y+=i,this}addVectors(i,s){return this.x=i.x+s.x,this.y=i.y+s.y,this}addScaledVector(i,s){return this.x+=i.x*s,this.y+=i.y*s,this}sub(i){return this.x-=i.x,this.y-=i.y,this}subScalar(i){return this.x-=i,this.y-=i,this}subVectors(i,s){return this.x=i.x-s.x,this.y=i.y-s.y,this}multiply(i){return this.x*=i.x,this.y*=i.y,this}multiplyScalar(i){return this.x*=i,this.y*=i,this}divide(i){return this.x/=i.x,this.y/=i.y,this}divideScalar(i){return this.multiplyScalar(1/i)}applyMatrix3(i){const s=this.x,c=this.y,f=i.elements;return this.x=f[0]*s+f[3]*c+f[6],this.y=f[1]*s+f[4]*c+f[7],this}min(i){return this.x=Math.min(this.x,i.x),this.y=Math.min(this.y,i.y),this}max(i){return this.x=Math.max(this.x,i.x),this.y=Math.max(this.y,i.y),this}clamp(i,s){return this.x=Li(this.x,i.x,s.x),this.y=Li(this.y,i.y,s.y),this}clampScalar(i,s){return this.x=Li(this.x,i,s),this.y=Li(this.y,i,s),this}clampLength(i,s){const c=this.length();return this.divideScalar(c||1).multiplyScalar(Li(c,i,s))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(i){return this.x*i.x+this.y*i.y}cross(i){return this.x*i.y-this.y*i.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(i){const s=Math.sqrt(this.lengthSq()*i.lengthSq());if(s===0)return Math.PI/2;const c=this.dot(i)/s;return Math.acos(Li(c,-1,1))}distanceTo(i){return Math.sqrt(this.distanceToSquared(i))}distanceToSquared(i){const s=this.x-i.x,c=this.y-i.y;return s*s+c*c}manhattanDistanceTo(i){return Math.abs(this.x-i.x)+Math.abs(this.y-i.y)}setLength(i){return this.normalize().multiplyScalar(i)}lerp(i,s){return this.x+=(i.x-this.x)*s,this.y+=(i.y-this.y)*s,this}lerpVectors(i,s,c){return this.x=i.x+(s.x-i.x)*c,this.y=i.y+(s.y-i.y)*c,this}equals(i){return i.x===this.x&&i.y===this.y}fromArray(i,s=0){return this.x=i[s],this.y=i[s+1],this}toArray(i=[],s=0){return i[s]=this.x,i[s+1]=this.y,i}fromBufferAttribute(i,s){return this.x=i.getX(s),this.y=i.getY(s),this}rotateAround(i,s){const c=Math.cos(s),f=Math.sin(s),v=this.x-i.x,_=this.y-i.y;return this.x=v*c-_*f+i.x,this.y=v*f+_*c+i.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class $o{constructor(i=0,s=0,c=0,f=1){this.isQuaternion=!0,this._x=i,this._y=s,this._z=c,this._w=f}static slerpFlat(i,s,c,f,v,_,o){let M=c[f+0],C=c[f+1],D=c[f+2],F=c[f+3],O=v[_+0],j=v[_+1],K=v[_+2],J=v[_+3];if(o<=0){i[s+0]=M,i[s+1]=C,i[s+2]=D,i[s+3]=F;return}if(o>=1){i[s+0]=O,i[s+1]=j,i[s+2]=K,i[s+3]=J;return}if(F!==J||M!==O||C!==j||D!==K){let N=M*O+C*j+D*K+F*J;N<0&&(O=-O,j=-j,K=-K,J=-J,N=-N);let W=1-o;if(N<.9995){const ge=Math.acos(N),de=Math.sin(ge);W=Math.sin(W*ge)/de,o=Math.sin(o*ge)/de,M=M*W+O*o,C=C*W+j*o,D=D*W+K*o,F=F*W+J*o}else{M=M*W+O*o,C=C*W+j*o,D=D*W+K*o,F=F*W+J*o;const ge=1/Math.sqrt(M*M+C*C+D*D+F*F);M*=ge,C*=ge,D*=ge,F*=ge}}i[s]=M,i[s+1]=C,i[s+2]=D,i[s+3]=F}static multiplyQuaternionsFlat(i,s,c,f,v,_){const o=c[f],M=c[f+1],C=c[f+2],D=c[f+3],F=v[_],O=v[_+1],j=v[_+2],K=v[_+3];return i[s]=o*K+D*F+M*j-C*O,i[s+1]=M*K+D*O+C*F-o*j,i[s+2]=C*K+D*j+o*O-M*F,i[s+3]=D*K-o*F-M*O-C*j,i}get x(){return this._x}set x(i){this._x=i,this._onChangeCallback()}get y(){return this._y}set y(i){this._y=i,this._onChangeCallback()}get z(){return this._z}set z(i){this._z=i,this._onChangeCallback()}get w(){return this._w}set w(i){this._w=i,this._onChangeCallback()}set(i,s,c,f){return this._x=i,this._y=s,this._z=c,this._w=f,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(i){return this._x=i.x,this._y=i.y,this._z=i.z,this._w=i.w,this._onChangeCallback(),this}setFromEuler(i,s=!0){const c=i._x,f=i._y,v=i._z,_=i._order,o=Math.cos,M=Math.sin,C=o(c/2),D=o(f/2),F=o(v/2),O=M(c/2),j=M(f/2),K=M(v/2);switch(_){case"XYZ":this._x=O*D*F+C*j*K,this._y=C*j*F-O*D*K,this._z=C*D*K+O*j*F,this._w=C*D*F-O*j*K;break;case"YXZ":this._x=O*D*F+C*j*K,this._y=C*j*F-O*D*K,this._z=C*D*K-O*j*F,this._w=C*D*F+O*j*K;break;case"ZXY":this._x=O*D*F-C*j*K,this._y=C*j*F+O*D*K,this._z=C*D*K+O*j*F,this._w=C*D*F-O*j*K;break;case"ZYX":this._x=O*D*F-C*j*K,this._y=C*j*F+O*D*K,this._z=C*D*K-O*j*F,this._w=C*D*F+O*j*K;break;case"YZX":this._x=O*D*F+C*j*K,this._y=C*j*F+O*D*K,this._z=C*D*K-O*j*F,this._w=C*D*F-O*j*K;break;case"XZY":this._x=O*D*F-C*j*K,this._y=C*j*F-O*D*K,this._z=C*D*K+O*j*F,this._w=C*D*F+O*j*K;break;default:ei("Quaternion: .setFromEuler() encountered an unknown order: "+_)}return s===!0&&this._onChangeCallback(),this}setFromAxisAngle(i,s){const c=s/2,f=Math.sin(c);return this._x=i.x*f,this._y=i.y*f,this._z=i.z*f,this._w=Math.cos(c),this._onChangeCallback(),this}setFromRotationMatrix(i){const s=i.elements,c=s[0],f=s[4],v=s[8],_=s[1],o=s[5],M=s[9],C=s[2],D=s[6],F=s[10],O=c+o+F;if(O>0){const j=.5/Math.sqrt(O+1);this._w=.25/j,this._x=(D-M)*j,this._y=(v-C)*j,this._z=(_-f)*j}else if(c>o&&c>F){const j=2*Math.sqrt(1+c-o-F);this._w=(D-M)/j,this._x=.25*j,this._y=(f+_)/j,this._z=(v+C)/j}else if(o>F){const j=2*Math.sqrt(1+o-c-F);this._w=(v-C)/j,this._x=(f+_)/j,this._y=.25*j,this._z=(M+D)/j}else{const j=2*Math.sqrt(1+F-c-o);this._w=(_-f)/j,this._x=(v+C)/j,this._y=(M+D)/j,this._z=.25*j}return this._onChangeCallback(),this}setFromUnitVectors(i,s){let c=i.dot(s)+1;return c<1e-8?(c=0,Math.abs(i.x)>Math.abs(i.z)?(this._x=-i.y,this._y=i.x,this._z=0,this._w=c):(this._x=0,this._y=-i.z,this._z=i.y,this._w=c)):(this._x=i.y*s.z-i.z*s.y,this._y=i.z*s.x-i.x*s.z,this._z=i.x*s.y-i.y*s.x,this._w=c),this.normalize()}angleTo(i){return 2*Math.acos(Math.abs(Li(this.dot(i),-1,1)))}rotateTowards(i,s){const c=this.angleTo(i);if(c===0)return this;const f=Math.min(1,s/c);return this.slerp(i,f),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(i){return this._x*i._x+this._y*i._y+this._z*i._z+this._w*i._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let i=this.length();return i===0?(this._x=0,this._y=0,this._z=0,this._w=1):(i=1/i,this._x=this._x*i,this._y=this._y*i,this._z=this._z*i,this._w=this._w*i),this._onChangeCallback(),this}multiply(i){return this.multiplyQuaternions(this,i)}premultiply(i){return this.multiplyQuaternions(i,this)}multiplyQuaternions(i,s){const c=i._x,f=i._y,v=i._z,_=i._w,o=s._x,M=s._y,C=s._z,D=s._w;return this._x=c*D+_*o+f*C-v*M,this._y=f*D+_*M+v*o-c*C,this._z=v*D+_*C+c*M-f*o,this._w=_*D-c*o-f*M-v*C,this._onChangeCallback(),this}slerp(i,s){if(s<=0)return this;if(s>=1)return this.copy(i);let c=i._x,f=i._y,v=i._z,_=i._w,o=this.dot(i);o<0&&(c=-c,f=-f,v=-v,_=-_,o=-o);let M=1-s;if(o<.9995){const C=Math.acos(o),D=Math.sin(C);M=Math.sin(M*C)/D,s=Math.sin(s*C)/D,this._x=this._x*M+c*s,this._y=this._y*M+f*s,this._z=this._z*M+v*s,this._w=this._w*M+_*s,this._onChangeCallback()}else this._x=this._x*M+c*s,this._y=this._y*M+f*s,this._z=this._z*M+v*s,this._w=this._w*M+_*s,this.normalize();return this}slerpQuaternions(i,s,c){return this.copy(i).slerp(s,c)}random(){const i=2*Math.PI*Math.random(),s=2*Math.PI*Math.random(),c=Math.random(),f=Math.sqrt(1-c),v=Math.sqrt(c);return this.set(f*Math.sin(i),f*Math.cos(i),v*Math.sin(s),v*Math.cos(s))}equals(i){return i._x===this._x&&i._y===this._y&&i._z===this._z&&i._w===this._w}fromArray(i,s=0){return this._x=i[s],this._y=i[s+1],this._z=i[s+2],this._w=i[s+3],this._onChangeCallback(),this}toArray(i=[],s=0){return i[s]=this._x,i[s+1]=this._y,i[s+2]=this._z,i[s+3]=this._w,i}fromBufferAttribute(i,s){return this._x=i.getX(s),this._y=i.getY(s),this._z=i.getZ(s),this._w=i.getW(s),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(i){return this._onChangeCallback=i,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class We{constructor(i=0,s=0,c=0){We.prototype.isVector3=!0,this.x=i,this.y=s,this.z=c}set(i,s,c){return c===void 0&&(c=this.z),this.x=i,this.y=s,this.z=c,this}setScalar(i){return this.x=i,this.y=i,this.z=i,this}setX(i){return this.x=i,this}setY(i){return this.y=i,this}setZ(i){return this.z=i,this}setComponent(i,s){switch(i){case 0:this.x=s;break;case 1:this.y=s;break;case 2:this.z=s;break;default:throw new Error("index is out of range: "+i)}return this}getComponent(i){switch(i){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+i)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(i){return this.x=i.x,this.y=i.y,this.z=i.z,this}add(i){return this.x+=i.x,this.y+=i.y,this.z+=i.z,this}addScalar(i){return this.x+=i,this.y+=i,this.z+=i,this}addVectors(i,s){return this.x=i.x+s.x,this.y=i.y+s.y,this.z=i.z+s.z,this}addScaledVector(i,s){return this.x+=i.x*s,this.y+=i.y*s,this.z+=i.z*s,this}sub(i){return this.x-=i.x,this.y-=i.y,this.z-=i.z,this}subScalar(i){return this.x-=i,this.y-=i,this.z-=i,this}subVectors(i,s){return this.x=i.x-s.x,this.y=i.y-s.y,this.z=i.z-s.z,this}multiply(i){return this.x*=i.x,this.y*=i.y,this.z*=i.z,this}multiplyScalar(i){return this.x*=i,this.y*=i,this.z*=i,this}multiplyVectors(i,s){return this.x=i.x*s.x,this.y=i.y*s.y,this.z=i.z*s.z,this}applyEuler(i){return this.applyQuaternion(B0.setFromEuler(i))}applyAxisAngle(i,s){return this.applyQuaternion(B0.setFromAxisAngle(i,s))}applyMatrix3(i){const s=this.x,c=this.y,f=this.z,v=i.elements;return this.x=v[0]*s+v[3]*c+v[6]*f,this.y=v[1]*s+v[4]*c+v[7]*f,this.z=v[2]*s+v[5]*c+v[8]*f,this}applyNormalMatrix(i){return this.applyMatrix3(i).normalize()}applyMatrix4(i){const s=this.x,c=this.y,f=this.z,v=i.elements,_=1/(v[3]*s+v[7]*c+v[11]*f+v[15]);return this.x=(v[0]*s+v[4]*c+v[8]*f+v[12])*_,this.y=(v[1]*s+v[5]*c+v[9]*f+v[13])*_,this.z=(v[2]*s+v[6]*c+v[10]*f+v[14])*_,this}applyQuaternion(i){const s=this.x,c=this.y,f=this.z,v=i.x,_=i.y,o=i.z,M=i.w,C=2*(_*f-o*c),D=2*(o*s-v*f),F=2*(v*c-_*s);return this.x=s+M*C+_*F-o*D,this.y=c+M*D+o*C-v*F,this.z=f+M*F+v*D-_*C,this}project(i){return this.applyMatrix4(i.matrixWorldInverse).applyMatrix4(i.projectionMatrix)}unproject(i){return this.applyMatrix4(i.projectionMatrixInverse).applyMatrix4(i.matrixWorld)}transformDirection(i){const s=this.x,c=this.y,f=this.z,v=i.elements;return this.x=v[0]*s+v[4]*c+v[8]*f,this.y=v[1]*s+v[5]*c+v[9]*f,this.z=v[2]*s+v[6]*c+v[10]*f,this.normalize()}divide(i){return this.x/=i.x,this.y/=i.y,this.z/=i.z,this}divideScalar(i){return this.multiplyScalar(1/i)}min(i){return this.x=Math.min(this.x,i.x),this.y=Math.min(this.y,i.y),this.z=Math.min(this.z,i.z),this}max(i){return this.x=Math.max(this.x,i.x),this.y=Math.max(this.y,i.y),this.z=Math.max(this.z,i.z),this}clamp(i,s){return this.x=Li(this.x,i.x,s.x),this.y=Li(this.y,i.y,s.y),this.z=Li(this.z,i.z,s.z),this}clampScalar(i,s){return this.x=Li(this.x,i,s),this.y=Li(this.y,i,s),this.z=Li(this.z,i,s),this}clampLength(i,s){const c=this.length();return this.divideScalar(c||1).multiplyScalar(Li(c,i,s))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(i){return this.x*i.x+this.y*i.y+this.z*i.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(i){return this.normalize().multiplyScalar(i)}lerp(i,s){return this.x+=(i.x-this.x)*s,this.y+=(i.y-this.y)*s,this.z+=(i.z-this.z)*s,this}lerpVectors(i,s,c){return this.x=i.x+(s.x-i.x)*c,this.y=i.y+(s.y-i.y)*c,this.z=i.z+(s.z-i.z)*c,this}cross(i){return this.crossVectors(this,i)}crossVectors(i,s){const c=i.x,f=i.y,v=i.z,_=s.x,o=s.y,M=s.z;return this.x=f*M-v*o,this.y=v*_-c*M,this.z=c*o-f*_,this}projectOnVector(i){const s=i.lengthSq();if(s===0)return this.set(0,0,0);const c=i.dot(this)/s;return this.copy(i).multiplyScalar(c)}projectOnPlane(i){return eg.copy(this).projectOnVector(i),this.sub(eg)}reflect(i){return this.sub(eg.copy(i).multiplyScalar(2*this.dot(i)))}angleTo(i){const s=Math.sqrt(this.lengthSq()*i.lengthSq());if(s===0)return Math.PI/2;const c=this.dot(i)/s;return Math.acos(Li(c,-1,1))}distanceTo(i){return Math.sqrt(this.distanceToSquared(i))}distanceToSquared(i){const s=this.x-i.x,c=this.y-i.y,f=this.z-i.z;return s*s+c*c+f*f}manhattanDistanceTo(i){return Math.abs(this.x-i.x)+Math.abs(this.y-i.y)+Math.abs(this.z-i.z)}setFromSpherical(i){return this.setFromSphericalCoords(i.radius,i.phi,i.theta)}setFromSphericalCoords(i,s,c){const f=Math.sin(s)*i;return this.x=f*Math.sin(c),this.y=Math.cos(s)*i,this.z=f*Math.cos(c),this}setFromCylindrical(i){return this.setFromCylindricalCoords(i.radius,i.theta,i.y)}setFromCylindricalCoords(i,s,c){return this.x=i*Math.sin(s),this.y=c,this.z=i*Math.cos(s),this}setFromMatrixPosition(i){const s=i.elements;return this.x=s[12],this.y=s[13],this.z=s[14],this}setFromMatrixScale(i){const s=this.setFromMatrixColumn(i,0).length(),c=this.setFromMatrixColumn(i,1).length(),f=this.setFromMatrixColumn(i,2).length();return this.x=s,this.y=c,this.z=f,this}setFromMatrixColumn(i,s){return this.fromArray(i.elements,s*4)}setFromMatrix3Column(i,s){return this.fromArray(i.elements,s*3)}setFromEuler(i){return this.x=i._x,this.y=i._y,this.z=i._z,this}setFromColor(i){return this.x=i.r,this.y=i.g,this.z=i.b,this}equals(i){return i.x===this.x&&i.y===this.y&&i.z===this.z}fromArray(i,s=0){return this.x=i[s],this.y=i[s+1],this.z=i[s+2],this}toArray(i=[],s=0){return i[s]=this.x,i[s+1]=this.y,i[s+2]=this.z,i}fromBufferAttribute(i,s){return this.x=i.getX(s),this.y=i.getY(s),this.z=i.getZ(s),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const i=Math.random()*Math.PI*2,s=Math.random()*2-1,c=Math.sqrt(1-s*s);return this.x=c*Math.cos(i),this.y=s,this.z=c*Math.sin(i),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const eg=new We,B0=new $o;class wi{constructor(i,s,c,f,v,_,o,M,C){wi.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],i!==void 0&&this.set(i,s,c,f,v,_,o,M,C)}set(i,s,c,f,v,_,o,M,C){const D=this.elements;return D[0]=i,D[1]=f,D[2]=o,D[3]=s,D[4]=v,D[5]=M,D[6]=c,D[7]=_,D[8]=C,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(i){const s=this.elements,c=i.elements;return s[0]=c[0],s[1]=c[1],s[2]=c[2],s[3]=c[3],s[4]=c[4],s[5]=c[5],s[6]=c[6],s[7]=c[7],s[8]=c[8],this}extractBasis(i,s,c){return i.setFromMatrix3Column(this,0),s.setFromMatrix3Column(this,1),c.setFromMatrix3Column(this,2),this}setFromMatrix4(i){const s=i.elements;return this.set(s[0],s[4],s[8],s[1],s[5],s[9],s[2],s[6],s[10]),this}multiply(i){return this.multiplyMatrices(this,i)}premultiply(i){return this.multiplyMatrices(i,this)}multiplyMatrices(i,s){const c=i.elements,f=s.elements,v=this.elements,_=c[0],o=c[3],M=c[6],C=c[1],D=c[4],F=c[7],O=c[2],j=c[5],K=c[8],J=f[0],N=f[3],W=f[6],ge=f[1],de=f[4],ve=f[7],Me=f[2],De=f[5],Ie=f[8];return v[0]=_*J+o*ge+M*Me,v[3]=_*N+o*de+M*De,v[6]=_*W+o*ve+M*Ie,v[1]=C*J+D*ge+F*Me,v[4]=C*N+D*de+F*De,v[7]=C*W+D*ve+F*Ie,v[2]=O*J+j*ge+K*Me,v[5]=O*N+j*de+K*De,v[8]=O*W+j*ve+K*Ie,this}multiplyScalar(i){const s=this.elements;return s[0]*=i,s[3]*=i,s[6]*=i,s[1]*=i,s[4]*=i,s[7]*=i,s[2]*=i,s[5]*=i,s[8]*=i,this}determinant(){const i=this.elements,s=i[0],c=i[1],f=i[2],v=i[3],_=i[4],o=i[5],M=i[6],C=i[7],D=i[8];return s*_*D-s*o*C-c*v*D+c*o*M+f*v*C-f*_*M}invert(){const i=this.elements,s=i[0],c=i[1],f=i[2],v=i[3],_=i[4],o=i[5],M=i[6],C=i[7],D=i[8],F=D*_-o*C,O=o*M-D*v,j=C*v-_*M,K=s*F+c*O+f*j;if(K===0)return this.set(0,0,0,0,0,0,0,0,0);const J=1/K;return i[0]=F*J,i[1]=(f*C-D*c)*J,i[2]=(o*c-f*_)*J,i[3]=O*J,i[4]=(D*s-f*M)*J,i[5]=(f*v-o*s)*J,i[6]=j*J,i[7]=(c*M-C*s)*J,i[8]=(_*s-c*v)*J,this}transpose(){let i;const s=this.elements;return i=s[1],s[1]=s[3],s[3]=i,i=s[2],s[2]=s[6],s[6]=i,i=s[5],s[5]=s[7],s[7]=i,this}getNormalMatrix(i){return this.setFromMatrix4(i).invert().transpose()}transposeIntoArray(i){const s=this.elements;return i[0]=s[0],i[1]=s[3],i[2]=s[6],i[3]=s[1],i[4]=s[4],i[5]=s[7],i[6]=s[2],i[7]=s[5],i[8]=s[8],this}setUvTransform(i,s,c,f,v,_,o){const M=Math.cos(v),C=Math.sin(v);return this.set(c*M,c*C,-c*(M*_+C*o)+_+i,-f*C,f*M,-f*(-C*_+M*o)+o+s,0,0,1),this}scale(i,s){return this.premultiply(tg.makeScale(i,s)),this}rotate(i){return this.premultiply(tg.makeRotation(-i)),this}translate(i,s){return this.premultiply(tg.makeTranslation(i,s)),this}makeTranslation(i,s){return i.isVector2?this.set(1,0,i.x,0,1,i.y,0,0,1):this.set(1,0,i,0,1,s,0,0,1),this}makeRotation(i){const s=Math.cos(i),c=Math.sin(i);return this.set(s,-c,0,c,s,0,0,0,1),this}makeScale(i,s){return this.set(i,0,0,0,s,0,0,0,1),this}equals(i){const s=this.elements,c=i.elements;for(let f=0;f<9;f++)if(s[f]!==c[f])return!1;return!0}fromArray(i,s=0){for(let c=0;c<9;c++)this.elements[c]=i[c+s];return this}toArray(i=[],s=0){const c=this.elements;return i[s]=c[0],i[s+1]=c[1],i[s+2]=c[2],i[s+3]=c[3],i[s+4]=c[4],i[s+5]=c[5],i[s+6]=c[6],i[s+7]=c[7],i[s+8]=c[8],i}clone(){return new this.constructor().fromArray(this.elements)}}const tg=new wi,k0=new wi().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),U0=new wi().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function sM(){const m={enabled:!0,workingColorSpace:Vr,spaces:{},convert:function(f,v,_){return this.enabled===!1||v===_||!v||!_||(this.spaces[v].transfer===en&&(f.r=no(f.r),f.g=no(f.g),f.b=no(f.b)),this.spaces[v].primaries!==this.spaces[_].primaries&&(f.applyMatrix3(this.spaces[v].toXYZ),f.applyMatrix3(this.spaces[_].fromXYZ)),this.spaces[_].transfer===en&&(f.r=fu(f.r),f.g=fu(f.g),f.b=fu(f.b))),f},workingToColorSpace:function(f,v){return this.convert(f,this.workingColorSpace,v)},colorSpaceToWorking:function(f,v){return this.convert(f,v,this.workingColorSpace)},getPrimaries:function(f){return this.spaces[f].primaries},getTransfer:function(f){return f===Xo?gp:this.spaces[f].transfer},getToneMappingMode:function(f){return this.spaces[f].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(f,v=this.workingColorSpace){return f.fromArray(this.spaces[v].luminanceCoefficients)},define:function(f){Object.assign(this.spaces,f)},_getMatrix:function(f,v,_){return f.copy(this.spaces[v].toXYZ).multiply(this.spaces[_].fromXYZ)},_getDrawingBufferColorSpace:function(f){return this.spaces[f].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(f=this.workingColorSpace){return this.spaces[f].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(f,v){return od("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),m.workingToColorSpace(f,v)},toWorkingColorSpace:function(f,v){return od("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),m.colorSpaceToWorking(f,v)}},i=[.64,.33,.3,.6,.15,.06],s=[.2126,.7152,.0722],c=[.3127,.329];return m.define({[Vr]:{primaries:i,whitePoint:c,transfer:gp,toXYZ:k0,fromXYZ:U0,luminanceCoefficients:s,workingColorSpaceConfig:{unpackColorSpace:Sr},outputColorSpaceConfig:{drawingBufferColorSpace:Sr}},[Sr]:{primaries:i,whitePoint:c,transfer:en,toXYZ:k0,fromXYZ:U0,luminanceCoefficients:s,outputColorSpaceConfig:{drawingBufferColorSpace:Sr}}}),m}const Ni=sM();function no(m){return m<.04045?m*.0773993808:Math.pow(m*.9478672986+.0521327014,2.4)}function fu(m){return m<.0031308?m*12.92:1.055*Math.pow(m,.41666)-.055}let Yc;class aM{static getDataURL(i,s="image/png"){if(/^data:/i.test(i.src)||typeof HTMLCanvasElement>"u")return i.src;let c;if(i instanceof HTMLCanvasElement)c=i;else{Yc===void 0&&(Yc=ad("canvas")),Yc.width=i.width,Yc.height=i.height;const f=Yc.getContext("2d");i instanceof ImageData?f.putImageData(i,0,0):f.drawImage(i,0,0,i.width,i.height),c=Yc}return c.toDataURL(s)}static sRGBToLinear(i){if(typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap){const s=ad("canvas");s.width=i.width,s.height=i.height;const c=s.getContext("2d");c.drawImage(i,0,0,i.width,i.height);const f=c.getImageData(0,0,i.width,i.height),v=f.data;for(let _=0;_<v.length;_++)v[_]=no(v[_]/255)*255;return c.putImageData(f,0,0),s}else if(i.data){const s=i.data.slice(0);for(let c=0;c<s.length;c++)s instanceof Uint8Array||s instanceof Uint8ClampedArray?s[c]=Math.floor(no(s[c]/255)*255):s[c]=no(s[c]);return{data:s,width:i.width,height:i.height}}else return ei("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),i}}let oM=0;class ey{constructor(i=null){this.isSource=!0,Object.defineProperty(this,"id",{value:oM++}),this.uuid=Ws(),this.data=i,this.dataReady=!0,this.version=0}getSize(i){const s=this.data;return typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement?i.set(s.videoWidth,s.videoHeight,0):typeof VideoFrame<"u"&&s instanceof VideoFrame?i.set(s.displayHeight,s.displayWidth,0):s!==null?i.set(s.width,s.height,s.depth||0):i.set(0,0,0),i}set needsUpdate(i){i===!0&&this.version++}toJSON(i){const s=i===void 0||typeof i=="string";if(!s&&i.images[this.uuid]!==void 0)return i.images[this.uuid];const c={uuid:this.uuid,url:""},f=this.data;if(f!==null){let v;if(Array.isArray(f)){v=[];for(let _=0,o=f.length;_<o;_++)f[_].isDataTexture?v.push(ig(f[_].image)):v.push(ig(f[_]))}else v=ig(f);c.url=v}return s||(i.images[this.uuid]=c),c}}function ig(m){return typeof HTMLImageElement<"u"&&m instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&m instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&m instanceof ImageBitmap?aM.getDataURL(m):m.data?{data:Array.from(m.data),width:m.width,height:m.height,type:m.data.constructor.name}:(ei("Texture: Unable to serialize Texture."),{})}let lM=0;const ng=new We;class pr extends Su{constructor(i=pr.DEFAULT_IMAGE,s=pr.DEFAULT_MAPPING,c=ha,f=ha,v=nr,_=Qa,o=Ps,M=gs,C=pr.DEFAULT_ANISOTROPY,D=Xo){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:lM++}),this.uuid=Ws(),this.name="",this.source=new ey(i),this.mipmaps=[],this.mapping=s,this.channel=0,this.wrapS=c,this.wrapT=f,this.magFilter=v,this.minFilter=_,this.anisotropy=C,this.format=o,this.internalFormat=null,this.type=M,this.offset=new Bi(0,0),this.repeat=new Bi(1,1),this.center=new Bi(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new wi,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=D,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(i&&i.depth&&i.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(ng).x}get height(){return this.source.getSize(ng).y}get depth(){return this.source.getSize(ng).z}get image(){return this.source.data}set image(i=null){this.source.data=i}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(i,s){this.updateRanges.push({start:i,count:s})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(i){return this.name=i.name,this.source=i.source,this.mipmaps=i.mipmaps.slice(0),this.mapping=i.mapping,this.channel=i.channel,this.wrapS=i.wrapS,this.wrapT=i.wrapT,this.magFilter=i.magFilter,this.minFilter=i.minFilter,this.anisotropy=i.anisotropy,this.format=i.format,this.internalFormat=i.internalFormat,this.type=i.type,this.offset.copy(i.offset),this.repeat.copy(i.repeat),this.center.copy(i.center),this.rotation=i.rotation,this.matrixAutoUpdate=i.matrixAutoUpdate,this.matrix.copy(i.matrix),this.generateMipmaps=i.generateMipmaps,this.premultiplyAlpha=i.premultiplyAlpha,this.flipY=i.flipY,this.unpackAlignment=i.unpackAlignment,this.colorSpace=i.colorSpace,this.renderTarget=i.renderTarget,this.isRenderTargetTexture=i.isRenderTargetTexture,this.isArrayTexture=i.isArrayTexture,this.userData=JSON.parse(JSON.stringify(i.userData)),this.needsUpdate=!0,this}setValues(i){for(const s in i){const c=i[s];if(c===void 0){ei(`Texture.setValues(): parameter '${s}' has value of undefined.`);continue}const f=this[s];if(f===void 0){ei(`Texture.setValues(): property '${s}' does not exist.`);continue}f&&c&&f.isVector2&&c.isVector2||f&&c&&f.isVector3&&c.isVector3||f&&c&&f.isMatrix3&&c.isMatrix3?f.copy(c):this[s]=c}}toJSON(i){const s=i===void 0||typeof i=="string";if(!s&&i.textures[this.uuid]!==void 0)return i.textures[this.uuid];const c={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(i).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(c.userData=this.userData),s||(i.textures[this.uuid]=c),c}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(i){if(this.mapping!==vb)return i;if(i.applyMatrix3(this.matrix),i.x<0||i.x>1)switch(this.wrapS){case _u:i.x=i.x-Math.floor(i.x);break;case ha:i.x=i.x<0?0:1;break;case mp:Math.abs(Math.floor(i.x)%2)===1?i.x=Math.ceil(i.x)-i.x:i.x=i.x-Math.floor(i.x);break}if(i.y<0||i.y>1)switch(this.wrapT){case _u:i.y=i.y-Math.floor(i.y);break;case ha:i.y=i.y<0?0:1;break;case mp:Math.abs(Math.floor(i.y)%2)===1?i.y=Math.ceil(i.y)-i.y:i.y=i.y-Math.floor(i.y);break}return this.flipY&&(i.y=1-i.y),i}set needsUpdate(i){i===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(i){i===!0&&this.pmremVersion++}}pr.DEFAULT_IMAGE=null;pr.DEFAULT_MAPPING=vb;pr.DEFAULT_ANISOTROPY=1;class wn{constructor(i=0,s=0,c=0,f=1){wn.prototype.isVector4=!0,this.x=i,this.y=s,this.z=c,this.w=f}get width(){return this.z}set width(i){this.z=i}get height(){return this.w}set height(i){this.w=i}set(i,s,c,f){return this.x=i,this.y=s,this.z=c,this.w=f,this}setScalar(i){return this.x=i,this.y=i,this.z=i,this.w=i,this}setX(i){return this.x=i,this}setY(i){return this.y=i,this}setZ(i){return this.z=i,this}setW(i){return this.w=i,this}setComponent(i,s){switch(i){case 0:this.x=s;break;case 1:this.y=s;break;case 2:this.z=s;break;case 3:this.w=s;break;default:throw new Error("index is out of range: "+i)}return this}getComponent(i){switch(i){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+i)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(i){return this.x=i.x,this.y=i.y,this.z=i.z,this.w=i.w!==void 0?i.w:1,this}add(i){return this.x+=i.x,this.y+=i.y,this.z+=i.z,this.w+=i.w,this}addScalar(i){return this.x+=i,this.y+=i,this.z+=i,this.w+=i,this}addVectors(i,s){return this.x=i.x+s.x,this.y=i.y+s.y,this.z=i.z+s.z,this.w=i.w+s.w,this}addScaledVector(i,s){return this.x+=i.x*s,this.y+=i.y*s,this.z+=i.z*s,this.w+=i.w*s,this}sub(i){return this.x-=i.x,this.y-=i.y,this.z-=i.z,this.w-=i.w,this}subScalar(i){return this.x-=i,this.y-=i,this.z-=i,this.w-=i,this}subVectors(i,s){return this.x=i.x-s.x,this.y=i.y-s.y,this.z=i.z-s.z,this.w=i.w-s.w,this}multiply(i){return this.x*=i.x,this.y*=i.y,this.z*=i.z,this.w*=i.w,this}multiplyScalar(i){return this.x*=i,this.y*=i,this.z*=i,this.w*=i,this}applyMatrix4(i){const s=this.x,c=this.y,f=this.z,v=this.w,_=i.elements;return this.x=_[0]*s+_[4]*c+_[8]*f+_[12]*v,this.y=_[1]*s+_[5]*c+_[9]*f+_[13]*v,this.z=_[2]*s+_[6]*c+_[10]*f+_[14]*v,this.w=_[3]*s+_[7]*c+_[11]*f+_[15]*v,this}divide(i){return this.x/=i.x,this.y/=i.y,this.z/=i.z,this.w/=i.w,this}divideScalar(i){return this.multiplyScalar(1/i)}setAxisAngleFromQuaternion(i){this.w=2*Math.acos(i.w);const s=Math.sqrt(1-i.w*i.w);return s<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=i.x/s,this.y=i.y/s,this.z=i.z/s),this}setAxisAngleFromRotationMatrix(i){let s,c,f,v;const M=i.elements,C=M[0],D=M[4],F=M[8],O=M[1],j=M[5],K=M[9],J=M[2],N=M[6],W=M[10];if(Math.abs(D-O)<.01&&Math.abs(F-J)<.01&&Math.abs(K-N)<.01){if(Math.abs(D+O)<.1&&Math.abs(F+J)<.1&&Math.abs(K+N)<.1&&Math.abs(C+j+W-3)<.1)return this.set(1,0,0,0),this;s=Math.PI;const de=(C+1)/2,ve=(j+1)/2,Me=(W+1)/2,De=(D+O)/4,Ie=(F+J)/4,$e=(K+N)/4;return de>ve&&de>Me?de<.01?(c=0,f=.707106781,v=.707106781):(c=Math.sqrt(de),f=De/c,v=Ie/c):ve>Me?ve<.01?(c=.707106781,f=0,v=.707106781):(f=Math.sqrt(ve),c=De/f,v=$e/f):Me<.01?(c=.707106781,f=.707106781,v=0):(v=Math.sqrt(Me),c=Ie/v,f=$e/v),this.set(c,f,v,s),this}let ge=Math.sqrt((N-K)*(N-K)+(F-J)*(F-J)+(O-D)*(O-D));return Math.abs(ge)<.001&&(ge=1),this.x=(N-K)/ge,this.y=(F-J)/ge,this.z=(O-D)/ge,this.w=Math.acos((C+j+W-1)/2),this}setFromMatrixPosition(i){const s=i.elements;return this.x=s[12],this.y=s[13],this.z=s[14],this.w=s[15],this}min(i){return this.x=Math.min(this.x,i.x),this.y=Math.min(this.y,i.y),this.z=Math.min(this.z,i.z),this.w=Math.min(this.w,i.w),this}max(i){return this.x=Math.max(this.x,i.x),this.y=Math.max(this.y,i.y),this.z=Math.max(this.z,i.z),this.w=Math.max(this.w,i.w),this}clamp(i,s){return this.x=Li(this.x,i.x,s.x),this.y=Li(this.y,i.y,s.y),this.z=Li(this.z,i.z,s.z),this.w=Li(this.w,i.w,s.w),this}clampScalar(i,s){return this.x=Li(this.x,i,s),this.y=Li(this.y,i,s),this.z=Li(this.z,i,s),this.w=Li(this.w,i,s),this}clampLength(i,s){const c=this.length();return this.divideScalar(c||1).multiplyScalar(Li(c,i,s))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(i){return this.x*i.x+this.y*i.y+this.z*i.z+this.w*i.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(i){return this.normalize().multiplyScalar(i)}lerp(i,s){return this.x+=(i.x-this.x)*s,this.y+=(i.y-this.y)*s,this.z+=(i.z-this.z)*s,this.w+=(i.w-this.w)*s,this}lerpVectors(i,s,c){return this.x=i.x+(s.x-i.x)*c,this.y=i.y+(s.y-i.y)*c,this.z=i.z+(s.z-i.z)*c,this.w=i.w+(s.w-i.w)*c,this}equals(i){return i.x===this.x&&i.y===this.y&&i.z===this.z&&i.w===this.w}fromArray(i,s=0){return this.x=i[s],this.y=i[s+1],this.z=i[s+2],this.w=i[s+3],this}toArray(i=[],s=0){return i[s]=this.x,i[s+1]=this.y,i[s+2]=this.z,i[s+3]=this.w,i}fromBufferAttribute(i,s){return this.x=i.getX(s),this.y=i.getY(s),this.z=i.getZ(s),this.w=i.getW(s),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class cM extends Su{constructor(i=1,s=1,c={}){super(),c=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:nr,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},c),this.isRenderTarget=!0,this.width=i,this.height=s,this.depth=c.depth,this.scissor=new wn(0,0,i,s),this.scissorTest=!1,this.viewport=new wn(0,0,i,s);const f={width:i,height:s,depth:c.depth},v=new pr(f);this.textures=[];const _=c.count;for(let o=0;o<_;o++)this.textures[o]=v.clone(),this.textures[o].isRenderTargetTexture=!0,this.textures[o].renderTarget=this;this._setTextureOptions(c),this.depthBuffer=c.depthBuffer,this.stencilBuffer=c.stencilBuffer,this.resolveDepthBuffer=c.resolveDepthBuffer,this.resolveStencilBuffer=c.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=c.depthTexture,this.samples=c.samples,this.multiview=c.multiview}_setTextureOptions(i={}){const s={minFilter:nr,generateMipmaps:!1,flipY:!1,internalFormat:null};i.mapping!==void 0&&(s.mapping=i.mapping),i.wrapS!==void 0&&(s.wrapS=i.wrapS),i.wrapT!==void 0&&(s.wrapT=i.wrapT),i.wrapR!==void 0&&(s.wrapR=i.wrapR),i.magFilter!==void 0&&(s.magFilter=i.magFilter),i.minFilter!==void 0&&(s.minFilter=i.minFilter),i.format!==void 0&&(s.format=i.format),i.type!==void 0&&(s.type=i.type),i.anisotropy!==void 0&&(s.anisotropy=i.anisotropy),i.colorSpace!==void 0&&(s.colorSpace=i.colorSpace),i.flipY!==void 0&&(s.flipY=i.flipY),i.generateMipmaps!==void 0&&(s.generateMipmaps=i.generateMipmaps),i.internalFormat!==void 0&&(s.internalFormat=i.internalFormat);for(let c=0;c<this.textures.length;c++)this.textures[c].setValues(s)}get texture(){return this.textures[0]}set texture(i){this.textures[0]=i}set depthTexture(i){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),i!==null&&(i.renderTarget=this),this._depthTexture=i}get depthTexture(){return this._depthTexture}setSize(i,s,c=1){if(this.width!==i||this.height!==s||this.depth!==c){this.width=i,this.height=s,this.depth=c;for(let f=0,v=this.textures.length;f<v;f++)this.textures[f].image.width=i,this.textures[f].image.height=s,this.textures[f].image.depth=c,this.textures[f].isData3DTexture!==!0&&(this.textures[f].isArrayTexture=this.textures[f].image.depth>1);this.dispose()}this.viewport.set(0,0,i,s),this.scissor.set(0,0,i,s)}clone(){return new this.constructor().copy(this)}copy(i){this.width=i.width,this.height=i.height,this.depth=i.depth,this.scissor.copy(i.scissor),this.scissorTest=i.scissorTest,this.viewport.copy(i.viewport),this.textures.length=0;for(let s=0,c=i.textures.length;s<c;s++){this.textures[s]=i.textures[s].clone(),this.textures[s].isRenderTargetTexture=!0,this.textures[s].renderTarget=this;const f=Object.assign({},i.textures[s].image);this.textures[s].source=new ey(f)}return this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,i.depthTexture!==null&&(this.depthTexture=i.depthTexture.clone()),this.samples=i.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class pa extends cM{constructor(i=1,s=1,c={}){super(i,s,c),this.isWebGLRenderTarget=!0}}class Rb extends pr{constructor(i=null,s=1,c=1,f=1){super(null),this.isDataArrayTexture=!0,this.image={data:i,width:s,height:c,depth:f},this.magFilter=ir,this.minFilter=ir,this.wrapR=ha,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(i){this.layerUpdates.add(i)}clearLayerUpdates(){this.layerUpdates.clear()}}class uM extends pr{constructor(i=null,s=1,c=1,f=1){super(null),this.isData3DTexture=!0,this.image={data:i,width:s,height:c,depth:f},this.magFilter=ir,this.minFilter=ir,this.wrapR=ha,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class oo{constructor(i=new We(1/0,1/0,1/0),s=new We(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=i,this.max=s}set(i,s){return this.min.copy(i),this.max.copy(s),this}setFromArray(i){this.makeEmpty();for(let s=0,c=i.length;s<c;s+=3)this.expandByPoint(Us.fromArray(i,s));return this}setFromBufferAttribute(i){this.makeEmpty();for(let s=0,c=i.count;s<c;s++)this.expandByPoint(Us.fromBufferAttribute(i,s));return this}setFromPoints(i){this.makeEmpty();for(let s=0,c=i.length;s<c;s++)this.expandByPoint(i[s]);return this}setFromCenterAndSize(i,s){const c=Us.copy(s).multiplyScalar(.5);return this.min.copy(i).sub(c),this.max.copy(i).add(c),this}setFromObject(i,s=!1){return this.makeEmpty(),this.expandByObject(i,s)}clone(){return new this.constructor().copy(this)}copy(i){return this.min.copy(i.min),this.max.copy(i.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(i){return this.isEmpty()?i.set(0,0,0):i.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(i){return this.isEmpty()?i.set(0,0,0):i.subVectors(this.max,this.min)}expandByPoint(i){return this.min.min(i),this.max.max(i),this}expandByVector(i){return this.min.sub(i),this.max.add(i),this}expandByScalar(i){return this.min.addScalar(-i),this.max.addScalar(i),this}expandByObject(i,s=!1){i.updateWorldMatrix(!1,!1);const c=i.geometry;if(c!==void 0){const v=c.getAttribute("position");if(s===!0&&v!==void 0&&i.isInstancedMesh!==!0)for(let _=0,o=v.count;_<o;_++)i.isMesh===!0?i.getVertexPosition(_,Us):Us.fromBufferAttribute(v,_),Us.applyMatrix4(i.matrixWorld),this.expandByPoint(Us);else i.boundingBox!==void 0?(i.boundingBox===null&&i.computeBoundingBox(),zf.copy(i.boundingBox)):(c.boundingBox===null&&c.computeBoundingBox(),zf.copy(c.boundingBox)),zf.applyMatrix4(i.matrixWorld),this.union(zf)}const f=i.children;for(let v=0,_=f.length;v<_;v++)this.expandByObject(f[v],s);return this}containsPoint(i){return i.x>=this.min.x&&i.x<=this.max.x&&i.y>=this.min.y&&i.y<=this.max.y&&i.z>=this.min.z&&i.z<=this.max.z}containsBox(i){return this.min.x<=i.min.x&&i.max.x<=this.max.x&&this.min.y<=i.min.y&&i.max.y<=this.max.y&&this.min.z<=i.min.z&&i.max.z<=this.max.z}getParameter(i,s){return s.set((i.x-this.min.x)/(this.max.x-this.min.x),(i.y-this.min.y)/(this.max.y-this.min.y),(i.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(i){return i.max.x>=this.min.x&&i.min.x<=this.max.x&&i.max.y>=this.min.y&&i.min.y<=this.max.y&&i.max.z>=this.min.z&&i.min.z<=this.max.z}intersectsSphere(i){return this.clampPoint(i.center,Us),Us.distanceToSquared(i.center)<=i.radius*i.radius}intersectsPlane(i){let s,c;return i.normal.x>0?(s=i.normal.x*this.min.x,c=i.normal.x*this.max.x):(s=i.normal.x*this.max.x,c=i.normal.x*this.min.x),i.normal.y>0?(s+=i.normal.y*this.min.y,c+=i.normal.y*this.max.y):(s+=i.normal.y*this.max.y,c+=i.normal.y*this.min.y),i.normal.z>0?(s+=i.normal.z*this.min.z,c+=i.normal.z*this.max.z):(s+=i.normal.z*this.max.z,c+=i.normal.z*this.min.z),s<=-i.constant&&c>=-i.constant}intersectsTriangle(i){if(this.isEmpty())return!1;this.getCenter(kh),Of.subVectors(this.max,kh),Kc.subVectors(i.a,kh),Jc.subVectors(i.b,kh),Qc.subVectors(i.c,kh),Uo.subVectors(Jc,Kc),Vo.subVectors(Qc,Jc),zl.subVectors(Kc,Qc);let s=[0,-Uo.z,Uo.y,0,-Vo.z,Vo.y,0,-zl.z,zl.y,Uo.z,0,-Uo.x,Vo.z,0,-Vo.x,zl.z,0,-zl.x,-Uo.y,Uo.x,0,-Vo.y,Vo.x,0,-zl.y,zl.x,0];return!rg(s,Kc,Jc,Qc,Of)||(s=[1,0,0,0,1,0,0,0,1],!rg(s,Kc,Jc,Qc,Of))?!1:(Nf.crossVectors(Uo,Vo),s=[Nf.x,Nf.y,Nf.z],rg(s,Kc,Jc,Qc,Of))}clampPoint(i,s){return s.copy(i).clamp(this.min,this.max)}distanceToPoint(i){return this.clampPoint(i,Us).distanceTo(i)}getBoundingSphere(i){return this.isEmpty()?i.makeEmpty():(this.getCenter(i.center),i.radius=this.getSize(Us).length()*.5),i}intersect(i){return this.min.max(i.min),this.max.min(i.max),this.isEmpty()&&this.makeEmpty(),this}union(i){return this.min.min(i.min),this.max.max(i.max),this}applyMatrix4(i){return this.isEmpty()?this:(Xa[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(i),Xa[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(i),Xa[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(i),Xa[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(i),Xa[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(i),Xa[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(i),Xa[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(i),Xa[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(i),this.setFromPoints(Xa),this)}translate(i){return this.min.add(i),this.max.add(i),this}equals(i){return i.min.equals(this.min)&&i.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(i){return this.min.fromArray(i.min),this.max.fromArray(i.max),this}}const Xa=[new We,new We,new We,new We,new We,new We,new We,new We],Us=new We,zf=new oo,Kc=new We,Jc=new We,Qc=new We,Uo=new We,Vo=new We,zl=new We,kh=new We,Of=new We,Nf=new We,Ol=new We;function rg(m,i,s,c,f){for(let v=0,_=m.length-3;v<=_;v+=3){Ol.fromArray(m,v);const o=f.x*Math.abs(Ol.x)+f.y*Math.abs(Ol.y)+f.z*Math.abs(Ol.z),M=i.dot(Ol),C=s.dot(Ol),D=c.dot(Ol);if(Math.max(-Math.max(M,C,D),Math.min(M,C,D))>o)return!1}return!0}const hM=new oo,Uh=new We,sg=new We;class xa{constructor(i=new We,s=-1){this.isSphere=!0,this.center=i,this.radius=s}set(i,s){return this.center.copy(i),this.radius=s,this}setFromPoints(i,s){const c=this.center;s!==void 0?c.copy(s):hM.setFromPoints(i).getCenter(c);let f=0;for(let v=0,_=i.length;v<_;v++)f=Math.max(f,c.distanceToSquared(i[v]));return this.radius=Math.sqrt(f),this}copy(i){return this.center.copy(i.center),this.radius=i.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(i){return i.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(i){return i.distanceTo(this.center)-this.radius}intersectsSphere(i){const s=this.radius+i.radius;return i.center.distanceToSquared(this.center)<=s*s}intersectsBox(i){return i.intersectsSphere(this)}intersectsPlane(i){return Math.abs(i.distanceToPoint(this.center))<=this.radius}clampPoint(i,s){const c=this.center.distanceToSquared(i);return s.copy(i),c>this.radius*this.radius&&(s.sub(this.center).normalize(),s.multiplyScalar(this.radius).add(this.center)),s}getBoundingBox(i){return this.isEmpty()?(i.makeEmpty(),i):(i.set(this.center,this.center),i.expandByScalar(this.radius),i)}applyMatrix4(i){return this.center.applyMatrix4(i),this.radius=this.radius*i.getMaxScaleOnAxis(),this}translate(i){return this.center.add(i),this}expandByPoint(i){if(this.isEmpty())return this.center.copy(i),this.radius=0,this;Uh.subVectors(i,this.center);const s=Uh.lengthSq();if(s>this.radius*this.radius){const c=Math.sqrt(s),f=(c-this.radius)*.5;this.center.addScaledVector(Uh,f/c),this.radius+=f}return this}union(i){return i.isEmpty()?this:this.isEmpty()?(this.copy(i),this):(this.center.equals(i.center)===!0?this.radius=Math.max(this.radius,i.radius):(sg.subVectors(i.center,this.center).setLength(i.radius),this.expandByPoint(Uh.copy(i.center).add(sg)),this.expandByPoint(Uh.copy(i.center).sub(sg))),this)}equals(i){return i.center.equals(this.center)&&i.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(i){return this.radius=i.radius,this.center.fromArray(i.center),this}}const Za=new We,ag=new We,Bf=new We,Go=new We,og=new We,kf=new We,lg=new We;class Tp{constructor(i=new We,s=new We(0,0,-1)){this.origin=i,this.direction=s}set(i,s){return this.origin.copy(i),this.direction.copy(s),this}copy(i){return this.origin.copy(i.origin),this.direction.copy(i.direction),this}at(i,s){return s.copy(this.origin).addScaledVector(this.direction,i)}lookAt(i){return this.direction.copy(i).sub(this.origin).normalize(),this}recast(i){return this.origin.copy(this.at(i,Za)),this}closestPointToPoint(i,s){s.subVectors(i,this.origin);const c=s.dot(this.direction);return c<0?s.copy(this.origin):s.copy(this.origin).addScaledVector(this.direction,c)}distanceToPoint(i){return Math.sqrt(this.distanceSqToPoint(i))}distanceSqToPoint(i){const s=Za.subVectors(i,this.origin).dot(this.direction);return s<0?this.origin.distanceToSquared(i):(Za.copy(this.origin).addScaledVector(this.direction,s),Za.distanceToSquared(i))}distanceSqToSegment(i,s,c,f){ag.copy(i).add(s).multiplyScalar(.5),Bf.copy(s).sub(i).normalize(),Go.copy(this.origin).sub(ag);const v=i.distanceTo(s)*.5,_=-this.direction.dot(Bf),o=Go.dot(this.direction),M=-Go.dot(Bf),C=Go.lengthSq(),D=Math.abs(1-_*_);let F,O,j,K;if(D>0)if(F=_*M-o,O=_*o-M,K=v*D,F>=0)if(O>=-K)if(O<=K){const J=1/D;F*=J,O*=J,j=F*(F+_*O+2*o)+O*(_*F+O+2*M)+C}else O=v,F=Math.max(0,-(_*O+o)),j=-F*F+O*(O+2*M)+C;else O=-v,F=Math.max(0,-(_*O+o)),j=-F*F+O*(O+2*M)+C;else O<=-K?(F=Math.max(0,-(-_*v+o)),O=F>0?-v:Math.min(Math.max(-v,-M),v),j=-F*F+O*(O+2*M)+C):O<=K?(F=0,O=Math.min(Math.max(-v,-M),v),j=O*(O+2*M)+C):(F=Math.max(0,-(_*v+o)),O=F>0?v:Math.min(Math.max(-v,-M),v),j=-F*F+O*(O+2*M)+C);else O=_>0?-v:v,F=Math.max(0,-(_*O+o)),j=-F*F+O*(O+2*M)+C;return c&&c.copy(this.origin).addScaledVector(this.direction,F),f&&f.copy(ag).addScaledVector(Bf,O),j}intersectSphere(i,s){Za.subVectors(i.center,this.origin);const c=Za.dot(this.direction),f=Za.dot(Za)-c*c,v=i.radius*i.radius;if(f>v)return null;const _=Math.sqrt(v-f),o=c-_,M=c+_;return M<0?null:o<0?this.at(M,s):this.at(o,s)}intersectsSphere(i){return i.radius<0?!1:this.distanceSqToPoint(i.center)<=i.radius*i.radius}distanceToPlane(i){const s=i.normal.dot(this.direction);if(s===0)return i.distanceToPoint(this.origin)===0?0:null;const c=-(this.origin.dot(i.normal)+i.constant)/s;return c>=0?c:null}intersectPlane(i,s){const c=this.distanceToPlane(i);return c===null?null:this.at(c,s)}intersectsPlane(i){const s=i.distanceToPoint(this.origin);return s===0||i.normal.dot(this.direction)*s<0}intersectBox(i,s){let c,f,v,_,o,M;const C=1/this.direction.x,D=1/this.direction.y,F=1/this.direction.z,O=this.origin;return C>=0?(c=(i.min.x-O.x)*C,f=(i.max.x-O.x)*C):(c=(i.max.x-O.x)*C,f=(i.min.x-O.x)*C),D>=0?(v=(i.min.y-O.y)*D,_=(i.max.y-O.y)*D):(v=(i.max.y-O.y)*D,_=(i.min.y-O.y)*D),c>_||v>f||((v>c||isNaN(c))&&(c=v),(_<f||isNaN(f))&&(f=_),F>=0?(o=(i.min.z-O.z)*F,M=(i.max.z-O.z)*F):(o=(i.max.z-O.z)*F,M=(i.min.z-O.z)*F),c>M||o>f)||((o>c||c!==c)&&(c=o),(M<f||f!==f)&&(f=M),f<0)?null:this.at(c>=0?c:f,s)}intersectsBox(i){return this.intersectBox(i,Za)!==null}intersectTriangle(i,s,c,f,v){og.subVectors(s,i),kf.subVectors(c,i),lg.crossVectors(og,kf);let _=this.direction.dot(lg),o;if(_>0){if(f)return null;o=1}else if(_<0)o=-1,_=-_;else return null;Go.subVectors(this.origin,i);const M=o*this.direction.dot(kf.crossVectors(Go,kf));if(M<0)return null;const C=o*this.direction.dot(og.cross(Go));if(C<0||M+C>_)return null;const D=-o*Go.dot(lg);return D<0?null:this.at(D/_,v)}applyMatrix4(i){return this.origin.applyMatrix4(i),this.direction.transformDirection(i),this}equals(i){return i.origin.equals(this.origin)&&i.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class gi{constructor(i,s,c,f,v,_,o,M,C,D,F,O,j,K,J,N){gi.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],i!==void 0&&this.set(i,s,c,f,v,_,o,M,C,D,F,O,j,K,J,N)}set(i,s,c,f,v,_,o,M,C,D,F,O,j,K,J,N){const W=this.elements;return W[0]=i,W[4]=s,W[8]=c,W[12]=f,W[1]=v,W[5]=_,W[9]=o,W[13]=M,W[2]=C,W[6]=D,W[10]=F,W[14]=O,W[3]=j,W[7]=K,W[11]=J,W[15]=N,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new gi().fromArray(this.elements)}copy(i){const s=this.elements,c=i.elements;return s[0]=c[0],s[1]=c[1],s[2]=c[2],s[3]=c[3],s[4]=c[4],s[5]=c[5],s[6]=c[6],s[7]=c[7],s[8]=c[8],s[9]=c[9],s[10]=c[10],s[11]=c[11],s[12]=c[12],s[13]=c[13],s[14]=c[14],s[15]=c[15],this}copyPosition(i){const s=this.elements,c=i.elements;return s[12]=c[12],s[13]=c[13],s[14]=c[14],this}setFromMatrix3(i){const s=i.elements;return this.set(s[0],s[3],s[6],0,s[1],s[4],s[7],0,s[2],s[5],s[8],0,0,0,0,1),this}extractBasis(i,s,c){return this.determinant()===0?(i.set(1,0,0),s.set(0,1,0),c.set(0,0,1),this):(i.setFromMatrixColumn(this,0),s.setFromMatrixColumn(this,1),c.setFromMatrixColumn(this,2),this)}makeBasis(i,s,c){return this.set(i.x,s.x,c.x,0,i.y,s.y,c.y,0,i.z,s.z,c.z,0,0,0,0,1),this}extractRotation(i){if(i.determinant()===0)return this.identity();const s=this.elements,c=i.elements,f=1/eu.setFromMatrixColumn(i,0).length(),v=1/eu.setFromMatrixColumn(i,1).length(),_=1/eu.setFromMatrixColumn(i,2).length();return s[0]=c[0]*f,s[1]=c[1]*f,s[2]=c[2]*f,s[3]=0,s[4]=c[4]*v,s[5]=c[5]*v,s[6]=c[6]*v,s[7]=0,s[8]=c[8]*_,s[9]=c[9]*_,s[10]=c[10]*_,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,this}makeRotationFromEuler(i){const s=this.elements,c=i.x,f=i.y,v=i.z,_=Math.cos(c),o=Math.sin(c),M=Math.cos(f),C=Math.sin(f),D=Math.cos(v),F=Math.sin(v);if(i.order==="XYZ"){const O=_*D,j=_*F,K=o*D,J=o*F;s[0]=M*D,s[4]=-M*F,s[8]=C,s[1]=j+K*C,s[5]=O-J*C,s[9]=-o*M,s[2]=J-O*C,s[6]=K+j*C,s[10]=_*M}else if(i.order==="YXZ"){const O=M*D,j=M*F,K=C*D,J=C*F;s[0]=O+J*o,s[4]=K*o-j,s[8]=_*C,s[1]=_*F,s[5]=_*D,s[9]=-o,s[2]=j*o-K,s[6]=J+O*o,s[10]=_*M}else if(i.order==="ZXY"){const O=M*D,j=M*F,K=C*D,J=C*F;s[0]=O-J*o,s[4]=-_*F,s[8]=K+j*o,s[1]=j+K*o,s[5]=_*D,s[9]=J-O*o,s[2]=-_*C,s[6]=o,s[10]=_*M}else if(i.order==="ZYX"){const O=_*D,j=_*F,K=o*D,J=o*F;s[0]=M*D,s[4]=K*C-j,s[8]=O*C+J,s[1]=M*F,s[5]=J*C+O,s[9]=j*C-K,s[2]=-C,s[6]=o*M,s[10]=_*M}else if(i.order==="YZX"){const O=_*M,j=_*C,K=o*M,J=o*C;s[0]=M*D,s[4]=J-O*F,s[8]=K*F+j,s[1]=F,s[5]=_*D,s[9]=-o*D,s[2]=-C*D,s[6]=j*F+K,s[10]=O-J*F}else if(i.order==="XZY"){const O=_*M,j=_*C,K=o*M,J=o*C;s[0]=M*D,s[4]=-F,s[8]=C*D,s[1]=O*F+J,s[5]=_*D,s[9]=j*F-K,s[2]=K*F-j,s[6]=o*D,s[10]=J*F+O}return s[3]=0,s[7]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,this}makeRotationFromQuaternion(i){return this.compose(dM,i,fM)}lookAt(i,s,c){const f=this.elements;return ds.subVectors(i,s),ds.lengthSq()===0&&(ds.z=1),ds.normalize(),Ho.crossVectors(c,ds),Ho.lengthSq()===0&&(Math.abs(c.z)===1?ds.x+=1e-4:ds.z+=1e-4,ds.normalize(),Ho.crossVectors(c,ds)),Ho.normalize(),Uf.crossVectors(ds,Ho),f[0]=Ho.x,f[4]=Uf.x,f[8]=ds.x,f[1]=Ho.y,f[5]=Uf.y,f[9]=ds.y,f[2]=Ho.z,f[6]=Uf.z,f[10]=ds.z,this}multiply(i){return this.multiplyMatrices(this,i)}premultiply(i){return this.multiplyMatrices(i,this)}multiplyMatrices(i,s){const c=i.elements,f=s.elements,v=this.elements,_=c[0],o=c[4],M=c[8],C=c[12],D=c[1],F=c[5],O=c[9],j=c[13],K=c[2],J=c[6],N=c[10],W=c[14],ge=c[3],de=c[7],ve=c[11],Me=c[15],De=f[0],Ie=f[4],$e=f[8],re=f[12],fe=f[1],Oe=f[5],tt=f[9],Qe=f[13],pt=f[2],ct=f[6],nt=f[10],Je=f[14],ut=f[3],xt=f[7],At=f[11],Rt=f[15];return v[0]=_*De+o*fe+M*pt+C*ut,v[4]=_*Ie+o*Oe+M*ct+C*xt,v[8]=_*$e+o*tt+M*nt+C*At,v[12]=_*re+o*Qe+M*Je+C*Rt,v[1]=D*De+F*fe+O*pt+j*ut,v[5]=D*Ie+F*Oe+O*ct+j*xt,v[9]=D*$e+F*tt+O*nt+j*At,v[13]=D*re+F*Qe+O*Je+j*Rt,v[2]=K*De+J*fe+N*pt+W*ut,v[6]=K*Ie+J*Oe+N*ct+W*xt,v[10]=K*$e+J*tt+N*nt+W*At,v[14]=K*re+J*Qe+N*Je+W*Rt,v[3]=ge*De+de*fe+ve*pt+Me*ut,v[7]=ge*Ie+de*Oe+ve*ct+Me*xt,v[11]=ge*$e+de*tt+ve*nt+Me*At,v[15]=ge*re+de*Qe+ve*Je+Me*Rt,this}multiplyScalar(i){const s=this.elements;return s[0]*=i,s[4]*=i,s[8]*=i,s[12]*=i,s[1]*=i,s[5]*=i,s[9]*=i,s[13]*=i,s[2]*=i,s[6]*=i,s[10]*=i,s[14]*=i,s[3]*=i,s[7]*=i,s[11]*=i,s[15]*=i,this}determinant(){const i=this.elements,s=i[0],c=i[4],f=i[8],v=i[12],_=i[1],o=i[5],M=i[9],C=i[13],D=i[2],F=i[6],O=i[10],j=i[14],K=i[3],J=i[7],N=i[11],W=i[15],ge=M*j-C*O,de=o*j-C*F,ve=o*O-M*F,Me=_*j-C*D,De=_*O-M*D,Ie=_*F-o*D;return s*(J*ge-N*de+W*ve)-c*(K*ge-N*Me+W*De)+f*(K*de-J*Me+W*Ie)-v*(K*ve-J*De+N*Ie)}transpose(){const i=this.elements;let s;return s=i[1],i[1]=i[4],i[4]=s,s=i[2],i[2]=i[8],i[8]=s,s=i[6],i[6]=i[9],i[9]=s,s=i[3],i[3]=i[12],i[12]=s,s=i[7],i[7]=i[13],i[13]=s,s=i[11],i[11]=i[14],i[14]=s,this}setPosition(i,s,c){const f=this.elements;return i.isVector3?(f[12]=i.x,f[13]=i.y,f[14]=i.z):(f[12]=i,f[13]=s,f[14]=c),this}invert(){const i=this.elements,s=i[0],c=i[1],f=i[2],v=i[3],_=i[4],o=i[5],M=i[6],C=i[7],D=i[8],F=i[9],O=i[10],j=i[11],K=i[12],J=i[13],N=i[14],W=i[15],ge=F*N*C-J*O*C+J*M*j-o*N*j-F*M*W+o*O*W,de=K*O*C-D*N*C-K*M*j+_*N*j+D*M*W-_*O*W,ve=D*J*C-K*F*C+K*o*j-_*J*j-D*o*W+_*F*W,Me=K*F*M-D*J*M-K*o*O+_*J*O+D*o*N-_*F*N,De=s*ge+c*de+f*ve+v*Me;if(De===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Ie=1/De;return i[0]=ge*Ie,i[1]=(J*O*v-F*N*v-J*f*j+c*N*j+F*f*W-c*O*W)*Ie,i[2]=(o*N*v-J*M*v+J*f*C-c*N*C-o*f*W+c*M*W)*Ie,i[3]=(F*M*v-o*O*v-F*f*C+c*O*C+o*f*j-c*M*j)*Ie,i[4]=de*Ie,i[5]=(D*N*v-K*O*v+K*f*j-s*N*j-D*f*W+s*O*W)*Ie,i[6]=(K*M*v-_*N*v-K*f*C+s*N*C+_*f*W-s*M*W)*Ie,i[7]=(_*O*v-D*M*v+D*f*C-s*O*C-_*f*j+s*M*j)*Ie,i[8]=ve*Ie,i[9]=(K*F*v-D*J*v-K*c*j+s*J*j+D*c*W-s*F*W)*Ie,i[10]=(_*J*v-K*o*v+K*c*C-s*J*C-_*c*W+s*o*W)*Ie,i[11]=(D*o*v-_*F*v-D*c*C+s*F*C+_*c*j-s*o*j)*Ie,i[12]=Me*Ie,i[13]=(D*J*f-K*F*f+K*c*O-s*J*O-D*c*N+s*F*N)*Ie,i[14]=(K*o*f-_*J*f-K*c*M+s*J*M+_*c*N-s*o*N)*Ie,i[15]=(_*F*f-D*o*f+D*c*M-s*F*M-_*c*O+s*o*O)*Ie,this}scale(i){const s=this.elements,c=i.x,f=i.y,v=i.z;return s[0]*=c,s[4]*=f,s[8]*=v,s[1]*=c,s[5]*=f,s[9]*=v,s[2]*=c,s[6]*=f,s[10]*=v,s[3]*=c,s[7]*=f,s[11]*=v,this}getMaxScaleOnAxis(){const i=this.elements,s=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],c=i[4]*i[4]+i[5]*i[5]+i[6]*i[6],f=i[8]*i[8]+i[9]*i[9]+i[10]*i[10];return Math.sqrt(Math.max(s,c,f))}makeTranslation(i,s,c){return i.isVector3?this.set(1,0,0,i.x,0,1,0,i.y,0,0,1,i.z,0,0,0,1):this.set(1,0,0,i,0,1,0,s,0,0,1,c,0,0,0,1),this}makeRotationX(i){const s=Math.cos(i),c=Math.sin(i);return this.set(1,0,0,0,0,s,-c,0,0,c,s,0,0,0,0,1),this}makeRotationY(i){const s=Math.cos(i),c=Math.sin(i);return this.set(s,0,c,0,0,1,0,0,-c,0,s,0,0,0,0,1),this}makeRotationZ(i){const s=Math.cos(i),c=Math.sin(i);return this.set(s,-c,0,0,c,s,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(i,s){const c=Math.cos(s),f=Math.sin(s),v=1-c,_=i.x,o=i.y,M=i.z,C=v*_,D=v*o;return this.set(C*_+c,C*o-f*M,C*M+f*o,0,C*o+f*M,D*o+c,D*M-f*_,0,C*M-f*o,D*M+f*_,v*M*M+c,0,0,0,0,1),this}makeScale(i,s,c){return this.set(i,0,0,0,0,s,0,0,0,0,c,0,0,0,0,1),this}makeShear(i,s,c,f,v,_){return this.set(1,c,v,0,i,1,_,0,s,f,1,0,0,0,0,1),this}compose(i,s,c){const f=this.elements,v=s._x,_=s._y,o=s._z,M=s._w,C=v+v,D=_+_,F=o+o,O=v*C,j=v*D,K=v*F,J=_*D,N=_*F,W=o*F,ge=M*C,de=M*D,ve=M*F,Me=c.x,De=c.y,Ie=c.z;return f[0]=(1-(J+W))*Me,f[1]=(j+ve)*Me,f[2]=(K-de)*Me,f[3]=0,f[4]=(j-ve)*De,f[5]=(1-(O+W))*De,f[6]=(N+ge)*De,f[7]=0,f[8]=(K+de)*Ie,f[9]=(N-ge)*Ie,f[10]=(1-(O+J))*Ie,f[11]=0,f[12]=i.x,f[13]=i.y,f[14]=i.z,f[15]=1,this}decompose(i,s,c){const f=this.elements;if(i.x=f[12],i.y=f[13],i.z=f[14],this.determinant()===0)return c.set(1,1,1),s.identity(),this;let v=eu.set(f[0],f[1],f[2]).length();const _=eu.set(f[4],f[5],f[6]).length(),o=eu.set(f[8],f[9],f[10]).length();this.determinant()<0&&(v=-v),Vs.copy(this);const C=1/v,D=1/_,F=1/o;return Vs.elements[0]*=C,Vs.elements[1]*=C,Vs.elements[2]*=C,Vs.elements[4]*=D,Vs.elements[5]*=D,Vs.elements[6]*=D,Vs.elements[8]*=F,Vs.elements[9]*=F,Vs.elements[10]*=F,s.setFromRotationMatrix(Vs),c.x=v,c.y=_,c.z=o,this}makePerspective(i,s,c,f,v,_,o=da,M=!1){const C=this.elements,D=2*v/(s-i),F=2*v/(c-f),O=(s+i)/(s-i),j=(c+f)/(c-f);let K,J;if(M)K=v/(_-v),J=_*v/(_-v);else if(o===da)K=-(_+v)/(_-v),J=-2*_*v/(_-v);else if(o===_p)K=-_/(_-v),J=-_*v/(_-v);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return C[0]=D,C[4]=0,C[8]=O,C[12]=0,C[1]=0,C[5]=F,C[9]=j,C[13]=0,C[2]=0,C[6]=0,C[10]=K,C[14]=J,C[3]=0,C[7]=0,C[11]=-1,C[15]=0,this}makeOrthographic(i,s,c,f,v,_,o=da,M=!1){const C=this.elements,D=2/(s-i),F=2/(c-f),O=-(s+i)/(s-i),j=-(c+f)/(c-f);let K,J;if(M)K=1/(_-v),J=_/(_-v);else if(o===da)K=-2/(_-v),J=-(_+v)/(_-v);else if(o===_p)K=-1/(_-v),J=-v/(_-v);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return C[0]=D,C[4]=0,C[8]=0,C[12]=O,C[1]=0,C[5]=F,C[9]=0,C[13]=j,C[2]=0,C[6]=0,C[10]=K,C[14]=J,C[3]=0,C[7]=0,C[11]=0,C[15]=1,this}equals(i){const s=this.elements,c=i.elements;for(let f=0;f<16;f++)if(s[f]!==c[f])return!1;return!0}fromArray(i,s=0){for(let c=0;c<16;c++)this.elements[c]=i[c+s];return this}toArray(i=[],s=0){const c=this.elements;return i[s]=c[0],i[s+1]=c[1],i[s+2]=c[2],i[s+3]=c[3],i[s+4]=c[4],i[s+5]=c[5],i[s+6]=c[6],i[s+7]=c[7],i[s+8]=c[8],i[s+9]=c[9],i[s+10]=c[10],i[s+11]=c[11],i[s+12]=c[12],i[s+13]=c[13],i[s+14]=c[14],i[s+15]=c[15],i}}const eu=new We,Vs=new gi,dM=new We(0,0,0),fM=new We(1,1,1),Ho=new We,Uf=new We,ds=new We,V0=new gi,G0=new $o;class _a{constructor(i=0,s=0,c=0,f=_a.DEFAULT_ORDER){this.isEuler=!0,this._x=i,this._y=s,this._z=c,this._order=f}get x(){return this._x}set x(i){this._x=i,this._onChangeCallback()}get y(){return this._y}set y(i){this._y=i,this._onChangeCallback()}get z(){return this._z}set z(i){this._z=i,this._onChangeCallback()}get order(){return this._order}set order(i){this._order=i,this._onChangeCallback()}set(i,s,c,f=this._order){return this._x=i,this._y=s,this._z=c,this._order=f,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(i){return this._x=i._x,this._y=i._y,this._z=i._z,this._order=i._order,this._onChangeCallback(),this}setFromRotationMatrix(i,s=this._order,c=!0){const f=i.elements,v=f[0],_=f[4],o=f[8],M=f[1],C=f[5],D=f[9],F=f[2],O=f[6],j=f[10];switch(s){case"XYZ":this._y=Math.asin(Li(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-D,j),this._z=Math.atan2(-_,v)):(this._x=Math.atan2(O,C),this._z=0);break;case"YXZ":this._x=Math.asin(-Li(D,-1,1)),Math.abs(D)<.9999999?(this._y=Math.atan2(o,j),this._z=Math.atan2(M,C)):(this._y=Math.atan2(-F,v),this._z=0);break;case"ZXY":this._x=Math.asin(Li(O,-1,1)),Math.abs(O)<.9999999?(this._y=Math.atan2(-F,j),this._z=Math.atan2(-_,C)):(this._y=0,this._z=Math.atan2(M,v));break;case"ZYX":this._y=Math.asin(-Li(F,-1,1)),Math.abs(F)<.9999999?(this._x=Math.atan2(O,j),this._z=Math.atan2(M,v)):(this._x=0,this._z=Math.atan2(-_,C));break;case"YZX":this._z=Math.asin(Li(M,-1,1)),Math.abs(M)<.9999999?(this._x=Math.atan2(-D,C),this._y=Math.atan2(-F,v)):(this._x=0,this._y=Math.atan2(o,j));break;case"XZY":this._z=Math.asin(-Li(_,-1,1)),Math.abs(_)<.9999999?(this._x=Math.atan2(O,C),this._y=Math.atan2(o,v)):(this._x=Math.atan2(-D,j),this._y=0);break;default:ei("Euler: .setFromRotationMatrix() encountered an unknown order: "+s)}return this._order=s,c===!0&&this._onChangeCallback(),this}setFromQuaternion(i,s,c){return V0.makeRotationFromQuaternion(i),this.setFromRotationMatrix(V0,s,c)}setFromVector3(i,s=this._order){return this.set(i.x,i.y,i.z,s)}reorder(i){return G0.setFromEuler(this),this.setFromQuaternion(G0,i)}equals(i){return i._x===this._x&&i._y===this._y&&i._z===this._z&&i._order===this._order}fromArray(i){return this._x=i[0],this._y=i[1],this._z=i[2],i[3]!==void 0&&(this._order=i[3]),this._onChangeCallback(),this}toArray(i=[],s=0){return i[s]=this._x,i[s+1]=this._y,i[s+2]=this._z,i[s+3]=this._order,i}_onChange(i){return this._onChangeCallback=i,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}_a.DEFAULT_ORDER="XYZ";class Db{constructor(){this.mask=1}set(i){this.mask=(1<<i|0)>>>0}enable(i){this.mask|=1<<i|0}enableAll(){this.mask=-1}toggle(i){this.mask^=1<<i|0}disable(i){this.mask&=~(1<<i|0)}disableAll(){this.mask=0}test(i){return(this.mask&i.mask)!==0}isEnabled(i){return(this.mask&(1<<i|0))!==0}}let pM=0;const H0=new We,tu=new $o,$a=new gi,Vf=new We,Vh=new We,mM=new We,gM=new $o,j0=new We(1,0,0),W0=new We(0,1,0),q0=new We(0,0,1),X0={type:"added"},_M={type:"removed"},iu={type:"childadded",child:null},cg={type:"childremoved",child:null};class Dn extends Su{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:pM++}),this.uuid=Ws(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Dn.DEFAULT_UP.clone();const i=new We,s=new _a,c=new $o,f=new We(1,1,1);function v(){c.setFromEuler(s,!1)}function _(){s.setFromQuaternion(c,void 0,!1)}s._onChange(v),c._onChange(_),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:i},rotation:{configurable:!0,enumerable:!0,value:s},quaternion:{configurable:!0,enumerable:!0,value:c},scale:{configurable:!0,enumerable:!0,value:f},modelViewMatrix:{value:new gi},normalMatrix:{value:new wi}}),this.matrix=new gi,this.matrixWorld=new gi,this.matrixAutoUpdate=Dn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Dn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Db,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(i){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(i),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(i){return this.quaternion.premultiply(i),this}setRotationFromAxisAngle(i,s){this.quaternion.setFromAxisAngle(i,s)}setRotationFromEuler(i){this.quaternion.setFromEuler(i,!0)}setRotationFromMatrix(i){this.quaternion.setFromRotationMatrix(i)}setRotationFromQuaternion(i){this.quaternion.copy(i)}rotateOnAxis(i,s){return tu.setFromAxisAngle(i,s),this.quaternion.multiply(tu),this}rotateOnWorldAxis(i,s){return tu.setFromAxisAngle(i,s),this.quaternion.premultiply(tu),this}rotateX(i){return this.rotateOnAxis(j0,i)}rotateY(i){return this.rotateOnAxis(W0,i)}rotateZ(i){return this.rotateOnAxis(q0,i)}translateOnAxis(i,s){return H0.copy(i).applyQuaternion(this.quaternion),this.position.add(H0.multiplyScalar(s)),this}translateX(i){return this.translateOnAxis(j0,i)}translateY(i){return this.translateOnAxis(W0,i)}translateZ(i){return this.translateOnAxis(q0,i)}localToWorld(i){return this.updateWorldMatrix(!0,!1),i.applyMatrix4(this.matrixWorld)}worldToLocal(i){return this.updateWorldMatrix(!0,!1),i.applyMatrix4($a.copy(this.matrixWorld).invert())}lookAt(i,s,c){i.isVector3?Vf.copy(i):Vf.set(i,s,c);const f=this.parent;this.updateWorldMatrix(!0,!1),Vh.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?$a.lookAt(Vh,Vf,this.up):$a.lookAt(Vf,Vh,this.up),this.quaternion.setFromRotationMatrix($a),f&&($a.extractRotation(f.matrixWorld),tu.setFromRotationMatrix($a),this.quaternion.premultiply(tu.invert()))}add(i){if(arguments.length>1){for(let s=0;s<arguments.length;s++)this.add(arguments[s]);return this}return i===this?(hi("Object3D.add: object can't be added as a child of itself.",i),this):(i&&i.isObject3D?(i.removeFromParent(),i.parent=this,this.children.push(i),i.dispatchEvent(X0),iu.child=i,this.dispatchEvent(iu),iu.child=null):hi("Object3D.add: object not an instance of THREE.Object3D.",i),this)}remove(i){if(arguments.length>1){for(let c=0;c<arguments.length;c++)this.remove(arguments[c]);return this}const s=this.children.indexOf(i);return s!==-1&&(i.parent=null,this.children.splice(s,1),i.dispatchEvent(_M),cg.child=i,this.dispatchEvent(cg),cg.child=null),this}removeFromParent(){const i=this.parent;return i!==null&&i.remove(this),this}clear(){return this.remove(...this.children)}attach(i){return this.updateWorldMatrix(!0,!1),$a.copy(this.matrixWorld).invert(),i.parent!==null&&(i.parent.updateWorldMatrix(!0,!1),$a.multiply(i.parent.matrixWorld)),i.applyMatrix4($a),i.removeFromParent(),i.parent=this,this.children.push(i),i.updateWorldMatrix(!1,!0),i.dispatchEvent(X0),iu.child=i,this.dispatchEvent(iu),iu.child=null,this}getObjectById(i){return this.getObjectByProperty("id",i)}getObjectByName(i){return this.getObjectByProperty("name",i)}getObjectByProperty(i,s){if(this[i]===s)return this;for(let c=0,f=this.children.length;c<f;c++){const _=this.children[c].getObjectByProperty(i,s);if(_!==void 0)return _}}getObjectsByProperty(i,s,c=[]){this[i]===s&&c.push(this);const f=this.children;for(let v=0,_=f.length;v<_;v++)f[v].getObjectsByProperty(i,s,c);return c}getWorldPosition(i){return this.updateWorldMatrix(!0,!1),i.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(i){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Vh,i,mM),i}getWorldScale(i){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Vh,gM,i),i}getWorldDirection(i){this.updateWorldMatrix(!0,!1);const s=this.matrixWorld.elements;return i.set(s[8],s[9],s[10]).normalize()}raycast(){}traverse(i){i(this);const s=this.children;for(let c=0,f=s.length;c<f;c++)s[c].traverse(i)}traverseVisible(i){if(this.visible===!1)return;i(this);const s=this.children;for(let c=0,f=s.length;c<f;c++)s[c].traverseVisible(i)}traverseAncestors(i){const s=this.parent;s!==null&&(i(s),s.traverseAncestors(i))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(i){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||i)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,i=!0);const s=this.children;for(let c=0,f=s.length;c<f;c++)s[c].updateMatrixWorld(i)}updateWorldMatrix(i,s){const c=this.parent;if(i===!0&&c!==null&&c.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),s===!0){const f=this.children;for(let v=0,_=f.length;v<_;v++)f[v].updateWorldMatrix(!1,!0)}}toJSON(i){const s=i===void 0||typeof i=="string",c={};s&&(i={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},c.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const f={};f.uuid=this.uuid,f.type=this.type,this.name!==""&&(f.name=this.name),this.castShadow===!0&&(f.castShadow=!0),this.receiveShadow===!0&&(f.receiveShadow=!0),this.visible===!1&&(f.visible=!1),this.frustumCulled===!1&&(f.frustumCulled=!1),this.renderOrder!==0&&(f.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(f.userData=this.userData),f.layers=this.layers.mask,f.matrix=this.matrix.toArray(),f.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(f.matrixAutoUpdate=!1),this.isInstancedMesh&&(f.type="InstancedMesh",f.count=this.count,f.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(f.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(f.type="BatchedMesh",f.perObjectFrustumCulled=this.perObjectFrustumCulled,f.sortObjects=this.sortObjects,f.drawRanges=this._drawRanges,f.reservedRanges=this._reservedRanges,f.geometryInfo=this._geometryInfo.map(o=>({...o,boundingBox:o.boundingBox?o.boundingBox.toJSON():void 0,boundingSphere:o.boundingSphere?o.boundingSphere.toJSON():void 0})),f.instanceInfo=this._instanceInfo.map(o=>({...o})),f.availableInstanceIds=this._availableInstanceIds.slice(),f.availableGeometryIds=this._availableGeometryIds.slice(),f.nextIndexStart=this._nextIndexStart,f.nextVertexStart=this._nextVertexStart,f.geometryCount=this._geometryCount,f.maxInstanceCount=this._maxInstanceCount,f.maxVertexCount=this._maxVertexCount,f.maxIndexCount=this._maxIndexCount,f.geometryInitialized=this._geometryInitialized,f.matricesTexture=this._matricesTexture.toJSON(i),f.indirectTexture=this._indirectTexture.toJSON(i),this._colorsTexture!==null&&(f.colorsTexture=this._colorsTexture.toJSON(i)),this.boundingSphere!==null&&(f.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(f.boundingBox=this.boundingBox.toJSON()));function v(o,M){return o[M.uuid]===void 0&&(o[M.uuid]=M.toJSON(i)),M.uuid}if(this.isScene)this.background&&(this.background.isColor?f.background=this.background.toJSON():this.background.isTexture&&(f.background=this.background.toJSON(i).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(f.environment=this.environment.toJSON(i).uuid);else if(this.isMesh||this.isLine||this.isPoints){f.geometry=v(i.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const M=o.shapes;if(Array.isArray(M))for(let C=0,D=M.length;C<D;C++){const F=M[C];v(i.shapes,F)}else v(i.shapes,M)}}if(this.isSkinnedMesh&&(f.bindMode=this.bindMode,f.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(v(i.skeletons,this.skeleton),f.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let M=0,C=this.material.length;M<C;M++)o.push(v(i.materials,this.material[M]));f.material=o}else f.material=v(i.materials,this.material);if(this.children.length>0){f.children=[];for(let o=0;o<this.children.length;o++)f.children.push(this.children[o].toJSON(i).object)}if(this.animations.length>0){f.animations=[];for(let o=0;o<this.animations.length;o++){const M=this.animations[o];f.animations.push(v(i.animations,M))}}if(s){const o=_(i.geometries),M=_(i.materials),C=_(i.textures),D=_(i.images),F=_(i.shapes),O=_(i.skeletons),j=_(i.animations),K=_(i.nodes);o.length>0&&(c.geometries=o),M.length>0&&(c.materials=M),C.length>0&&(c.textures=C),D.length>0&&(c.images=D),F.length>0&&(c.shapes=F),O.length>0&&(c.skeletons=O),j.length>0&&(c.animations=j),K.length>0&&(c.nodes=K)}return c.object=f,c;function _(o){const M=[];for(const C in o){const D=o[C];delete D.metadata,M.push(D)}return M}}clone(i){return new this.constructor().copy(this,i)}copy(i,s=!0){if(this.name=i.name,this.up.copy(i.up),this.position.copy(i.position),this.rotation.order=i.rotation.order,this.quaternion.copy(i.quaternion),this.scale.copy(i.scale),this.matrix.copy(i.matrix),this.matrixWorld.copy(i.matrixWorld),this.matrixAutoUpdate=i.matrixAutoUpdate,this.matrixWorldAutoUpdate=i.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=i.matrixWorldNeedsUpdate,this.layers.mask=i.layers.mask,this.visible=i.visible,this.castShadow=i.castShadow,this.receiveShadow=i.receiveShadow,this.frustumCulled=i.frustumCulled,this.renderOrder=i.renderOrder,this.animations=i.animations.slice(),this.userData=JSON.parse(JSON.stringify(i.userData)),s===!0)for(let c=0;c<i.children.length;c++){const f=i.children[c];this.add(f.clone())}return this}}Dn.DEFAULT_UP=new We(0,1,0);Dn.DEFAULT_MATRIX_AUTO_UPDATE=!0;Dn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Gs=new We,Ya=new We,ug=new We,Ka=new We,nu=new We,ru=new We,Z0=new We,hg=new We,dg=new We,fg=new We,pg=new wn,mg=new wn,gg=new wn;class js{constructor(i=new We,s=new We,c=new We){this.a=i,this.b=s,this.c=c}static getNormal(i,s,c,f){f.subVectors(c,s),Gs.subVectors(i,s),f.cross(Gs);const v=f.lengthSq();return v>0?f.multiplyScalar(1/Math.sqrt(v)):f.set(0,0,0)}static getBarycoord(i,s,c,f,v){Gs.subVectors(f,s),Ya.subVectors(c,s),ug.subVectors(i,s);const _=Gs.dot(Gs),o=Gs.dot(Ya),M=Gs.dot(ug),C=Ya.dot(Ya),D=Ya.dot(ug),F=_*C-o*o;if(F===0)return v.set(0,0,0),null;const O=1/F,j=(C*M-o*D)*O,K=(_*D-o*M)*O;return v.set(1-j-K,K,j)}static containsPoint(i,s,c,f){return this.getBarycoord(i,s,c,f,Ka)===null?!1:Ka.x>=0&&Ka.y>=0&&Ka.x+Ka.y<=1}static getInterpolation(i,s,c,f,v,_,o,M){return this.getBarycoord(i,s,c,f,Ka)===null?(M.x=0,M.y=0,"z"in M&&(M.z=0),"w"in M&&(M.w=0),null):(M.setScalar(0),M.addScaledVector(v,Ka.x),M.addScaledVector(_,Ka.y),M.addScaledVector(o,Ka.z),M)}static getInterpolatedAttribute(i,s,c,f,v,_){return pg.setScalar(0),mg.setScalar(0),gg.setScalar(0),pg.fromBufferAttribute(i,s),mg.fromBufferAttribute(i,c),gg.fromBufferAttribute(i,f),_.setScalar(0),_.addScaledVector(pg,v.x),_.addScaledVector(mg,v.y),_.addScaledVector(gg,v.z),_}static isFrontFacing(i,s,c,f){return Gs.subVectors(c,s),Ya.subVectors(i,s),Gs.cross(Ya).dot(f)<0}set(i,s,c){return this.a.copy(i),this.b.copy(s),this.c.copy(c),this}setFromPointsAndIndices(i,s,c,f){return this.a.copy(i[s]),this.b.copy(i[c]),this.c.copy(i[f]),this}setFromAttributeAndIndices(i,s,c,f){return this.a.fromBufferAttribute(i,s),this.b.fromBufferAttribute(i,c),this.c.fromBufferAttribute(i,f),this}clone(){return new this.constructor().copy(this)}copy(i){return this.a.copy(i.a),this.b.copy(i.b),this.c.copy(i.c),this}getArea(){return Gs.subVectors(this.c,this.b),Ya.subVectors(this.a,this.b),Gs.cross(Ya).length()*.5}getMidpoint(i){return i.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(i){return js.getNormal(this.a,this.b,this.c,i)}getPlane(i){return i.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(i,s){return js.getBarycoord(i,this.a,this.b,this.c,s)}getInterpolation(i,s,c,f,v){return js.getInterpolation(i,this.a,this.b,this.c,s,c,f,v)}containsPoint(i){return js.containsPoint(i,this.a,this.b,this.c)}isFrontFacing(i){return js.isFrontFacing(this.a,this.b,this.c,i)}intersectsBox(i){return i.intersectsTriangle(this)}closestPointToPoint(i,s){const c=this.a,f=this.b,v=this.c;let _,o;nu.subVectors(f,c),ru.subVectors(v,c),hg.subVectors(i,c);const M=nu.dot(hg),C=ru.dot(hg);if(M<=0&&C<=0)return s.copy(c);dg.subVectors(i,f);const D=nu.dot(dg),F=ru.dot(dg);if(D>=0&&F<=D)return s.copy(f);const O=M*F-D*C;if(O<=0&&M>=0&&D<=0)return _=M/(M-D),s.copy(c).addScaledVector(nu,_);fg.subVectors(i,v);const j=nu.dot(fg),K=ru.dot(fg);if(K>=0&&j<=K)return s.copy(v);const J=j*C-M*K;if(J<=0&&C>=0&&K<=0)return o=C/(C-K),s.copy(c).addScaledVector(ru,o);const N=D*K-j*F;if(N<=0&&F-D>=0&&j-K>=0)return Z0.subVectors(v,f),o=(F-D)/(F-D+(j-K)),s.copy(f).addScaledVector(Z0,o);const W=1/(N+J+O);return _=J*W,o=O*W,s.copy(c).addScaledVector(nu,_).addScaledVector(ru,o)}equals(i){return i.a.equals(this.a)&&i.b.equals(this.b)&&i.c.equals(this.c)}}const Lb={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},jo={h:0,s:0,l:0},Gf={h:0,s:0,l:0};function _g(m,i,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?m+(i-m)*6*s:s<1/2?i:s<2/3?m+(i-m)*6*(2/3-s):m}class bi{constructor(i,s,c){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(i,s,c)}set(i,s,c){if(s===void 0&&c===void 0){const f=i;f&&f.isColor?this.copy(f):typeof f=="number"?this.setHex(f):typeof f=="string"&&this.setStyle(f)}else this.setRGB(i,s,c);return this}setScalar(i){return this.r=i,this.g=i,this.b=i,this}setHex(i,s=Sr){return i=Math.floor(i),this.r=(i>>16&255)/255,this.g=(i>>8&255)/255,this.b=(i&255)/255,Ni.colorSpaceToWorking(this,s),this}setRGB(i,s,c,f=Ni.workingColorSpace){return this.r=i,this.g=s,this.b=c,Ni.colorSpaceToWorking(this,f),this}setHSL(i,s,c,f=Ni.workingColorSpace){if(i=Q_(i,1),s=Li(s,0,1),c=Li(c,0,1),s===0)this.r=this.g=this.b=c;else{const v=c<=.5?c*(1+s):c+s-c*s,_=2*c-v;this.r=_g(_,v,i+1/3),this.g=_g(_,v,i),this.b=_g(_,v,i-1/3)}return Ni.colorSpaceToWorking(this,f),this}setStyle(i,s=Sr){function c(v){v!==void 0&&parseFloat(v)<1&&ei("Color: Alpha component of "+i+" will be ignored.")}let f;if(f=/^(\w+)\(([^\)]*)\)/.exec(i)){let v;const _=f[1],o=f[2];switch(_){case"rgb":case"rgba":if(v=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return c(v[4]),this.setRGB(Math.min(255,parseInt(v[1],10))/255,Math.min(255,parseInt(v[2],10))/255,Math.min(255,parseInt(v[3],10))/255,s);if(v=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return c(v[4]),this.setRGB(Math.min(100,parseInt(v[1],10))/100,Math.min(100,parseInt(v[2],10))/100,Math.min(100,parseInt(v[3],10))/100,s);break;case"hsl":case"hsla":if(v=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return c(v[4]),this.setHSL(parseFloat(v[1])/360,parseFloat(v[2])/100,parseFloat(v[3])/100,s);break;default:ei("Color: Unknown color model "+i)}}else if(f=/^\#([A-Fa-f\d]+)$/.exec(i)){const v=f[1],_=v.length;if(_===3)return this.setRGB(parseInt(v.charAt(0),16)/15,parseInt(v.charAt(1),16)/15,parseInt(v.charAt(2),16)/15,s);if(_===6)return this.setHex(parseInt(v,16),s);ei("Color: Invalid hex color "+i)}else if(i&&i.length>0)return this.setColorName(i,s);return this}setColorName(i,s=Sr){const c=Lb[i.toLowerCase()];return c!==void 0?this.setHex(c,s):ei("Color: Unknown color "+i),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(i){return this.r=i.r,this.g=i.g,this.b=i.b,this}copySRGBToLinear(i){return this.r=no(i.r),this.g=no(i.g),this.b=no(i.b),this}copyLinearToSRGB(i){return this.r=fu(i.r),this.g=fu(i.g),this.b=fu(i.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(i=Sr){return Ni.workingToColorSpace(Dr.copy(this),i),Math.round(Li(Dr.r*255,0,255))*65536+Math.round(Li(Dr.g*255,0,255))*256+Math.round(Li(Dr.b*255,0,255))}getHexString(i=Sr){return("000000"+this.getHex(i).toString(16)).slice(-6)}getHSL(i,s=Ni.workingColorSpace){Ni.workingToColorSpace(Dr.copy(this),s);const c=Dr.r,f=Dr.g,v=Dr.b,_=Math.max(c,f,v),o=Math.min(c,f,v);let M,C;const D=(o+_)/2;if(o===_)M=0,C=0;else{const F=_-o;switch(C=D<=.5?F/(_+o):F/(2-_-o),_){case c:M=(f-v)/F+(f<v?6:0);break;case f:M=(v-c)/F+2;break;case v:M=(c-f)/F+4;break}M/=6}return i.h=M,i.s=C,i.l=D,i}getRGB(i,s=Ni.workingColorSpace){return Ni.workingToColorSpace(Dr.copy(this),s),i.r=Dr.r,i.g=Dr.g,i.b=Dr.b,i}getStyle(i=Sr){Ni.workingToColorSpace(Dr.copy(this),i);const s=Dr.r,c=Dr.g,f=Dr.b;return i!==Sr?`color(${i} ${s.toFixed(3)} ${c.toFixed(3)} ${f.toFixed(3)})`:`rgb(${Math.round(s*255)},${Math.round(c*255)},${Math.round(f*255)})`}offsetHSL(i,s,c){return this.getHSL(jo),this.setHSL(jo.h+i,jo.s+s,jo.l+c)}add(i){return this.r+=i.r,this.g+=i.g,this.b+=i.b,this}addColors(i,s){return this.r=i.r+s.r,this.g=i.g+s.g,this.b=i.b+s.b,this}addScalar(i){return this.r+=i,this.g+=i,this.b+=i,this}sub(i){return this.r=Math.max(0,this.r-i.r),this.g=Math.max(0,this.g-i.g),this.b=Math.max(0,this.b-i.b),this}multiply(i){return this.r*=i.r,this.g*=i.g,this.b*=i.b,this}multiplyScalar(i){return this.r*=i,this.g*=i,this.b*=i,this}lerp(i,s){return this.r+=(i.r-this.r)*s,this.g+=(i.g-this.g)*s,this.b+=(i.b-this.b)*s,this}lerpColors(i,s,c){return this.r=i.r+(s.r-i.r)*c,this.g=i.g+(s.g-i.g)*c,this.b=i.b+(s.b-i.b)*c,this}lerpHSL(i,s){this.getHSL(jo),i.getHSL(Gf);const c=ed(jo.h,Gf.h,s),f=ed(jo.s,Gf.s,s),v=ed(jo.l,Gf.l,s);return this.setHSL(c,f,v),this}setFromVector3(i){return this.r=i.x,this.g=i.y,this.b=i.z,this}applyMatrix3(i){const s=this.r,c=this.g,f=this.b,v=i.elements;return this.r=v[0]*s+v[3]*c+v[6]*f,this.g=v[1]*s+v[4]*c+v[7]*f,this.b=v[2]*s+v[5]*c+v[8]*f,this}equals(i){return i.r===this.r&&i.g===this.g&&i.b===this.b}fromArray(i,s=0){return this.r=i[s],this.g=i[s+1],this.b=i[s+2],this}toArray(i=[],s=0){return i[s]=this.r,i[s+1]=this.g,i[s+2]=this.b,i}fromBufferAttribute(i,s){return this.r=i.getX(s),this.g=i.getY(s),this.b=i.getZ(s),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Dr=new bi;bi.NAMES=Lb;let yM=0;class ma extends Su{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:yM++}),this.uuid=Ws(),this.name="",this.type="Material",this.blending=Xl,this.side=ro,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Ug,this.blendDst=Vg,this.blendEquation=Hl,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new bi(0,0,0),this.blendAlpha=0,this.depthFunc=mu,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=F0,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=$c,this.stencilZFail=$c,this.stencilZPass=$c,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(i){this._alphaTest>0!=i>0&&this.version++,this._alphaTest=i}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(i){if(i!==void 0)for(const s in i){const c=i[s];if(c===void 0){ei(`Material: parameter '${s}' has value of undefined.`);continue}const f=this[s];if(f===void 0){ei(`Material: '${s}' is not a property of THREE.${this.type}.`);continue}f&&f.isColor?f.set(c):f&&f.isVector3&&c&&c.isVector3?f.copy(c):this[s]=c}}toJSON(i){const s=i===void 0||typeof i=="string";s&&(i={textures:{},images:{}});const c={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};c.uuid=this.uuid,c.type=this.type,this.name!==""&&(c.name=this.name),this.color&&this.color.isColor&&(c.color=this.color.getHex()),this.roughness!==void 0&&(c.roughness=this.roughness),this.metalness!==void 0&&(c.metalness=this.metalness),this.sheen!==void 0&&(c.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(c.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(c.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(c.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(c.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(c.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(c.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(c.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(c.shininess=this.shininess),this.clearcoat!==void 0&&(c.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(c.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(c.clearcoatMap=this.clearcoatMap.toJSON(i).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(c.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(i).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(c.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(i).uuid,c.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(c.sheenColorMap=this.sheenColorMap.toJSON(i).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(c.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(i).uuid),this.dispersion!==void 0&&(c.dispersion=this.dispersion),this.iridescence!==void 0&&(c.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(c.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(c.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(c.iridescenceMap=this.iridescenceMap.toJSON(i).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(c.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(i).uuid),this.anisotropy!==void 0&&(c.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(c.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(c.anisotropyMap=this.anisotropyMap.toJSON(i).uuid),this.map&&this.map.isTexture&&(c.map=this.map.toJSON(i).uuid),this.matcap&&this.matcap.isTexture&&(c.matcap=this.matcap.toJSON(i).uuid),this.alphaMap&&this.alphaMap.isTexture&&(c.alphaMap=this.alphaMap.toJSON(i).uuid),this.lightMap&&this.lightMap.isTexture&&(c.lightMap=this.lightMap.toJSON(i).uuid,c.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(c.aoMap=this.aoMap.toJSON(i).uuid,c.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(c.bumpMap=this.bumpMap.toJSON(i).uuid,c.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(c.normalMap=this.normalMap.toJSON(i).uuid,c.normalMapType=this.normalMapType,c.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(c.displacementMap=this.displacementMap.toJSON(i).uuid,c.displacementScale=this.displacementScale,c.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(c.roughnessMap=this.roughnessMap.toJSON(i).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(c.metalnessMap=this.metalnessMap.toJSON(i).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(c.emissiveMap=this.emissiveMap.toJSON(i).uuid),this.specularMap&&this.specularMap.isTexture&&(c.specularMap=this.specularMap.toJSON(i).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(c.specularIntensityMap=this.specularIntensityMap.toJSON(i).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(c.specularColorMap=this.specularColorMap.toJSON(i).uuid),this.envMap&&this.envMap.isTexture&&(c.envMap=this.envMap.toJSON(i).uuid,this.combine!==void 0&&(c.combine=this.combine)),this.envMapRotation!==void 0&&(c.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(c.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(c.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(c.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(c.gradientMap=this.gradientMap.toJSON(i).uuid),this.transmission!==void 0&&(c.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(c.transmissionMap=this.transmissionMap.toJSON(i).uuid),this.thickness!==void 0&&(c.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(c.thicknessMap=this.thicknessMap.toJSON(i).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(c.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(c.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(c.size=this.size),this.shadowSide!==null&&(c.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(c.sizeAttenuation=this.sizeAttenuation),this.blending!==Xl&&(c.blending=this.blending),this.side!==ro&&(c.side=this.side),this.vertexColors===!0&&(c.vertexColors=!0),this.opacity<1&&(c.opacity=this.opacity),this.transparent===!0&&(c.transparent=!0),this.blendSrc!==Ug&&(c.blendSrc=this.blendSrc),this.blendDst!==Vg&&(c.blendDst=this.blendDst),this.blendEquation!==Hl&&(c.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(c.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(c.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(c.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(c.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(c.blendAlpha=this.blendAlpha),this.depthFunc!==mu&&(c.depthFunc=this.depthFunc),this.depthTest===!1&&(c.depthTest=this.depthTest),this.depthWrite===!1&&(c.depthWrite=this.depthWrite),this.colorWrite===!1&&(c.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(c.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==F0&&(c.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(c.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(c.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==$c&&(c.stencilFail=this.stencilFail),this.stencilZFail!==$c&&(c.stencilZFail=this.stencilZFail),this.stencilZPass!==$c&&(c.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(c.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(c.rotation=this.rotation),this.polygonOffset===!0&&(c.polygonOffset=!0),this.polygonOffsetFactor!==0&&(c.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(c.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(c.linewidth=this.linewidth),this.dashSize!==void 0&&(c.dashSize=this.dashSize),this.gapSize!==void 0&&(c.gapSize=this.gapSize),this.scale!==void 0&&(c.scale=this.scale),this.dithering===!0&&(c.dithering=!0),this.alphaTest>0&&(c.alphaTest=this.alphaTest),this.alphaHash===!0&&(c.alphaHash=!0),this.alphaToCoverage===!0&&(c.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(c.premultipliedAlpha=!0),this.forceSinglePass===!0&&(c.forceSinglePass=!0),this.allowOverride===!1&&(c.allowOverride=!1),this.wireframe===!0&&(c.wireframe=!0),this.wireframeLinewidth>1&&(c.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(c.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(c.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(c.flatShading=!0),this.visible===!1&&(c.visible=!1),this.toneMapped===!1&&(c.toneMapped=!1),this.fog===!1&&(c.fog=!1),Object.keys(this.userData).length>0&&(c.userData=this.userData);function f(v){const _=[];for(const o in v){const M=v[o];delete M.metadata,_.push(M)}return _}if(s){const v=f(i.textures),_=f(i.images);v.length>0&&(c.textures=v),_.length>0&&(c.images=_)}return c}clone(){return new this.constructor().copy(this)}copy(i){this.name=i.name,this.blending=i.blending,this.side=i.side,this.vertexColors=i.vertexColors,this.opacity=i.opacity,this.transparent=i.transparent,this.blendSrc=i.blendSrc,this.blendDst=i.blendDst,this.blendEquation=i.blendEquation,this.blendSrcAlpha=i.blendSrcAlpha,this.blendDstAlpha=i.blendDstAlpha,this.blendEquationAlpha=i.blendEquationAlpha,this.blendColor.copy(i.blendColor),this.blendAlpha=i.blendAlpha,this.depthFunc=i.depthFunc,this.depthTest=i.depthTest,this.depthWrite=i.depthWrite,this.stencilWriteMask=i.stencilWriteMask,this.stencilFunc=i.stencilFunc,this.stencilRef=i.stencilRef,this.stencilFuncMask=i.stencilFuncMask,this.stencilFail=i.stencilFail,this.stencilZFail=i.stencilZFail,this.stencilZPass=i.stencilZPass,this.stencilWrite=i.stencilWrite;const s=i.clippingPlanes;let c=null;if(s!==null){const f=s.length;c=new Array(f);for(let v=0;v!==f;++v)c[v]=s[v].clone()}return this.clippingPlanes=c,this.clipIntersection=i.clipIntersection,this.clipShadows=i.clipShadows,this.shadowSide=i.shadowSide,this.colorWrite=i.colorWrite,this.precision=i.precision,this.polygonOffset=i.polygonOffset,this.polygonOffsetFactor=i.polygonOffsetFactor,this.polygonOffsetUnits=i.polygonOffsetUnits,this.dithering=i.dithering,this.alphaTest=i.alphaTest,this.alphaHash=i.alphaHash,this.alphaToCoverage=i.alphaToCoverage,this.premultipliedAlpha=i.premultipliedAlpha,this.forceSinglePass=i.forceSinglePass,this.allowOverride=i.allowOverride,this.visible=i.visible,this.toneMapped=i.toneMapped,this.userData=JSON.parse(JSON.stringify(i.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(i){i===!0&&this.version++}}class eo extends ma{constructor(i){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new bi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new _a,this.combine=db,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(i)}copy(i){return super.copy(i),this.color.copy(i.color),this.map=i.map,this.lightMap=i.lightMap,this.lightMapIntensity=i.lightMapIntensity,this.aoMap=i.aoMap,this.aoMapIntensity=i.aoMapIntensity,this.specularMap=i.specularMap,this.alphaMap=i.alphaMap,this.envMap=i.envMap,this.envMapRotation.copy(i.envMapRotation),this.combine=i.combine,this.reflectivity=i.reflectivity,this.refractionRatio=i.refractionRatio,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.wireframeLinecap=i.wireframeLinecap,this.wireframeLinejoin=i.wireframeLinejoin,this.fog=i.fog,this}}const $n=new We,Hf=new Bi;let xM=0;class mr{constructor(i,s,c=!1){if(Array.isArray(i))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:xM++}),this.name="",this.array=i,this.itemSize=s,this.count=i!==void 0?i.length/s:0,this.normalized=c,this.usage=I_,this.updateRanges=[],this.gpuType=Cs,this.version=0}onUploadCallback(){}set needsUpdate(i){i===!0&&this.version++}setUsage(i){return this.usage=i,this}addUpdateRange(i,s){this.updateRanges.push({start:i,count:s})}clearUpdateRanges(){this.updateRanges.length=0}copy(i){return this.name=i.name,this.array=new i.array.constructor(i.array),this.itemSize=i.itemSize,this.count=i.count,this.normalized=i.normalized,this.usage=i.usage,this.gpuType=i.gpuType,this}copyAt(i,s,c){i*=this.itemSize,c*=s.itemSize;for(let f=0,v=this.itemSize;f<v;f++)this.array[i+f]=s.array[c+f];return this}copyArray(i){return this.array.set(i),this}applyMatrix3(i){if(this.itemSize===2)for(let s=0,c=this.count;s<c;s++)Hf.fromBufferAttribute(this,s),Hf.applyMatrix3(i),this.setXY(s,Hf.x,Hf.y);else if(this.itemSize===3)for(let s=0,c=this.count;s<c;s++)$n.fromBufferAttribute(this,s),$n.applyMatrix3(i),this.setXYZ(s,$n.x,$n.y,$n.z);return this}applyMatrix4(i){for(let s=0,c=this.count;s<c;s++)$n.fromBufferAttribute(this,s),$n.applyMatrix4(i),this.setXYZ(s,$n.x,$n.y,$n.z);return this}applyNormalMatrix(i){for(let s=0,c=this.count;s<c;s++)$n.fromBufferAttribute(this,s),$n.applyNormalMatrix(i),this.setXYZ(s,$n.x,$n.y,$n.z);return this}transformDirection(i){for(let s=0,c=this.count;s<c;s++)$n.fromBufferAttribute(this,s),$n.transformDirection(i),this.setXYZ(s,$n.x,$n.y,$n.z);return this}set(i,s=0){return this.array.set(i,s),this}getComponent(i,s){let c=this.array[i*this.itemSize+s];return this.normalized&&(c=Hs(c,this.array)),c}setComponent(i,s,c){return this.normalized&&(c=tn(c,this.array)),this.array[i*this.itemSize+s]=c,this}getX(i){let s=this.array[i*this.itemSize];return this.normalized&&(s=Hs(s,this.array)),s}setX(i,s){return this.normalized&&(s=tn(s,this.array)),this.array[i*this.itemSize]=s,this}getY(i){let s=this.array[i*this.itemSize+1];return this.normalized&&(s=Hs(s,this.array)),s}setY(i,s){return this.normalized&&(s=tn(s,this.array)),this.array[i*this.itemSize+1]=s,this}getZ(i){let s=this.array[i*this.itemSize+2];return this.normalized&&(s=Hs(s,this.array)),s}setZ(i,s){return this.normalized&&(s=tn(s,this.array)),this.array[i*this.itemSize+2]=s,this}getW(i){let s=this.array[i*this.itemSize+3];return this.normalized&&(s=Hs(s,this.array)),s}setW(i,s){return this.normalized&&(s=tn(s,this.array)),this.array[i*this.itemSize+3]=s,this}setXY(i,s,c){return i*=this.itemSize,this.normalized&&(s=tn(s,this.array),c=tn(c,this.array)),this.array[i+0]=s,this.array[i+1]=c,this}setXYZ(i,s,c,f){return i*=this.itemSize,this.normalized&&(s=tn(s,this.array),c=tn(c,this.array),f=tn(f,this.array)),this.array[i+0]=s,this.array[i+1]=c,this.array[i+2]=f,this}setXYZW(i,s,c,f,v){return i*=this.itemSize,this.normalized&&(s=tn(s,this.array),c=tn(c,this.array),f=tn(f,this.array),v=tn(v,this.array)),this.array[i+0]=s,this.array[i+1]=c,this.array[i+2]=f,this.array[i+3]=v,this}onUpload(i){return this.onUploadCallback=i,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const i={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(i.name=this.name),this.usage!==I_&&(i.usage=this.usage),i}}class Fb extends mr{constructor(i,s,c){super(new Uint16Array(i),s,c)}}class zb extends mr{constructor(i,s,c){super(new Uint32Array(i),s,c)}}class es extends mr{constructor(i,s,c){super(new Float32Array(i),s,c)}}let vM=0;const Ss=new gi,yg=new Dn,su=new We,fs=new oo,Gh=new oo,dr=new We;class ts extends Su{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:vM++}),this.uuid=Ws(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.indirectOffset=0,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(i){return Array.isArray(i)?this.index=new(Ib(i)?zb:Fb)(i,1):this.index=i,this}setIndirect(i,s=0){return this.indirect=i,this.indirectOffset=s,this}getIndirect(){return this.indirect}getAttribute(i){return this.attributes[i]}setAttribute(i,s){return this.attributes[i]=s,this}deleteAttribute(i){return delete this.attributes[i],this}hasAttribute(i){return this.attributes[i]!==void 0}addGroup(i,s,c=0){this.groups.push({start:i,count:s,materialIndex:c})}clearGroups(){this.groups=[]}setDrawRange(i,s){this.drawRange.start=i,this.drawRange.count=s}applyMatrix4(i){const s=this.attributes.position;s!==void 0&&(s.applyMatrix4(i),s.needsUpdate=!0);const c=this.attributes.normal;if(c!==void 0){const v=new wi().getNormalMatrix(i);c.applyNormalMatrix(v),c.needsUpdate=!0}const f=this.attributes.tangent;return f!==void 0&&(f.transformDirection(i),f.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(i){return Ss.makeRotationFromQuaternion(i),this.applyMatrix4(Ss),this}rotateX(i){return Ss.makeRotationX(i),this.applyMatrix4(Ss),this}rotateY(i){return Ss.makeRotationY(i),this.applyMatrix4(Ss),this}rotateZ(i){return Ss.makeRotationZ(i),this.applyMatrix4(Ss),this}translate(i,s,c){return Ss.makeTranslation(i,s,c),this.applyMatrix4(Ss),this}scale(i,s,c){return Ss.makeScale(i,s,c),this.applyMatrix4(Ss),this}lookAt(i){return yg.lookAt(i),yg.updateMatrix(),this.applyMatrix4(yg.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(su).negate(),this.translate(su.x,su.y,su.z),this}setFromPoints(i){const s=this.getAttribute("position");if(s===void 0){const c=[];for(let f=0,v=i.length;f<v;f++){const _=i[f];c.push(_.x,_.y,_.z||0)}this.setAttribute("position",new es(c,3))}else{const c=Math.min(i.length,s.count);for(let f=0;f<c;f++){const v=i[f];s.setXYZ(f,v.x,v.y,v.z||0)}i.length>s.count&&ei("BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),s.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new oo);const i=this.attributes.position,s=this.morphAttributes.position;if(i&&i.isGLBufferAttribute){hi("BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new We(-1/0,-1/0,-1/0),new We(1/0,1/0,1/0));return}if(i!==void 0){if(this.boundingBox.setFromBufferAttribute(i),s)for(let c=0,f=s.length;c<f;c++){const v=s[c];fs.setFromBufferAttribute(v),this.morphTargetsRelative?(dr.addVectors(this.boundingBox.min,fs.min),this.boundingBox.expandByPoint(dr),dr.addVectors(this.boundingBox.max,fs.max),this.boundingBox.expandByPoint(dr)):(this.boundingBox.expandByPoint(fs.min),this.boundingBox.expandByPoint(fs.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&hi('BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new xa);const i=this.attributes.position,s=this.morphAttributes.position;if(i&&i.isGLBufferAttribute){hi("BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new We,1/0);return}if(i){const c=this.boundingSphere.center;if(fs.setFromBufferAttribute(i),s)for(let v=0,_=s.length;v<_;v++){const o=s[v];Gh.setFromBufferAttribute(o),this.morphTargetsRelative?(dr.addVectors(fs.min,Gh.min),fs.expandByPoint(dr),dr.addVectors(fs.max,Gh.max),fs.expandByPoint(dr)):(fs.expandByPoint(Gh.min),fs.expandByPoint(Gh.max))}fs.getCenter(c);let f=0;for(let v=0,_=i.count;v<_;v++)dr.fromBufferAttribute(i,v),f=Math.max(f,c.distanceToSquared(dr));if(s)for(let v=0,_=s.length;v<_;v++){const o=s[v],M=this.morphTargetsRelative;for(let C=0,D=o.count;C<D;C++)dr.fromBufferAttribute(o,C),M&&(su.fromBufferAttribute(i,C),dr.add(su)),f=Math.max(f,c.distanceToSquared(dr))}this.boundingSphere.radius=Math.sqrt(f),isNaN(this.boundingSphere.radius)&&hi('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const i=this.index,s=this.attributes;if(i===null||s.position===void 0||s.normal===void 0||s.uv===void 0){hi("BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const c=s.position,f=s.normal,v=s.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new mr(new Float32Array(4*c.count),4));const _=this.getAttribute("tangent"),o=[],M=[];for(let $e=0;$e<c.count;$e++)o[$e]=new We,M[$e]=new We;const C=new We,D=new We,F=new We,O=new Bi,j=new Bi,K=new Bi,J=new We,N=new We;function W($e,re,fe){C.fromBufferAttribute(c,$e),D.fromBufferAttribute(c,re),F.fromBufferAttribute(c,fe),O.fromBufferAttribute(v,$e),j.fromBufferAttribute(v,re),K.fromBufferAttribute(v,fe),D.sub(C),F.sub(C),j.sub(O),K.sub(O);const Oe=1/(j.x*K.y-K.x*j.y);isFinite(Oe)&&(J.copy(D).multiplyScalar(K.y).addScaledVector(F,-j.y).multiplyScalar(Oe),N.copy(F).multiplyScalar(j.x).addScaledVector(D,-K.x).multiplyScalar(Oe),o[$e].add(J),o[re].add(J),o[fe].add(J),M[$e].add(N),M[re].add(N),M[fe].add(N))}let ge=this.groups;ge.length===0&&(ge=[{start:0,count:i.count}]);for(let $e=0,re=ge.length;$e<re;++$e){const fe=ge[$e],Oe=fe.start,tt=fe.count;for(let Qe=Oe,pt=Oe+tt;Qe<pt;Qe+=3)W(i.getX(Qe+0),i.getX(Qe+1),i.getX(Qe+2))}const de=new We,ve=new We,Me=new We,De=new We;function Ie($e){Me.fromBufferAttribute(f,$e),De.copy(Me);const re=o[$e];de.copy(re),de.sub(Me.multiplyScalar(Me.dot(re))).normalize(),ve.crossVectors(De,re);const Oe=ve.dot(M[$e])<0?-1:1;_.setXYZW($e,de.x,de.y,de.z,Oe)}for(let $e=0,re=ge.length;$e<re;++$e){const fe=ge[$e],Oe=fe.start,tt=fe.count;for(let Qe=Oe,pt=Oe+tt;Qe<pt;Qe+=3)Ie(i.getX(Qe+0)),Ie(i.getX(Qe+1)),Ie(i.getX(Qe+2))}}computeVertexNormals(){const i=this.index,s=this.getAttribute("position");if(s!==void 0){let c=this.getAttribute("normal");if(c===void 0)c=new mr(new Float32Array(s.count*3),3),this.setAttribute("normal",c);else for(let O=0,j=c.count;O<j;O++)c.setXYZ(O,0,0,0);const f=new We,v=new We,_=new We,o=new We,M=new We,C=new We,D=new We,F=new We;if(i)for(let O=0,j=i.count;O<j;O+=3){const K=i.getX(O+0),J=i.getX(O+1),N=i.getX(O+2);f.fromBufferAttribute(s,K),v.fromBufferAttribute(s,J),_.fromBufferAttribute(s,N),D.subVectors(_,v),F.subVectors(f,v),D.cross(F),o.fromBufferAttribute(c,K),M.fromBufferAttribute(c,J),C.fromBufferAttribute(c,N),o.add(D),M.add(D),C.add(D),c.setXYZ(K,o.x,o.y,o.z),c.setXYZ(J,M.x,M.y,M.z),c.setXYZ(N,C.x,C.y,C.z)}else for(let O=0,j=s.count;O<j;O+=3)f.fromBufferAttribute(s,O+0),v.fromBufferAttribute(s,O+1),_.fromBufferAttribute(s,O+2),D.subVectors(_,v),F.subVectors(f,v),D.cross(F),c.setXYZ(O+0,D.x,D.y,D.z),c.setXYZ(O+1,D.x,D.y,D.z),c.setXYZ(O+2,D.x,D.y,D.z);this.normalizeNormals(),c.needsUpdate=!0}}normalizeNormals(){const i=this.attributes.normal;for(let s=0,c=i.count;s<c;s++)dr.fromBufferAttribute(i,s),dr.normalize(),i.setXYZ(s,dr.x,dr.y,dr.z)}toNonIndexed(){function i(o,M){const C=o.array,D=o.itemSize,F=o.normalized,O=new C.constructor(M.length*D);let j=0,K=0;for(let J=0,N=M.length;J<N;J++){o.isInterleavedBufferAttribute?j=M[J]*o.data.stride+o.offset:j=M[J]*D;for(let W=0;W<D;W++)O[K++]=C[j++]}return new mr(O,D,F)}if(this.index===null)return ei("BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const s=new ts,c=this.index.array,f=this.attributes;for(const o in f){const M=f[o],C=i(M,c);s.setAttribute(o,C)}const v=this.morphAttributes;for(const o in v){const M=[],C=v[o];for(let D=0,F=C.length;D<F;D++){const O=C[D],j=i(O,c);M.push(j)}s.morphAttributes[o]=M}s.morphTargetsRelative=this.morphTargetsRelative;const _=this.groups;for(let o=0,M=_.length;o<M;o++){const C=_[o];s.addGroup(C.start,C.count,C.materialIndex)}return s}toJSON(){const i={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),Object.keys(this.userData).length>0&&(i.userData=this.userData),this.parameters!==void 0){const M=this.parameters;for(const C in M)M[C]!==void 0&&(i[C]=M[C]);return i}i.data={attributes:{}};const s=this.index;s!==null&&(i.data.index={type:s.array.constructor.name,array:Array.prototype.slice.call(s.array)});const c=this.attributes;for(const M in c){const C=c[M];i.data.attributes[M]=C.toJSON(i.data)}const f={};let v=!1;for(const M in this.morphAttributes){const C=this.morphAttributes[M],D=[];for(let F=0,O=C.length;F<O;F++){const j=C[F];D.push(j.toJSON(i.data))}D.length>0&&(f[M]=D,v=!0)}v&&(i.data.morphAttributes=f,i.data.morphTargetsRelative=this.morphTargetsRelative);const _=this.groups;_.length>0&&(i.data.groups=JSON.parse(JSON.stringify(_)));const o=this.boundingSphere;return o!==null&&(i.data.boundingSphere=o.toJSON()),i}clone(){return new this.constructor().copy(this)}copy(i){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const s={};this.name=i.name;const c=i.index;c!==null&&this.setIndex(c.clone());const f=i.attributes;for(const C in f){const D=f[C];this.setAttribute(C,D.clone(s))}const v=i.morphAttributes;for(const C in v){const D=[],F=v[C];for(let O=0,j=F.length;O<j;O++)D.push(F[O].clone(s));this.morphAttributes[C]=D}this.morphTargetsRelative=i.morphTargetsRelative;const _=i.groups;for(let C=0,D=_.length;C<D;C++){const F=_[C];this.addGroup(F.start,F.count,F.materialIndex)}const o=i.boundingBox;o!==null&&(this.boundingBox=o.clone());const M=i.boundingSphere;return M!==null&&(this.boundingSphere=M.clone()),this.drawRange.start=i.drawRange.start,this.drawRange.count=i.drawRange.count,this.userData=i.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const $0=new gi,Nl=new Tp,jf=new xa,Y0=new We,Wf=new We,qf=new We,Xf=new We,xg=new We,Zf=new We,K0=new We,$f=new We;class Gr extends Dn{constructor(i=new ts,s=new eo){super(),this.isMesh=!0,this.type="Mesh",this.geometry=i,this.material=s,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(i,s){return super.copy(i,s),i.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=i.morphTargetInfluences.slice()),i.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},i.morphTargetDictionary)),this.material=Array.isArray(i.material)?i.material.slice():i.material,this.geometry=i.geometry,this}updateMorphTargets(){const s=this.geometry.morphAttributes,c=Object.keys(s);if(c.length>0){const f=s[c[0]];if(f!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let v=0,_=f.length;v<_;v++){const o=f[v].name||String(v);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=v}}}}getVertexPosition(i,s){const c=this.geometry,f=c.attributes.position,v=c.morphAttributes.position,_=c.morphTargetsRelative;s.fromBufferAttribute(f,i);const o=this.morphTargetInfluences;if(v&&o){Zf.set(0,0,0);for(let M=0,C=v.length;M<C;M++){const D=o[M],F=v[M];D!==0&&(xg.fromBufferAttribute(F,i),_?Zf.addScaledVector(xg,D):Zf.addScaledVector(xg.sub(s),D))}s.add(Zf)}return s}raycast(i,s){const c=this.geometry,f=this.material,v=this.matrixWorld;f!==void 0&&(c.boundingSphere===null&&c.computeBoundingSphere(),jf.copy(c.boundingSphere),jf.applyMatrix4(v),Nl.copy(i.ray).recast(i.near),!(jf.containsPoint(Nl.origin)===!1&&(Nl.intersectSphere(jf,Y0)===null||Nl.origin.distanceToSquared(Y0)>(i.far-i.near)**2))&&($0.copy(v).invert(),Nl.copy(i.ray).applyMatrix4($0),!(c.boundingBox!==null&&Nl.intersectsBox(c.boundingBox)===!1)&&this._computeIntersections(i,s,Nl)))}_computeIntersections(i,s,c){let f;const v=this.geometry,_=this.material,o=v.index,M=v.attributes.position,C=v.attributes.uv,D=v.attributes.uv1,F=v.attributes.normal,O=v.groups,j=v.drawRange;if(o!==null)if(Array.isArray(_))for(let K=0,J=O.length;K<J;K++){const N=O[K],W=_[N.materialIndex],ge=Math.max(N.start,j.start),de=Math.min(o.count,Math.min(N.start+N.count,j.start+j.count));for(let ve=ge,Me=de;ve<Me;ve+=3){const De=o.getX(ve),Ie=o.getX(ve+1),$e=o.getX(ve+2);f=Yf(this,W,i,c,C,D,F,De,Ie,$e),f&&(f.faceIndex=Math.floor(ve/3),f.face.materialIndex=N.materialIndex,s.push(f))}}else{const K=Math.max(0,j.start),J=Math.min(o.count,j.start+j.count);for(let N=K,W=J;N<W;N+=3){const ge=o.getX(N),de=o.getX(N+1),ve=o.getX(N+2);f=Yf(this,_,i,c,C,D,F,ge,de,ve),f&&(f.faceIndex=Math.floor(N/3),s.push(f))}}else if(M!==void 0)if(Array.isArray(_))for(let K=0,J=O.length;K<J;K++){const N=O[K],W=_[N.materialIndex],ge=Math.max(N.start,j.start),de=Math.min(M.count,Math.min(N.start+N.count,j.start+j.count));for(let ve=ge,Me=de;ve<Me;ve+=3){const De=ve,Ie=ve+1,$e=ve+2;f=Yf(this,W,i,c,C,D,F,De,Ie,$e),f&&(f.faceIndex=Math.floor(ve/3),f.face.materialIndex=N.materialIndex,s.push(f))}}else{const K=Math.max(0,j.start),J=Math.min(M.count,j.start+j.count);for(let N=K,W=J;N<W;N+=3){const ge=N,de=N+1,ve=N+2;f=Yf(this,_,i,c,C,D,F,ge,de,ve),f&&(f.faceIndex=Math.floor(N/3),s.push(f))}}}}function bM(m,i,s,c,f,v,_,o){let M;if(i.side===Qr?M=c.intersectTriangle(_,v,f,!0,o):M=c.intersectTriangle(f,v,_,i.side===ro,o),M===null)return null;$f.copy(o),$f.applyMatrix4(m.matrixWorld);const C=s.ray.origin.distanceTo($f);return C<s.near||C>s.far?null:{distance:C,point:$f.clone(),object:m}}function Yf(m,i,s,c,f,v,_,o,M,C){m.getVertexPosition(o,Wf),m.getVertexPosition(M,qf),m.getVertexPosition(C,Xf);const D=bM(m,i,s,c,Wf,qf,Xf,K0);if(D){const F=new We;js.getBarycoord(K0,Wf,qf,Xf,F),f&&(D.uv=js.getInterpolatedAttribute(f,o,M,C,F,new Bi)),v&&(D.uv1=js.getInterpolatedAttribute(v,o,M,C,F,new Bi)),_&&(D.normal=js.getInterpolatedAttribute(_,o,M,C,F,new We),D.normal.dot(c.direction)>0&&D.normal.multiplyScalar(-1));const O={a:o,b:M,c:C,normal:new We,materialIndex:0};js.getNormal(Wf,qf,Xf,O.normal),D.face=O,D.barycoord=F}return D}class ud extends ts{constructor(i=1,s=1,c=1,f=1,v=1,_=1){super(),this.type="BoxGeometry",this.parameters={width:i,height:s,depth:c,widthSegments:f,heightSegments:v,depthSegments:_};const o=this;f=Math.floor(f),v=Math.floor(v),_=Math.floor(_);const M=[],C=[],D=[],F=[];let O=0,j=0;K("z","y","x",-1,-1,c,s,i,_,v,0),K("z","y","x",1,-1,c,s,-i,_,v,1),K("x","z","y",1,1,i,c,s,f,_,2),K("x","z","y",1,-1,i,c,-s,f,_,3),K("x","y","z",1,-1,i,s,c,f,v,4),K("x","y","z",-1,-1,i,s,-c,f,v,5),this.setIndex(M),this.setAttribute("position",new es(C,3)),this.setAttribute("normal",new es(D,3)),this.setAttribute("uv",new es(F,2));function K(J,N,W,ge,de,ve,Me,De,Ie,$e,re){const fe=ve/Ie,Oe=Me/$e,tt=ve/2,Qe=Me/2,pt=De/2,ct=Ie+1,nt=$e+1;let Je=0,ut=0;const xt=new We;for(let At=0;At<nt;At++){const Rt=At*Oe-Qe;for(let oi=0;oi<ct;oi++){const ti=oi*fe-tt;xt[J]=ti*ge,xt[N]=Rt*de,xt[W]=pt,C.push(xt.x,xt.y,xt.z),xt[J]=0,xt[N]=0,xt[W]=De>0?1:-1,D.push(xt.x,xt.y,xt.z),F.push(oi/Ie),F.push(1-At/$e),Je+=1}}for(let At=0;At<$e;At++)for(let Rt=0;Rt<Ie;Rt++){const oi=O+Rt+ct*At,ti=O+Rt+ct*(At+1),Ii=O+(Rt+1)+ct*(At+1),yi=O+(Rt+1)+ct*At;M.push(oi,ti,yi),M.push(ti,Ii,yi),ut+=6}o.addGroup(j,ut,re),j+=ut,O+=Je}}copy(i){return super.copy(i),this.parameters=Object.assign({},i.parameters),this}static fromJSON(i){return new ud(i.width,i.height,i.depth,i.widthSegments,i.heightSegments,i.depthSegments)}}function vu(m){const i={};for(const s in m){i[s]={};for(const c in m[s]){const f=m[s][c];f&&(f.isColor||f.isMatrix3||f.isMatrix4||f.isVector2||f.isVector3||f.isVector4||f.isTexture||f.isQuaternion)?f.isRenderTargetTexture?(ei("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),i[s][c]=null):i[s][c]=f.clone():Array.isArray(f)?i[s][c]=f.slice():i[s][c]=f}}return i}function Ur(m){const i={};for(let s=0;s<m.length;s++){const c=vu(m[s]);for(const f in c)i[f]=c[f]}return i}function wM(m){const i=[];for(let s=0;s<m.length;s++)i.push(m[s].clone());return i}function Ob(m){const i=m.getRenderTarget();return i===null?m.outputColorSpace:i.isXRRenderTarget===!0?i.texture.colorSpace:Ni.workingColorSpace}const TM={clone:vu,merge:Ur};var SM=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,MM=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class ya extends ma{constructor(i){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=SM,this.fragmentShader=MM,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,i!==void 0&&this.setValues(i)}copy(i){return super.copy(i),this.fragmentShader=i.fragmentShader,this.vertexShader=i.vertexShader,this.uniforms=vu(i.uniforms),this.uniformsGroups=wM(i.uniformsGroups),this.defines=Object.assign({},i.defines),this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.fog=i.fog,this.lights=i.lights,this.clipping=i.clipping,this.extensions=Object.assign({},i.extensions),this.glslVersion=i.glslVersion,this.defaultAttributeValues=Object.assign({},i.defaultAttributeValues),this.index0AttributeName=i.index0AttributeName,this.uniformsNeedUpdate=i.uniformsNeedUpdate,this}toJSON(i){const s=super.toJSON(i);s.glslVersion=this.glslVersion,s.uniforms={};for(const f in this.uniforms){const _=this.uniforms[f].value;_&&_.isTexture?s.uniforms[f]={type:"t",value:_.toJSON(i).uuid}:_&&_.isColor?s.uniforms[f]={type:"c",value:_.getHex()}:_&&_.isVector2?s.uniforms[f]={type:"v2",value:_.toArray()}:_&&_.isVector3?s.uniforms[f]={type:"v3",value:_.toArray()}:_&&_.isVector4?s.uniforms[f]={type:"v4",value:_.toArray()}:_&&_.isMatrix3?s.uniforms[f]={type:"m3",value:_.toArray()}:_&&_.isMatrix4?s.uniforms[f]={type:"m4",value:_.toArray()}:s.uniforms[f]={value:_}}Object.keys(this.defines).length>0&&(s.defines=this.defines),s.vertexShader=this.vertexShader,s.fragmentShader=this.fragmentShader,s.lights=this.lights,s.clipping=this.clipping;const c={};for(const f in this.extensions)this.extensions[f]===!0&&(c[f]=!0);return Object.keys(c).length>0&&(s.extensions=c),s}}class ty extends Dn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new gi,this.projectionMatrix=new gi,this.projectionMatrixInverse=new gi,this.coordinateSystem=da,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(i,s){return super.copy(i,s),this.matrixWorldInverse.copy(i.matrixWorldInverse),this.projectionMatrix.copy(i.projectionMatrix),this.projectionMatrixInverse.copy(i.projectionMatrixInverse),this.coordinateSystem=i.coordinateSystem,this}getWorldDirection(i){return super.getWorldDirection(i).negate()}updateMatrixWorld(i){super.updateMatrixWorld(i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(i,s){super.updateWorldMatrix(i,s),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Wo=new We,J0=new Bi,Q0=new Bi;class Jr extends ty{constructor(i=50,s=1,c=.1,f=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=i,this.zoom=1,this.near=c,this.far=f,this.focus=10,this.aspect=s,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(i,s){return super.copy(i,s),this.fov=i.fov,this.zoom=i.zoom,this.near=i.near,this.far=i.far,this.focus=i.focus,this.aspect=i.aspect,this.view=i.view===null?null:Object.assign({},i.view),this.filmGauge=i.filmGauge,this.filmOffset=i.filmOffset,this}setFocalLength(i){const s=.5*this.getFilmHeight()/i;this.fov=xu*2*Math.atan(s),this.updateProjectionMatrix()}getFocalLength(){const i=Math.tan(Qh*.5*this.fov);return .5*this.getFilmHeight()/i}getEffectiveFOV(){return xu*2*Math.atan(Math.tan(Qh*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(i,s,c){Wo.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),s.set(Wo.x,Wo.y).multiplyScalar(-i/Wo.z),Wo.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),c.set(Wo.x,Wo.y).multiplyScalar(-i/Wo.z)}getViewSize(i,s){return this.getViewBounds(i,J0,Q0),s.subVectors(Q0,J0)}setViewOffset(i,s,c,f,v,_){this.aspect=i/s,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=i,this.view.fullHeight=s,this.view.offsetX=c,this.view.offsetY=f,this.view.width=v,this.view.height=_,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const i=this.near;let s=i*Math.tan(Qh*.5*this.fov)/this.zoom,c=2*s,f=this.aspect*c,v=-.5*f;const _=this.view;if(this.view!==null&&this.view.enabled){const M=_.fullWidth,C=_.fullHeight;v+=_.offsetX*f/M,s-=_.offsetY*c/C,f*=_.width/M,c*=_.height/C}const o=this.filmOffset;o!==0&&(v+=i*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(v,v+f,s,s-c,i,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(i){const s=super.toJSON(i);return s.object.fov=this.fov,s.object.zoom=this.zoom,s.object.near=this.near,s.object.far=this.far,s.object.focus=this.focus,s.object.aspect=this.aspect,this.view!==null&&(s.object.view=Object.assign({},this.view)),s.object.filmGauge=this.filmGauge,s.object.filmOffset=this.filmOffset,s}}const au=-90,ou=1;class EM extends Dn{constructor(i,s,c){super(),this.type="CubeCamera",this.renderTarget=c,this.coordinateSystem=null,this.activeMipmapLevel=0;const f=new Jr(au,ou,i,s);f.layers=this.layers,this.add(f);const v=new Jr(au,ou,i,s);v.layers=this.layers,this.add(v);const _=new Jr(au,ou,i,s);_.layers=this.layers,this.add(_);const o=new Jr(au,ou,i,s);o.layers=this.layers,this.add(o);const M=new Jr(au,ou,i,s);M.layers=this.layers,this.add(M);const C=new Jr(au,ou,i,s);C.layers=this.layers,this.add(C)}updateCoordinateSystem(){const i=this.coordinateSystem,s=this.children.concat(),[c,f,v,_,o,M]=s;for(const C of s)this.remove(C);if(i===da)c.up.set(0,1,0),c.lookAt(1,0,0),f.up.set(0,1,0),f.lookAt(-1,0,0),v.up.set(0,0,-1),v.lookAt(0,1,0),_.up.set(0,0,1),_.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),M.up.set(0,1,0),M.lookAt(0,0,-1);else if(i===_p)c.up.set(0,-1,0),c.lookAt(-1,0,0),f.up.set(0,-1,0),f.lookAt(1,0,0),v.up.set(0,0,1),v.lookAt(0,1,0),_.up.set(0,0,-1),_.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),M.up.set(0,-1,0),M.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+i);for(const C of s)this.add(C),C.updateMatrixWorld()}update(i,s){this.parent===null&&this.updateMatrixWorld();const{renderTarget:c,activeMipmapLevel:f}=this;this.coordinateSystem!==i.coordinateSystem&&(this.coordinateSystem=i.coordinateSystem,this.updateCoordinateSystem());const[v,_,o,M,C,D]=this.children,F=i.getRenderTarget(),O=i.getActiveCubeFace(),j=i.getActiveMipmapLevel(),K=i.xr.enabled;i.xr.enabled=!1;const J=c.texture.generateMipmaps;c.texture.generateMipmaps=!1,i.setRenderTarget(c,0,f),i.render(s,v),i.setRenderTarget(c,1,f),i.render(s,_),i.setRenderTarget(c,2,f),i.render(s,o),i.setRenderTarget(c,3,f),i.render(s,M),i.setRenderTarget(c,4,f),i.render(s,C),c.texture.generateMipmaps=J,i.setRenderTarget(c,5,f),i.render(s,D),i.setRenderTarget(F,O,j),i.xr.enabled=K,c.texture.needsPMREMUpdate=!0}}class Nb extends pr{constructor(i=[],s=Zl,c,f,v,_,o,M,C,D){super(i,s,c,f,v,_,o,M,C,D),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(i){this.image=i}}class Bb extends pa{constructor(i=1,s={}){super(i,i,s),this.isWebGLCubeRenderTarget=!0;const c={width:i,height:i,depth:1},f=[c,c,c,c,c,c];this.texture=new Nb(f),this._setTextureOptions(s),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(i,s){this.texture.type=s.type,this.texture.colorSpace=s.colorSpace,this.texture.generateMipmaps=s.generateMipmaps,this.texture.minFilter=s.minFilter,this.texture.magFilter=s.magFilter;const c={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},f=new ud(5,5,5),v=new ya({name:"CubemapFromEquirect",uniforms:vu(c.uniforms),vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,side:Qr,blending:io});v.uniforms.tEquirect.value=s;const _=new Gr(f,v),o=s.minFilter;return s.minFilter===Qa&&(s.minFilter=nr),new EM(1,10,this).update(i,_),s.minFilter=o,_.geometry.dispose(),_.material.dispose(),this}clear(i,s=!0,c=!0,f=!0){const v=i.getRenderTarget();for(let _=0;_<6;_++)i.setRenderTarget(this,_),i.clear(s,c,f);i.setRenderTarget(v)}}class ql extends Dn{constructor(){super(),this.isGroup=!0,this.type="Group"}}const AM={type:"move"};class vg{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new ql,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new ql,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new We,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new We),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new ql,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new We,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new We),this._grip}dispatchEvent(i){return this._targetRay!==null&&this._targetRay.dispatchEvent(i),this._grip!==null&&this._grip.dispatchEvent(i),this._hand!==null&&this._hand.dispatchEvent(i),this}connect(i){if(i&&i.hand){const s=this._hand;if(s)for(const c of i.hand.values())this._getHandJoint(s,c)}return this.dispatchEvent({type:"connected",data:i}),this}disconnect(i){return this.dispatchEvent({type:"disconnected",data:i}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(i,s,c){let f=null,v=null,_=null;const o=this._targetRay,M=this._grip,C=this._hand;if(i&&s.session.visibilityState!=="visible-blurred"){if(C&&i.hand){_=!0;for(const J of i.hand.values()){const N=s.getJointPose(J,c),W=this._getHandJoint(C,J);N!==null&&(W.matrix.fromArray(N.transform.matrix),W.matrix.decompose(W.position,W.rotation,W.scale),W.matrixWorldNeedsUpdate=!0,W.jointRadius=N.radius),W.visible=N!==null}const D=C.joints["index-finger-tip"],F=C.joints["thumb-tip"],O=D.position.distanceTo(F.position),j=.02,K=.005;C.inputState.pinching&&O>j+K?(C.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:i.handedness,target:this})):!C.inputState.pinching&&O<=j-K&&(C.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:i.handedness,target:this}))}else M!==null&&i.gripSpace&&(v=s.getPose(i.gripSpace,c),v!==null&&(M.matrix.fromArray(v.transform.matrix),M.matrix.decompose(M.position,M.rotation,M.scale),M.matrixWorldNeedsUpdate=!0,v.linearVelocity?(M.hasLinearVelocity=!0,M.linearVelocity.copy(v.linearVelocity)):M.hasLinearVelocity=!1,v.angularVelocity?(M.hasAngularVelocity=!0,M.angularVelocity.copy(v.angularVelocity)):M.hasAngularVelocity=!1));o!==null&&(f=s.getPose(i.targetRaySpace,c),f===null&&v!==null&&(f=v),f!==null&&(o.matrix.fromArray(f.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,f.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(f.linearVelocity)):o.hasLinearVelocity=!1,f.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(f.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(AM)))}return o!==null&&(o.visible=f!==null),M!==null&&(M.visible=v!==null),C!==null&&(C.visible=_!==null),this}_getHandJoint(i,s){if(i.joints[s.jointName]===void 0){const c=new ql;c.matrixAutoUpdate=!1,c.visible=!1,i.joints[s.jointName]=c,i.add(c)}return i.joints[s.jointName]}}class CM extends Dn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new _a,this.environmentIntensity=1,this.environmentRotation=new _a,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(i,s){return super.copy(i,s),i.background!==null&&(this.background=i.background.clone()),i.environment!==null&&(this.environment=i.environment.clone()),i.fog!==null&&(this.fog=i.fog.clone()),this.backgroundBlurriness=i.backgroundBlurriness,this.backgroundIntensity=i.backgroundIntensity,this.backgroundRotation.copy(i.backgroundRotation),this.environmentIntensity=i.environmentIntensity,this.environmentRotation.copy(i.environmentRotation),i.overrideMaterial!==null&&(this.overrideMaterial=i.overrideMaterial.clone()),this.matrixAutoUpdate=i.matrixAutoUpdate,this}toJSON(i){const s=super.toJSON(i);return this.fog!==null&&(s.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(s.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(s.object.backgroundIntensity=this.backgroundIntensity),s.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(s.object.environmentIntensity=this.environmentIntensity),s.object.environmentRotation=this.environmentRotation.toArray(),s}}class PM{constructor(i,s){this.isInterleavedBuffer=!0,this.array=i,this.stride=s,this.count=i!==void 0?i.length/s:0,this.usage=I_,this.updateRanges=[],this.version=0,this.uuid=Ws()}onUploadCallback(){}set needsUpdate(i){i===!0&&this.version++}setUsage(i){return this.usage=i,this}addUpdateRange(i,s){this.updateRanges.push({start:i,count:s})}clearUpdateRanges(){this.updateRanges.length=0}copy(i){return this.array=new i.array.constructor(i.array),this.count=i.count,this.stride=i.stride,this.usage=i.usage,this}copyAt(i,s,c){i*=this.stride,c*=s.stride;for(let f=0,v=this.stride;f<v;f++)this.array[i+f]=s.array[c+f];return this}set(i,s=0){return this.array.set(i,s),this}clone(i){i.arrayBuffers===void 0&&(i.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ws()),i.arrayBuffers[this.array.buffer._uuid]===void 0&&(i.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const s=new this.array.constructor(i.arrayBuffers[this.array.buffer._uuid]),c=new this.constructor(s,this.stride);return c.setUsage(this.usage),c}onUpload(i){return this.onUploadCallback=i,this}toJSON(i){return i.arrayBuffers===void 0&&(i.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ws()),i.arrayBuffers[this.array.buffer._uuid]===void 0&&(i.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const kr=new We;class iy{constructor(i,s,c,f=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=i,this.itemSize=s,this.offset=c,this.normalized=f}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(i){this.data.needsUpdate=i}applyMatrix4(i){for(let s=0,c=this.data.count;s<c;s++)kr.fromBufferAttribute(this,s),kr.applyMatrix4(i),this.setXYZ(s,kr.x,kr.y,kr.z);return this}applyNormalMatrix(i){for(let s=0,c=this.count;s<c;s++)kr.fromBufferAttribute(this,s),kr.applyNormalMatrix(i),this.setXYZ(s,kr.x,kr.y,kr.z);return this}transformDirection(i){for(let s=0,c=this.count;s<c;s++)kr.fromBufferAttribute(this,s),kr.transformDirection(i),this.setXYZ(s,kr.x,kr.y,kr.z);return this}getComponent(i,s){let c=this.array[i*this.data.stride+this.offset+s];return this.normalized&&(c=Hs(c,this.array)),c}setComponent(i,s,c){return this.normalized&&(c=tn(c,this.array)),this.data.array[i*this.data.stride+this.offset+s]=c,this}setX(i,s){return this.normalized&&(s=tn(s,this.array)),this.data.array[i*this.data.stride+this.offset]=s,this}setY(i,s){return this.normalized&&(s=tn(s,this.array)),this.data.array[i*this.data.stride+this.offset+1]=s,this}setZ(i,s){return this.normalized&&(s=tn(s,this.array)),this.data.array[i*this.data.stride+this.offset+2]=s,this}setW(i,s){return this.normalized&&(s=tn(s,this.array)),this.data.array[i*this.data.stride+this.offset+3]=s,this}getX(i){let s=this.data.array[i*this.data.stride+this.offset];return this.normalized&&(s=Hs(s,this.array)),s}getY(i){let s=this.data.array[i*this.data.stride+this.offset+1];return this.normalized&&(s=Hs(s,this.array)),s}getZ(i){let s=this.data.array[i*this.data.stride+this.offset+2];return this.normalized&&(s=Hs(s,this.array)),s}getW(i){let s=this.data.array[i*this.data.stride+this.offset+3];return this.normalized&&(s=Hs(s,this.array)),s}setXY(i,s,c){return i=i*this.data.stride+this.offset,this.normalized&&(s=tn(s,this.array),c=tn(c,this.array)),this.data.array[i+0]=s,this.data.array[i+1]=c,this}setXYZ(i,s,c,f){return i=i*this.data.stride+this.offset,this.normalized&&(s=tn(s,this.array),c=tn(c,this.array),f=tn(f,this.array)),this.data.array[i+0]=s,this.data.array[i+1]=c,this.data.array[i+2]=f,this}setXYZW(i,s,c,f,v){return i=i*this.data.stride+this.offset,this.normalized&&(s=tn(s,this.array),c=tn(c,this.array),f=tn(f,this.array),v=tn(v,this.array)),this.data.array[i+0]=s,this.data.array[i+1]=c,this.data.array[i+2]=f,this.data.array[i+3]=v,this}clone(i){if(i===void 0){yp("InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const s=[];for(let c=0;c<this.count;c++){const f=c*this.data.stride+this.offset;for(let v=0;v<this.itemSize;v++)s.push(this.data.array[f+v])}return new mr(new this.array.constructor(s),this.itemSize,this.normalized)}else return i.interleavedBuffers===void 0&&(i.interleavedBuffers={}),i.interleavedBuffers[this.data.uuid]===void 0&&(i.interleavedBuffers[this.data.uuid]=this.data.clone(i)),new iy(i.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(i){if(i===void 0){yp("InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const s=[];for(let c=0;c<this.count;c++){const f=c*this.data.stride+this.offset;for(let v=0;v<this.itemSize;v++)s.push(this.data.array[f+v])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:s,normalized:this.normalized}}else return i.interleavedBuffers===void 0&&(i.interleavedBuffers={}),i.interleavedBuffers[this.data.uuid]===void 0&&(i.interleavedBuffers[this.data.uuid]=this.data.toJSON(i)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const ev=new We,tv=new wn,iv=new wn,IM=new We,nv=new gi,Kf=new We,bg=new xa,rv=new gi,wg=new Tp;class RM extends Gr{constructor(i,s){super(i,s),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=I0,this.bindMatrix=new gi,this.bindMatrixInverse=new gi,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const i=this.geometry;this.boundingBox===null&&(this.boundingBox=new oo),this.boundingBox.makeEmpty();const s=i.getAttribute("position");for(let c=0;c<s.count;c++)this.getVertexPosition(c,Kf),this.boundingBox.expandByPoint(Kf)}computeBoundingSphere(){const i=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new xa),this.boundingSphere.makeEmpty();const s=i.getAttribute("position");for(let c=0;c<s.count;c++)this.getVertexPosition(c,Kf),this.boundingSphere.expandByPoint(Kf)}copy(i,s){return super.copy(i,s),this.bindMode=i.bindMode,this.bindMatrix.copy(i.bindMatrix),this.bindMatrixInverse.copy(i.bindMatrixInverse),this.skeleton=i.skeleton,i.boundingBox!==null&&(this.boundingBox=i.boundingBox.clone()),i.boundingSphere!==null&&(this.boundingSphere=i.boundingSphere.clone()),this}raycast(i,s){const c=this.material,f=this.matrixWorld;c!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),bg.copy(this.boundingSphere),bg.applyMatrix4(f),i.ray.intersectsSphere(bg)!==!1&&(rv.copy(f).invert(),wg.copy(i.ray).applyMatrix4(rv),!(this.boundingBox!==null&&wg.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(i,s,wg)))}getVertexPosition(i,s){return super.getVertexPosition(i,s),this.applyBoneTransform(i,s),s}bind(i,s){this.skeleton=i,s===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),s=this.matrixWorld),this.bindMatrix.copy(s),this.bindMatrixInverse.copy(s).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const i=new wn,s=this.geometry.attributes.skinWeight;for(let c=0,f=s.count;c<f;c++){i.fromBufferAttribute(s,c);const v=1/i.manhattanLength();v!==1/0?i.multiplyScalar(v):i.set(1,0,0,0),s.setXYZW(c,i.x,i.y,i.z,i.w)}}updateMatrixWorld(i){super.updateMatrixWorld(i),this.bindMode===I0?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===CS?this.bindMatrixInverse.copy(this.bindMatrix).invert():ei("SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(i,s){const c=this.skeleton,f=this.geometry;tv.fromBufferAttribute(f.attributes.skinIndex,i),iv.fromBufferAttribute(f.attributes.skinWeight,i),ev.copy(s).applyMatrix4(this.bindMatrix),s.set(0,0,0);for(let v=0;v<4;v++){const _=iv.getComponent(v);if(_!==0){const o=tv.getComponent(v);nv.multiplyMatrices(c.bones[o].matrixWorld,c.boneInverses[o]),s.addScaledVector(IM.copy(ev).applyMatrix4(nv),_)}}return s.applyMatrix4(this.bindMatrixInverse)}}class kb extends Dn{constructor(){super(),this.isBone=!0,this.type="Bone"}}class ny extends pr{constructor(i=null,s=1,c=1,f,v,_,o,M,C=ir,D=ir,F,O){super(null,_,o,M,C,D,f,v,F,O),this.isDataTexture=!0,this.image={data:i,width:s,height:c},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const sv=new gi,DM=new gi;class ry{constructor(i=[],s=[]){this.uuid=Ws(),this.bones=i.slice(0),this.boneInverses=s,this.boneMatrices=null,this.previousBoneMatrices=null,this.boneTexture=null,this.init()}init(){const i=this.bones,s=this.boneInverses;if(this.boneMatrices=new Float32Array(i.length*16),s.length===0)this.calculateInverses();else if(i.length!==s.length){ei("Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let c=0,f=this.bones.length;c<f;c++)this.boneInverses.push(new gi)}}calculateInverses(){this.boneInverses.length=0;for(let i=0,s=this.bones.length;i<s;i++){const c=new gi;this.bones[i]&&c.copy(this.bones[i].matrixWorld).invert(),this.boneInverses.push(c)}}pose(){for(let i=0,s=this.bones.length;i<s;i++){const c=this.bones[i];c&&c.matrixWorld.copy(this.boneInverses[i]).invert()}for(let i=0,s=this.bones.length;i<s;i++){const c=this.bones[i];c&&(c.parent&&c.parent.isBone?(c.matrix.copy(c.parent.matrixWorld).invert(),c.matrix.multiply(c.matrixWorld)):c.matrix.copy(c.matrixWorld),c.matrix.decompose(c.position,c.quaternion,c.scale))}}update(){const i=this.bones,s=this.boneInverses,c=this.boneMatrices,f=this.boneTexture;for(let v=0,_=i.length;v<_;v++){const o=i[v]?i[v].matrixWorld:DM;sv.multiplyMatrices(o,s[v]),sv.toArray(c,v*16)}f!==null&&(f.needsUpdate=!0)}clone(){return new ry(this.bones,this.boneInverses)}computeBoneTexture(){let i=Math.sqrt(this.bones.length*4);i=Math.ceil(i/4)*4,i=Math.max(i,4);const s=new Float32Array(i*i*4);s.set(this.boneMatrices);const c=new ny(s,i,i,Ps,Cs);return c.needsUpdate=!0,this.boneMatrices=s,this.boneTexture=c,this}getBoneByName(i){for(let s=0,c=this.bones.length;s<c;s++){const f=this.bones[s];if(f.name===i)return f}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(i,s){this.uuid=i.uuid;for(let c=0,f=i.bones.length;c<f;c++){const v=i.bones[c];let _=s[v];_===void 0&&(ei("Skeleton: No bone found with UUID:",v),_=new kb),this.bones.push(_),this.boneInverses.push(new gi().fromArray(i.boneInverses[c]))}return this.init(),this}toJSON(){const i={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};i.uuid=this.uuid;const s=this.bones,c=this.boneInverses;for(let f=0,v=s.length;f<v;f++){const _=s[f];i.bones.push(_.uuid);const o=c[f];i.boneInverses.push(o.toArray())}return i}}class R_ extends mr{constructor(i,s,c,f=1){super(i,s,c),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=f}copy(i){return super.copy(i),this.meshPerAttribute=i.meshPerAttribute,this}toJSON(){const i=super.toJSON();return i.meshPerAttribute=this.meshPerAttribute,i.isInstancedBufferAttribute=!0,i}}const lu=new gi,av=new gi,Jf=[],ov=new oo,LM=new gi,Hh=new Gr,jh=new xa;class FM extends Gr{constructor(i,s,c){super(i,s),this.isInstancedMesh=!0,this.instanceMatrix=new R_(new Float32Array(c*16),16),this.instanceColor=null,this.morphTexture=null,this.count=c,this.boundingBox=null,this.boundingSphere=null;for(let f=0;f<c;f++)this.setMatrixAt(f,LM)}computeBoundingBox(){const i=this.geometry,s=this.count;this.boundingBox===null&&(this.boundingBox=new oo),i.boundingBox===null&&i.computeBoundingBox(),this.boundingBox.makeEmpty();for(let c=0;c<s;c++)this.getMatrixAt(c,lu),ov.copy(i.boundingBox).applyMatrix4(lu),this.boundingBox.union(ov)}computeBoundingSphere(){const i=this.geometry,s=this.count;this.boundingSphere===null&&(this.boundingSphere=new xa),i.boundingSphere===null&&i.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let c=0;c<s;c++)this.getMatrixAt(c,lu),jh.copy(i.boundingSphere).applyMatrix4(lu),this.boundingSphere.union(jh)}copy(i,s){return super.copy(i,s),this.instanceMatrix.copy(i.instanceMatrix),i.morphTexture!==null&&(this.morphTexture=i.morphTexture.clone()),i.instanceColor!==null&&(this.instanceColor=i.instanceColor.clone()),this.count=i.count,i.boundingBox!==null&&(this.boundingBox=i.boundingBox.clone()),i.boundingSphere!==null&&(this.boundingSphere=i.boundingSphere.clone()),this}getColorAt(i,s){s.fromArray(this.instanceColor.array,i*3)}getMatrixAt(i,s){s.fromArray(this.instanceMatrix.array,i*16)}getMorphAt(i,s){const c=s.morphTargetInfluences,f=this.morphTexture.source.data.data,v=c.length+1,_=i*v+1;for(let o=0;o<c.length;o++)c[o]=f[_+o]}raycast(i,s){const c=this.matrixWorld,f=this.count;if(Hh.geometry=this.geometry,Hh.material=this.material,Hh.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),jh.copy(this.boundingSphere),jh.applyMatrix4(c),i.ray.intersectsSphere(jh)!==!1))for(let v=0;v<f;v++){this.getMatrixAt(v,lu),av.multiplyMatrices(c,lu),Hh.matrixWorld=av,Hh.raycast(i,Jf);for(let _=0,o=Jf.length;_<o;_++){const M=Jf[_];M.instanceId=v,M.object=this,s.push(M)}Jf.length=0}}setColorAt(i,s){this.instanceColor===null&&(this.instanceColor=new R_(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),s.toArray(this.instanceColor.array,i*3)}setMatrixAt(i,s){s.toArray(this.instanceMatrix.array,i*16)}setMorphAt(i,s){const c=s.morphTargetInfluences,f=c.length+1;this.morphTexture===null&&(this.morphTexture=new ny(new Float32Array(f*this.count),f,this.count,X_,Cs));const v=this.morphTexture.source.data.data;let _=0;for(let C=0;C<c.length;C++)_+=c[C];const o=this.geometry.morphTargetsRelative?1:1-_,M=f*i;v[M]=o,v.set(c,M+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const Tg=new We,zM=new We,OM=new wi;class Gl{constructor(i=new We(1,0,0),s=0){this.isPlane=!0,this.normal=i,this.constant=s}set(i,s){return this.normal.copy(i),this.constant=s,this}setComponents(i,s,c,f){return this.normal.set(i,s,c),this.constant=f,this}setFromNormalAndCoplanarPoint(i,s){return this.normal.copy(i),this.constant=-s.dot(this.normal),this}setFromCoplanarPoints(i,s,c){const f=Tg.subVectors(c,s).cross(zM.subVectors(i,s)).normalize();return this.setFromNormalAndCoplanarPoint(f,i),this}copy(i){return this.normal.copy(i.normal),this.constant=i.constant,this}normalize(){const i=1/this.normal.length();return this.normal.multiplyScalar(i),this.constant*=i,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(i){return this.normal.dot(i)+this.constant}distanceToSphere(i){return this.distanceToPoint(i.center)-i.radius}projectPoint(i,s){return s.copy(i).addScaledVector(this.normal,-this.distanceToPoint(i))}intersectLine(i,s){const c=i.delta(Tg),f=this.normal.dot(c);if(f===0)return this.distanceToPoint(i.start)===0?s.copy(i.start):null;const v=-(i.start.dot(this.normal)+this.constant)/f;return v<0||v>1?null:s.copy(i.start).addScaledVector(c,v)}intersectsLine(i){const s=this.distanceToPoint(i.start),c=this.distanceToPoint(i.end);return s<0&&c>0||c<0&&s>0}intersectsBox(i){return i.intersectsPlane(this)}intersectsSphere(i){return i.intersectsPlane(this)}coplanarPoint(i){return i.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(i,s){const c=s||OM.getNormalMatrix(i),f=this.coplanarPoint(Tg).applyMatrix4(i),v=this.normal.applyMatrix3(c).normalize();return this.constant=-f.dot(v),this}translate(i){return this.constant-=i.dot(this.normal),this}equals(i){return i.normal.equals(this.normal)&&i.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Bl=new xa,NM=new Bi(.5,.5),Qf=new We;class sy{constructor(i=new Gl,s=new Gl,c=new Gl,f=new Gl,v=new Gl,_=new Gl){this.planes=[i,s,c,f,v,_]}set(i,s,c,f,v,_){const o=this.planes;return o[0].copy(i),o[1].copy(s),o[2].copy(c),o[3].copy(f),o[4].copy(v),o[5].copy(_),this}copy(i){const s=this.planes;for(let c=0;c<6;c++)s[c].copy(i.planes[c]);return this}setFromProjectionMatrix(i,s=da,c=!1){const f=this.planes,v=i.elements,_=v[0],o=v[1],M=v[2],C=v[3],D=v[4],F=v[5],O=v[6],j=v[7],K=v[8],J=v[9],N=v[10],W=v[11],ge=v[12],de=v[13],ve=v[14],Me=v[15];if(f[0].setComponents(C-_,j-D,W-K,Me-ge).normalize(),f[1].setComponents(C+_,j+D,W+K,Me+ge).normalize(),f[2].setComponents(C+o,j+F,W+J,Me+de).normalize(),f[3].setComponents(C-o,j-F,W-J,Me-de).normalize(),c)f[4].setComponents(M,O,N,ve).normalize(),f[5].setComponents(C-M,j-O,W-N,Me-ve).normalize();else if(f[4].setComponents(C-M,j-O,W-N,Me-ve).normalize(),s===da)f[5].setComponents(C+M,j+O,W+N,Me+ve).normalize();else if(s===_p)f[5].setComponents(M,O,N,ve).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+s);return this}intersectsObject(i){if(i.boundingSphere!==void 0)i.boundingSphere===null&&i.computeBoundingSphere(),Bl.copy(i.boundingSphere).applyMatrix4(i.matrixWorld);else{const s=i.geometry;s.boundingSphere===null&&s.computeBoundingSphere(),Bl.copy(s.boundingSphere).applyMatrix4(i.matrixWorld)}return this.intersectsSphere(Bl)}intersectsSprite(i){Bl.center.set(0,0,0);const s=NM.distanceTo(i.center);return Bl.radius=.7071067811865476+s,Bl.applyMatrix4(i.matrixWorld),this.intersectsSphere(Bl)}intersectsSphere(i){const s=this.planes,c=i.center,f=-i.radius;for(let v=0;v<6;v++)if(s[v].distanceToPoint(c)<f)return!1;return!0}intersectsBox(i){const s=this.planes;for(let c=0;c<6;c++){const f=s[c];if(Qf.x=f.normal.x>0?i.max.x:i.min.x,Qf.y=f.normal.y>0?i.max.y:i.min.y,Qf.z=f.normal.z>0?i.max.z:i.min.z,f.distanceToPoint(Qf)<0)return!1}return!0}containsPoint(i){const s=this.planes;for(let c=0;c<6;c++)if(s[c].distanceToPoint(i)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class Ub extends ma{constructor(i){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new bi(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(i)}copy(i){return super.copy(i),this.color.copy(i.color),this.map=i.map,this.linewidth=i.linewidth,this.linecap=i.linecap,this.linejoin=i.linejoin,this.fog=i.fog,this}}const xp=new We,vp=new We,lv=new gi,Wh=new Tp,ep=new xa,Sg=new We,cv=new We;class ay extends Dn{constructor(i=new ts,s=new Ub){super(),this.isLine=!0,this.type="Line",this.geometry=i,this.material=s,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(i,s){return super.copy(i,s),this.material=Array.isArray(i.material)?i.material.slice():i.material,this.geometry=i.geometry,this}computeLineDistances(){const i=this.geometry;if(i.index===null){const s=i.attributes.position,c=[0];for(let f=1,v=s.count;f<v;f++)xp.fromBufferAttribute(s,f-1),vp.fromBufferAttribute(s,f),c[f]=c[f-1],c[f]+=xp.distanceTo(vp);i.setAttribute("lineDistance",new es(c,1))}else ei("Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(i,s){const c=this.geometry,f=this.matrixWorld,v=i.params.Line.threshold,_=c.drawRange;if(c.boundingSphere===null&&c.computeBoundingSphere(),ep.copy(c.boundingSphere),ep.applyMatrix4(f),ep.radius+=v,i.ray.intersectsSphere(ep)===!1)return;lv.copy(f).invert(),Wh.copy(i.ray).applyMatrix4(lv);const o=v/((this.scale.x+this.scale.y+this.scale.z)/3),M=o*o,C=this.isLineSegments?2:1,D=c.index,O=c.attributes.position;if(D!==null){const j=Math.max(0,_.start),K=Math.min(D.count,_.start+_.count);for(let J=j,N=K-1;J<N;J+=C){const W=D.getX(J),ge=D.getX(J+1),de=tp(this,i,Wh,M,W,ge,J);de&&s.push(de)}if(this.isLineLoop){const J=D.getX(K-1),N=D.getX(j),W=tp(this,i,Wh,M,J,N,K-1);W&&s.push(W)}}else{const j=Math.max(0,_.start),K=Math.min(O.count,_.start+_.count);for(let J=j,N=K-1;J<N;J+=C){const W=tp(this,i,Wh,M,J,J+1,J);W&&s.push(W)}if(this.isLineLoop){const J=tp(this,i,Wh,M,K-1,j,K-1);J&&s.push(J)}}}updateMorphTargets(){const s=this.geometry.morphAttributes,c=Object.keys(s);if(c.length>0){const f=s[c[0]];if(f!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let v=0,_=f.length;v<_;v++){const o=f[v].name||String(v);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=v}}}}}function tp(m,i,s,c,f,v,_){const o=m.geometry.attributes.position;if(xp.fromBufferAttribute(o,f),vp.fromBufferAttribute(o,v),s.distanceSqToSegment(xp,vp,Sg,cv)>c)return;Sg.applyMatrix4(m.matrixWorld);const C=i.ray.origin.distanceTo(Sg);if(!(C<i.near||C>i.far))return{distance:C,point:cv.clone().applyMatrix4(m.matrixWorld),index:_,face:null,faceIndex:null,barycoord:null,object:m}}const uv=new We,hv=new We;class BM extends ay{constructor(i,s){super(i,s),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const i=this.geometry;if(i.index===null){const s=i.attributes.position,c=[];for(let f=0,v=s.count;f<v;f+=2)uv.fromBufferAttribute(s,f),hv.fromBufferAttribute(s,f+1),c[f]=f===0?0:c[f-1],c[f+1]=c[f]+uv.distanceTo(hv);i.setAttribute("lineDistance",new es(c,1))}else ei("LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class kM extends ay{constructor(i,s){super(i,s),this.isLineLoop=!0,this.type="LineLoop"}}class Vb extends ma{constructor(i){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new bi(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(i)}copy(i){return super.copy(i),this.color.copy(i.color),this.map=i.map,this.alphaMap=i.alphaMap,this.size=i.size,this.sizeAttenuation=i.sizeAttenuation,this.fog=i.fog,this}}const dv=new gi,D_=new Tp,ip=new xa,np=new We;class UM extends Dn{constructor(i=new ts,s=new Vb){super(),this.isPoints=!0,this.type="Points",this.geometry=i,this.material=s,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(i,s){return super.copy(i,s),this.material=Array.isArray(i.material)?i.material.slice():i.material,this.geometry=i.geometry,this}raycast(i,s){const c=this.geometry,f=this.matrixWorld,v=i.params.Points.threshold,_=c.drawRange;if(c.boundingSphere===null&&c.computeBoundingSphere(),ip.copy(c.boundingSphere),ip.applyMatrix4(f),ip.radius+=v,i.ray.intersectsSphere(ip)===!1)return;dv.copy(f).invert(),D_.copy(i.ray).applyMatrix4(dv);const o=v/((this.scale.x+this.scale.y+this.scale.z)/3),M=o*o,C=c.index,F=c.attributes.position;if(C!==null){const O=Math.max(0,_.start),j=Math.min(C.count,_.start+_.count);for(let K=O,J=j;K<J;K++){const N=C.getX(K);np.fromBufferAttribute(F,N),fv(np,N,M,f,i,s,this)}}else{const O=Math.max(0,_.start),j=Math.min(F.count,_.start+_.count);for(let K=O,J=j;K<J;K++)np.fromBufferAttribute(F,K),fv(np,K,M,f,i,s,this)}}updateMorphTargets(){const s=this.geometry.morphAttributes,c=Object.keys(s);if(c.length>0){const f=s[c[0]];if(f!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let v=0,_=f.length;v<_;v++){const o=f[v].name||String(v);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=v}}}}}function fv(m,i,s,c,f,v,_){const o=D_.distanceSqToPoint(m);if(o<s){const M=new We;D_.closestPointToPoint(m,M),M.applyMatrix4(c);const C=f.ray.origin.distanceTo(M);if(C<f.near||C>f.far)return;v.push({distance:C,distanceToRay:Math.sqrt(o),point:M,index:i,face:null,faceIndex:null,barycoord:null,object:_})}}class ld extends pr{constructor(i,s,c=ga,f,v,_,o=ir,M=ir,C,D=ao,F=1){if(D!==ao&&D!==Wl)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const O={width:i,height:s,depth:F};super(O,f,v,_,o,M,D,c,C),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(i){return super.copy(i),this.source=new ey(Object.assign({},i.image)),this.compareFunction=i.compareFunction,this}toJSON(i){const s=super.toJSON(i);return this.compareFunction!==null&&(s.compareFunction=this.compareFunction),s}}class VM extends ld{constructor(i,s=ga,c=Zl,f,v,_=ir,o=ir,M,C=ao){const D={width:i,height:i,depth:1},F=[D,D,D,D,D,D];super(i,i,s,c,f,v,_,o,M,C),this.image=F,this.isCubeDepthTexture=!0,this.isCubeTexture=!0}get images(){return this.image}set images(i){this.image=i}}class Gb extends pr{constructor(i=null){super(),this.sourceTexture=i,this.isExternalTexture=!0}copy(i){return super.copy(i),this.sourceTexture=i.sourceTexture,this}}class oy extends ts{constructor(i=1,s=32,c=0,f=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:i,segments:s,thetaStart:c,thetaLength:f},s=Math.max(3,s);const v=[],_=[],o=[],M=[],C=new We,D=new Bi;_.push(0,0,0),o.push(0,0,1),M.push(.5,.5);for(let F=0,O=3;F<=s;F++,O+=3){const j=c+F/s*f;C.x=i*Math.cos(j),C.y=i*Math.sin(j),_.push(C.x,C.y,C.z),o.push(0,0,1),D.x=(_[O]/i+1)/2,D.y=(_[O+1]/i+1)/2,M.push(D.x,D.y)}for(let F=1;F<=s;F++)v.push(F,F+1,0);this.setIndex(v),this.setAttribute("position",new es(_,3)),this.setAttribute("normal",new es(o,3)),this.setAttribute("uv",new es(M,2))}copy(i){return super.copy(i),this.parameters=Object.assign({},i.parameters),this}static fromJSON(i){return new oy(i.radius,i.segments,i.thetaStart,i.thetaLength)}}class Sp extends ts{constructor(i=1,s=1,c=1,f=1){super(),this.type="PlaneGeometry",this.parameters={width:i,height:s,widthSegments:c,heightSegments:f};const v=i/2,_=s/2,o=Math.floor(c),M=Math.floor(f),C=o+1,D=M+1,F=i/o,O=s/M,j=[],K=[],J=[],N=[];for(let W=0;W<D;W++){const ge=W*O-_;for(let de=0;de<C;de++){const ve=de*F-v;K.push(ve,-ge,0),J.push(0,0,1),N.push(de/o),N.push(1-W/M)}}for(let W=0;W<M;W++)for(let ge=0;ge<o;ge++){const de=ge+C*W,ve=ge+C*(W+1),Me=ge+1+C*(W+1),De=ge+1+C*W;j.push(de,ve,De),j.push(ve,Me,De)}this.setIndex(j),this.setAttribute("position",new es(K,3)),this.setAttribute("normal",new es(J,3)),this.setAttribute("uv",new es(N,2))}copy(i){return super.copy(i),this.parameters=Object.assign({},i.parameters),this}static fromJSON(i){return new Sp(i.width,i.height,i.widthSegments,i.heightSegments)}}class GM extends ya{constructor(i){super(i),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class ly extends ma{constructor(i){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new bi(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new bi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Pb,this.normalScale=new Bi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new _a,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(i)}copy(i){return super.copy(i),this.defines={STANDARD:""},this.color.copy(i.color),this.roughness=i.roughness,this.metalness=i.metalness,this.map=i.map,this.lightMap=i.lightMap,this.lightMapIntensity=i.lightMapIntensity,this.aoMap=i.aoMap,this.aoMapIntensity=i.aoMapIntensity,this.emissive.copy(i.emissive),this.emissiveMap=i.emissiveMap,this.emissiveIntensity=i.emissiveIntensity,this.bumpMap=i.bumpMap,this.bumpScale=i.bumpScale,this.normalMap=i.normalMap,this.normalMapType=i.normalMapType,this.normalScale.copy(i.normalScale),this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.roughnessMap=i.roughnessMap,this.metalnessMap=i.metalnessMap,this.alphaMap=i.alphaMap,this.envMap=i.envMap,this.envMapRotation.copy(i.envMapRotation),this.envMapIntensity=i.envMapIntensity,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.wireframeLinecap=i.wireframeLinecap,this.wireframeLinejoin=i.wireframeLinejoin,this.flatShading=i.flatShading,this.fog=i.fog,this}}class va extends ly{constructor(i){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Bi(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Li(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(s){this.ior=(1+.4*s)/(1-.4*s)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new bi(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new bi(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new bi(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(i)}get anisotropy(){return this._anisotropy}set anisotropy(i){this._anisotropy>0!=i>0&&this.version++,this._anisotropy=i}get clearcoat(){return this._clearcoat}set clearcoat(i){this._clearcoat>0!=i>0&&this.version++,this._clearcoat=i}get iridescence(){return this._iridescence}set iridescence(i){this._iridescence>0!=i>0&&this.version++,this._iridescence=i}get dispersion(){return this._dispersion}set dispersion(i){this._dispersion>0!=i>0&&this.version++,this._dispersion=i}get sheen(){return this._sheen}set sheen(i){this._sheen>0!=i>0&&this.version++,this._sheen=i}get transmission(){return this._transmission}set transmission(i){this._transmission>0!=i>0&&this.version++,this._transmission=i}copy(i){return super.copy(i),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=i.anisotropy,this.anisotropyRotation=i.anisotropyRotation,this.anisotropyMap=i.anisotropyMap,this.clearcoat=i.clearcoat,this.clearcoatMap=i.clearcoatMap,this.clearcoatRoughness=i.clearcoatRoughness,this.clearcoatRoughnessMap=i.clearcoatRoughnessMap,this.clearcoatNormalMap=i.clearcoatNormalMap,this.clearcoatNormalScale.copy(i.clearcoatNormalScale),this.dispersion=i.dispersion,this.ior=i.ior,this.iridescence=i.iridescence,this.iridescenceMap=i.iridescenceMap,this.iridescenceIOR=i.iridescenceIOR,this.iridescenceThicknessRange=[...i.iridescenceThicknessRange],this.iridescenceThicknessMap=i.iridescenceThicknessMap,this.sheen=i.sheen,this.sheenColor.copy(i.sheenColor),this.sheenColorMap=i.sheenColorMap,this.sheenRoughness=i.sheenRoughness,this.sheenRoughnessMap=i.sheenRoughnessMap,this.transmission=i.transmission,this.transmissionMap=i.transmissionMap,this.thickness=i.thickness,this.thicknessMap=i.thicknessMap,this.attenuationDistance=i.attenuationDistance,this.attenuationColor.copy(i.attenuationColor),this.specularIntensity=i.specularIntensity,this.specularIntensityMap=i.specularIntensityMap,this.specularColor.copy(i.specularColor),this.specularColorMap=i.specularColorMap,this}}class HM extends ma{constructor(i){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=RS,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(i)}copy(i){return super.copy(i),this.depthPacking=i.depthPacking,this.map=i.map,this.alphaMap=i.alphaMap,this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this}}class jM extends ma{constructor(i){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(i)}copy(i){return super.copy(i),this.map=i.map,this.alphaMap=i.alphaMap,this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this}}function rp(m,i){return!m||m.constructor===i?m:typeof i.BYTES_PER_ELEMENT=="number"?new i(m):Array.prototype.slice.call(m)}function WM(m){function i(f,v){return m[f]-m[v]}const s=m.length,c=new Array(s);for(let f=0;f!==s;++f)c[f]=f;return c.sort(i),c}function pv(m,i,s){const c=m.length,f=new m.constructor(c);for(let v=0,_=0;_!==c;++v){const o=s[v]*i;for(let M=0;M!==i;++M)f[_++]=m[o+M]}return f}function Hb(m,i,s,c){let f=1,v=m[0];for(;v!==void 0&&v[c]===void 0;)v=m[f++];if(v===void 0)return;let _=v[c];if(_!==void 0)if(Array.isArray(_))do _=v[c],_!==void 0&&(i.push(v.time),s.push(..._)),v=m[f++];while(v!==void 0);else if(_.toArray!==void 0)do _=v[c],_!==void 0&&(i.push(v.time),_.toArray(s,s.length)),v=m[f++];while(v!==void 0);else do _=v[c],_!==void 0&&(i.push(v.time),s.push(_)),v=m[f++];while(v!==void 0)}class hd{constructor(i,s,c,f){this.parameterPositions=i,this._cachedIndex=0,this.resultBuffer=f!==void 0?f:new s.constructor(c),this.sampleValues=s,this.valueSize=c,this.settings=null,this.DefaultSettings_={}}evaluate(i){const s=this.parameterPositions;let c=this._cachedIndex,f=s[c],v=s[c-1];i:{e:{let _;t:{n:if(!(i<f)){for(let o=c+2;;){if(f===void 0){if(i<v)break n;return c=s.length,this._cachedIndex=c,this.copySampleValue_(c-1)}if(c===o)break;if(v=f,f=s[++c],i<f)break e}_=s.length;break t}if(!(i>=v)){const o=s[1];i<o&&(c=2,v=o);for(let M=c-2;;){if(v===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(c===M)break;if(f=v,v=s[--c-1],i>=v)break e}_=c,c=0;break t}break i}for(;c<_;){const o=c+_>>>1;i<s[o]?_=o:c=o+1}if(f=s[c],v=s[c-1],v===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(f===void 0)return c=s.length,this._cachedIndex=c,this.copySampleValue_(c-1)}this._cachedIndex=c,this.intervalChanged_(c,v,f)}return this.interpolate_(c,v,i,f)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(i){const s=this.resultBuffer,c=this.sampleValues,f=this.valueSize,v=i*f;for(let _=0;_!==f;++_)s[_]=c[v+_];return s}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class qM extends hd{constructor(i,s,c,f){super(i,s,c,f),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:R0,endingEnd:R0}}intervalChanged_(i,s,c){const f=this.parameterPositions;let v=i-2,_=i+1,o=f[v],M=f[_];if(o===void 0)switch(this.getSettings_().endingStart){case D0:v=i,o=2*s-c;break;case L0:v=f.length-2,o=s+f[v]-f[v+1];break;default:v=i,o=c}if(M===void 0)switch(this.getSettings_().endingEnd){case D0:_=i,M=2*c-s;break;case L0:_=1,M=c+f[1]-f[0];break;default:_=i-1,M=s}const C=(c-s)*.5,D=this.valueSize;this._weightPrev=C/(s-o),this._weightNext=C/(M-c),this._offsetPrev=v*D,this._offsetNext=_*D}interpolate_(i,s,c,f){const v=this.resultBuffer,_=this.sampleValues,o=this.valueSize,M=i*o,C=M-o,D=this._offsetPrev,F=this._offsetNext,O=this._weightPrev,j=this._weightNext,K=(c-s)/(f-s),J=K*K,N=J*K,W=-O*N+2*O*J-O*K,ge=(1+O)*N+(-1.5-2*O)*J+(-.5+O)*K+1,de=(-1-j)*N+(1.5+j)*J+.5*K,ve=j*N-j*J;for(let Me=0;Me!==o;++Me)v[Me]=W*_[D+Me]+ge*_[C+Me]+de*_[M+Me]+ve*_[F+Me];return v}}class XM extends hd{constructor(i,s,c,f){super(i,s,c,f)}interpolate_(i,s,c,f){const v=this.resultBuffer,_=this.sampleValues,o=this.valueSize,M=i*o,C=M-o,D=(c-s)/(f-s),F=1-D;for(let O=0;O!==o;++O)v[O]=_[C+O]*F+_[M+O]*D;return v}}class ZM extends hd{constructor(i,s,c,f){super(i,s,c,f)}interpolate_(i){return this.copySampleValue_(i-1)}}class qs{constructor(i,s,c,f){if(i===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(s===void 0||s.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+i);this.name=i,this.times=rp(s,this.TimeBufferType),this.values=rp(c,this.ValueBufferType),this.setInterpolation(f||this.DefaultInterpolation)}static toJSON(i){const s=i.constructor;let c;if(s.toJSON!==this.toJSON)c=s.toJSON(i);else{c={name:i.name,times:rp(i.times,Array),values:rp(i.values,Array)};const f=i.getInterpolation();f!==i.DefaultInterpolation&&(c.interpolation=f)}return c.type=i.ValueTypeName,c}InterpolantFactoryMethodDiscrete(i){return new ZM(this.times,this.values,this.getValueSize(),i)}InterpolantFactoryMethodLinear(i){return new XM(this.times,this.values,this.getValueSize(),i)}InterpolantFactoryMethodSmooth(i){return new qM(this.times,this.values,this.getValueSize(),i)}setInterpolation(i){let s;switch(i){case rd:s=this.InterpolantFactoryMethodDiscrete;break;case sd:s=this.InterpolantFactoryMethodLinear;break;case Qm:s=this.InterpolantFactoryMethodSmooth;break}if(s===void 0){const c="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(i!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(c);return ei("KeyframeTrack:",c),this}return this.createInterpolant=s,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return rd;case this.InterpolantFactoryMethodLinear:return sd;case this.InterpolantFactoryMethodSmooth:return Qm}}getValueSize(){return this.values.length/this.times.length}shift(i){if(i!==0){const s=this.times;for(let c=0,f=s.length;c!==f;++c)s[c]+=i}return this}scale(i){if(i!==1){const s=this.times;for(let c=0,f=s.length;c!==f;++c)s[c]*=i}return this}trim(i,s){const c=this.times,f=c.length;let v=0,_=f-1;for(;v!==f&&c[v]<i;)++v;for(;_!==-1&&c[_]>s;)--_;if(++_,v!==0||_!==f){v>=_&&(_=Math.max(_,1),v=_-1);const o=this.getValueSize();this.times=c.slice(v,_),this.values=this.values.slice(v*o,_*o)}return this}validate(){let i=!0;const s=this.getValueSize();s-Math.floor(s)!==0&&(hi("KeyframeTrack: Invalid value size in track.",this),i=!1);const c=this.times,f=this.values,v=c.length;v===0&&(hi("KeyframeTrack: Track is empty.",this),i=!1);let _=null;for(let o=0;o!==v;o++){const M=c[o];if(typeof M=="number"&&isNaN(M)){hi("KeyframeTrack: Time is not a valid number.",this,o,M),i=!1;break}if(_!==null&&_>M){hi("KeyframeTrack: Out of order keys.",this,o,M,_),i=!1;break}_=M}if(f!==void 0&&kS(f))for(let o=0,M=f.length;o!==M;++o){const C=f[o];if(isNaN(C)){hi("KeyframeTrack: Value is not a valid number.",this,o,C),i=!1;break}}return i}optimize(){const i=this.times.slice(),s=this.values.slice(),c=this.getValueSize(),f=this.getInterpolation()===Qm,v=i.length-1;let _=1;for(let o=1;o<v;++o){let M=!1;const C=i[o],D=i[o+1];if(C!==D&&(o!==1||C!==i[0]))if(f)M=!0;else{const F=o*c,O=F-c,j=F+c;for(let K=0;K!==c;++K){const J=s[F+K];if(J!==s[O+K]||J!==s[j+K]){M=!0;break}}}if(M){if(o!==_){i[_]=i[o];const F=o*c,O=_*c;for(let j=0;j!==c;++j)s[O+j]=s[F+j]}++_}}if(v>0){i[_]=i[v];for(let o=v*c,M=_*c,C=0;C!==c;++C)s[M+C]=s[o+C];++_}return _!==i.length?(this.times=i.slice(0,_),this.values=s.slice(0,_*c)):(this.times=i,this.values=s),this}clone(){const i=this.times.slice(),s=this.values.slice(),c=this.constructor,f=new c(this.name,i,s);return f.createInterpolant=this.createInterpolant,f}}qs.prototype.ValueTypeName="";qs.prototype.TimeBufferType=Float32Array;qs.prototype.ValueBufferType=Float32Array;qs.prototype.DefaultInterpolation=sd;class Mu extends qs{constructor(i,s,c){super(i,s,c)}}Mu.prototype.ValueTypeName="bool";Mu.prototype.ValueBufferType=Array;Mu.prototype.DefaultInterpolation=rd;Mu.prototype.InterpolantFactoryMethodLinear=void 0;Mu.prototype.InterpolantFactoryMethodSmooth=void 0;class jb extends qs{constructor(i,s,c,f){super(i,s,c,f)}}jb.prototype.ValueTypeName="color";class bu extends qs{constructor(i,s,c,f){super(i,s,c,f)}}bu.prototype.ValueTypeName="number";class $M extends hd{constructor(i,s,c,f){super(i,s,c,f)}interpolate_(i,s,c,f){const v=this.resultBuffer,_=this.sampleValues,o=this.valueSize,M=(c-s)/(f-s);let C=i*o;for(let D=C+o;C!==D;C+=4)$o.slerpFlat(v,0,_,C-o,_,C,M);return v}}class wu extends qs{constructor(i,s,c,f){super(i,s,c,f)}InterpolantFactoryMethodLinear(i){return new $M(this.times,this.values,this.getValueSize(),i)}}wu.prototype.ValueTypeName="quaternion";wu.prototype.InterpolantFactoryMethodSmooth=void 0;class Eu extends qs{constructor(i,s,c){super(i,s,c)}}Eu.prototype.ValueTypeName="string";Eu.prototype.ValueBufferType=Array;Eu.prototype.DefaultInterpolation=rd;Eu.prototype.InterpolantFactoryMethodLinear=void 0;Eu.prototype.InterpolantFactoryMethodSmooth=void 0;class Tu extends qs{constructor(i,s,c,f){super(i,s,c,f)}}Tu.prototype.ValueTypeName="vector";class YM{constructor(i="",s=-1,c=[],f=PS){this.name=i,this.tracks=c,this.duration=s,this.blendMode=f,this.uuid=Ws(),this.userData={},this.duration<0&&this.resetDuration()}static parse(i){const s=[],c=i.tracks,f=1/(i.fps||1);for(let _=0,o=c.length;_!==o;++_)s.push(JM(c[_]).scale(f));const v=new this(i.name,i.duration,s,i.blendMode);return v.uuid=i.uuid,v.userData=JSON.parse(i.userData||"{}"),v}static toJSON(i){const s=[],c=i.tracks,f={name:i.name,duration:i.duration,tracks:s,uuid:i.uuid,blendMode:i.blendMode,userData:JSON.stringify(i.userData)};for(let v=0,_=c.length;v!==_;++v)s.push(qs.toJSON(c[v]));return f}static CreateFromMorphTargetSequence(i,s,c,f){const v=s.length,_=[];for(let o=0;o<v;o++){let M=[],C=[];M.push((o+v-1)%v,o,(o+1)%v),C.push(0,1,0);const D=WM(M);M=pv(M,1,D),C=pv(C,1,D),!f&&M[0]===0&&(M.push(v),C.push(C[0])),_.push(new bu(".morphTargetInfluences["+s[o].name+"]",M,C).scale(1/c))}return new this(i,-1,_)}static findByName(i,s){let c=i;if(!Array.isArray(i)){const f=i;c=f.geometry&&f.geometry.animations||f.animations}for(let f=0;f<c.length;f++)if(c[f].name===s)return c[f];return null}static CreateClipsFromMorphTargetSequences(i,s,c){const f={},v=/^([\w-]*?)([\d]+)$/;for(let o=0,M=i.length;o<M;o++){const C=i[o],D=C.name.match(v);if(D&&D.length>1){const F=D[1];let O=f[F];O||(f[F]=O=[]),O.push(C)}}const _=[];for(const o in f)_.push(this.CreateFromMorphTargetSequence(o,f[o],s,c));return _}static parseAnimation(i,s){if(ei("AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!i)return hi("AnimationClip: No animation in JSONLoader data."),null;const c=function(F,O,j,K,J){if(j.length!==0){const N=[],W=[];Hb(j,N,W,K),N.length!==0&&J.push(new F(O,N,W))}},f=[],v=i.name||"default",_=i.fps||30,o=i.blendMode;let M=i.length||-1;const C=i.hierarchy||[];for(let F=0;F<C.length;F++){const O=C[F].keys;if(!(!O||O.length===0))if(O[0].morphTargets){const j={};let K;for(K=0;K<O.length;K++)if(O[K].morphTargets)for(let J=0;J<O[K].morphTargets.length;J++)j[O[K].morphTargets[J]]=-1;for(const J in j){const N=[],W=[];for(let ge=0;ge!==O[K].morphTargets.length;++ge){const de=O[K];N.push(de.time),W.push(de.morphTarget===J?1:0)}f.push(new bu(".morphTargetInfluence["+J+"]",N,W))}M=j.length*_}else{const j=".bones["+s[F].name+"]";c(Tu,j+".position",O,"pos",f),c(wu,j+".quaternion",O,"rot",f),c(Tu,j+".scale",O,"scl",f)}}return f.length===0?null:new this(v,M,f,o)}resetDuration(){const i=this.tracks;let s=0;for(let c=0,f=i.length;c!==f;++c){const v=this.tracks[c];s=Math.max(s,v.times[v.times.length-1])}return this.duration=s,this}trim(){for(let i=0;i<this.tracks.length;i++)this.tracks[i].trim(0,this.duration);return this}validate(){let i=!0;for(let s=0;s<this.tracks.length;s++)i=i&&this.tracks[s].validate();return i}optimize(){for(let i=0;i<this.tracks.length;i++)this.tracks[i].optimize();return this}clone(){const i=[];for(let c=0;c<this.tracks.length;c++)i.push(this.tracks[c].clone());const s=new this.constructor(this.name,this.duration,i,this.blendMode);return s.userData=JSON.parse(JSON.stringify(this.userData)),s}toJSON(){return this.constructor.toJSON(this)}}function KM(m){switch(m.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return bu;case"vector":case"vector2":case"vector3":case"vector4":return Tu;case"color":return jb;case"quaternion":return wu;case"bool":case"boolean":return Mu;case"string":return Eu}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+m)}function JM(m){if(m.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const i=KM(m.type);if(m.times===void 0){const s=[],c=[];Hb(m.keys,s,c,"value"),m.times=s,m.values=c}return i.parse!==void 0?i.parse(m):new i(m.name,m.times,m.values,m.interpolation)}const to={enabled:!1,files:{},add:function(m,i){this.enabled!==!1&&(this.files[m]=i)},get:function(m){if(this.enabled!==!1)return this.files[m]},remove:function(m){delete this.files[m]},clear:function(){this.files={}}};class QM{constructor(i,s,c){const f=this;let v=!1,_=0,o=0,M;const C=[];this.onStart=void 0,this.onLoad=i,this.onProgress=s,this.onError=c,this._abortController=null,this.itemStart=function(D){o++,v===!1&&f.onStart!==void 0&&f.onStart(D,_,o),v=!0},this.itemEnd=function(D){_++,f.onProgress!==void 0&&f.onProgress(D,_,o),_===o&&(v=!1,f.onLoad!==void 0&&f.onLoad())},this.itemError=function(D){f.onError!==void 0&&f.onError(D)},this.resolveURL=function(D){return M?M(D):D},this.setURLModifier=function(D){return M=D,this},this.addHandler=function(D,F){return C.push(D,F),this},this.removeHandler=function(D){const F=C.indexOf(D);return F!==-1&&C.splice(F,2),this},this.getHandler=function(D){for(let F=0,O=C.length;F<O;F+=2){const j=C[F],K=C[F+1];if(j.global&&(j.lastIndex=0),j.test(D))return K}return null},this.abort=function(){return this.abortController.abort(),this._abortController=null,this}}get abortController(){return this._abortController||(this._abortController=new AbortController),this._abortController}}const eE=new QM;class Au{constructor(i){this.manager=i!==void 0?i:eE,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(i,s){const c=this;return new Promise(function(f,v){c.load(i,f,s,v)})}parse(){}setCrossOrigin(i){return this.crossOrigin=i,this}setWithCredentials(i){return this.withCredentials=i,this}setPath(i){return this.path=i,this}setResourcePath(i){return this.resourcePath=i,this}setRequestHeader(i){return this.requestHeader=i,this}abort(){return this}}Au.DEFAULT_MATERIAL_NAME="__DEFAULT";const Ja={};class tE extends Error{constructor(i,s){super(i),this.response=s}}class Wb extends Au{constructor(i){super(i),this.mimeType="",this.responseType="",this._abortController=new AbortController}load(i,s,c,f){i===void 0&&(i=""),this.path!==void 0&&(i=this.path+i),i=this.manager.resolveURL(i);const v=to.get(`file:${i}`);if(v!==void 0)return this.manager.itemStart(i),setTimeout(()=>{s&&s(v),this.manager.itemEnd(i)},0),v;if(Ja[i]!==void 0){Ja[i].push({onLoad:s,onProgress:c,onError:f});return}Ja[i]=[],Ja[i].push({onLoad:s,onProgress:c,onError:f});const _=new Request(i,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin",signal:typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal}),o=this.mimeType,M=this.responseType;fetch(_).then(C=>{if(C.status===200||C.status===0){if(C.status===0&&ei("FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||C.body===void 0||C.body.getReader===void 0)return C;const D=Ja[i],F=C.body.getReader(),O=C.headers.get("X-File-Size")||C.headers.get("Content-Length"),j=O?parseInt(O):0,K=j!==0;let J=0;const N=new ReadableStream({start(W){ge();function ge(){F.read().then(({done:de,value:ve})=>{if(de)W.close();else{J+=ve.byteLength;const Me=new ProgressEvent("progress",{lengthComputable:K,loaded:J,total:j});for(let De=0,Ie=D.length;De<Ie;De++){const $e=D[De];$e.onProgress&&$e.onProgress(Me)}W.enqueue(ve),ge()}},de=>{W.error(de)})}}});return new Response(N)}else throw new tE(`fetch for "${C.url}" responded with ${C.status}: ${C.statusText}`,C)}).then(C=>{switch(M){case"arraybuffer":return C.arrayBuffer();case"blob":return C.blob();case"document":return C.text().then(D=>new DOMParser().parseFromString(D,o));case"json":return C.json();default:if(o==="")return C.text();{const F=/charset="?([^;"\s]*)"?/i.exec(o),O=F&&F[1]?F[1].toLowerCase():void 0,j=new TextDecoder(O);return C.arrayBuffer().then(K=>j.decode(K))}}}).then(C=>{to.add(`file:${i}`,C);const D=Ja[i];delete Ja[i];for(let F=0,O=D.length;F<O;F++){const j=D[F];j.onLoad&&j.onLoad(C)}}).catch(C=>{const D=Ja[i];if(D===void 0)throw this.manager.itemError(i),C;delete Ja[i];for(let F=0,O=D.length;F<O;F++){const j=D[F];j.onError&&j.onError(C)}this.manager.itemError(i)}).finally(()=>{this.manager.itemEnd(i)}),this.manager.itemStart(i)}setResponseType(i){return this.responseType=i,this}setMimeType(i){return this.mimeType=i,this}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}const cu=new WeakMap;class iE extends Au{constructor(i){super(i)}load(i,s,c,f){this.path!==void 0&&(i=this.path+i),i=this.manager.resolveURL(i);const v=this,_=to.get(`image:${i}`);if(_!==void 0){if(_.complete===!0)v.manager.itemStart(i),setTimeout(function(){s&&s(_),v.manager.itemEnd(i)},0);else{let F=cu.get(_);F===void 0&&(F=[],cu.set(_,F)),F.push({onLoad:s,onError:f})}return _}const o=ad("img");function M(){D(),s&&s(this);const F=cu.get(this)||[];for(let O=0;O<F.length;O++){const j=F[O];j.onLoad&&j.onLoad(this)}cu.delete(this),v.manager.itemEnd(i)}function C(F){D(),f&&f(F),to.remove(`image:${i}`);const O=cu.get(this)||[];for(let j=0;j<O.length;j++){const K=O[j];K.onError&&K.onError(F)}cu.delete(this),v.manager.itemError(i),v.manager.itemEnd(i)}function D(){o.removeEventListener("load",M,!1),o.removeEventListener("error",C,!1)}return o.addEventListener("load",M,!1),o.addEventListener("error",C,!1),i.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),to.add(`image:${i}`,o),v.manager.itemStart(i),o.src=i,o}}class qb extends Au{constructor(i){super(i)}load(i,s,c,f){const v=new pr,_=new iE(this.manager);return _.setCrossOrigin(this.crossOrigin),_.setPath(this.path),_.load(i,function(o){v.image=o,v.needsUpdate=!0,s!==void 0&&s(v)},c,f),v}}class cy extends Dn{constructor(i,s=1){super(),this.isLight=!0,this.type="Light",this.color=new bi(i),this.intensity=s}dispose(){this.dispatchEvent({type:"dispose"})}copy(i,s){return super.copy(i,s),this.color.copy(i.color),this.intensity=i.intensity,this}toJSON(i){const s=super.toJSON(i);return s.object.color=this.color.getHex(),s.object.intensity=this.intensity,s}}const Mg=new gi,mv=new We,gv=new We;class uy{constructor(i){this.camera=i,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Bi(512,512),this.mapType=gs,this.map=null,this.mapPass=null,this.matrix=new gi,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new sy,this._frameExtents=new Bi(1,1),this._viewportCount=1,this._viewports=[new wn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(i){const s=this.camera,c=this.matrix;mv.setFromMatrixPosition(i.matrixWorld),s.position.copy(mv),gv.setFromMatrixPosition(i.target.matrixWorld),s.lookAt(gv),s.updateMatrixWorld(),Mg.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Mg,s.coordinateSystem,s.reversedDepth),s.reversedDepth?c.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):c.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),c.multiply(Mg)}getViewport(i){return this._viewports[i]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(i){return this.camera=i.camera.clone(),this.intensity=i.intensity,this.bias=i.bias,this.radius=i.radius,this.autoUpdate=i.autoUpdate,this.needsUpdate=i.needsUpdate,this.normalBias=i.normalBias,this.blurSamples=i.blurSamples,this.mapSize.copy(i.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const i={};return this.intensity!==1&&(i.intensity=this.intensity),this.bias!==0&&(i.bias=this.bias),this.normalBias!==0&&(i.normalBias=this.normalBias),this.radius!==1&&(i.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(i.mapSize=this.mapSize.toArray()),i.camera=this.camera.toJSON(!1).object,delete i.camera.matrix,i}}class nE extends uy{constructor(){super(new Jr(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(i){const s=this.camera,c=xu*2*i.angle*this.focus,f=this.mapSize.width/this.mapSize.height*this.aspect,v=i.distance||s.far;(c!==s.fov||f!==s.aspect||v!==s.far)&&(s.fov=c,s.aspect=f,s.far=v,s.updateProjectionMatrix()),super.updateMatrices(i)}copy(i){return super.copy(i),this.focus=i.focus,this}}class rE extends cy{constructor(i,s,c=0,f=Math.PI/3,v=0,_=2){super(i,s),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Dn.DEFAULT_UP),this.updateMatrix(),this.target=new Dn,this.distance=c,this.angle=f,this.penumbra=v,this.decay=_,this.map=null,this.shadow=new nE}get power(){return this.intensity*Math.PI}set power(i){this.intensity=i/Math.PI}dispose(){super.dispose(),this.shadow.dispose()}copy(i,s){return super.copy(i,s),this.distance=i.distance,this.angle=i.angle,this.penumbra=i.penumbra,this.decay=i.decay,this.target=i.target.clone(),this.map=i.map,this.shadow=i.shadow.clone(),this}toJSON(i){const s=super.toJSON(i);return s.object.distance=this.distance,s.object.angle=this.angle,s.object.decay=this.decay,s.object.penumbra=this.penumbra,s.object.target=this.target.uuid,this.map&&this.map.isTexture&&(s.object.map=this.map.toJSON(i).uuid),s.object.shadow=this.shadow.toJSON(),s}}class sE extends uy{constructor(){super(new Jr(90,1,.5,500)),this.isPointLightShadow=!0}}class aE extends cy{constructor(i,s,c=0,f=2){super(i,s),this.isPointLight=!0,this.type="PointLight",this.distance=c,this.decay=f,this.shadow=new sE}get power(){return this.intensity*4*Math.PI}set power(i){this.intensity=i/(4*Math.PI)}dispose(){super.dispose(),this.shadow.dispose()}copy(i,s){return super.copy(i,s),this.distance=i.distance,this.decay=i.decay,this.shadow=i.shadow.clone(),this}toJSON(i){const s=super.toJSON(i);return s.object.distance=this.distance,s.object.decay=this.decay,s.object.shadow=this.shadow.toJSON(),s}}class Mp extends ty{constructor(i=-1,s=1,c=1,f=-1,v=.1,_=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=i,this.right=s,this.top=c,this.bottom=f,this.near=v,this.far=_,this.updateProjectionMatrix()}copy(i,s){return super.copy(i,s),this.left=i.left,this.right=i.right,this.top=i.top,this.bottom=i.bottom,this.near=i.near,this.far=i.far,this.zoom=i.zoom,this.view=i.view===null?null:Object.assign({},i.view),this}setViewOffset(i,s,c,f,v,_){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=i,this.view.fullHeight=s,this.view.offsetX=c,this.view.offsetY=f,this.view.width=v,this.view.height=_,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const i=(this.right-this.left)/(2*this.zoom),s=(this.top-this.bottom)/(2*this.zoom),c=(this.right+this.left)/2,f=(this.top+this.bottom)/2;let v=c-i,_=c+i,o=f+s,M=f-s;if(this.view!==null&&this.view.enabled){const C=(this.right-this.left)/this.view.fullWidth/this.zoom,D=(this.top-this.bottom)/this.view.fullHeight/this.zoom;v+=C*this.view.offsetX,_=v+C*this.view.width,o-=D*this.view.offsetY,M=o-D*this.view.height}this.projectionMatrix.makeOrthographic(v,_,o,M,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(i){const s=super.toJSON(i);return s.object.zoom=this.zoom,s.object.left=this.left,s.object.right=this.right,s.object.top=this.top,s.object.bottom=this.bottom,s.object.near=this.near,s.object.far=this.far,this.view!==null&&(s.object.view=Object.assign({},this.view)),s}}class oE extends uy{constructor(){super(new Mp(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class L_ extends cy{constructor(i,s){super(i,s),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Dn.DEFAULT_UP),this.updateMatrix(),this.target=new Dn,this.shadow=new oE}dispose(){super.dispose(),this.shadow.dispose()}copy(i){return super.copy(i),this.target=i.target.clone(),this.shadow=i.shadow.clone(),this}toJSON(i){const s=super.toJSON(i);return s.object.shadow=this.shadow.toJSON(),s.object.target=this.target.uuid,s}}class td{static extractUrlBase(i){const s=i.lastIndexOf("/");return s===-1?"./":i.slice(0,s+1)}static resolveURL(i,s){return typeof i!="string"||i===""?"":(/^https?:\/\//i.test(s)&&/^\//.test(i)&&(s=s.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(i)||/^data:.*,.*$/i.test(i)||/^blob:.*$/i.test(i)?i:s+i)}}const Eg=new WeakMap;class lE extends Au{constructor(i){super(i),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&ei("ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&ei("ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"},this._abortController=new AbortController}setOptions(i){return this.options=i,this}load(i,s,c,f){i===void 0&&(i=""),this.path!==void 0&&(i=this.path+i),i=this.manager.resolveURL(i);const v=this,_=to.get(`image-bitmap:${i}`);if(_!==void 0){if(v.manager.itemStart(i),_.then){_.then(C=>{if(Eg.has(_)===!0)f&&f(Eg.get(_)),v.manager.itemError(i),v.manager.itemEnd(i);else return s&&s(C),v.manager.itemEnd(i),C});return}return setTimeout(function(){s&&s(_),v.manager.itemEnd(i)},0),_}const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader,o.signal=typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal;const M=fetch(i,o).then(function(C){return C.blob()}).then(function(C){return createImageBitmap(C,Object.assign(v.options,{colorSpaceConversion:"none"}))}).then(function(C){return to.add(`image-bitmap:${i}`,C),s&&s(C),v.manager.itemEnd(i),C}).catch(function(C){f&&f(C),Eg.set(M,C),to.remove(`image-bitmap:${i}`),v.manager.itemError(i),v.manager.itemEnd(i)});to.add(`image-bitmap:${i}`,M),v.manager.itemStart(i)}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}class cE extends Jr{constructor(i=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=i}}const hy="\\[\\]\\.:\\/",uE=new RegExp("["+hy+"]","g"),dy="[^"+hy+"]",hE="[^"+hy.replace("\\.","")+"]",dE=/((?:WC+[\/:])*)/.source.replace("WC",dy),fE=/(WCOD+)?/.source.replace("WCOD",hE),pE=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",dy),mE=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",dy),gE=new RegExp("^"+dE+fE+pE+mE+"$"),_E=["material","materials","bones","map"];class yE{constructor(i,s,c){const f=c||nn.parseTrackName(s);this._targetGroup=i,this._bindings=i.subscribe_(s,f)}getValue(i,s){this.bind();const c=this._targetGroup.nCachedObjects_,f=this._bindings[c];f!==void 0&&f.getValue(i,s)}setValue(i,s){const c=this._bindings;for(let f=this._targetGroup.nCachedObjects_,v=c.length;f!==v;++f)c[f].setValue(i,s)}bind(){const i=this._bindings;for(let s=this._targetGroup.nCachedObjects_,c=i.length;s!==c;++s)i[s].bind()}unbind(){const i=this._bindings;for(let s=this._targetGroup.nCachedObjects_,c=i.length;s!==c;++s)i[s].unbind()}}class nn{constructor(i,s,c){this.path=s,this.parsedPath=c||nn.parseTrackName(s),this.node=nn.findNode(i,this.parsedPath.nodeName),this.rootNode=i,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(i,s,c){return i&&i.isAnimationObjectGroup?new nn.Composite(i,s,c):new nn(i,s,c)}static sanitizeNodeName(i){return i.replace(/\s/g,"_").replace(uE,"")}static parseTrackName(i){const s=gE.exec(i);if(s===null)throw new Error("PropertyBinding: Cannot parse trackName: "+i);const c={nodeName:s[2],objectName:s[3],objectIndex:s[4],propertyName:s[5],propertyIndex:s[6]},f=c.nodeName&&c.nodeName.lastIndexOf(".");if(f!==void 0&&f!==-1){const v=c.nodeName.substring(f+1);_E.indexOf(v)!==-1&&(c.nodeName=c.nodeName.substring(0,f),c.objectName=v)}if(c.propertyName===null||c.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+i);return c}static findNode(i,s){if(s===void 0||s===""||s==="."||s===-1||s===i.name||s===i.uuid)return i;if(i.skeleton){const c=i.skeleton.getBoneByName(s);if(c!==void 0)return c}if(i.children){const c=function(v){for(let _=0;_<v.length;_++){const o=v[_];if(o.name===s||o.uuid===s)return o;const M=c(o.children);if(M)return M}return null},f=c(i.children);if(f)return f}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(i,s){i[s]=this.targetObject[this.propertyName]}_getValue_array(i,s){const c=this.resolvedProperty;for(let f=0,v=c.length;f!==v;++f)i[s++]=c[f]}_getValue_arrayElement(i,s){i[s]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(i,s){this.resolvedProperty.toArray(i,s)}_setValue_direct(i,s){this.targetObject[this.propertyName]=i[s]}_setValue_direct_setNeedsUpdate(i,s){this.targetObject[this.propertyName]=i[s],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(i,s){this.targetObject[this.propertyName]=i[s],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(i,s){const c=this.resolvedProperty;for(let f=0,v=c.length;f!==v;++f)c[f]=i[s++]}_setValue_array_setNeedsUpdate(i,s){const c=this.resolvedProperty;for(let f=0,v=c.length;f!==v;++f)c[f]=i[s++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(i,s){const c=this.resolvedProperty;for(let f=0,v=c.length;f!==v;++f)c[f]=i[s++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(i,s){this.resolvedProperty[this.propertyIndex]=i[s]}_setValue_arrayElement_setNeedsUpdate(i,s){this.resolvedProperty[this.propertyIndex]=i[s],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(i,s){this.resolvedProperty[this.propertyIndex]=i[s],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(i,s){this.resolvedProperty.fromArray(i,s)}_setValue_fromArray_setNeedsUpdate(i,s){this.resolvedProperty.fromArray(i,s),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(i,s){this.resolvedProperty.fromArray(i,s),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(i,s){this.bind(),this.getValue(i,s)}_setValue_unbound(i,s){this.bind(),this.setValue(i,s)}bind(){let i=this.node;const s=this.parsedPath,c=s.objectName,f=s.propertyName;let v=s.propertyIndex;if(i||(i=nn.findNode(this.rootNode,s.nodeName),this.node=i),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!i){ei("PropertyBinding: No target node found for track: "+this.path+".");return}if(c){let C=s.objectIndex;switch(c){case"materials":if(!i.material){hi("PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!i.material.materials){hi("PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}i=i.material.materials;break;case"bones":if(!i.skeleton){hi("PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}i=i.skeleton.bones;for(let D=0;D<i.length;D++)if(i[D].name===C){C=D;break}break;case"map":if("map"in i){i=i.map;break}if(!i.material){hi("PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!i.material.map){hi("PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}i=i.material.map;break;default:if(i[c]===void 0){hi("PropertyBinding: Can not bind to objectName of node undefined.",this);return}i=i[c]}if(C!==void 0){if(i[C]===void 0){hi("PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,i);return}i=i[C]}}const _=i[f];if(_===void 0){const C=s.nodeName;hi("PropertyBinding: Trying to update property for track: "+C+"."+f+" but it wasn't found.",i);return}let o=this.Versioning.None;this.targetObject=i,i.isMaterial===!0?o=this.Versioning.NeedsUpdate:i.isObject3D===!0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let M=this.BindingType.Direct;if(v!==void 0){if(f==="morphTargetInfluences"){if(!i.geometry){hi("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!i.geometry.morphAttributes){hi("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}i.morphTargetDictionary[v]!==void 0&&(v=i.morphTargetDictionary[v])}M=this.BindingType.ArrayElement,this.resolvedProperty=_,this.propertyIndex=v}else _.fromArray!==void 0&&_.toArray!==void 0?(M=this.BindingType.HasFromToArray,this.resolvedProperty=_):Array.isArray(_)?(M=this.BindingType.EntireArray,this.resolvedProperty=_):this.propertyName=f;this.getValue=this.GetterByBindingType[M],this.setValue=this.SetterByBindingTypeAndVersioning[M][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}nn.Composite=yE;nn.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};nn.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};nn.prototype.GetterByBindingType=[nn.prototype._getValue_direct,nn.prototype._getValue_array,nn.prototype._getValue_arrayElement,nn.prototype._getValue_toArray];nn.prototype.SetterByBindingTypeAndVersioning=[[nn.prototype._setValue_direct,nn.prototype._setValue_direct_setNeedsUpdate,nn.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[nn.prototype._setValue_array,nn.prototype._setValue_array_setNeedsUpdate,nn.prototype._setValue_array_setMatrixWorldNeedsUpdate],[nn.prototype._setValue_arrayElement,nn.prototype._setValue_arrayElement_setNeedsUpdate,nn.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[nn.prototype._setValue_fromArray,nn.prototype._setValue_fromArray_setNeedsUpdate,nn.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];function _v(m,i,s,c){const f=xE(c);switch(s){case Eb:return m*i;case X_:return m*i/f.components*f.byteLength;case Z_:return m*i/f.components*f.byteLength;case yu:return m*i*2/f.components*f.byteLength;case $_:return m*i*2/f.components*f.byteLength;case Ab:return m*i*3/f.components*f.byteLength;case Ps:return m*i*4/f.components*f.byteLength;case Y_:return m*i*4/f.components*f.byteLength;case up:case hp:return Math.floor((m+3)/4)*Math.floor((i+3)/4)*8;case dp:case fp:return Math.floor((m+3)/4)*Math.floor((i+3)/4)*16;case Jg:case e_:return Math.max(m,16)*Math.max(i,8)/4;case Kg:case Qg:return Math.max(m,8)*Math.max(i,8)/2;case t_:case i_:case r_:case s_:return Math.floor((m+3)/4)*Math.floor((i+3)/4)*8;case n_:case a_:case o_:return Math.floor((m+3)/4)*Math.floor((i+3)/4)*16;case l_:return Math.floor((m+3)/4)*Math.floor((i+3)/4)*16;case c_:return Math.floor((m+4)/5)*Math.floor((i+3)/4)*16;case u_:return Math.floor((m+4)/5)*Math.floor((i+4)/5)*16;case h_:return Math.floor((m+5)/6)*Math.floor((i+4)/5)*16;case d_:return Math.floor((m+5)/6)*Math.floor((i+5)/6)*16;case f_:return Math.floor((m+7)/8)*Math.floor((i+4)/5)*16;case p_:return Math.floor((m+7)/8)*Math.floor((i+5)/6)*16;case m_:return Math.floor((m+7)/8)*Math.floor((i+7)/8)*16;case g_:return Math.floor((m+9)/10)*Math.floor((i+4)/5)*16;case __:return Math.floor((m+9)/10)*Math.floor((i+5)/6)*16;case y_:return Math.floor((m+9)/10)*Math.floor((i+7)/8)*16;case x_:return Math.floor((m+9)/10)*Math.floor((i+9)/10)*16;case v_:return Math.floor((m+11)/12)*Math.floor((i+9)/10)*16;case b_:return Math.floor((m+11)/12)*Math.floor((i+11)/12)*16;case w_:case T_:case S_:return Math.ceil(m/4)*Math.ceil(i/4)*16;case M_:case E_:return Math.ceil(m/4)*Math.ceil(i/4)*8;case A_:case C_:return Math.ceil(m/4)*Math.ceil(i/4)*16}throw new Error(`Unable to determine texture byte length for ${s} format.`)}function xE(m){switch(m){case gs:case wb:return{byteLength:1,components:1};case id:case Tb:case so:return{byteLength:2,components:1};case W_:case q_:return{byteLength:2,components:4};case ga:case j_:case Cs:return{byteLength:4,components:1};case Sb:case Mb:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${m}.`)}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:H_}}));typeof window<"u"&&(window.__THREE__?ei("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=H_);function Xb(){let m=null,i=!1,s=null,c=null;function f(v,_){s(v,_),c=m.requestAnimationFrame(f)}return{start:function(){i!==!0&&s!==null&&(c=m.requestAnimationFrame(f),i=!0)},stop:function(){m.cancelAnimationFrame(c),i=!1},setAnimationLoop:function(v){s=v},setContext:function(v){m=v}}}function vE(m){const i=new WeakMap;function s(o,M){const C=o.array,D=o.usage,F=C.byteLength,O=m.createBuffer();m.bindBuffer(M,O),m.bufferData(M,C,D),o.onUploadCallback();let j;if(C instanceof Float32Array)j=m.FLOAT;else if(typeof Float16Array<"u"&&C instanceof Float16Array)j=m.HALF_FLOAT;else if(C instanceof Uint16Array)o.isFloat16BufferAttribute?j=m.HALF_FLOAT:j=m.UNSIGNED_SHORT;else if(C instanceof Int16Array)j=m.SHORT;else if(C instanceof Uint32Array)j=m.UNSIGNED_INT;else if(C instanceof Int32Array)j=m.INT;else if(C instanceof Int8Array)j=m.BYTE;else if(C instanceof Uint8Array)j=m.UNSIGNED_BYTE;else if(C instanceof Uint8ClampedArray)j=m.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+C);return{buffer:O,type:j,bytesPerElement:C.BYTES_PER_ELEMENT,version:o.version,size:F}}function c(o,M,C){const D=M.array,F=M.updateRanges;if(m.bindBuffer(C,o),F.length===0)m.bufferSubData(C,0,D);else{F.sort((j,K)=>j.start-K.start);let O=0;for(let j=1;j<F.length;j++){const K=F[O],J=F[j];J.start<=K.start+K.count+1?K.count=Math.max(K.count,J.start+J.count-K.start):(++O,F[O]=J)}F.length=O+1;for(let j=0,K=F.length;j<K;j++){const J=F[j];m.bufferSubData(C,J.start*D.BYTES_PER_ELEMENT,D,J.start,J.count)}M.clearUpdateRanges()}M.onUploadCallback()}function f(o){return o.isInterleavedBufferAttribute&&(o=o.data),i.get(o)}function v(o){o.isInterleavedBufferAttribute&&(o=o.data);const M=i.get(o);M&&(m.deleteBuffer(M.buffer),i.delete(o))}function _(o,M){if(o.isInterleavedBufferAttribute&&(o=o.data),o.isGLBufferAttribute){const D=i.get(o);(!D||D.version<o.version)&&i.set(o,{buffer:o.buffer,type:o.type,bytesPerElement:o.elementSize,version:o.version});return}const C=i.get(o);if(C===void 0)i.set(o,s(o,M));else if(C.version<o.version){if(C.size!==o.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");c(C.buffer,o,M),C.version=o.version}}return{get:f,remove:v,update:_}}var bE=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,wE=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,TE=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,SE=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,ME=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,EE=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,AE=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,CE=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,PE=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,IE=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,RE=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,DE=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,LE=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,FE=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,zE=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,OE=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,NE=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,BE=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,kE=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,UE=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,VE=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,GE=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,HE=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,jE=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,WE=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,qE=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,XE=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,ZE=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,$E=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,YE=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,KE="gl_FragColor = linearToOutputTexel( gl_FragColor );",JE=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,QE=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,eA=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,tA=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,iA=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,nA=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,rA=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,sA=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,aA=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,oA=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,lA=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,cA=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,uA=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,hA=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,dA=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,fA=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, pow4( roughness ) ) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,pA=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,mA=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,gA=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,_A=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,yA=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.diffuseContribution = diffuseColor.rgb * ( 1.0 - metalnessFactor );
material.metalness = metalnessFactor;
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor;
	material.specularColorBlended = mix( material.specularColor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = vec3( 0.04 );
	material.specularColorBlended = mix( material.specularColor, diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.0001, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,xA=`uniform sampler2D dfgLUT;
struct PhysicalMaterial {
	vec3 diffuseColor;
	vec3 diffuseContribution;
	vec3 specularColor;
	vec3 specularColorBlended;
	float roughness;
	float metalness;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
		vec3 iridescenceFresnelDielectric;
		vec3 iridescenceFresnelMetallic;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return v;
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColorBlended;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transpose( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float rInv = 1.0 / ( roughness + 0.1 );
	float a = -1.9362 + 1.0678 * roughness + 0.4573 * r2 - 0.8469 * rInv;
	float b = -0.6014 + 0.5538 * roughness - 0.4670 * r2 - 0.1255 * rInv;
	float DG = exp( a * dotNV + b );
	return saturate( DG );
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 fab = texture2D( dfgLUT, vec2( roughness, dotNV ) ).rg;
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 fab = texture2D( dfgLUT, vec2( roughness, dotNV ) ).rg;
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
vec3 BRDF_GGX_Multiscatter( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 singleScatter = BRDF_GGX( lightDir, viewDir, normal, material );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 dfgV = texture2D( dfgLUT, vec2( material.roughness, dotNV ) ).rg;
	vec2 dfgL = texture2D( dfgLUT, vec2( material.roughness, dotNL ) ).rg;
	vec3 FssEss_V = material.specularColorBlended * dfgV.x + material.specularF90 * dfgV.y;
	vec3 FssEss_L = material.specularColorBlended * dfgL.x + material.specularF90 * dfgL.y;
	float Ess_V = dfgV.x + dfgV.y;
	float Ess_L = dfgL.x + dfgL.y;
	float Ems_V = 1.0 - Ess_V;
	float Ems_L = 1.0 - Ess_L;
	vec3 Favg = material.specularColorBlended + ( 1.0 - material.specularColorBlended ) * 0.047619;
	vec3 Fms = FssEss_V * FssEss_L * Favg / ( 1.0 - Ems_V * Ems_L * Favg + EPSILON );
	float compensationFactor = Ems_V * Ems_L;
	vec3 multiScatter = Fms * compensationFactor;
	return singleScatter + multiScatter;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColorBlended * t2.x + ( vec3( 1.0 ) - material.specularColorBlended ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseContribution * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
 
 		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
 
 		float sheenAlbedoV = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
 		float sheenAlbedoL = IBLSheenBRDF( geometryNormal, directLight.direction, material.sheenRoughness );
 
 		float sheenEnergyComp = 1.0 - max3( material.sheenColor ) * max( sheenAlbedoV, sheenAlbedoL );
 
 		irradiance *= sheenEnergyComp;
 
 	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX_Multiscatter( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseContribution );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 diffuse = irradiance * BRDF_Lambert( material.diffuseContribution );
	#ifdef USE_SHEEN
		float sheenAlbedo = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
		float sheenEnergyComp = 1.0 - max3( material.sheenColor ) * sheenAlbedo;
		diffuse *= sheenEnergyComp;
	#endif
	reflectedLight.indirectDiffuse += diffuse;
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness ) * RECIPROCAL_PI;
 	#endif
	vec3 singleScatteringDielectric = vec3( 0.0 );
	vec3 multiScatteringDielectric = vec3( 0.0 );
	vec3 singleScatteringMetallic = vec3( 0.0 );
	vec3 multiScatteringMetallic = vec3( 0.0 );
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnelDielectric, material.roughness, singleScatteringDielectric, multiScatteringDielectric );
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.diffuseColor, material.specularF90, material.iridescence, material.iridescenceFresnelMetallic, material.roughness, singleScatteringMetallic, multiScatteringMetallic );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScatteringDielectric, multiScatteringDielectric );
		computeMultiscattering( geometryNormal, geometryViewDir, material.diffuseColor, material.specularF90, material.roughness, singleScatteringMetallic, multiScatteringMetallic );
	#endif
	vec3 singleScattering = mix( singleScatteringDielectric, singleScatteringMetallic, material.metalness );
	vec3 multiScattering = mix( multiScatteringDielectric, multiScatteringMetallic, material.metalness );
	vec3 totalScatteringDielectric = singleScatteringDielectric + multiScatteringDielectric;
	vec3 diffuse = material.diffuseContribution * ( 1.0 - totalScatteringDielectric );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	vec3 indirectSpecular = radiance * singleScattering;
	indirectSpecular += multiScattering * cosineWeightedIrradiance;
	vec3 indirectDiffuse = diffuse * cosineWeightedIrradiance;
	#ifdef USE_SHEEN
		float sheenAlbedo = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
		float sheenEnergyComp = 1.0 - max3( material.sheenColor ) * sheenAlbedo;
		indirectSpecular *= sheenEnergyComp;
		indirectDiffuse *= sheenEnergyComp;
	#endif
	reflectedLight.indirectSpecular += indirectSpecular;
	reflectedLight.indirectDiffuse += indirectDiffuse;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,vA=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnelDielectric = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceFresnelMetallic = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.diffuseColor );
		material.iridescenceFresnel = mix( material.iridescenceFresnelDielectric, material.iridescenceFresnelMetallic, material.metalness );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS ) && ( defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_BASIC ) )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,bA=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,wA=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,TA=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,SA=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,MA=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,EA=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,AA=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,CA=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,PA=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,IA=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,RA=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,DA=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,LA=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,FA=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,zA=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,OA=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,NA=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,BA=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,kA=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,UA=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,VA=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,GA=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,HA=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,jA=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,WA=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,qA=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,XA=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,ZA=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,$A=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,YA=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,KA=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,JA=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,QA=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,e2=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,t2=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,i2=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#if defined( SHADOWMAP_TYPE_PCF )
			uniform sampler2DShadow directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		#else
			uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		#endif
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		#if defined( SHADOWMAP_TYPE_PCF )
			uniform sampler2DShadow spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		#else
			uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		#endif
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#if defined( SHADOWMAP_TYPE_PCF )
			uniform samplerCubeShadow pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		#elif defined( SHADOWMAP_TYPE_BASIC )
			uniform samplerCube pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		#endif
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	#if defined( SHADOWMAP_TYPE_PCF )
		float interleavedGradientNoise( vec2 position ) {
			return fract( 52.9829189 * fract( dot( position, vec2( 0.06711056, 0.00583715 ) ) ) );
		}
		vec2 vogelDiskSample( int sampleIndex, int samplesCount, float phi ) {
			const float goldenAngle = 2.399963229728653;
			float r = sqrt( ( float( sampleIndex ) + 0.5 ) / float( samplesCount ) );
			float theta = float( sampleIndex ) * goldenAngle + phi;
			return vec2( cos( theta ), sin( theta ) ) * r;
		}
	#endif
	#if defined( SHADOWMAP_TYPE_PCF )
		float getShadow( sampler2DShadow shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
			float shadow = 1.0;
			shadowCoord.xyz /= shadowCoord.w;
			shadowCoord.z += shadowBias;
			bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
			bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
			if ( frustumTest ) {
				vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
				float radius = shadowRadius * texelSize.x;
				float phi = interleavedGradientNoise( gl_FragCoord.xy ) * 6.28318530718;
				shadow = (
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 0, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 1, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 2, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 3, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 4, 5, phi ) * radius, shadowCoord.z ) )
				) * 0.2;
			}
			return mix( 1.0, shadow, shadowIntensity );
		}
	#elif defined( SHADOWMAP_TYPE_VSM )
		float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
			float shadow = 1.0;
			shadowCoord.xyz /= shadowCoord.w;
			shadowCoord.z += shadowBias;
			bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
			bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
			if ( frustumTest ) {
				vec2 distribution = texture2D( shadowMap, shadowCoord.xy ).rg;
				float mean = distribution.x;
				float variance = distribution.y * distribution.y;
				#ifdef USE_REVERSED_DEPTH_BUFFER
					float hard_shadow = step( mean, shadowCoord.z );
				#else
					float hard_shadow = step( shadowCoord.z, mean );
				#endif
				if ( hard_shadow == 1.0 ) {
					shadow = 1.0;
				} else {
					variance = max( variance, 0.0000001 );
					float d = shadowCoord.z - mean;
					float p_max = variance / ( variance + d * d );
					p_max = clamp( ( p_max - 0.3 ) / 0.65, 0.0, 1.0 );
					shadow = max( hard_shadow, p_max );
				}
			}
			return mix( 1.0, shadow, shadowIntensity );
		}
	#else
		float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
			float shadow = 1.0;
			shadowCoord.xyz /= shadowCoord.w;
			shadowCoord.z += shadowBias;
			bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
			bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
			if ( frustumTest ) {
				float depth = texture2D( shadowMap, shadowCoord.xy ).r;
				#ifdef USE_REVERSED_DEPTH_BUFFER
					shadow = step( depth, shadowCoord.z );
				#else
					shadow = step( shadowCoord.z, depth );
				#endif
			}
			return mix( 1.0, shadow, shadowIntensity );
		}
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#if defined( SHADOWMAP_TYPE_PCF )
	float getPointShadow( samplerCubeShadow shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		vec3 bd3D = normalize( lightToPosition );
		vec3 absVec = abs( lightToPosition );
		float viewSpaceZ = max( max( absVec.x, absVec.y ), absVec.z );
		if ( viewSpaceZ - shadowCameraFar <= 0.0 && viewSpaceZ - shadowCameraNear >= 0.0 ) {
			float dp = ( shadowCameraFar * ( viewSpaceZ - shadowCameraNear ) ) / ( viewSpaceZ * ( shadowCameraFar - shadowCameraNear ) );
			dp += shadowBias;
			float texelSize = shadowRadius / shadowMapSize.x;
			vec3 absDir = abs( bd3D );
			vec3 tangent = absDir.x > absDir.z ? vec3( 0.0, 1.0, 0.0 ) : vec3( 1.0, 0.0, 0.0 );
			tangent = normalize( cross( bd3D, tangent ) );
			vec3 bitangent = cross( bd3D, tangent );
			float phi = interleavedGradientNoise( gl_FragCoord.xy ) * 6.28318530718;
			shadow = (
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 0, 5, phi ).x + bitangent * vogelDiskSample( 0, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 1, 5, phi ).x + bitangent * vogelDiskSample( 1, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 2, 5, phi ).x + bitangent * vogelDiskSample( 2, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 3, 5, phi ).x + bitangent * vogelDiskSample( 3, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 4, 5, phi ).x + bitangent * vogelDiskSample( 4, 5, phi ).y ) * texelSize, dp ) )
			) * 0.2;
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	#elif defined( SHADOWMAP_TYPE_BASIC )
	float getPointShadow( samplerCube shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		vec3 bd3D = normalize( lightToPosition );
		vec3 absVec = abs( lightToPosition );
		float viewSpaceZ = max( max( absVec.x, absVec.y ), absVec.z );
		if ( viewSpaceZ - shadowCameraFar <= 0.0 && viewSpaceZ - shadowCameraNear >= 0.0 ) {
			float dp = ( shadowCameraFar * ( viewSpaceZ - shadowCameraNear ) ) / ( viewSpaceZ * ( shadowCameraFar - shadowCameraNear ) );
			dp += shadowBias;
			float depth = textureCube( shadowMap, bd3D ).r;
			#ifdef USE_REVERSED_DEPTH_BUFFER
				shadow = step( depth, dp );
			#else
				shadow = step( dp, depth );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	#endif
	#endif
#endif`,n2=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,r2=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,s2=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0 && ( defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_BASIC ) )
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,a2=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,o2=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,l2=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,c2=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,u2=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,h2=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,d2=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,f2=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,p2=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseContribution, material.specularColorBlended, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,m2=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,g2=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,_2=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,y2=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,x2=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const v2=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,b2=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,w2=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,T2=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,S2=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,M2=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,E2=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,A2=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	#ifdef USE_REVERSED_DEPTH_BUFFER
		float fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];
	#else
		float fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;
	#endif
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,C2=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,P2=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = vec4( dist, 0.0, 0.0, 1.0 );
}`,I2=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,R2=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,D2=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,L2=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,F2=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,z2=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,O2=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,N2=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,B2=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,k2=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,U2=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,V2=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( normalize( normal ) * 0.5 + 0.5, diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,G2=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,H2=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,j2=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,W2=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
 
		outgoingLight = outgoingLight + sheenSpecularDirect + sheenSpecularIndirect;
 
 	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,q2=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,X2=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Z2=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,$2=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Y2=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,K2=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,J2=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Q2=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Mi={alphahash_fragment:bE,alphahash_pars_fragment:wE,alphamap_fragment:TE,alphamap_pars_fragment:SE,alphatest_fragment:ME,alphatest_pars_fragment:EE,aomap_fragment:AE,aomap_pars_fragment:CE,batching_pars_vertex:PE,batching_vertex:IE,begin_vertex:RE,beginnormal_vertex:DE,bsdfs:LE,iridescence_fragment:FE,bumpmap_pars_fragment:zE,clipping_planes_fragment:OE,clipping_planes_pars_fragment:NE,clipping_planes_pars_vertex:BE,clipping_planes_vertex:kE,color_fragment:UE,color_pars_fragment:VE,color_pars_vertex:GE,color_vertex:HE,common:jE,cube_uv_reflection_fragment:WE,defaultnormal_vertex:qE,displacementmap_pars_vertex:XE,displacementmap_vertex:ZE,emissivemap_fragment:$E,emissivemap_pars_fragment:YE,colorspace_fragment:KE,colorspace_pars_fragment:JE,envmap_fragment:QE,envmap_common_pars_fragment:eA,envmap_pars_fragment:tA,envmap_pars_vertex:iA,envmap_physical_pars_fragment:fA,envmap_vertex:nA,fog_vertex:rA,fog_pars_vertex:sA,fog_fragment:aA,fog_pars_fragment:oA,gradientmap_pars_fragment:lA,lightmap_pars_fragment:cA,lights_lambert_fragment:uA,lights_lambert_pars_fragment:hA,lights_pars_begin:dA,lights_toon_fragment:pA,lights_toon_pars_fragment:mA,lights_phong_fragment:gA,lights_phong_pars_fragment:_A,lights_physical_fragment:yA,lights_physical_pars_fragment:xA,lights_fragment_begin:vA,lights_fragment_maps:bA,lights_fragment_end:wA,logdepthbuf_fragment:TA,logdepthbuf_pars_fragment:SA,logdepthbuf_pars_vertex:MA,logdepthbuf_vertex:EA,map_fragment:AA,map_pars_fragment:CA,map_particle_fragment:PA,map_particle_pars_fragment:IA,metalnessmap_fragment:RA,metalnessmap_pars_fragment:DA,morphinstance_vertex:LA,morphcolor_vertex:FA,morphnormal_vertex:zA,morphtarget_pars_vertex:OA,morphtarget_vertex:NA,normal_fragment_begin:BA,normal_fragment_maps:kA,normal_pars_fragment:UA,normal_pars_vertex:VA,normal_vertex:GA,normalmap_pars_fragment:HA,clearcoat_normal_fragment_begin:jA,clearcoat_normal_fragment_maps:WA,clearcoat_pars_fragment:qA,iridescence_pars_fragment:XA,opaque_fragment:ZA,packing:$A,premultiplied_alpha_fragment:YA,project_vertex:KA,dithering_fragment:JA,dithering_pars_fragment:QA,roughnessmap_fragment:e2,roughnessmap_pars_fragment:t2,shadowmap_pars_fragment:i2,shadowmap_pars_vertex:n2,shadowmap_vertex:r2,shadowmask_pars_fragment:s2,skinbase_vertex:a2,skinning_pars_vertex:o2,skinning_vertex:l2,skinnormal_vertex:c2,specularmap_fragment:u2,specularmap_pars_fragment:h2,tonemapping_fragment:d2,tonemapping_pars_fragment:f2,transmission_fragment:p2,transmission_pars_fragment:m2,uv_pars_fragment:g2,uv_pars_vertex:_2,uv_vertex:y2,worldpos_vertex:x2,background_vert:v2,background_frag:b2,backgroundCube_vert:w2,backgroundCube_frag:T2,cube_vert:S2,cube_frag:M2,depth_vert:E2,depth_frag:A2,distance_vert:C2,distance_frag:P2,equirect_vert:I2,equirect_frag:R2,linedashed_vert:D2,linedashed_frag:L2,meshbasic_vert:F2,meshbasic_frag:z2,meshlambert_vert:O2,meshlambert_frag:N2,meshmatcap_vert:B2,meshmatcap_frag:k2,meshnormal_vert:U2,meshnormal_frag:V2,meshphong_vert:G2,meshphong_frag:H2,meshphysical_vert:j2,meshphysical_frag:W2,meshtoon_vert:q2,meshtoon_frag:X2,points_vert:Z2,points_frag:$2,shadow_vert:Y2,shadow_frag:K2,sprite_vert:J2,sprite_frag:Q2},Bt={common:{diffuse:{value:new bi(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new wi},alphaMap:{value:null},alphaMapTransform:{value:new wi},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new wi}},envmap:{envMap:{value:null},envMapRotation:{value:new wi},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},dfgLUT:{value:null}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new wi}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new wi}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new wi},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new wi},normalScale:{value:new Bi(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new wi},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new wi}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new wi}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new wi}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new bi(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new bi(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new wi},alphaTest:{value:0},uvTransform:{value:new wi}},sprite:{diffuse:{value:new bi(16777215)},opacity:{value:1},center:{value:new Bi(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new wi},alphaMap:{value:null},alphaMapTransform:{value:new wi},alphaTest:{value:0}}},ua={basic:{uniforms:Ur([Bt.common,Bt.specularmap,Bt.envmap,Bt.aomap,Bt.lightmap,Bt.fog]),vertexShader:Mi.meshbasic_vert,fragmentShader:Mi.meshbasic_frag},lambert:{uniforms:Ur([Bt.common,Bt.specularmap,Bt.envmap,Bt.aomap,Bt.lightmap,Bt.emissivemap,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.fog,Bt.lights,{emissive:{value:new bi(0)}}]),vertexShader:Mi.meshlambert_vert,fragmentShader:Mi.meshlambert_frag},phong:{uniforms:Ur([Bt.common,Bt.specularmap,Bt.envmap,Bt.aomap,Bt.lightmap,Bt.emissivemap,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.fog,Bt.lights,{emissive:{value:new bi(0)},specular:{value:new bi(1118481)},shininess:{value:30}}]),vertexShader:Mi.meshphong_vert,fragmentShader:Mi.meshphong_frag},standard:{uniforms:Ur([Bt.common,Bt.envmap,Bt.aomap,Bt.lightmap,Bt.emissivemap,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.roughnessmap,Bt.metalnessmap,Bt.fog,Bt.lights,{emissive:{value:new bi(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Mi.meshphysical_vert,fragmentShader:Mi.meshphysical_frag},toon:{uniforms:Ur([Bt.common,Bt.aomap,Bt.lightmap,Bt.emissivemap,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.gradientmap,Bt.fog,Bt.lights,{emissive:{value:new bi(0)}}]),vertexShader:Mi.meshtoon_vert,fragmentShader:Mi.meshtoon_frag},matcap:{uniforms:Ur([Bt.common,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.fog,{matcap:{value:null}}]),vertexShader:Mi.meshmatcap_vert,fragmentShader:Mi.meshmatcap_frag},points:{uniforms:Ur([Bt.points,Bt.fog]),vertexShader:Mi.points_vert,fragmentShader:Mi.points_frag},dashed:{uniforms:Ur([Bt.common,Bt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Mi.linedashed_vert,fragmentShader:Mi.linedashed_frag},depth:{uniforms:Ur([Bt.common,Bt.displacementmap]),vertexShader:Mi.depth_vert,fragmentShader:Mi.depth_frag},normal:{uniforms:Ur([Bt.common,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,{opacity:{value:1}}]),vertexShader:Mi.meshnormal_vert,fragmentShader:Mi.meshnormal_frag},sprite:{uniforms:Ur([Bt.sprite,Bt.fog]),vertexShader:Mi.sprite_vert,fragmentShader:Mi.sprite_frag},background:{uniforms:{uvTransform:{value:new wi},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Mi.background_vert,fragmentShader:Mi.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new wi}},vertexShader:Mi.backgroundCube_vert,fragmentShader:Mi.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Mi.cube_vert,fragmentShader:Mi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Mi.equirect_vert,fragmentShader:Mi.equirect_frag},distance:{uniforms:Ur([Bt.common,Bt.displacementmap,{referencePosition:{value:new We},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Mi.distance_vert,fragmentShader:Mi.distance_frag},shadow:{uniforms:Ur([Bt.lights,Bt.fog,{color:{value:new bi(0)},opacity:{value:1}}]),vertexShader:Mi.shadow_vert,fragmentShader:Mi.shadow_frag}};ua.physical={uniforms:Ur([ua.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new wi},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new wi},clearcoatNormalScale:{value:new Bi(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new wi},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new wi},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new wi},sheen:{value:0},sheenColor:{value:new bi(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new wi},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new wi},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new wi},transmissionSamplerSize:{value:new Bi},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new wi},attenuationDistance:{value:0},attenuationColor:{value:new bi(0)},specularColor:{value:new bi(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new wi},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new wi},anisotropyVector:{value:new Bi},anisotropyMap:{value:null},anisotropyMapTransform:{value:new wi}}]),vertexShader:Mi.meshphysical_vert,fragmentShader:Mi.meshphysical_frag};const sp={r:0,b:0,g:0},kl=new _a,eC=new gi;function tC(m,i,s,c,f,v,_){const o=new bi(0);let M=v===!0?0:1,C,D,F=null,O=0,j=null;function K(de){let ve=de.isScene===!0?de.background:null;return ve&&ve.isTexture&&(ve=(de.backgroundBlurriness>0?s:i).get(ve)),ve}function J(de){let ve=!1;const Me=K(de);Me===null?W(o,M):Me&&Me.isColor&&(W(Me,1),ve=!0);const De=m.xr.getEnvironmentBlendMode();De==="additive"?c.buffers.color.setClear(0,0,0,1,_):De==="alpha-blend"&&c.buffers.color.setClear(0,0,0,0,_),(m.autoClear||ve)&&(c.buffers.depth.setTest(!0),c.buffers.depth.setMask(!0),c.buffers.color.setMask(!0),m.clear(m.autoClearColor,m.autoClearDepth,m.autoClearStencil))}function N(de,ve){const Me=K(ve);Me&&(Me.isCubeTexture||Me.mapping===wp)?(D===void 0&&(D=new Gr(new ud(1,1,1),new ya({name:"BackgroundCubeMaterial",uniforms:vu(ua.backgroundCube.uniforms),vertexShader:ua.backgroundCube.vertexShader,fragmentShader:ua.backgroundCube.fragmentShader,side:Qr,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),D.geometry.deleteAttribute("normal"),D.geometry.deleteAttribute("uv"),D.onBeforeRender=function(De,Ie,$e){this.matrixWorld.copyPosition($e.matrixWorld)},Object.defineProperty(D.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),f.update(D)),kl.copy(ve.backgroundRotation),kl.x*=-1,kl.y*=-1,kl.z*=-1,Me.isCubeTexture&&Me.isRenderTargetTexture===!1&&(kl.y*=-1,kl.z*=-1),D.material.uniforms.envMap.value=Me,D.material.uniforms.flipEnvMap.value=Me.isCubeTexture&&Me.isRenderTargetTexture===!1?-1:1,D.material.uniforms.backgroundBlurriness.value=ve.backgroundBlurriness,D.material.uniforms.backgroundIntensity.value=ve.backgroundIntensity,D.material.uniforms.backgroundRotation.value.setFromMatrix4(eC.makeRotationFromEuler(kl)),D.material.toneMapped=Ni.getTransfer(Me.colorSpace)!==en,(F!==Me||O!==Me.version||j!==m.toneMapping)&&(D.material.needsUpdate=!0,F=Me,O=Me.version,j=m.toneMapping),D.layers.enableAll(),de.unshift(D,D.geometry,D.material,0,0,null)):Me&&Me.isTexture&&(C===void 0&&(C=new Gr(new Sp(2,2),new ya({name:"BackgroundMaterial",uniforms:vu(ua.background.uniforms),vertexShader:ua.background.vertexShader,fragmentShader:ua.background.fragmentShader,side:ro,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),C.geometry.deleteAttribute("normal"),Object.defineProperty(C.material,"map",{get:function(){return this.uniforms.t2D.value}}),f.update(C)),C.material.uniforms.t2D.value=Me,C.material.uniforms.backgroundIntensity.value=ve.backgroundIntensity,C.material.toneMapped=Ni.getTransfer(Me.colorSpace)!==en,Me.matrixAutoUpdate===!0&&Me.updateMatrix(),C.material.uniforms.uvTransform.value.copy(Me.matrix),(F!==Me||O!==Me.version||j!==m.toneMapping)&&(C.material.needsUpdate=!0,F=Me,O=Me.version,j=m.toneMapping),C.layers.enableAll(),de.unshift(C,C.geometry,C.material,0,0,null))}function W(de,ve){de.getRGB(sp,Ob(m)),c.buffers.color.setClear(sp.r,sp.g,sp.b,ve,_)}function ge(){D!==void 0&&(D.geometry.dispose(),D.material.dispose(),D=void 0),C!==void 0&&(C.geometry.dispose(),C.material.dispose(),C=void 0)}return{getClearColor:function(){return o},setClearColor:function(de,ve=1){o.set(de),M=ve,W(o,M)},getClearAlpha:function(){return M},setClearAlpha:function(de){M=de,W(o,M)},render:J,addToRenderList:N,dispose:ge}}function iC(m,i){const s=m.getParameter(m.MAX_VERTEX_ATTRIBS),c={},f=O(null);let v=f,_=!1;function o(fe,Oe,tt,Qe,pt){let ct=!1;const nt=F(Qe,tt,Oe);v!==nt&&(v=nt,C(v.object)),ct=j(fe,Qe,tt,pt),ct&&K(fe,Qe,tt,pt),pt!==null&&i.update(pt,m.ELEMENT_ARRAY_BUFFER),(ct||_)&&(_=!1,ve(fe,Oe,tt,Qe),pt!==null&&m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,i.get(pt).buffer))}function M(){return m.createVertexArray()}function C(fe){return m.bindVertexArray(fe)}function D(fe){return m.deleteVertexArray(fe)}function F(fe,Oe,tt){const Qe=tt.wireframe===!0;let pt=c[fe.id];pt===void 0&&(pt={},c[fe.id]=pt);let ct=pt[Oe.id];ct===void 0&&(ct={},pt[Oe.id]=ct);let nt=ct[Qe];return nt===void 0&&(nt=O(M()),ct[Qe]=nt),nt}function O(fe){const Oe=[],tt=[],Qe=[];for(let pt=0;pt<s;pt++)Oe[pt]=0,tt[pt]=0,Qe[pt]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Oe,enabledAttributes:tt,attributeDivisors:Qe,object:fe,attributes:{},index:null}}function j(fe,Oe,tt,Qe){const pt=v.attributes,ct=Oe.attributes;let nt=0;const Je=tt.getAttributes();for(const ut in Je)if(Je[ut].location>=0){const At=pt[ut];let Rt=ct[ut];if(Rt===void 0&&(ut==="instanceMatrix"&&fe.instanceMatrix&&(Rt=fe.instanceMatrix),ut==="instanceColor"&&fe.instanceColor&&(Rt=fe.instanceColor)),At===void 0||At.attribute!==Rt||Rt&&At.data!==Rt.data)return!0;nt++}return v.attributesNum!==nt||v.index!==Qe}function K(fe,Oe,tt,Qe){const pt={},ct=Oe.attributes;let nt=0;const Je=tt.getAttributes();for(const ut in Je)if(Je[ut].location>=0){let At=ct[ut];At===void 0&&(ut==="instanceMatrix"&&fe.instanceMatrix&&(At=fe.instanceMatrix),ut==="instanceColor"&&fe.instanceColor&&(At=fe.instanceColor));const Rt={};Rt.attribute=At,At&&At.data&&(Rt.data=At.data),pt[ut]=Rt,nt++}v.attributes=pt,v.attributesNum=nt,v.index=Qe}function J(){const fe=v.newAttributes;for(let Oe=0,tt=fe.length;Oe<tt;Oe++)fe[Oe]=0}function N(fe){W(fe,0)}function W(fe,Oe){const tt=v.newAttributes,Qe=v.enabledAttributes,pt=v.attributeDivisors;tt[fe]=1,Qe[fe]===0&&(m.enableVertexAttribArray(fe),Qe[fe]=1),pt[fe]!==Oe&&(m.vertexAttribDivisor(fe,Oe),pt[fe]=Oe)}function ge(){const fe=v.newAttributes,Oe=v.enabledAttributes;for(let tt=0,Qe=Oe.length;tt<Qe;tt++)Oe[tt]!==fe[tt]&&(m.disableVertexAttribArray(tt),Oe[tt]=0)}function de(fe,Oe,tt,Qe,pt,ct,nt){nt===!0?m.vertexAttribIPointer(fe,Oe,tt,pt,ct):m.vertexAttribPointer(fe,Oe,tt,Qe,pt,ct)}function ve(fe,Oe,tt,Qe){J();const pt=Qe.attributes,ct=tt.getAttributes(),nt=Oe.defaultAttributeValues;for(const Je in ct){const ut=ct[Je];if(ut.location>=0){let xt=pt[Je];if(xt===void 0&&(Je==="instanceMatrix"&&fe.instanceMatrix&&(xt=fe.instanceMatrix),Je==="instanceColor"&&fe.instanceColor&&(xt=fe.instanceColor)),xt!==void 0){const At=xt.normalized,Rt=xt.itemSize,oi=i.get(xt);if(oi===void 0)continue;const ti=oi.buffer,Ii=oi.type,yi=oi.bytesPerElement,ot=Ii===m.INT||Ii===m.UNSIGNED_INT||xt.gpuType===j_;if(xt.isInterleavedBufferAttribute){const mt=xt.data,Dt=mt.stride,ni=xt.offset;if(mt.isInstancedInterleavedBuffer){for(let Gt=0;Gt<ut.locationSize;Gt++)W(ut.location+Gt,mt.meshPerAttribute);fe.isInstancedMesh!==!0&&Qe._maxInstanceCount===void 0&&(Qe._maxInstanceCount=mt.meshPerAttribute*mt.count)}else for(let Gt=0;Gt<ut.locationSize;Gt++)N(ut.location+Gt);m.bindBuffer(m.ARRAY_BUFFER,ti);for(let Gt=0;Gt<ut.locationSize;Gt++)de(ut.location+Gt,Rt/ut.locationSize,Ii,At,Dt*yi,(ni+Rt/ut.locationSize*Gt)*yi,ot)}else{if(xt.isInstancedBufferAttribute){for(let mt=0;mt<ut.locationSize;mt++)W(ut.location+mt,xt.meshPerAttribute);fe.isInstancedMesh!==!0&&Qe._maxInstanceCount===void 0&&(Qe._maxInstanceCount=xt.meshPerAttribute*xt.count)}else for(let mt=0;mt<ut.locationSize;mt++)N(ut.location+mt);m.bindBuffer(m.ARRAY_BUFFER,ti);for(let mt=0;mt<ut.locationSize;mt++)de(ut.location+mt,Rt/ut.locationSize,Ii,At,Rt*yi,Rt/ut.locationSize*mt*yi,ot)}}else if(nt!==void 0){const At=nt[Je];if(At!==void 0)switch(At.length){case 2:m.vertexAttrib2fv(ut.location,At);break;case 3:m.vertexAttrib3fv(ut.location,At);break;case 4:m.vertexAttrib4fv(ut.location,At);break;default:m.vertexAttrib1fv(ut.location,At)}}}}ge()}function Me(){$e();for(const fe in c){const Oe=c[fe];for(const tt in Oe){const Qe=Oe[tt];for(const pt in Qe)D(Qe[pt].object),delete Qe[pt];delete Oe[tt]}delete c[fe]}}function De(fe){if(c[fe.id]===void 0)return;const Oe=c[fe.id];for(const tt in Oe){const Qe=Oe[tt];for(const pt in Qe)D(Qe[pt].object),delete Qe[pt];delete Oe[tt]}delete c[fe.id]}function Ie(fe){for(const Oe in c){const tt=c[Oe];if(tt[fe.id]===void 0)continue;const Qe=tt[fe.id];for(const pt in Qe)D(Qe[pt].object),delete Qe[pt];delete tt[fe.id]}}function $e(){re(),_=!0,v!==f&&(v=f,C(v.object))}function re(){f.geometry=null,f.program=null,f.wireframe=!1}return{setup:o,reset:$e,resetDefaultState:re,dispose:Me,releaseStatesOfGeometry:De,releaseStatesOfProgram:Ie,initAttributes:J,enableAttribute:N,disableUnusedAttributes:ge}}function nC(m,i,s){let c;function f(C){c=C}function v(C,D){m.drawArrays(c,C,D),s.update(D,c,1)}function _(C,D,F){F!==0&&(m.drawArraysInstanced(c,C,D,F),s.update(D,c,F))}function o(C,D,F){if(F===0)return;i.get("WEBGL_multi_draw").multiDrawArraysWEBGL(c,C,0,D,0,F);let j=0;for(let K=0;K<F;K++)j+=D[K];s.update(j,c,1)}function M(C,D,F,O){if(F===0)return;const j=i.get("WEBGL_multi_draw");if(j===null)for(let K=0;K<C.length;K++)_(C[K],D[K],O[K]);else{j.multiDrawArraysInstancedWEBGL(c,C,0,D,0,O,0,F);let K=0;for(let J=0;J<F;J++)K+=D[J]*O[J];s.update(K,c,1)}}this.setMode=f,this.render=v,this.renderInstances=_,this.renderMultiDraw=o,this.renderMultiDrawInstances=M}function rC(m,i,s,c){let f;function v(){if(f!==void 0)return f;if(i.has("EXT_texture_filter_anisotropic")===!0){const Ie=i.get("EXT_texture_filter_anisotropic");f=m.getParameter(Ie.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else f=0;return f}function _(Ie){return!(Ie!==Ps&&c.convert(Ie)!==m.getParameter(m.IMPLEMENTATION_COLOR_READ_FORMAT))}function o(Ie){const $e=Ie===so&&(i.has("EXT_color_buffer_half_float")||i.has("EXT_color_buffer_float"));return!(Ie!==gs&&c.convert(Ie)!==m.getParameter(m.IMPLEMENTATION_COLOR_READ_TYPE)&&Ie!==Cs&&!$e)}function M(Ie){if(Ie==="highp"){if(m.getShaderPrecisionFormat(m.VERTEX_SHADER,m.HIGH_FLOAT).precision>0&&m.getShaderPrecisionFormat(m.FRAGMENT_SHADER,m.HIGH_FLOAT).precision>0)return"highp";Ie="mediump"}return Ie==="mediump"&&m.getShaderPrecisionFormat(m.VERTEX_SHADER,m.MEDIUM_FLOAT).precision>0&&m.getShaderPrecisionFormat(m.FRAGMENT_SHADER,m.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let C=s.precision!==void 0?s.precision:"highp";const D=M(C);D!==C&&(ei("WebGLRenderer:",C,"not supported, using",D,"instead."),C=D);const F=s.logarithmicDepthBuffer===!0,O=s.reversedDepthBuffer===!0&&i.has("EXT_clip_control"),j=m.getParameter(m.MAX_TEXTURE_IMAGE_UNITS),K=m.getParameter(m.MAX_VERTEX_TEXTURE_IMAGE_UNITS),J=m.getParameter(m.MAX_TEXTURE_SIZE),N=m.getParameter(m.MAX_CUBE_MAP_TEXTURE_SIZE),W=m.getParameter(m.MAX_VERTEX_ATTRIBS),ge=m.getParameter(m.MAX_VERTEX_UNIFORM_VECTORS),de=m.getParameter(m.MAX_VARYING_VECTORS),ve=m.getParameter(m.MAX_FRAGMENT_UNIFORM_VECTORS),Me=m.getParameter(m.MAX_SAMPLES),De=m.getParameter(m.SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:v,getMaxPrecision:M,textureFormatReadable:_,textureTypeReadable:o,precision:C,logarithmicDepthBuffer:F,reversedDepthBuffer:O,maxTextures:j,maxVertexTextures:K,maxTextureSize:J,maxCubemapSize:N,maxAttributes:W,maxVertexUniforms:ge,maxVaryings:de,maxFragmentUniforms:ve,maxSamples:Me,samples:De}}function sC(m){const i=this;let s=null,c=0,f=!1,v=!1;const _=new Gl,o=new wi,M={value:null,needsUpdate:!1};this.uniform=M,this.numPlanes=0,this.numIntersection=0,this.init=function(F,O){const j=F.length!==0||O||c!==0||f;return f=O,c=F.length,j},this.beginShadows=function(){v=!0,D(null)},this.endShadows=function(){v=!1},this.setGlobalState=function(F,O){s=D(F,O,0)},this.setState=function(F,O,j){const K=F.clippingPlanes,J=F.clipIntersection,N=F.clipShadows,W=m.get(F);if(!f||K===null||K.length===0||v&&!N)v?D(null):C();else{const ge=v?0:c,de=ge*4;let ve=W.clippingState||null;M.value=ve,ve=D(K,O,de,j);for(let Me=0;Me!==de;++Me)ve[Me]=s[Me];W.clippingState=ve,this.numIntersection=J?this.numPlanes:0,this.numPlanes+=ge}};function C(){M.value!==s&&(M.value=s,M.needsUpdate=c>0),i.numPlanes=c,i.numIntersection=0}function D(F,O,j,K){const J=F!==null?F.length:0;let N=null;if(J!==0){if(N=M.value,K!==!0||N===null){const W=j+J*4,ge=O.matrixWorldInverse;o.getNormalMatrix(ge),(N===null||N.length<W)&&(N=new Float32Array(W));for(let de=0,ve=j;de!==J;++de,ve+=4)_.copy(F[de]).applyMatrix4(ge,o),_.normal.toArray(N,ve),N[ve+3]=_.constant}M.value=N,M.needsUpdate=!0}return i.numPlanes=J,i.numIntersection=0,N}}function aC(m){let i=new WeakMap;function s(_,o){return o===$g?_.mapping=Zl:o===Yg&&(_.mapping=gu),_}function c(_){if(_&&_.isTexture){const o=_.mapping;if(o===$g||o===Yg)if(i.has(_)){const M=i.get(_).texture;return s(M,_.mapping)}else{const M=_.image;if(M&&M.height>0){const C=new Bb(M.height);return C.fromEquirectangularTexture(m,_),i.set(_,C),_.addEventListener("dispose",f),s(C.texture,_.mapping)}else return null}}return _}function f(_){const o=_.target;o.removeEventListener("dispose",f);const M=i.get(o);M!==void 0&&(i.delete(o),M.dispose())}function v(){i=new WeakMap}return{get:c,dispose:v}}const Zo=4,yv=[.125,.215,.35,.446,.526,.582],jl=20,oC=256,qh=new Mp,xv=new bi;let Ag=null,Cg=0,Pg=0,Ig=!1;const lC=new We;class vv{constructor(i){this._renderer=i,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._backgroundBox=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._blurMaterial=null,this._ggxMaterial=null}fromScene(i,s=0,c=.1,f=100,v={}){const{size:_=256,position:o=lC}=v;Ag=this._renderer.getRenderTarget(),Cg=this._renderer.getActiveCubeFace(),Pg=this._renderer.getActiveMipmapLevel(),Ig=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(_);const M=this._allocateTargets();return M.depthBuffer=!0,this._sceneToCubeUV(i,c,f,M,o),s>0&&this._blur(M,0,0,s),this._applyPMREM(M),this._cleanup(M),M}fromEquirectangular(i,s=null){return this._fromTexture(i,s)}fromCubemap(i,s=null){return this._fromTexture(i,s)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Tv(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=wv(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSize(i){this._lodMax=Math.floor(Math.log2(i)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._ggxMaterial!==null&&this._ggxMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let i=0;i<this._lodMeshes.length;i++)this._lodMeshes[i].geometry.dispose()}_cleanup(i){this._renderer.setRenderTarget(Ag,Cg,Pg),this._renderer.xr.enabled=Ig,i.scissorTest=!1,uu(i,0,0,i.width,i.height)}_fromTexture(i,s){i.mapping===Zl||i.mapping===gu?this._setSize(i.image.length===0?16:i.image[0].width||i.image[0].image.width):this._setSize(i.image.width/4),Ag=this._renderer.getRenderTarget(),Cg=this._renderer.getActiveCubeFace(),Pg=this._renderer.getActiveMipmapLevel(),Ig=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const c=s||this._allocateTargets();return this._textureToCubeUV(i,c),this._applyPMREM(c),this._cleanup(c),c}_allocateTargets(){const i=3*Math.max(this._cubeSize,112),s=4*this._cubeSize,c={magFilter:nr,minFilter:nr,generateMipmaps:!1,type:so,format:Ps,colorSpace:Vr,depthBuffer:!1},f=bv(i,s,c);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==i||this._pingPongRenderTarget.height!==s){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=bv(i,s,c);const{_lodMax:v}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=cC(v)),this._blurMaterial=hC(v,i,s),this._ggxMaterial=uC(v,i,s)}return f}_compileMaterial(i){const s=new Gr(new ts,i);this._renderer.compile(s,qh)}_sceneToCubeUV(i,s,c,f,v){const M=new Jr(90,1,s,c),C=[1,-1,1,1,1,1],D=[1,1,1,-1,-1,-1],F=this._renderer,O=F.autoClear,j=F.toneMapping;F.getClearColor(xv),F.toneMapping=fa,F.autoClear=!1,F.state.buffers.depth.getReversed()&&(F.setRenderTarget(f),F.clearDepth(),F.setRenderTarget(null)),this._backgroundBox===null&&(this._backgroundBox=new Gr(new ud,new eo({name:"PMREM.Background",side:Qr,depthWrite:!1,depthTest:!1})));const J=this._backgroundBox,N=J.material;let W=!1;const ge=i.background;ge?ge.isColor&&(N.color.copy(ge),i.background=null,W=!0):(N.color.copy(xv),W=!0);for(let de=0;de<6;de++){const ve=de%3;ve===0?(M.up.set(0,C[de],0),M.position.set(v.x,v.y,v.z),M.lookAt(v.x+D[de],v.y,v.z)):ve===1?(M.up.set(0,0,C[de]),M.position.set(v.x,v.y,v.z),M.lookAt(v.x,v.y+D[de],v.z)):(M.up.set(0,C[de],0),M.position.set(v.x,v.y,v.z),M.lookAt(v.x,v.y,v.z+D[de]));const Me=this._cubeSize;uu(f,ve*Me,de>2?Me:0,Me,Me),F.setRenderTarget(f),W&&F.render(J,M),F.render(i,M)}F.toneMapping=j,F.autoClear=O,i.background=ge}_textureToCubeUV(i,s){const c=this._renderer,f=i.mapping===Zl||i.mapping===gu;f?(this._cubemapMaterial===null&&(this._cubemapMaterial=Tv()),this._cubemapMaterial.uniforms.flipEnvMap.value=i.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=wv());const v=f?this._cubemapMaterial:this._equirectMaterial,_=this._lodMeshes[0];_.material=v;const o=v.uniforms;o.envMap.value=i;const M=this._cubeSize;uu(s,0,0,3*M,2*M),c.setRenderTarget(s),c.render(_,qh)}_applyPMREM(i){const s=this._renderer,c=s.autoClear;s.autoClear=!1;const f=this._lodMeshes.length;for(let v=1;v<f;v++)this._applyGGXFilter(i,v-1,v);s.autoClear=c}_applyGGXFilter(i,s,c){const f=this._renderer,v=this._pingPongRenderTarget,_=this._ggxMaterial,o=this._lodMeshes[c];o.material=_;const M=_.uniforms,C=c/(this._lodMeshes.length-1),D=s/(this._lodMeshes.length-1),F=Math.sqrt(C*C-D*D),O=0+C*1.25,j=F*O,{_lodMax:K}=this,J=this._sizeLods[c],N=3*J*(c>K-Zo?c-K+Zo:0),W=4*(this._cubeSize-J);M.envMap.value=i.texture,M.roughness.value=j,M.mipInt.value=K-s,uu(v,N,W,3*J,2*J),f.setRenderTarget(v),f.render(o,qh),M.envMap.value=v.texture,M.roughness.value=0,M.mipInt.value=K-c,uu(i,N,W,3*J,2*J),f.setRenderTarget(i),f.render(o,qh)}_blur(i,s,c,f,v){const _=this._pingPongRenderTarget;this._halfBlur(i,_,s,c,f,"latitudinal",v),this._halfBlur(_,i,c,c,f,"longitudinal",v)}_halfBlur(i,s,c,f,v,_,o){const M=this._renderer,C=this._blurMaterial;_!=="latitudinal"&&_!=="longitudinal"&&hi("blur direction must be either latitudinal or longitudinal!");const D=3,F=this._lodMeshes[f];F.material=C;const O=C.uniforms,j=this._sizeLods[c]-1,K=isFinite(v)?Math.PI/(2*j):2*Math.PI/(2*jl-1),J=v/K,N=isFinite(v)?1+Math.floor(D*J):jl;N>jl&&ei(`sigmaRadians, ${v}, is too large and will clip, as it requested ${N} samples when the maximum is set to ${jl}`);const W=[];let ge=0;for(let Ie=0;Ie<jl;++Ie){const $e=Ie/J,re=Math.exp(-$e*$e/2);W.push(re),Ie===0?ge+=re:Ie<N&&(ge+=2*re)}for(let Ie=0;Ie<W.length;Ie++)W[Ie]=W[Ie]/ge;O.envMap.value=i.texture,O.samples.value=N,O.weights.value=W,O.latitudinal.value=_==="latitudinal",o&&(O.poleAxis.value=o);const{_lodMax:de}=this;O.dTheta.value=K,O.mipInt.value=de-c;const ve=this._sizeLods[f],Me=3*ve*(f>de-Zo?f-de+Zo:0),De=4*(this._cubeSize-ve);uu(s,Me,De,3*ve,2*ve),M.setRenderTarget(s),M.render(F,qh)}}function cC(m){const i=[],s=[],c=[];let f=m;const v=m-Zo+1+yv.length;for(let _=0;_<v;_++){const o=Math.pow(2,f);i.push(o);let M=1/o;_>m-Zo?M=yv[_-m+Zo-1]:_===0&&(M=0),s.push(M);const C=1/(o-2),D=-C,F=1+C,O=[D,D,F,D,F,F,D,D,F,F,D,F],j=6,K=6,J=3,N=2,W=1,ge=new Float32Array(J*K*j),de=new Float32Array(N*K*j),ve=new Float32Array(W*K*j);for(let De=0;De<j;De++){const Ie=De%3*2/3-1,$e=De>2?0:-1,re=[Ie,$e,0,Ie+2/3,$e,0,Ie+2/3,$e+1,0,Ie,$e,0,Ie+2/3,$e+1,0,Ie,$e+1,0];ge.set(re,J*K*De),de.set(O,N*K*De);const fe=[De,De,De,De,De,De];ve.set(fe,W*K*De)}const Me=new ts;Me.setAttribute("position",new mr(ge,J)),Me.setAttribute("uv",new mr(de,N)),Me.setAttribute("faceIndex",new mr(ve,W)),c.push(new Gr(Me,null)),f>Zo&&f--}return{lodMeshes:c,sizeLods:i,sigmas:s}}function bv(m,i,s){const c=new pa(m,i,s);return c.texture.mapping=wp,c.texture.name="PMREM.cubeUv",c.scissorTest=!0,c}function uu(m,i,s,c,f){m.viewport.set(i,s,c,f),m.scissor.set(i,s,c,f)}function uC(m,i,s){return new ya({name:"PMREMGGXConvolution",defines:{GGX_SAMPLES:oC,CUBEUV_TEXEL_WIDTH:1/i,CUBEUV_TEXEL_HEIGHT:1/s,CUBEUV_MAX_MIP:`${m}.0`},uniforms:{envMap:{value:null},roughness:{value:0},mipInt:{value:0}},vertexShader:Ep(),fragmentShader:`

			precision highp float;
			precision highp int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform float roughness;
			uniform float mipInt;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			#define PI 3.14159265359

			// Van der Corput radical inverse
			float radicalInverse_VdC(uint bits) {
				bits = (bits << 16u) | (bits >> 16u);
				bits = ((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);
				bits = ((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);
				bits = ((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);
				bits = ((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);
				return float(bits) * 2.3283064365386963e-10; // / 0x100000000
			}

			// Hammersley sequence
			vec2 hammersley(uint i, uint N) {
				return vec2(float(i) / float(N), radicalInverse_VdC(i));
			}

			// GGX VNDF importance sampling (Eric Heitz 2018)
			// "Sampling the GGX Distribution of Visible Normals"
			// https://jcgt.org/published/0007/04/01/
			vec3 importanceSampleGGX_VNDF(vec2 Xi, vec3 V, float roughness) {
				float alpha = roughness * roughness;

				// Section 3.2: Transform view direction to hemisphere configuration
				vec3 Vh = normalize(vec3(alpha * V.x, alpha * V.y, V.z));

				// Section 4.1: Orthonormal basis
				float lensq = Vh.x * Vh.x + Vh.y * Vh.y;
				vec3 T1 = lensq > 0.0 ? vec3(-Vh.y, Vh.x, 0.0) / sqrt(lensq) : vec3(1.0, 0.0, 0.0);
				vec3 T2 = cross(Vh, T1);

				// Section 4.2: Parameterization of projected area
				float r = sqrt(Xi.x);
				float phi = 2.0 * PI * Xi.y;
				float t1 = r * cos(phi);
				float t2 = r * sin(phi);
				float s = 0.5 * (1.0 + Vh.z);
				t2 = (1.0 - s) * sqrt(1.0 - t1 * t1) + s * t2;

				// Section 4.3: Reprojection onto hemisphere
				vec3 Nh = t1 * T1 + t2 * T2 + sqrt(max(0.0, 1.0 - t1 * t1 - t2 * t2)) * Vh;

				// Section 3.4: Transform back to ellipsoid configuration
				return normalize(vec3(alpha * Nh.x, alpha * Nh.y, max(0.0, Nh.z)));
			}

			void main() {
				vec3 N = normalize(vOutputDirection);
				vec3 V = N; // Assume view direction equals normal for pre-filtering

				vec3 prefilteredColor = vec3(0.0);
				float totalWeight = 0.0;

				// For very low roughness, just sample the environment directly
				if (roughness < 0.001) {
					gl_FragColor = vec4(bilinearCubeUV(envMap, N, mipInt), 1.0);
					return;
				}

				// Tangent space basis for VNDF sampling
				vec3 up = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);
				vec3 tangent = normalize(cross(up, N));
				vec3 bitangent = cross(N, tangent);

				for(uint i = 0u; i < uint(GGX_SAMPLES); i++) {
					vec2 Xi = hammersley(i, uint(GGX_SAMPLES));

					// For PMREM, V = N, so in tangent space V is always (0, 0, 1)
					vec3 H_tangent = importanceSampleGGX_VNDF(Xi, vec3(0.0, 0.0, 1.0), roughness);

					// Transform H back to world space
					vec3 H = normalize(tangent * H_tangent.x + bitangent * H_tangent.y + N * H_tangent.z);
					vec3 L = normalize(2.0 * dot(V, H) * H - V);

					float NdotL = max(dot(N, L), 0.0);

					if(NdotL > 0.0) {
						// Sample environment at fixed mip level
						// VNDF importance sampling handles the distribution filtering
						vec3 sampleColor = bilinearCubeUV(envMap, L, mipInt);

						// Weight by NdotL for the split-sum approximation
						// VNDF PDF naturally accounts for the visible microfacet distribution
						prefilteredColor += sampleColor * NdotL;
						totalWeight += NdotL;
					}
				}

				if (totalWeight > 0.0) {
					prefilteredColor = prefilteredColor / totalWeight;
				}

				gl_FragColor = vec4(prefilteredColor, 1.0);
			}
		`,blending:io,depthTest:!1,depthWrite:!1})}function hC(m,i,s){const c=new Float32Array(jl),f=new We(0,1,0);return new ya({name:"SphericalGaussianBlur",defines:{n:jl,CUBEUV_TEXEL_WIDTH:1/i,CUBEUV_TEXEL_HEIGHT:1/s,CUBEUV_MAX_MIP:`${m}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:c},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:f}},vertexShader:Ep(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:io,depthTest:!1,depthWrite:!1})}function wv(){return new ya({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Ep(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:io,depthTest:!1,depthWrite:!1})}function Tv(){return new ya({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Ep(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:io,depthTest:!1,depthWrite:!1})}function Ep(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function dC(m){let i=new WeakMap,s=null;function c(o){if(o&&o.isTexture){const M=o.mapping,C=M===$g||M===Yg,D=M===Zl||M===gu;if(C||D){let F=i.get(o);const O=F!==void 0?F.texture.pmremVersion:0;if(o.isRenderTargetTexture&&o.pmremVersion!==O)return s===null&&(s=new vv(m)),F=C?s.fromEquirectangular(o,F):s.fromCubemap(o,F),F.texture.pmremVersion=o.pmremVersion,i.set(o,F),F.texture;if(F!==void 0)return F.texture;{const j=o.image;return C&&j&&j.height>0||D&&j&&f(j)?(s===null&&(s=new vv(m)),F=C?s.fromEquirectangular(o):s.fromCubemap(o),F.texture.pmremVersion=o.pmremVersion,i.set(o,F),o.addEventListener("dispose",v),F.texture):null}}}return o}function f(o){let M=0;const C=6;for(let D=0;D<C;D++)o[D]!==void 0&&M++;return M===C}function v(o){const M=o.target;M.removeEventListener("dispose",v);const C=i.get(M);C!==void 0&&(i.delete(M),C.dispose())}function _(){i=new WeakMap,s!==null&&(s.dispose(),s=null)}return{get:c,dispose:_}}function fC(m){const i={};function s(c){if(i[c]!==void 0)return i[c];const f=m.getExtension(c);return i[c]=f,f}return{has:function(c){return s(c)!==null},init:function(){s("EXT_color_buffer_float"),s("WEBGL_clip_cull_distance"),s("OES_texture_float_linear"),s("EXT_color_buffer_half_float"),s("WEBGL_multisampled_render_to_texture"),s("WEBGL_render_shared_exponent")},get:function(c){const f=s(c);return f===null&&od("WebGLRenderer: "+c+" extension not supported."),f}}}function pC(m,i,s,c){const f={},v=new WeakMap;function _(F){const O=F.target;O.index!==null&&i.remove(O.index);for(const K in O.attributes)i.remove(O.attributes[K]);O.removeEventListener("dispose",_),delete f[O.id];const j=v.get(O);j&&(i.remove(j),v.delete(O)),c.releaseStatesOfGeometry(O),O.isInstancedBufferGeometry===!0&&delete O._maxInstanceCount,s.memory.geometries--}function o(F,O){return f[O.id]===!0||(O.addEventListener("dispose",_),f[O.id]=!0,s.memory.geometries++),O}function M(F){const O=F.attributes;for(const j in O)i.update(O[j],m.ARRAY_BUFFER)}function C(F){const O=[],j=F.index,K=F.attributes.position;let J=0;if(j!==null){const ge=j.array;J=j.version;for(let de=0,ve=ge.length;de<ve;de+=3){const Me=ge[de+0],De=ge[de+1],Ie=ge[de+2];O.push(Me,De,De,Ie,Ie,Me)}}else if(K!==void 0){const ge=K.array;J=K.version;for(let de=0,ve=ge.length/3-1;de<ve;de+=3){const Me=de+0,De=de+1,Ie=de+2;O.push(Me,De,De,Ie,Ie,Me)}}else return;const N=new(Ib(O)?zb:Fb)(O,1);N.version=J;const W=v.get(F);W&&i.remove(W),v.set(F,N)}function D(F){const O=v.get(F);if(O){const j=F.index;j!==null&&O.version<j.version&&C(F)}else C(F);return v.get(F)}return{get:o,update:M,getWireframeAttribute:D}}function mC(m,i,s){let c;function f(O){c=O}let v,_;function o(O){v=O.type,_=O.bytesPerElement}function M(O,j){m.drawElements(c,j,v,O*_),s.update(j,c,1)}function C(O,j,K){K!==0&&(m.drawElementsInstanced(c,j,v,O*_,K),s.update(j,c,K))}function D(O,j,K){if(K===0)return;i.get("WEBGL_multi_draw").multiDrawElementsWEBGL(c,j,0,v,O,0,K);let N=0;for(let W=0;W<K;W++)N+=j[W];s.update(N,c,1)}function F(O,j,K,J){if(K===0)return;const N=i.get("WEBGL_multi_draw");if(N===null)for(let W=0;W<O.length;W++)C(O[W]/_,j[W],J[W]);else{N.multiDrawElementsInstancedWEBGL(c,j,0,v,O,0,J,0,K);let W=0;for(let ge=0;ge<K;ge++)W+=j[ge]*J[ge];s.update(W,c,1)}}this.setMode=f,this.setIndex=o,this.render=M,this.renderInstances=C,this.renderMultiDraw=D,this.renderMultiDrawInstances=F}function gC(m){const i={geometries:0,textures:0},s={frame:0,calls:0,triangles:0,points:0,lines:0};function c(v,_,o){switch(s.calls++,_){case m.TRIANGLES:s.triangles+=o*(v/3);break;case m.LINES:s.lines+=o*(v/2);break;case m.LINE_STRIP:s.lines+=o*(v-1);break;case m.LINE_LOOP:s.lines+=o*v;break;case m.POINTS:s.points+=o*v;break;default:hi("WebGLInfo: Unknown draw mode:",_);break}}function f(){s.calls=0,s.triangles=0,s.points=0,s.lines=0}return{memory:i,render:s,programs:null,autoReset:!0,reset:f,update:c}}function _C(m,i,s){const c=new WeakMap,f=new wn;function v(_,o,M){const C=_.morphTargetInfluences,D=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,F=D!==void 0?D.length:0;let O=c.get(o);if(O===void 0||O.count!==F){let fe=function(){$e.dispose(),c.delete(o),o.removeEventListener("dispose",fe)};var j=fe;O!==void 0&&O.texture.dispose();const K=o.morphAttributes.position!==void 0,J=o.morphAttributes.normal!==void 0,N=o.morphAttributes.color!==void 0,W=o.morphAttributes.position||[],ge=o.morphAttributes.normal||[],de=o.morphAttributes.color||[];let ve=0;K===!0&&(ve=1),J===!0&&(ve=2),N===!0&&(ve=3);let Me=o.attributes.position.count*ve,De=1;Me>i.maxTextureSize&&(De=Math.ceil(Me/i.maxTextureSize),Me=i.maxTextureSize);const Ie=new Float32Array(Me*De*4*F),$e=new Rb(Ie,Me,De,F);$e.type=Cs,$e.needsUpdate=!0;const re=ve*4;for(let Oe=0;Oe<F;Oe++){const tt=W[Oe],Qe=ge[Oe],pt=de[Oe],ct=Me*De*4*Oe;for(let nt=0;nt<tt.count;nt++){const Je=nt*re;K===!0&&(f.fromBufferAttribute(tt,nt),Ie[ct+Je+0]=f.x,Ie[ct+Je+1]=f.y,Ie[ct+Je+2]=f.z,Ie[ct+Je+3]=0),J===!0&&(f.fromBufferAttribute(Qe,nt),Ie[ct+Je+4]=f.x,Ie[ct+Je+5]=f.y,Ie[ct+Je+6]=f.z,Ie[ct+Je+7]=0),N===!0&&(f.fromBufferAttribute(pt,nt),Ie[ct+Je+8]=f.x,Ie[ct+Je+9]=f.y,Ie[ct+Je+10]=f.z,Ie[ct+Je+11]=pt.itemSize===4?f.w:1)}}O={count:F,texture:$e,size:new Bi(Me,De)},c.set(o,O),o.addEventListener("dispose",fe)}if(_.isInstancedMesh===!0&&_.morphTexture!==null)M.getUniforms().setValue(m,"morphTexture",_.morphTexture,s);else{let K=0;for(let N=0;N<C.length;N++)K+=C[N];const J=o.morphTargetsRelative?1:1-K;M.getUniforms().setValue(m,"morphTargetBaseInfluence",J),M.getUniforms().setValue(m,"morphTargetInfluences",C)}M.getUniforms().setValue(m,"morphTargetsTexture",O.texture,s),M.getUniforms().setValue(m,"morphTargetsTextureSize",O.size)}return{update:v}}function yC(m,i,s,c){let f=new WeakMap;function v(M){const C=c.render.frame,D=M.geometry,F=i.get(M,D);if(f.get(F)!==C&&(i.update(F),f.set(F,C)),M.isInstancedMesh&&(M.hasEventListener("dispose",o)===!1&&M.addEventListener("dispose",o),f.get(M)!==C&&(s.update(M.instanceMatrix,m.ARRAY_BUFFER),M.instanceColor!==null&&s.update(M.instanceColor,m.ARRAY_BUFFER),f.set(M,C))),M.isSkinnedMesh){const O=M.skeleton;f.get(O)!==C&&(O.update(),f.set(O,C))}return F}function _(){f=new WeakMap}function o(M){const C=M.target;C.removeEventListener("dispose",o),s.remove(C.instanceMatrix),C.instanceColor!==null&&s.remove(C.instanceColor)}return{update:v,dispose:_}}const xC={[fb]:"LINEAR_TONE_MAPPING",[pb]:"REINHARD_TONE_MAPPING",[mb]:"CINEON_TONE_MAPPING",[gb]:"ACES_FILMIC_TONE_MAPPING",[yb]:"AGX_TONE_MAPPING",[xb]:"NEUTRAL_TONE_MAPPING",[_b]:"CUSTOM_TONE_MAPPING"};function vC(m,i,s,c,f){const v=new pa(i,s,{type:m,depthBuffer:c,stencilBuffer:f}),_=new pa(i,s,{type:so,depthBuffer:!1,stencilBuffer:!1}),o=new ts;o.setAttribute("position",new es([-1,3,0,-1,-1,0,3,-1,0],3)),o.setAttribute("uv",new es([0,2,0,0,2,0],2));const M=new GM({uniforms:{tDiffuse:{value:null}},vertexShader:`
			precision highp float;

			uniform mat4 modelViewMatrix;
			uniform mat4 projectionMatrix;

			attribute vec3 position;
			attribute vec2 uv;

			varying vec2 vUv;

			void main() {
				vUv = uv;
				gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			}`,fragmentShader:`
			precision highp float;

			uniform sampler2D tDiffuse;

			varying vec2 vUv;

			#include <tonemapping_pars_fragment>
			#include <colorspace_pars_fragment>

			void main() {
				gl_FragColor = texture2D( tDiffuse, vUv );

				#ifdef LINEAR_TONE_MAPPING
					gl_FragColor.rgb = LinearToneMapping( gl_FragColor.rgb );
				#elif defined( REINHARD_TONE_MAPPING )
					gl_FragColor.rgb = ReinhardToneMapping( gl_FragColor.rgb );
				#elif defined( CINEON_TONE_MAPPING )
					gl_FragColor.rgb = CineonToneMapping( gl_FragColor.rgb );
				#elif defined( ACES_FILMIC_TONE_MAPPING )
					gl_FragColor.rgb = ACESFilmicToneMapping( gl_FragColor.rgb );
				#elif defined( AGX_TONE_MAPPING )
					gl_FragColor.rgb = AgXToneMapping( gl_FragColor.rgb );
				#elif defined( NEUTRAL_TONE_MAPPING )
					gl_FragColor.rgb = NeutralToneMapping( gl_FragColor.rgb );
				#elif defined( CUSTOM_TONE_MAPPING )
					gl_FragColor.rgb = CustomToneMapping( gl_FragColor.rgb );
				#endif

				#ifdef SRGB_TRANSFER
					gl_FragColor = sRGBTransferOETF( gl_FragColor );
				#endif
			}`,depthTest:!1,depthWrite:!1}),C=new Gr(o,M),D=new Mp(-1,1,1,-1,0,1);let F=null,O=null,j=!1,K,J=null,N=[],W=!1;this.setSize=function(ge,de){v.setSize(ge,de),_.setSize(ge,de);for(let ve=0;ve<N.length;ve++){const Me=N[ve];Me.setSize&&Me.setSize(ge,de)}},this.setEffects=function(ge){N=ge,W=N.length>0&&N[0].isRenderPass===!0;const de=v.width,ve=v.height;for(let Me=0;Me<N.length;Me++){const De=N[Me];De.setSize&&De.setSize(de,ve)}},this.begin=function(ge,de){if(j||ge.toneMapping===fa&&N.length===0)return!1;if(J=de,de!==null){const ve=de.width,Me=de.height;(v.width!==ve||v.height!==Me)&&this.setSize(ve,Me)}return W===!1&&ge.setRenderTarget(v),K=ge.toneMapping,ge.toneMapping=fa,!0},this.hasRenderPass=function(){return W},this.end=function(ge,de){ge.toneMapping=K,j=!0;let ve=v,Me=_;for(let De=0;De<N.length;De++){const Ie=N[De];if(Ie.enabled!==!1&&(Ie.render(ge,Me,ve,de),Ie.needsSwap!==!1)){const $e=ve;ve=Me,Me=$e}}if(F!==ge.outputColorSpace||O!==ge.toneMapping){F=ge.outputColorSpace,O=ge.toneMapping,M.defines={},Ni.getTransfer(F)===en&&(M.defines.SRGB_TRANSFER="");const De=xC[O];De&&(M.defines[De]=""),M.needsUpdate=!0}M.uniforms.tDiffuse.value=ve.texture,ge.setRenderTarget(J),ge.render(C,D),J=null,j=!1},this.isCompositing=function(){return j},this.dispose=function(){v.dispose(),_.dispose(),o.dispose(),M.dispose()}}const Zb=new pr,F_=new ld(1,1),$b=new Rb,Yb=new uM,Kb=new Nb,Sv=[],Mv=[],Ev=new Float32Array(16),Av=new Float32Array(9),Cv=new Float32Array(4);function Cu(m,i,s){const c=m[0];if(c<=0||c>0)return m;const f=i*s;let v=Sv[f];if(v===void 0&&(v=new Float32Array(f),Sv[f]=v),i!==0){c.toArray(v,0);for(let _=1,o=0;_!==i;++_)o+=s,m[_].toArray(v,o)}return v}function rr(m,i){if(m.length!==i.length)return!1;for(let s=0,c=m.length;s<c;s++)if(m[s]!==i[s])return!1;return!0}function sr(m,i){for(let s=0,c=i.length;s<c;s++)m[s]=i[s]}function Ap(m,i){let s=Mv[i];s===void 0&&(s=new Int32Array(i),Mv[i]=s);for(let c=0;c!==i;++c)s[c]=m.allocateTextureUnit();return s}function bC(m,i){const s=this.cache;s[0]!==i&&(m.uniform1f(this.addr,i),s[0]=i)}function wC(m,i){const s=this.cache;if(i.x!==void 0)(s[0]!==i.x||s[1]!==i.y)&&(m.uniform2f(this.addr,i.x,i.y),s[0]=i.x,s[1]=i.y);else{if(rr(s,i))return;m.uniform2fv(this.addr,i),sr(s,i)}}function TC(m,i){const s=this.cache;if(i.x!==void 0)(s[0]!==i.x||s[1]!==i.y||s[2]!==i.z)&&(m.uniform3f(this.addr,i.x,i.y,i.z),s[0]=i.x,s[1]=i.y,s[2]=i.z);else if(i.r!==void 0)(s[0]!==i.r||s[1]!==i.g||s[2]!==i.b)&&(m.uniform3f(this.addr,i.r,i.g,i.b),s[0]=i.r,s[1]=i.g,s[2]=i.b);else{if(rr(s,i))return;m.uniform3fv(this.addr,i),sr(s,i)}}function SC(m,i){const s=this.cache;if(i.x!==void 0)(s[0]!==i.x||s[1]!==i.y||s[2]!==i.z||s[3]!==i.w)&&(m.uniform4f(this.addr,i.x,i.y,i.z,i.w),s[0]=i.x,s[1]=i.y,s[2]=i.z,s[3]=i.w);else{if(rr(s,i))return;m.uniform4fv(this.addr,i),sr(s,i)}}function MC(m,i){const s=this.cache,c=i.elements;if(c===void 0){if(rr(s,i))return;m.uniformMatrix2fv(this.addr,!1,i),sr(s,i)}else{if(rr(s,c))return;Cv.set(c),m.uniformMatrix2fv(this.addr,!1,Cv),sr(s,c)}}function EC(m,i){const s=this.cache,c=i.elements;if(c===void 0){if(rr(s,i))return;m.uniformMatrix3fv(this.addr,!1,i),sr(s,i)}else{if(rr(s,c))return;Av.set(c),m.uniformMatrix3fv(this.addr,!1,Av),sr(s,c)}}function AC(m,i){const s=this.cache,c=i.elements;if(c===void 0){if(rr(s,i))return;m.uniformMatrix4fv(this.addr,!1,i),sr(s,i)}else{if(rr(s,c))return;Ev.set(c),m.uniformMatrix4fv(this.addr,!1,Ev),sr(s,c)}}function CC(m,i){const s=this.cache;s[0]!==i&&(m.uniform1i(this.addr,i),s[0]=i)}function PC(m,i){const s=this.cache;if(i.x!==void 0)(s[0]!==i.x||s[1]!==i.y)&&(m.uniform2i(this.addr,i.x,i.y),s[0]=i.x,s[1]=i.y);else{if(rr(s,i))return;m.uniform2iv(this.addr,i),sr(s,i)}}function IC(m,i){const s=this.cache;if(i.x!==void 0)(s[0]!==i.x||s[1]!==i.y||s[2]!==i.z)&&(m.uniform3i(this.addr,i.x,i.y,i.z),s[0]=i.x,s[1]=i.y,s[2]=i.z);else{if(rr(s,i))return;m.uniform3iv(this.addr,i),sr(s,i)}}function RC(m,i){const s=this.cache;if(i.x!==void 0)(s[0]!==i.x||s[1]!==i.y||s[2]!==i.z||s[3]!==i.w)&&(m.uniform4i(this.addr,i.x,i.y,i.z,i.w),s[0]=i.x,s[1]=i.y,s[2]=i.z,s[3]=i.w);else{if(rr(s,i))return;m.uniform4iv(this.addr,i),sr(s,i)}}function DC(m,i){const s=this.cache;s[0]!==i&&(m.uniform1ui(this.addr,i),s[0]=i)}function LC(m,i){const s=this.cache;if(i.x!==void 0)(s[0]!==i.x||s[1]!==i.y)&&(m.uniform2ui(this.addr,i.x,i.y),s[0]=i.x,s[1]=i.y);else{if(rr(s,i))return;m.uniform2uiv(this.addr,i),sr(s,i)}}function FC(m,i){const s=this.cache;if(i.x!==void 0)(s[0]!==i.x||s[1]!==i.y||s[2]!==i.z)&&(m.uniform3ui(this.addr,i.x,i.y,i.z),s[0]=i.x,s[1]=i.y,s[2]=i.z);else{if(rr(s,i))return;m.uniform3uiv(this.addr,i),sr(s,i)}}function zC(m,i){const s=this.cache;if(i.x!==void 0)(s[0]!==i.x||s[1]!==i.y||s[2]!==i.z||s[3]!==i.w)&&(m.uniform4ui(this.addr,i.x,i.y,i.z,i.w),s[0]=i.x,s[1]=i.y,s[2]=i.z,s[3]=i.w);else{if(rr(s,i))return;m.uniform4uiv(this.addr,i),sr(s,i)}}function OC(m,i,s){const c=this.cache,f=s.allocateTextureUnit();c[0]!==f&&(m.uniform1i(this.addr,f),c[0]=f);let v;this.type===m.SAMPLER_2D_SHADOW?(F_.compareFunction=s.isReversedDepthBuffer()?J_:K_,v=F_):v=Zb,s.setTexture2D(i||v,f)}function NC(m,i,s){const c=this.cache,f=s.allocateTextureUnit();c[0]!==f&&(m.uniform1i(this.addr,f),c[0]=f),s.setTexture3D(i||Yb,f)}function BC(m,i,s){const c=this.cache,f=s.allocateTextureUnit();c[0]!==f&&(m.uniform1i(this.addr,f),c[0]=f),s.setTextureCube(i||Kb,f)}function kC(m,i,s){const c=this.cache,f=s.allocateTextureUnit();c[0]!==f&&(m.uniform1i(this.addr,f),c[0]=f),s.setTexture2DArray(i||$b,f)}function UC(m){switch(m){case 5126:return bC;case 35664:return wC;case 35665:return TC;case 35666:return SC;case 35674:return MC;case 35675:return EC;case 35676:return AC;case 5124:case 35670:return CC;case 35667:case 35671:return PC;case 35668:case 35672:return IC;case 35669:case 35673:return RC;case 5125:return DC;case 36294:return LC;case 36295:return FC;case 36296:return zC;case 35678:case 36198:case 36298:case 36306:case 35682:return OC;case 35679:case 36299:case 36307:return NC;case 35680:case 36300:case 36308:case 36293:return BC;case 36289:case 36303:case 36311:case 36292:return kC}}function VC(m,i){m.uniform1fv(this.addr,i)}function GC(m,i){const s=Cu(i,this.size,2);m.uniform2fv(this.addr,s)}function HC(m,i){const s=Cu(i,this.size,3);m.uniform3fv(this.addr,s)}function jC(m,i){const s=Cu(i,this.size,4);m.uniform4fv(this.addr,s)}function WC(m,i){const s=Cu(i,this.size,4);m.uniformMatrix2fv(this.addr,!1,s)}function qC(m,i){const s=Cu(i,this.size,9);m.uniformMatrix3fv(this.addr,!1,s)}function XC(m,i){const s=Cu(i,this.size,16);m.uniformMatrix4fv(this.addr,!1,s)}function ZC(m,i){m.uniform1iv(this.addr,i)}function $C(m,i){m.uniform2iv(this.addr,i)}function YC(m,i){m.uniform3iv(this.addr,i)}function KC(m,i){m.uniform4iv(this.addr,i)}function JC(m,i){m.uniform1uiv(this.addr,i)}function QC(m,i){m.uniform2uiv(this.addr,i)}function eP(m,i){m.uniform3uiv(this.addr,i)}function tP(m,i){m.uniform4uiv(this.addr,i)}function iP(m,i,s){const c=this.cache,f=i.length,v=Ap(s,f);rr(c,v)||(m.uniform1iv(this.addr,v),sr(c,v));let _;this.type===m.SAMPLER_2D_SHADOW?_=F_:_=Zb;for(let o=0;o!==f;++o)s.setTexture2D(i[o]||_,v[o])}function nP(m,i,s){const c=this.cache,f=i.length,v=Ap(s,f);rr(c,v)||(m.uniform1iv(this.addr,v),sr(c,v));for(let _=0;_!==f;++_)s.setTexture3D(i[_]||Yb,v[_])}function rP(m,i,s){const c=this.cache,f=i.length,v=Ap(s,f);rr(c,v)||(m.uniform1iv(this.addr,v),sr(c,v));for(let _=0;_!==f;++_)s.setTextureCube(i[_]||Kb,v[_])}function sP(m,i,s){const c=this.cache,f=i.length,v=Ap(s,f);rr(c,v)||(m.uniform1iv(this.addr,v),sr(c,v));for(let _=0;_!==f;++_)s.setTexture2DArray(i[_]||$b,v[_])}function aP(m){switch(m){case 5126:return VC;case 35664:return GC;case 35665:return HC;case 35666:return jC;case 35674:return WC;case 35675:return qC;case 35676:return XC;case 5124:case 35670:return ZC;case 35667:case 35671:return $C;case 35668:case 35672:return YC;case 35669:case 35673:return KC;case 5125:return JC;case 36294:return QC;case 36295:return eP;case 36296:return tP;case 35678:case 36198:case 36298:case 36306:case 35682:return iP;case 35679:case 36299:case 36307:return nP;case 35680:case 36300:case 36308:case 36293:return rP;case 36289:case 36303:case 36311:case 36292:return sP}}class oP{constructor(i,s,c){this.id=i,this.addr=c,this.cache=[],this.type=s.type,this.setValue=UC(s.type)}}class lP{constructor(i,s,c){this.id=i,this.addr=c,this.cache=[],this.type=s.type,this.size=s.size,this.setValue=aP(s.type)}}class cP{constructor(i){this.id=i,this.seq=[],this.map={}}setValue(i,s,c){const f=this.seq;for(let v=0,_=f.length;v!==_;++v){const o=f[v];o.setValue(i,s[o.id],c)}}}const Rg=/(\w+)(\])?(\[|\.)?/g;function Pv(m,i){m.seq.push(i),m.map[i.id]=i}function uP(m,i,s){const c=m.name,f=c.length;for(Rg.lastIndex=0;;){const v=Rg.exec(c),_=Rg.lastIndex;let o=v[1];const M=v[2]==="]",C=v[3];if(M&&(o=o|0),C===void 0||C==="["&&_+2===f){Pv(s,C===void 0?new oP(o,m,i):new lP(o,m,i));break}else{let F=s.map[o];F===void 0&&(F=new cP(o),Pv(s,F)),s=F}}}class pp{constructor(i,s){this.seq=[],this.map={};const c=i.getProgramParameter(s,i.ACTIVE_UNIFORMS);for(let _=0;_<c;++_){const o=i.getActiveUniform(s,_),M=i.getUniformLocation(s,o.name);uP(o,M,this)}const f=[],v=[];for(const _ of this.seq)_.type===i.SAMPLER_2D_SHADOW||_.type===i.SAMPLER_CUBE_SHADOW||_.type===i.SAMPLER_2D_ARRAY_SHADOW?f.push(_):v.push(_);f.length>0&&(this.seq=f.concat(v))}setValue(i,s,c,f){const v=this.map[s];v!==void 0&&v.setValue(i,c,f)}setOptional(i,s,c){const f=s[c];f!==void 0&&this.setValue(i,c,f)}static upload(i,s,c,f){for(let v=0,_=s.length;v!==_;++v){const o=s[v],M=c[o.id];M.needsUpdate!==!1&&o.setValue(i,M.value,f)}}static seqWithValue(i,s){const c=[];for(let f=0,v=i.length;f!==v;++f){const _=i[f];_.id in s&&c.push(_)}return c}}function Iv(m,i,s){const c=m.createShader(i);return m.shaderSource(c,s),m.compileShader(c),c}const hP=37297;let dP=0;function fP(m,i){const s=m.split(`
`),c=[],f=Math.max(i-6,0),v=Math.min(i+6,s.length);for(let _=f;_<v;_++){const o=_+1;c.push(`${o===i?">":" "} ${o}: ${s[_]}`)}return c.join(`
`)}const Rv=new wi;function pP(m){Ni._getMatrix(Rv,Ni.workingColorSpace,m);const i=`mat3( ${Rv.elements.map(s=>s.toFixed(4))} )`;switch(Ni.getTransfer(m)){case gp:return[i,"LinearTransferOETF"];case en:return[i,"sRGBTransferOETF"];default:return ei("WebGLProgram: Unsupported color space: ",m),[i,"LinearTransferOETF"]}}function Dv(m,i,s){const c=m.getShaderParameter(i,m.COMPILE_STATUS),v=(m.getShaderInfoLog(i)||"").trim();if(c&&v==="")return"";const _=/ERROR: 0:(\d+)/.exec(v);if(_){const o=parseInt(_[1]);return s.toUpperCase()+`

`+v+`

`+fP(m.getShaderSource(i),o)}else return v}function mP(m,i){const s=pP(i);return[`vec4 ${m}( vec4 value ) {`,`	return ${s[1]}( vec4( value.rgb * ${s[0]}, value.a ) );`,"}"].join(`
`)}const gP={[fb]:"Linear",[pb]:"Reinhard",[mb]:"Cineon",[gb]:"ACESFilmic",[yb]:"AgX",[xb]:"Neutral",[_b]:"Custom"};function _P(m,i){const s=gP[i];return s===void 0?(ei("WebGLProgram: Unsupported toneMapping:",i),"vec3 "+m+"( vec3 color ) { return LinearToneMapping( color ); }"):"vec3 "+m+"( vec3 color ) { return "+s+"ToneMapping( color ); }"}const ap=new We;function yP(){Ni.getLuminanceCoefficients(ap);const m=ap.x.toFixed(4),i=ap.y.toFixed(4),s=ap.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${m}, ${i}, ${s} );`,"	return dot( weights, rgb );","}"].join(`
`)}function xP(m){return[m.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",m.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Kh).join(`
`)}function vP(m){const i=[];for(const s in m){const c=m[s];c!==!1&&i.push("#define "+s+" "+c)}return i.join(`
`)}function bP(m,i){const s={},c=m.getProgramParameter(i,m.ACTIVE_ATTRIBUTES);for(let f=0;f<c;f++){const v=m.getActiveAttrib(i,f),_=v.name;let o=1;v.type===m.FLOAT_MAT2&&(o=2),v.type===m.FLOAT_MAT3&&(o=3),v.type===m.FLOAT_MAT4&&(o=4),s[_]={type:v.type,location:m.getAttribLocation(i,_),locationSize:o}}return s}function Kh(m){return m!==""}function Lv(m,i){const s=i.numSpotLightShadows+i.numSpotLightMaps-i.numSpotLightShadowsWithMaps;return m.replace(/NUM_DIR_LIGHTS/g,i.numDirLights).replace(/NUM_SPOT_LIGHTS/g,i.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,i.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,s).replace(/NUM_RECT_AREA_LIGHTS/g,i.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,i.numPointLights).replace(/NUM_HEMI_LIGHTS/g,i.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,i.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,i.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,i.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,i.numPointLightShadows)}function Fv(m,i){return m.replace(/NUM_CLIPPING_PLANES/g,i.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,i.numClippingPlanes-i.numClipIntersection)}const wP=/^[ \t]*#include +<([\w\d./]+)>/gm;function z_(m){return m.replace(wP,SP)}const TP=new Map;function SP(m,i){let s=Mi[i];if(s===void 0){const c=TP.get(i);if(c!==void 0)s=Mi[c],ei('WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',i,c);else throw new Error("Can not resolve #include <"+i+">")}return z_(s)}const MP=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function zv(m){return m.replace(MP,EP)}function EP(m,i,s,c){let f="";for(let v=parseInt(i);v<parseInt(s);v++)f+=c.replace(/\[\s*i\s*\]/g,"[ "+v+" ]").replace(/UNROLLED_LOOP_INDEX/g,v);return f}function Ov(m){let i=`precision ${m.precision} float;
	precision ${m.precision} int;
	precision ${m.precision} sampler2D;
	precision ${m.precision} samplerCube;
	precision ${m.precision} sampler3D;
	precision ${m.precision} sampler2DArray;
	precision ${m.precision} sampler2DShadow;
	precision ${m.precision} samplerCubeShadow;
	precision ${m.precision} sampler2DArrayShadow;
	precision ${m.precision} isampler2D;
	precision ${m.precision} isampler3D;
	precision ${m.precision} isamplerCube;
	precision ${m.precision} isampler2DArray;
	precision ${m.precision} usampler2D;
	precision ${m.precision} usampler3D;
	precision ${m.precision} usamplerCube;
	precision ${m.precision} usampler2DArray;
	`;return m.precision==="highp"?i+=`
#define HIGH_PRECISION`:m.precision==="mediump"?i+=`
#define MEDIUM_PRECISION`:m.precision==="lowp"&&(i+=`
#define LOW_PRECISION`),i}const AP={[lp]:"SHADOWMAP_TYPE_PCF",[$h]:"SHADOWMAP_TYPE_VSM"};function CP(m){return AP[m.shadowMapType]||"SHADOWMAP_TYPE_BASIC"}const PP={[Zl]:"ENVMAP_TYPE_CUBE",[gu]:"ENVMAP_TYPE_CUBE",[wp]:"ENVMAP_TYPE_CUBE_UV"};function IP(m){return m.envMap===!1?"ENVMAP_TYPE_CUBE":PP[m.envMapMode]||"ENVMAP_TYPE_CUBE"}const RP={[gu]:"ENVMAP_MODE_REFRACTION"};function DP(m){return m.envMap===!1?"ENVMAP_MODE_REFLECTION":RP[m.envMapMode]||"ENVMAP_MODE_REFLECTION"}const LP={[db]:"ENVMAP_BLENDING_MULTIPLY",[ES]:"ENVMAP_BLENDING_MIX",[AS]:"ENVMAP_BLENDING_ADD"};function FP(m){return m.envMap===!1?"ENVMAP_BLENDING_NONE":LP[m.combine]||"ENVMAP_BLENDING_NONE"}function zP(m){const i=m.envMapCubeUVHeight;if(i===null)return null;const s=Math.log2(i)-2,c=1/i;return{texelWidth:1/(3*Math.max(Math.pow(2,s),112)),texelHeight:c,maxMip:s}}function OP(m,i,s,c){const f=m.getContext(),v=s.defines;let _=s.vertexShader,o=s.fragmentShader;const M=CP(s),C=IP(s),D=DP(s),F=FP(s),O=zP(s),j=xP(s),K=vP(v),J=f.createProgram();let N,W,ge=s.glslVersion?"#version "+s.glslVersion+`
`:"";s.isRawShaderMaterial?(N=["#define SHADER_TYPE "+s.shaderType,"#define SHADER_NAME "+s.shaderName,K].filter(Kh).join(`
`),N.length>0&&(N+=`
`),W=["#define SHADER_TYPE "+s.shaderType,"#define SHADER_NAME "+s.shaderName,K].filter(Kh).join(`
`),W.length>0&&(W+=`
`)):(N=[Ov(s),"#define SHADER_TYPE "+s.shaderType,"#define SHADER_NAME "+s.shaderName,K,s.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",s.batching?"#define USE_BATCHING":"",s.batchingColor?"#define USE_BATCHING_COLOR":"",s.instancing?"#define USE_INSTANCING":"",s.instancingColor?"#define USE_INSTANCING_COLOR":"",s.instancingMorph?"#define USE_INSTANCING_MORPH":"",s.useFog&&s.fog?"#define USE_FOG":"",s.useFog&&s.fogExp2?"#define FOG_EXP2":"",s.map?"#define USE_MAP":"",s.envMap?"#define USE_ENVMAP":"",s.envMap?"#define "+D:"",s.lightMap?"#define USE_LIGHTMAP":"",s.aoMap?"#define USE_AOMAP":"",s.bumpMap?"#define USE_BUMPMAP":"",s.normalMap?"#define USE_NORMALMAP":"",s.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",s.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",s.displacementMap?"#define USE_DISPLACEMENTMAP":"",s.emissiveMap?"#define USE_EMISSIVEMAP":"",s.anisotropy?"#define USE_ANISOTROPY":"",s.anisotropyMap?"#define USE_ANISOTROPYMAP":"",s.clearcoatMap?"#define USE_CLEARCOATMAP":"",s.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",s.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",s.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",s.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",s.specularMap?"#define USE_SPECULARMAP":"",s.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",s.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",s.roughnessMap?"#define USE_ROUGHNESSMAP":"",s.metalnessMap?"#define USE_METALNESSMAP":"",s.alphaMap?"#define USE_ALPHAMAP":"",s.alphaHash?"#define USE_ALPHAHASH":"",s.transmission?"#define USE_TRANSMISSION":"",s.transmissionMap?"#define USE_TRANSMISSIONMAP":"",s.thicknessMap?"#define USE_THICKNESSMAP":"",s.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",s.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",s.mapUv?"#define MAP_UV "+s.mapUv:"",s.alphaMapUv?"#define ALPHAMAP_UV "+s.alphaMapUv:"",s.lightMapUv?"#define LIGHTMAP_UV "+s.lightMapUv:"",s.aoMapUv?"#define AOMAP_UV "+s.aoMapUv:"",s.emissiveMapUv?"#define EMISSIVEMAP_UV "+s.emissiveMapUv:"",s.bumpMapUv?"#define BUMPMAP_UV "+s.bumpMapUv:"",s.normalMapUv?"#define NORMALMAP_UV "+s.normalMapUv:"",s.displacementMapUv?"#define DISPLACEMENTMAP_UV "+s.displacementMapUv:"",s.metalnessMapUv?"#define METALNESSMAP_UV "+s.metalnessMapUv:"",s.roughnessMapUv?"#define ROUGHNESSMAP_UV "+s.roughnessMapUv:"",s.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+s.anisotropyMapUv:"",s.clearcoatMapUv?"#define CLEARCOATMAP_UV "+s.clearcoatMapUv:"",s.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+s.clearcoatNormalMapUv:"",s.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+s.clearcoatRoughnessMapUv:"",s.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+s.iridescenceMapUv:"",s.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+s.iridescenceThicknessMapUv:"",s.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+s.sheenColorMapUv:"",s.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+s.sheenRoughnessMapUv:"",s.specularMapUv?"#define SPECULARMAP_UV "+s.specularMapUv:"",s.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+s.specularColorMapUv:"",s.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+s.specularIntensityMapUv:"",s.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+s.transmissionMapUv:"",s.thicknessMapUv?"#define THICKNESSMAP_UV "+s.thicknessMapUv:"",s.vertexTangents&&s.flatShading===!1?"#define USE_TANGENT":"",s.vertexColors?"#define USE_COLOR":"",s.vertexAlphas?"#define USE_COLOR_ALPHA":"",s.vertexUv1s?"#define USE_UV1":"",s.vertexUv2s?"#define USE_UV2":"",s.vertexUv3s?"#define USE_UV3":"",s.pointsUvs?"#define USE_POINTS_UV":"",s.flatShading?"#define FLAT_SHADED":"",s.skinning?"#define USE_SKINNING":"",s.morphTargets?"#define USE_MORPHTARGETS":"",s.morphNormals&&s.flatShading===!1?"#define USE_MORPHNORMALS":"",s.morphColors?"#define USE_MORPHCOLORS":"",s.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+s.morphTextureStride:"",s.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+s.morphTargetsCount:"",s.doubleSided?"#define DOUBLE_SIDED":"",s.flipSided?"#define FLIP_SIDED":"",s.shadowMapEnabled?"#define USE_SHADOWMAP":"",s.shadowMapEnabled?"#define "+M:"",s.sizeAttenuation?"#define USE_SIZEATTENUATION":"",s.numLightProbes>0?"#define USE_LIGHT_PROBES":"",s.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",s.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Kh).join(`
`),W=[Ov(s),"#define SHADER_TYPE "+s.shaderType,"#define SHADER_NAME "+s.shaderName,K,s.useFog&&s.fog?"#define USE_FOG":"",s.useFog&&s.fogExp2?"#define FOG_EXP2":"",s.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",s.map?"#define USE_MAP":"",s.matcap?"#define USE_MATCAP":"",s.envMap?"#define USE_ENVMAP":"",s.envMap?"#define "+C:"",s.envMap?"#define "+D:"",s.envMap?"#define "+F:"",O?"#define CUBEUV_TEXEL_WIDTH "+O.texelWidth:"",O?"#define CUBEUV_TEXEL_HEIGHT "+O.texelHeight:"",O?"#define CUBEUV_MAX_MIP "+O.maxMip+".0":"",s.lightMap?"#define USE_LIGHTMAP":"",s.aoMap?"#define USE_AOMAP":"",s.bumpMap?"#define USE_BUMPMAP":"",s.normalMap?"#define USE_NORMALMAP":"",s.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",s.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",s.emissiveMap?"#define USE_EMISSIVEMAP":"",s.anisotropy?"#define USE_ANISOTROPY":"",s.anisotropyMap?"#define USE_ANISOTROPYMAP":"",s.clearcoat?"#define USE_CLEARCOAT":"",s.clearcoatMap?"#define USE_CLEARCOATMAP":"",s.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",s.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",s.dispersion?"#define USE_DISPERSION":"",s.iridescence?"#define USE_IRIDESCENCE":"",s.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",s.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",s.specularMap?"#define USE_SPECULARMAP":"",s.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",s.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",s.roughnessMap?"#define USE_ROUGHNESSMAP":"",s.metalnessMap?"#define USE_METALNESSMAP":"",s.alphaMap?"#define USE_ALPHAMAP":"",s.alphaTest?"#define USE_ALPHATEST":"",s.alphaHash?"#define USE_ALPHAHASH":"",s.sheen?"#define USE_SHEEN":"",s.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",s.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",s.transmission?"#define USE_TRANSMISSION":"",s.transmissionMap?"#define USE_TRANSMISSIONMAP":"",s.thicknessMap?"#define USE_THICKNESSMAP":"",s.vertexTangents&&s.flatShading===!1?"#define USE_TANGENT":"",s.vertexColors||s.instancingColor||s.batchingColor?"#define USE_COLOR":"",s.vertexAlphas?"#define USE_COLOR_ALPHA":"",s.vertexUv1s?"#define USE_UV1":"",s.vertexUv2s?"#define USE_UV2":"",s.vertexUv3s?"#define USE_UV3":"",s.pointsUvs?"#define USE_POINTS_UV":"",s.gradientMap?"#define USE_GRADIENTMAP":"",s.flatShading?"#define FLAT_SHADED":"",s.doubleSided?"#define DOUBLE_SIDED":"",s.flipSided?"#define FLIP_SIDED":"",s.shadowMapEnabled?"#define USE_SHADOWMAP":"",s.shadowMapEnabled?"#define "+M:"",s.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",s.numLightProbes>0?"#define USE_LIGHT_PROBES":"",s.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",s.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",s.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",s.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",s.toneMapping!==fa?"#define TONE_MAPPING":"",s.toneMapping!==fa?Mi.tonemapping_pars_fragment:"",s.toneMapping!==fa?_P("toneMapping",s.toneMapping):"",s.dithering?"#define DITHERING":"",s.opaque?"#define OPAQUE":"",Mi.colorspace_pars_fragment,mP("linearToOutputTexel",s.outputColorSpace),yP(),s.useDepthPacking?"#define DEPTH_PACKING "+s.depthPacking:"",`
`].filter(Kh).join(`
`)),_=z_(_),_=Lv(_,s),_=Fv(_,s),o=z_(o),o=Lv(o,s),o=Fv(o,s),_=zv(_),o=zv(o),s.isRawShaderMaterial!==!0&&(ge=`#version 300 es
`,N=[j,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+N,W=["#define varying in",s.glslVersion===z0?"":"layout(location = 0) out highp vec4 pc_fragColor;",s.glslVersion===z0?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+W);const de=ge+N+_,ve=ge+W+o,Me=Iv(f,f.VERTEX_SHADER,de),De=Iv(f,f.FRAGMENT_SHADER,ve);f.attachShader(J,Me),f.attachShader(J,De),s.index0AttributeName!==void 0?f.bindAttribLocation(J,0,s.index0AttributeName):s.morphTargets===!0&&f.bindAttribLocation(J,0,"position"),f.linkProgram(J);function Ie(Oe){if(m.debug.checkShaderErrors){const tt=f.getProgramInfoLog(J)||"",Qe=f.getShaderInfoLog(Me)||"",pt=f.getShaderInfoLog(De)||"",ct=tt.trim(),nt=Qe.trim(),Je=pt.trim();let ut=!0,xt=!0;if(f.getProgramParameter(J,f.LINK_STATUS)===!1)if(ut=!1,typeof m.debug.onShaderError=="function")m.debug.onShaderError(f,J,Me,De);else{const At=Dv(f,Me,"vertex"),Rt=Dv(f,De,"fragment");hi("THREE.WebGLProgram: Shader Error "+f.getError()+" - VALIDATE_STATUS "+f.getProgramParameter(J,f.VALIDATE_STATUS)+`

Material Name: `+Oe.name+`
Material Type: `+Oe.type+`

Program Info Log: `+ct+`
`+At+`
`+Rt)}else ct!==""?ei("WebGLProgram: Program Info Log:",ct):(nt===""||Je==="")&&(xt=!1);xt&&(Oe.diagnostics={runnable:ut,programLog:ct,vertexShader:{log:nt,prefix:N},fragmentShader:{log:Je,prefix:W}})}f.deleteShader(Me),f.deleteShader(De),$e=new pp(f,J),re=bP(f,J)}let $e;this.getUniforms=function(){return $e===void 0&&Ie(this),$e};let re;this.getAttributes=function(){return re===void 0&&Ie(this),re};let fe=s.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return fe===!1&&(fe=f.getProgramParameter(J,hP)),fe},this.destroy=function(){c.releaseStatesOfProgram(this),f.deleteProgram(J),this.program=void 0},this.type=s.shaderType,this.name=s.shaderName,this.id=dP++,this.cacheKey=i,this.usedTimes=1,this.program=J,this.vertexShader=Me,this.fragmentShader=De,this}let NP=0;class BP{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(i){const s=i.vertexShader,c=i.fragmentShader,f=this._getShaderStage(s),v=this._getShaderStage(c),_=this._getShaderCacheForMaterial(i);return _.has(f)===!1&&(_.add(f),f.usedTimes++),_.has(v)===!1&&(_.add(v),v.usedTimes++),this}remove(i){const s=this.materialCache.get(i);for(const c of s)c.usedTimes--,c.usedTimes===0&&this.shaderCache.delete(c.code);return this.materialCache.delete(i),this}getVertexShaderID(i){return this._getShaderStage(i.vertexShader).id}getFragmentShaderID(i){return this._getShaderStage(i.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(i){const s=this.materialCache;let c=s.get(i);return c===void 0&&(c=new Set,s.set(i,c)),c}_getShaderStage(i){const s=this.shaderCache;let c=s.get(i);return c===void 0&&(c=new kP(i),s.set(i,c)),c}}class kP{constructor(i){this.id=NP++,this.code=i,this.usedTimes=0}}function UP(m,i,s,c,f,v,_){const o=new Db,M=new BP,C=new Set,D=[],F=new Map,O=f.logarithmicDepthBuffer;let j=f.precision;const K={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distance",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function J(re){return C.add(re),re===0?"uv":`uv${re}`}function N(re,fe,Oe,tt,Qe){const pt=tt.fog,ct=Qe.geometry,nt=re.isMeshStandardMaterial?tt.environment:null,Je=(re.isMeshStandardMaterial?s:i).get(re.envMap||nt),ut=Je&&Je.mapping===wp?Je.image.height:null,xt=K[re.type];re.precision!==null&&(j=f.getMaxPrecision(re.precision),j!==re.precision&&ei("WebGLProgram.getParameters:",re.precision,"not supported, using",j,"instead."));const At=ct.morphAttributes.position||ct.morphAttributes.normal||ct.morphAttributes.color,Rt=At!==void 0?At.length:0;let oi=0;ct.morphAttributes.position!==void 0&&(oi=1),ct.morphAttributes.normal!==void 0&&(oi=2),ct.morphAttributes.color!==void 0&&(oi=3);let ti,Ii,yi,ot;if(xt){const Ct=ua[xt];ti=Ct.vertexShader,Ii=Ct.fragmentShader}else ti=re.vertexShader,Ii=re.fragmentShader,M.update(re),yi=M.getVertexShaderID(re),ot=M.getFragmentShaderID(re);const mt=m.getRenderTarget(),Dt=m.state.buffers.depth.getReversed(),ni=Qe.isInstancedMesh===!0,Gt=Qe.isBatchedMesh===!0,pi=!!re.map,Ti=!!re.matcap,xi=!!Je,ci=!!re.aoMap,vi=!!re.lightMap,ri=!!re.bumpMap,ui=!!re.normalMap,Le=!!re.displacementMap,Ji=!!re.emissiveMap,Si=!!re.metalnessMap,Ri=!!re.roughnessMap,Vt=re.anisotropy>0,xe=re.clearcoat>0,Q=re.dispersion>0,ke=re.iridescence>0,ht=re.sheen>0,yt=re.transmission>0,st=Vt&&!!re.anisotropyMap,jt=xe&&!!re.clearcoatMap,Et=xe&&!!re.clearcoatNormalMap,be=xe&&!!re.clearcoatRoughnessMap,H=ke&&!!re.iridescenceMap,U=ke&&!!re.iridescenceThicknessMap,Z=ht&&!!re.sheenColorMap,ae=ht&&!!re.sheenRoughnessMap,pe=!!re.specularMap,Se=!!re.specularColorMap,Fe=!!re.specularIntensityMap,te=yt&&!!re.transmissionMap,Ce=yt&&!!re.thicknessMap,Ne=!!re.gradientMap,ze=!!re.alphaMap,oe=re.alphaTest>0,Ve=!!re.alphaHash,lt=!!re.extensions;let vt=fa;re.toneMapped&&(mt===null||mt.isXRRenderTarget===!0)&&(vt=m.toneMapping);const It={shaderID:xt,shaderType:re.type,shaderName:re.name,vertexShader:ti,fragmentShader:Ii,defines:re.defines,customVertexShaderID:yi,customFragmentShaderID:ot,isRawShaderMaterial:re.isRawShaderMaterial===!0,glslVersion:re.glslVersion,precision:j,batching:Gt,batchingColor:Gt&&Qe._colorsTexture!==null,instancing:ni,instancingColor:ni&&Qe.instanceColor!==null,instancingMorph:ni&&Qe.morphTexture!==null,outputColorSpace:mt===null?m.outputColorSpace:mt.isXRRenderTarget===!0?mt.texture.colorSpace:Vr,alphaToCoverage:!!re.alphaToCoverage,map:pi,matcap:Ti,envMap:xi,envMapMode:xi&&Je.mapping,envMapCubeUVHeight:ut,aoMap:ci,lightMap:vi,bumpMap:ri,normalMap:ui,displacementMap:Le,emissiveMap:Ji,normalMapObjectSpace:ui&&re.normalMapType===DS,normalMapTangentSpace:ui&&re.normalMapType===Pb,metalnessMap:Si,roughnessMap:Ri,anisotropy:Vt,anisotropyMap:st,clearcoat:xe,clearcoatMap:jt,clearcoatNormalMap:Et,clearcoatRoughnessMap:be,dispersion:Q,iridescence:ke,iridescenceMap:H,iridescenceThicknessMap:U,sheen:ht,sheenColorMap:Z,sheenRoughnessMap:ae,specularMap:pe,specularColorMap:Se,specularIntensityMap:Fe,transmission:yt,transmissionMap:te,thicknessMap:Ce,gradientMap:Ne,opaque:re.transparent===!1&&re.blending===Xl&&re.alphaToCoverage===!1,alphaMap:ze,alphaTest:oe,alphaHash:Ve,combine:re.combine,mapUv:pi&&J(re.map.channel),aoMapUv:ci&&J(re.aoMap.channel),lightMapUv:vi&&J(re.lightMap.channel),bumpMapUv:ri&&J(re.bumpMap.channel),normalMapUv:ui&&J(re.normalMap.channel),displacementMapUv:Le&&J(re.displacementMap.channel),emissiveMapUv:Ji&&J(re.emissiveMap.channel),metalnessMapUv:Si&&J(re.metalnessMap.channel),roughnessMapUv:Ri&&J(re.roughnessMap.channel),anisotropyMapUv:st&&J(re.anisotropyMap.channel),clearcoatMapUv:jt&&J(re.clearcoatMap.channel),clearcoatNormalMapUv:Et&&J(re.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:be&&J(re.clearcoatRoughnessMap.channel),iridescenceMapUv:H&&J(re.iridescenceMap.channel),iridescenceThicknessMapUv:U&&J(re.iridescenceThicknessMap.channel),sheenColorMapUv:Z&&J(re.sheenColorMap.channel),sheenRoughnessMapUv:ae&&J(re.sheenRoughnessMap.channel),specularMapUv:pe&&J(re.specularMap.channel),specularColorMapUv:Se&&J(re.specularColorMap.channel),specularIntensityMapUv:Fe&&J(re.specularIntensityMap.channel),transmissionMapUv:te&&J(re.transmissionMap.channel),thicknessMapUv:Ce&&J(re.thicknessMap.channel),alphaMapUv:ze&&J(re.alphaMap.channel),vertexTangents:!!ct.attributes.tangent&&(ui||Vt),vertexColors:re.vertexColors,vertexAlphas:re.vertexColors===!0&&!!ct.attributes.color&&ct.attributes.color.itemSize===4,pointsUvs:Qe.isPoints===!0&&!!ct.attributes.uv&&(pi||ze),fog:!!pt,useFog:re.fog===!0,fogExp2:!!pt&&pt.isFogExp2,flatShading:re.flatShading===!0&&re.wireframe===!1,sizeAttenuation:re.sizeAttenuation===!0,logarithmicDepthBuffer:O,reversedDepthBuffer:Dt,skinning:Qe.isSkinnedMesh===!0,morphTargets:ct.morphAttributes.position!==void 0,morphNormals:ct.morphAttributes.normal!==void 0,morphColors:ct.morphAttributes.color!==void 0,morphTargetsCount:Rt,morphTextureStride:oi,numDirLights:fe.directional.length,numPointLights:fe.point.length,numSpotLights:fe.spot.length,numSpotLightMaps:fe.spotLightMap.length,numRectAreaLights:fe.rectArea.length,numHemiLights:fe.hemi.length,numDirLightShadows:fe.directionalShadowMap.length,numPointLightShadows:fe.pointShadowMap.length,numSpotLightShadows:fe.spotShadowMap.length,numSpotLightShadowsWithMaps:fe.numSpotLightShadowsWithMaps,numLightProbes:fe.numLightProbes,numClippingPlanes:_.numPlanes,numClipIntersection:_.numIntersection,dithering:re.dithering,shadowMapEnabled:m.shadowMap.enabled&&Oe.length>0,shadowMapType:m.shadowMap.type,toneMapping:vt,decodeVideoTexture:pi&&re.map.isVideoTexture===!0&&Ni.getTransfer(re.map.colorSpace)===en,decodeVideoTextureEmissive:Ji&&re.emissiveMap.isVideoTexture===!0&&Ni.getTransfer(re.emissiveMap.colorSpace)===en,premultipliedAlpha:re.premultipliedAlpha,doubleSided:re.side===As,flipSided:re.side===Qr,useDepthPacking:re.depthPacking>=0,depthPacking:re.depthPacking||0,index0AttributeName:re.index0AttributeName,extensionClipCullDistance:lt&&re.extensions.clipCullDistance===!0&&c.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(lt&&re.extensions.multiDraw===!0||Gt)&&c.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:c.has("KHR_parallel_shader_compile"),customProgramCacheKey:re.customProgramCacheKey()};return It.vertexUv1s=C.has(1),It.vertexUv2s=C.has(2),It.vertexUv3s=C.has(3),C.clear(),It}function W(re){const fe=[];if(re.shaderID?fe.push(re.shaderID):(fe.push(re.customVertexShaderID),fe.push(re.customFragmentShaderID)),re.defines!==void 0)for(const Oe in re.defines)fe.push(Oe),fe.push(re.defines[Oe]);return re.isRawShaderMaterial===!1&&(ge(fe,re),de(fe,re),fe.push(m.outputColorSpace)),fe.push(re.customProgramCacheKey),fe.join()}function ge(re,fe){re.push(fe.precision),re.push(fe.outputColorSpace),re.push(fe.envMapMode),re.push(fe.envMapCubeUVHeight),re.push(fe.mapUv),re.push(fe.alphaMapUv),re.push(fe.lightMapUv),re.push(fe.aoMapUv),re.push(fe.bumpMapUv),re.push(fe.normalMapUv),re.push(fe.displacementMapUv),re.push(fe.emissiveMapUv),re.push(fe.metalnessMapUv),re.push(fe.roughnessMapUv),re.push(fe.anisotropyMapUv),re.push(fe.clearcoatMapUv),re.push(fe.clearcoatNormalMapUv),re.push(fe.clearcoatRoughnessMapUv),re.push(fe.iridescenceMapUv),re.push(fe.iridescenceThicknessMapUv),re.push(fe.sheenColorMapUv),re.push(fe.sheenRoughnessMapUv),re.push(fe.specularMapUv),re.push(fe.specularColorMapUv),re.push(fe.specularIntensityMapUv),re.push(fe.transmissionMapUv),re.push(fe.thicknessMapUv),re.push(fe.combine),re.push(fe.fogExp2),re.push(fe.sizeAttenuation),re.push(fe.morphTargetsCount),re.push(fe.morphAttributeCount),re.push(fe.numDirLights),re.push(fe.numPointLights),re.push(fe.numSpotLights),re.push(fe.numSpotLightMaps),re.push(fe.numHemiLights),re.push(fe.numRectAreaLights),re.push(fe.numDirLightShadows),re.push(fe.numPointLightShadows),re.push(fe.numSpotLightShadows),re.push(fe.numSpotLightShadowsWithMaps),re.push(fe.numLightProbes),re.push(fe.shadowMapType),re.push(fe.toneMapping),re.push(fe.numClippingPlanes),re.push(fe.numClipIntersection),re.push(fe.depthPacking)}function de(re,fe){o.disableAll(),fe.instancing&&o.enable(0),fe.instancingColor&&o.enable(1),fe.instancingMorph&&o.enable(2),fe.matcap&&o.enable(3),fe.envMap&&o.enable(4),fe.normalMapObjectSpace&&o.enable(5),fe.normalMapTangentSpace&&o.enable(6),fe.clearcoat&&o.enable(7),fe.iridescence&&o.enable(8),fe.alphaTest&&o.enable(9),fe.vertexColors&&o.enable(10),fe.vertexAlphas&&o.enable(11),fe.vertexUv1s&&o.enable(12),fe.vertexUv2s&&o.enable(13),fe.vertexUv3s&&o.enable(14),fe.vertexTangents&&o.enable(15),fe.anisotropy&&o.enable(16),fe.alphaHash&&o.enable(17),fe.batching&&o.enable(18),fe.dispersion&&o.enable(19),fe.batchingColor&&o.enable(20),fe.gradientMap&&o.enable(21),re.push(o.mask),o.disableAll(),fe.fog&&o.enable(0),fe.useFog&&o.enable(1),fe.flatShading&&o.enable(2),fe.logarithmicDepthBuffer&&o.enable(3),fe.reversedDepthBuffer&&o.enable(4),fe.skinning&&o.enable(5),fe.morphTargets&&o.enable(6),fe.morphNormals&&o.enable(7),fe.morphColors&&o.enable(8),fe.premultipliedAlpha&&o.enable(9),fe.shadowMapEnabled&&o.enable(10),fe.doubleSided&&o.enable(11),fe.flipSided&&o.enable(12),fe.useDepthPacking&&o.enable(13),fe.dithering&&o.enable(14),fe.transmission&&o.enable(15),fe.sheen&&o.enable(16),fe.opaque&&o.enable(17),fe.pointsUvs&&o.enable(18),fe.decodeVideoTexture&&o.enable(19),fe.decodeVideoTextureEmissive&&o.enable(20),fe.alphaToCoverage&&o.enable(21),re.push(o.mask)}function ve(re){const fe=K[re.type];let Oe;if(fe){const tt=ua[fe];Oe=TM.clone(tt.uniforms)}else Oe=re.uniforms;return Oe}function Me(re,fe){let Oe=F.get(fe);return Oe!==void 0?++Oe.usedTimes:(Oe=new OP(m,fe,re,v),D.push(Oe),F.set(fe,Oe)),Oe}function De(re){if(--re.usedTimes===0){const fe=D.indexOf(re);D[fe]=D[D.length-1],D.pop(),F.delete(re.cacheKey),re.destroy()}}function Ie(re){M.remove(re)}function $e(){M.dispose()}return{getParameters:N,getProgramCacheKey:W,getUniforms:ve,acquireProgram:Me,releaseProgram:De,releaseShaderCache:Ie,programs:D,dispose:$e}}function VP(){let m=new WeakMap;function i(_){return m.has(_)}function s(_){let o=m.get(_);return o===void 0&&(o={},m.set(_,o)),o}function c(_){m.delete(_)}function f(_,o,M){m.get(_)[o]=M}function v(){m=new WeakMap}return{has:i,get:s,remove:c,update:f,dispose:v}}function GP(m,i){return m.groupOrder!==i.groupOrder?m.groupOrder-i.groupOrder:m.renderOrder!==i.renderOrder?m.renderOrder-i.renderOrder:m.material.id!==i.material.id?m.material.id-i.material.id:m.z!==i.z?m.z-i.z:m.id-i.id}function Nv(m,i){return m.groupOrder!==i.groupOrder?m.groupOrder-i.groupOrder:m.renderOrder!==i.renderOrder?m.renderOrder-i.renderOrder:m.z!==i.z?i.z-m.z:m.id-i.id}function Bv(){const m=[];let i=0;const s=[],c=[],f=[];function v(){i=0,s.length=0,c.length=0,f.length=0}function _(F,O,j,K,J,N){let W=m[i];return W===void 0?(W={id:F.id,object:F,geometry:O,material:j,groupOrder:K,renderOrder:F.renderOrder,z:J,group:N},m[i]=W):(W.id=F.id,W.object=F,W.geometry=O,W.material=j,W.groupOrder=K,W.renderOrder=F.renderOrder,W.z=J,W.group=N),i++,W}function o(F,O,j,K,J,N){const W=_(F,O,j,K,J,N);j.transmission>0?c.push(W):j.transparent===!0?f.push(W):s.push(W)}function M(F,O,j,K,J,N){const W=_(F,O,j,K,J,N);j.transmission>0?c.unshift(W):j.transparent===!0?f.unshift(W):s.unshift(W)}function C(F,O){s.length>1&&s.sort(F||GP),c.length>1&&c.sort(O||Nv),f.length>1&&f.sort(O||Nv)}function D(){for(let F=i,O=m.length;F<O;F++){const j=m[F];if(j.id===null)break;j.id=null,j.object=null,j.geometry=null,j.material=null,j.group=null}}return{opaque:s,transmissive:c,transparent:f,init:v,push:o,unshift:M,finish:D,sort:C}}function HP(){let m=new WeakMap;function i(c,f){const v=m.get(c);let _;return v===void 0?(_=new Bv,m.set(c,[_])):f>=v.length?(_=new Bv,v.push(_)):_=v[f],_}function s(){m=new WeakMap}return{get:i,dispose:s}}function jP(){const m={};return{get:function(i){if(m[i.id]!==void 0)return m[i.id];let s;switch(i.type){case"DirectionalLight":s={direction:new We,color:new bi};break;case"SpotLight":s={position:new We,direction:new We,color:new bi,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":s={position:new We,color:new bi,distance:0,decay:0};break;case"HemisphereLight":s={direction:new We,skyColor:new bi,groundColor:new bi};break;case"RectAreaLight":s={color:new bi,position:new We,halfWidth:new We,halfHeight:new We};break}return m[i.id]=s,s}}}function WP(){const m={};return{get:function(i){if(m[i.id]!==void 0)return m[i.id];let s;switch(i.type){case"DirectionalLight":s={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Bi};break;case"SpotLight":s={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Bi};break;case"PointLight":s={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Bi,shadowCameraNear:1,shadowCameraFar:1e3};break}return m[i.id]=s,s}}}let qP=0;function XP(m,i){return(i.castShadow?2:0)-(m.castShadow?2:0)+(i.map?1:0)-(m.map?1:0)}function ZP(m){const i=new jP,s=WP(),c={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let C=0;C<9;C++)c.probe.push(new We);const f=new We,v=new gi,_=new gi;function o(C){let D=0,F=0,O=0;for(let re=0;re<9;re++)c.probe[re].set(0,0,0);let j=0,K=0,J=0,N=0,W=0,ge=0,de=0,ve=0,Me=0,De=0,Ie=0;C.sort(XP);for(let re=0,fe=C.length;re<fe;re++){const Oe=C[re],tt=Oe.color,Qe=Oe.intensity,pt=Oe.distance;let ct=null;if(Oe.shadow&&Oe.shadow.map&&(Oe.shadow.map.texture.format===yu?ct=Oe.shadow.map.texture:ct=Oe.shadow.map.depthTexture||Oe.shadow.map.texture),Oe.isAmbientLight)D+=tt.r*Qe,F+=tt.g*Qe,O+=tt.b*Qe;else if(Oe.isLightProbe){for(let nt=0;nt<9;nt++)c.probe[nt].addScaledVector(Oe.sh.coefficients[nt],Qe);Ie++}else if(Oe.isDirectionalLight){const nt=i.get(Oe);if(nt.color.copy(Oe.color).multiplyScalar(Oe.intensity),Oe.castShadow){const Je=Oe.shadow,ut=s.get(Oe);ut.shadowIntensity=Je.intensity,ut.shadowBias=Je.bias,ut.shadowNormalBias=Je.normalBias,ut.shadowRadius=Je.radius,ut.shadowMapSize=Je.mapSize,c.directionalShadow[j]=ut,c.directionalShadowMap[j]=ct,c.directionalShadowMatrix[j]=Oe.shadow.matrix,ge++}c.directional[j]=nt,j++}else if(Oe.isSpotLight){const nt=i.get(Oe);nt.position.setFromMatrixPosition(Oe.matrixWorld),nt.color.copy(tt).multiplyScalar(Qe),nt.distance=pt,nt.coneCos=Math.cos(Oe.angle),nt.penumbraCos=Math.cos(Oe.angle*(1-Oe.penumbra)),nt.decay=Oe.decay,c.spot[J]=nt;const Je=Oe.shadow;if(Oe.map&&(c.spotLightMap[Me]=Oe.map,Me++,Je.updateMatrices(Oe),Oe.castShadow&&De++),c.spotLightMatrix[J]=Je.matrix,Oe.castShadow){const ut=s.get(Oe);ut.shadowIntensity=Je.intensity,ut.shadowBias=Je.bias,ut.shadowNormalBias=Je.normalBias,ut.shadowRadius=Je.radius,ut.shadowMapSize=Je.mapSize,c.spotShadow[J]=ut,c.spotShadowMap[J]=ct,ve++}J++}else if(Oe.isRectAreaLight){const nt=i.get(Oe);nt.color.copy(tt).multiplyScalar(Qe),nt.halfWidth.set(Oe.width*.5,0,0),nt.halfHeight.set(0,Oe.height*.5,0),c.rectArea[N]=nt,N++}else if(Oe.isPointLight){const nt=i.get(Oe);if(nt.color.copy(Oe.color).multiplyScalar(Oe.intensity),nt.distance=Oe.distance,nt.decay=Oe.decay,Oe.castShadow){const Je=Oe.shadow,ut=s.get(Oe);ut.shadowIntensity=Je.intensity,ut.shadowBias=Je.bias,ut.shadowNormalBias=Je.normalBias,ut.shadowRadius=Je.radius,ut.shadowMapSize=Je.mapSize,ut.shadowCameraNear=Je.camera.near,ut.shadowCameraFar=Je.camera.far,c.pointShadow[K]=ut,c.pointShadowMap[K]=ct,c.pointShadowMatrix[K]=Oe.shadow.matrix,de++}c.point[K]=nt,K++}else if(Oe.isHemisphereLight){const nt=i.get(Oe);nt.skyColor.copy(Oe.color).multiplyScalar(Qe),nt.groundColor.copy(Oe.groundColor).multiplyScalar(Qe),c.hemi[W]=nt,W++}}N>0&&(m.has("OES_texture_float_linear")===!0?(c.rectAreaLTC1=Bt.LTC_FLOAT_1,c.rectAreaLTC2=Bt.LTC_FLOAT_2):(c.rectAreaLTC1=Bt.LTC_HALF_1,c.rectAreaLTC2=Bt.LTC_HALF_2)),c.ambient[0]=D,c.ambient[1]=F,c.ambient[2]=O;const $e=c.hash;($e.directionalLength!==j||$e.pointLength!==K||$e.spotLength!==J||$e.rectAreaLength!==N||$e.hemiLength!==W||$e.numDirectionalShadows!==ge||$e.numPointShadows!==de||$e.numSpotShadows!==ve||$e.numSpotMaps!==Me||$e.numLightProbes!==Ie)&&(c.directional.length=j,c.spot.length=J,c.rectArea.length=N,c.point.length=K,c.hemi.length=W,c.directionalShadow.length=ge,c.directionalShadowMap.length=ge,c.pointShadow.length=de,c.pointShadowMap.length=de,c.spotShadow.length=ve,c.spotShadowMap.length=ve,c.directionalShadowMatrix.length=ge,c.pointShadowMatrix.length=de,c.spotLightMatrix.length=ve+Me-De,c.spotLightMap.length=Me,c.numSpotLightShadowsWithMaps=De,c.numLightProbes=Ie,$e.directionalLength=j,$e.pointLength=K,$e.spotLength=J,$e.rectAreaLength=N,$e.hemiLength=W,$e.numDirectionalShadows=ge,$e.numPointShadows=de,$e.numSpotShadows=ve,$e.numSpotMaps=Me,$e.numLightProbes=Ie,c.version=qP++)}function M(C,D){let F=0,O=0,j=0,K=0,J=0;const N=D.matrixWorldInverse;for(let W=0,ge=C.length;W<ge;W++){const de=C[W];if(de.isDirectionalLight){const ve=c.directional[F];ve.direction.setFromMatrixPosition(de.matrixWorld),f.setFromMatrixPosition(de.target.matrixWorld),ve.direction.sub(f),ve.direction.transformDirection(N),F++}else if(de.isSpotLight){const ve=c.spot[j];ve.position.setFromMatrixPosition(de.matrixWorld),ve.position.applyMatrix4(N),ve.direction.setFromMatrixPosition(de.matrixWorld),f.setFromMatrixPosition(de.target.matrixWorld),ve.direction.sub(f),ve.direction.transformDirection(N),j++}else if(de.isRectAreaLight){const ve=c.rectArea[K];ve.position.setFromMatrixPosition(de.matrixWorld),ve.position.applyMatrix4(N),_.identity(),v.copy(de.matrixWorld),v.premultiply(N),_.extractRotation(v),ve.halfWidth.set(de.width*.5,0,0),ve.halfHeight.set(0,de.height*.5,0),ve.halfWidth.applyMatrix4(_),ve.halfHeight.applyMatrix4(_),K++}else if(de.isPointLight){const ve=c.point[O];ve.position.setFromMatrixPosition(de.matrixWorld),ve.position.applyMatrix4(N),O++}else if(de.isHemisphereLight){const ve=c.hemi[J];ve.direction.setFromMatrixPosition(de.matrixWorld),ve.direction.transformDirection(N),J++}}}return{setup:o,setupView:M,state:c}}function kv(m){const i=new ZP(m),s=[],c=[];function f(D){C.camera=D,s.length=0,c.length=0}function v(D){s.push(D)}function _(D){c.push(D)}function o(){i.setup(s)}function M(D){i.setupView(s,D)}const C={lightsArray:s,shadowsArray:c,camera:null,lights:i,transmissionRenderTarget:{}};return{init:f,state:C,setupLights:o,setupLightsView:M,pushLight:v,pushShadow:_}}function $P(m){let i=new WeakMap;function s(f,v=0){const _=i.get(f);let o;return _===void 0?(o=new kv(m),i.set(f,[o])):v>=_.length?(o=new kv(m),_.push(o)):o=_[v],o}function c(){i=new WeakMap}return{get:s,dispose:c}}const YP=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,KP=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ).rg;
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ).r;
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( max( 0.0, squared_mean - mean * mean ) );
	gl_FragColor = vec4( mean, std_dev, 0.0, 1.0 );
}`,JP=[new We(1,0,0),new We(-1,0,0),new We(0,1,0),new We(0,-1,0),new We(0,0,1),new We(0,0,-1)],QP=[new We(0,-1,0),new We(0,-1,0),new We(0,0,1),new We(0,0,-1),new We(0,-1,0),new We(0,-1,0)],Uv=new gi,Xh=new We,Dg=new We;function eI(m,i,s){let c=new sy;const f=new Bi,v=new Bi,_=new wn,o=new HM,M=new jM,C={},D=s.maxTextureSize,F={[ro]:Qr,[Qr]:ro,[As]:As},O=new ya({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Bi},radius:{value:4}},vertexShader:YP,fragmentShader:KP}),j=O.clone();j.defines.HORIZONTAL_PASS=1;const K=new ts;K.setAttribute("position",new mr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const J=new Gr(K,O),N=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=lp;let W=this.type;this.render=function(De,Ie,$e){if(N.enabled===!1||N.autoUpdate===!1&&N.needsUpdate===!1||De.length===0)return;De.type===oS&&(ei("WebGLShadowMap: PCFSoftShadowMap has been deprecated. Using PCFShadowMap instead."),De.type=lp);const re=m.getRenderTarget(),fe=m.getActiveCubeFace(),Oe=m.getActiveMipmapLevel(),tt=m.state;tt.setBlending(io),tt.buffers.depth.getReversed()===!0?tt.buffers.color.setClear(0,0,0,0):tt.buffers.color.setClear(1,1,1,1),tt.buffers.depth.setTest(!0),tt.setScissorTest(!1);const Qe=W!==this.type;Qe&&Ie.traverse(function(pt){pt.material&&(Array.isArray(pt.material)?pt.material.forEach(ct=>ct.needsUpdate=!0):pt.material.needsUpdate=!0)});for(let pt=0,ct=De.length;pt<ct;pt++){const nt=De[pt],Je=nt.shadow;if(Je===void 0){ei("WebGLShadowMap:",nt,"has no shadow.");continue}if(Je.autoUpdate===!1&&Je.needsUpdate===!1)continue;f.copy(Je.mapSize);const ut=Je.getFrameExtents();if(f.multiply(ut),v.copy(Je.mapSize),(f.x>D||f.y>D)&&(f.x>D&&(v.x=Math.floor(D/ut.x),f.x=v.x*ut.x,Je.mapSize.x=v.x),f.y>D&&(v.y=Math.floor(D/ut.y),f.y=v.y*ut.y,Je.mapSize.y=v.y)),Je.map===null||Qe===!0){if(Je.map!==null&&(Je.map.depthTexture!==null&&(Je.map.depthTexture.dispose(),Je.map.depthTexture=null),Je.map.dispose()),this.type===$h){if(nt.isPointLight){ei("WebGLShadowMap: VSM shadow maps are not supported for PointLights. Use PCF or BasicShadowMap instead.");continue}Je.map=new pa(f.x,f.y,{format:yu,type:so,minFilter:nr,magFilter:nr,generateMipmaps:!1}),Je.map.texture.name=nt.name+".shadowMap",Je.map.depthTexture=new ld(f.x,f.y,Cs),Je.map.depthTexture.name=nt.name+".shadowMapDepth",Je.map.depthTexture.format=ao,Je.map.depthTexture.compareFunction=null,Je.map.depthTexture.minFilter=ir,Je.map.depthTexture.magFilter=ir}else{nt.isPointLight?(Je.map=new Bb(f.x),Je.map.depthTexture=new VM(f.x,ga)):(Je.map=new pa(f.x,f.y),Je.map.depthTexture=new ld(f.x,f.y,ga)),Je.map.depthTexture.name=nt.name+".shadowMap",Je.map.depthTexture.format=ao;const At=m.state.buffers.depth.getReversed();this.type===lp?(Je.map.depthTexture.compareFunction=At?J_:K_,Je.map.depthTexture.minFilter=nr,Je.map.depthTexture.magFilter=nr):(Je.map.depthTexture.compareFunction=null,Je.map.depthTexture.minFilter=ir,Je.map.depthTexture.magFilter=ir)}Je.camera.updateProjectionMatrix()}const xt=Je.map.isWebGLCubeRenderTarget?6:1;for(let At=0;At<xt;At++){if(Je.map.isWebGLCubeRenderTarget)m.setRenderTarget(Je.map,At),m.clear();else{At===0&&(m.setRenderTarget(Je.map),m.clear());const Rt=Je.getViewport(At);_.set(v.x*Rt.x,v.y*Rt.y,v.x*Rt.z,v.y*Rt.w),tt.viewport(_)}if(nt.isPointLight){const Rt=Je.camera,oi=Je.matrix,ti=nt.distance||Rt.far;ti!==Rt.far&&(Rt.far=ti,Rt.updateProjectionMatrix()),Xh.setFromMatrixPosition(nt.matrixWorld),Rt.position.copy(Xh),Dg.copy(Rt.position),Dg.add(JP[At]),Rt.up.copy(QP[At]),Rt.lookAt(Dg),Rt.updateMatrixWorld(),oi.makeTranslation(-Xh.x,-Xh.y,-Xh.z),Uv.multiplyMatrices(Rt.projectionMatrix,Rt.matrixWorldInverse),Je._frustum.setFromProjectionMatrix(Uv,Rt.coordinateSystem,Rt.reversedDepth)}else Je.updateMatrices(nt);c=Je.getFrustum(),ve(Ie,$e,Je.camera,nt,this.type)}Je.isPointLightShadow!==!0&&this.type===$h&&ge(Je,$e),Je.needsUpdate=!1}W=this.type,N.needsUpdate=!1,m.setRenderTarget(re,fe,Oe)};function ge(De,Ie){const $e=i.update(J);O.defines.VSM_SAMPLES!==De.blurSamples&&(O.defines.VSM_SAMPLES=De.blurSamples,j.defines.VSM_SAMPLES=De.blurSamples,O.needsUpdate=!0,j.needsUpdate=!0),De.mapPass===null&&(De.mapPass=new pa(f.x,f.y,{format:yu,type:so})),O.uniforms.shadow_pass.value=De.map.depthTexture,O.uniforms.resolution.value=De.mapSize,O.uniforms.radius.value=De.radius,m.setRenderTarget(De.mapPass),m.clear(),m.renderBufferDirect(Ie,null,$e,O,J,null),j.uniforms.shadow_pass.value=De.mapPass.texture,j.uniforms.resolution.value=De.mapSize,j.uniforms.radius.value=De.radius,m.setRenderTarget(De.map),m.clear(),m.renderBufferDirect(Ie,null,$e,j,J,null)}function de(De,Ie,$e,re){let fe=null;const Oe=$e.isPointLight===!0?De.customDistanceMaterial:De.customDepthMaterial;if(Oe!==void 0)fe=Oe;else if(fe=$e.isPointLight===!0?M:o,m.localClippingEnabled&&Ie.clipShadows===!0&&Array.isArray(Ie.clippingPlanes)&&Ie.clippingPlanes.length!==0||Ie.displacementMap&&Ie.displacementScale!==0||Ie.alphaMap&&Ie.alphaTest>0||Ie.map&&Ie.alphaTest>0||Ie.alphaToCoverage===!0){const tt=fe.uuid,Qe=Ie.uuid;let pt=C[tt];pt===void 0&&(pt={},C[tt]=pt);let ct=pt[Qe];ct===void 0&&(ct=fe.clone(),pt[Qe]=ct,Ie.addEventListener("dispose",Me)),fe=ct}if(fe.visible=Ie.visible,fe.wireframe=Ie.wireframe,re===$h?fe.side=Ie.shadowSide!==null?Ie.shadowSide:Ie.side:fe.side=Ie.shadowSide!==null?Ie.shadowSide:F[Ie.side],fe.alphaMap=Ie.alphaMap,fe.alphaTest=Ie.alphaToCoverage===!0?.5:Ie.alphaTest,fe.map=Ie.map,fe.clipShadows=Ie.clipShadows,fe.clippingPlanes=Ie.clippingPlanes,fe.clipIntersection=Ie.clipIntersection,fe.displacementMap=Ie.displacementMap,fe.displacementScale=Ie.displacementScale,fe.displacementBias=Ie.displacementBias,fe.wireframeLinewidth=Ie.wireframeLinewidth,fe.linewidth=Ie.linewidth,$e.isPointLight===!0&&fe.isMeshDistanceMaterial===!0){const tt=m.properties.get(fe);tt.light=$e}return fe}function ve(De,Ie,$e,re,fe){if(De.visible===!1)return;if(De.layers.test(Ie.layers)&&(De.isMesh||De.isLine||De.isPoints)&&(De.castShadow||De.receiveShadow&&fe===$h)&&(!De.frustumCulled||c.intersectsObject(De))){De.modelViewMatrix.multiplyMatrices($e.matrixWorldInverse,De.matrixWorld);const Qe=i.update(De),pt=De.material;if(Array.isArray(pt)){const ct=Qe.groups;for(let nt=0,Je=ct.length;nt<Je;nt++){const ut=ct[nt],xt=pt[ut.materialIndex];if(xt&&xt.visible){const At=de(De,xt,re,fe);De.onBeforeShadow(m,De,Ie,$e,Qe,At,ut),m.renderBufferDirect($e,null,Qe,At,De,ut),De.onAfterShadow(m,De,Ie,$e,Qe,At,ut)}}}else if(pt.visible){const ct=de(De,pt,re,fe);De.onBeforeShadow(m,De,Ie,$e,Qe,ct,null),m.renderBufferDirect($e,null,Qe,ct,De,null),De.onAfterShadow(m,De,Ie,$e,Qe,ct,null)}}const tt=De.children;for(let Qe=0,pt=tt.length;Qe<pt;Qe++)ve(tt[Qe],Ie,$e,re,fe)}function Me(De){De.target.removeEventListener("dispose",Me);for(const $e in C){const re=C[$e],fe=De.target.uuid;fe in re&&(re[fe].dispose(),delete re[fe])}}}const tI={[Gg]:Hg,[jg]:Xg,[Wg]:Zg,[mu]:qg,[Hg]:Gg,[Xg]:jg,[Zg]:Wg,[qg]:mu};function iI(m,i){function s(){let te=!1;const Ce=new wn;let Ne=null;const ze=new wn(0,0,0,0);return{setMask:function(oe){Ne!==oe&&!te&&(m.colorMask(oe,oe,oe,oe),Ne=oe)},setLocked:function(oe){te=oe},setClear:function(oe,Ve,lt,vt,It){It===!0&&(oe*=vt,Ve*=vt,lt*=vt),Ce.set(oe,Ve,lt,vt),ze.equals(Ce)===!1&&(m.clearColor(oe,Ve,lt,vt),ze.copy(Ce))},reset:function(){te=!1,Ne=null,ze.set(-1,0,0,0)}}}function c(){let te=!1,Ce=!1,Ne=null,ze=null,oe=null;return{setReversed:function(Ve){if(Ce!==Ve){const lt=i.get("EXT_clip_control");Ve?lt.clipControlEXT(lt.LOWER_LEFT_EXT,lt.ZERO_TO_ONE_EXT):lt.clipControlEXT(lt.LOWER_LEFT_EXT,lt.NEGATIVE_ONE_TO_ONE_EXT),Ce=Ve;const vt=oe;oe=null,this.setClear(vt)}},getReversed:function(){return Ce},setTest:function(Ve){Ve?mt(m.DEPTH_TEST):Dt(m.DEPTH_TEST)},setMask:function(Ve){Ne!==Ve&&!te&&(m.depthMask(Ve),Ne=Ve)},setFunc:function(Ve){if(Ce&&(Ve=tI[Ve]),ze!==Ve){switch(Ve){case Gg:m.depthFunc(m.NEVER);break;case Hg:m.depthFunc(m.ALWAYS);break;case jg:m.depthFunc(m.LESS);break;case mu:m.depthFunc(m.LEQUAL);break;case Wg:m.depthFunc(m.EQUAL);break;case qg:m.depthFunc(m.GEQUAL);break;case Xg:m.depthFunc(m.GREATER);break;case Zg:m.depthFunc(m.NOTEQUAL);break;default:m.depthFunc(m.LEQUAL)}ze=Ve}},setLocked:function(Ve){te=Ve},setClear:function(Ve){oe!==Ve&&(Ce&&(Ve=1-Ve),m.clearDepth(Ve),oe=Ve)},reset:function(){te=!1,Ne=null,ze=null,oe=null,Ce=!1}}}function f(){let te=!1,Ce=null,Ne=null,ze=null,oe=null,Ve=null,lt=null,vt=null,It=null;return{setTest:function(Ct){te||(Ct?mt(m.STENCIL_TEST):Dt(m.STENCIL_TEST))},setMask:function(Ct){Ce!==Ct&&!te&&(m.stencilMask(Ct),Ce=Ct)},setFunc:function(Ct,$t,Di){(Ne!==Ct||ze!==$t||oe!==Di)&&(m.stencilFunc(Ct,$t,Di),Ne=Ct,ze=$t,oe=Di)},setOp:function(Ct,$t,Di){(Ve!==Ct||lt!==$t||vt!==Di)&&(m.stencilOp(Ct,$t,Di),Ve=Ct,lt=$t,vt=Di)},setLocked:function(Ct){te=Ct},setClear:function(Ct){It!==Ct&&(m.clearStencil(Ct),It=Ct)},reset:function(){te=!1,Ce=null,Ne=null,ze=null,oe=null,Ve=null,lt=null,vt=null,It=null}}}const v=new s,_=new c,o=new f,M=new WeakMap,C=new WeakMap;let D={},F={},O=new WeakMap,j=[],K=null,J=!1,N=null,W=null,ge=null,de=null,ve=null,Me=null,De=null,Ie=new bi(0,0,0),$e=0,re=!1,fe=null,Oe=null,tt=null,Qe=null,pt=null;const ct=m.getParameter(m.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let nt=!1,Je=0;const ut=m.getParameter(m.VERSION);ut.indexOf("WebGL")!==-1?(Je=parseFloat(/^WebGL (\d)/.exec(ut)[1]),nt=Je>=1):ut.indexOf("OpenGL ES")!==-1&&(Je=parseFloat(/^OpenGL ES (\d)/.exec(ut)[1]),nt=Je>=2);let xt=null,At={};const Rt=m.getParameter(m.SCISSOR_BOX),oi=m.getParameter(m.VIEWPORT),ti=new wn().fromArray(Rt),Ii=new wn().fromArray(oi);function yi(te,Ce,Ne,ze){const oe=new Uint8Array(4),Ve=m.createTexture();m.bindTexture(te,Ve),m.texParameteri(te,m.TEXTURE_MIN_FILTER,m.NEAREST),m.texParameteri(te,m.TEXTURE_MAG_FILTER,m.NEAREST);for(let lt=0;lt<Ne;lt++)te===m.TEXTURE_3D||te===m.TEXTURE_2D_ARRAY?m.texImage3D(Ce,0,m.RGBA,1,1,ze,0,m.RGBA,m.UNSIGNED_BYTE,oe):m.texImage2D(Ce+lt,0,m.RGBA,1,1,0,m.RGBA,m.UNSIGNED_BYTE,oe);return Ve}const ot={};ot[m.TEXTURE_2D]=yi(m.TEXTURE_2D,m.TEXTURE_2D,1),ot[m.TEXTURE_CUBE_MAP]=yi(m.TEXTURE_CUBE_MAP,m.TEXTURE_CUBE_MAP_POSITIVE_X,6),ot[m.TEXTURE_2D_ARRAY]=yi(m.TEXTURE_2D_ARRAY,m.TEXTURE_2D_ARRAY,1,1),ot[m.TEXTURE_3D]=yi(m.TEXTURE_3D,m.TEXTURE_3D,1,1),v.setClear(0,0,0,1),_.setClear(1),o.setClear(0),mt(m.DEPTH_TEST),_.setFunc(mu),ri(!1),ui(E0),mt(m.CULL_FACE),ci(io);function mt(te){D[te]!==!0&&(m.enable(te),D[te]=!0)}function Dt(te){D[te]!==!1&&(m.disable(te),D[te]=!1)}function ni(te,Ce){return F[te]!==Ce?(m.bindFramebuffer(te,Ce),F[te]=Ce,te===m.DRAW_FRAMEBUFFER&&(F[m.FRAMEBUFFER]=Ce),te===m.FRAMEBUFFER&&(F[m.DRAW_FRAMEBUFFER]=Ce),!0):!1}function Gt(te,Ce){let Ne=j,ze=!1;if(te){Ne=O.get(Ce),Ne===void 0&&(Ne=[],O.set(Ce,Ne));const oe=te.textures;if(Ne.length!==oe.length||Ne[0]!==m.COLOR_ATTACHMENT0){for(let Ve=0,lt=oe.length;Ve<lt;Ve++)Ne[Ve]=m.COLOR_ATTACHMENT0+Ve;Ne.length=oe.length,ze=!0}}else Ne[0]!==m.BACK&&(Ne[0]=m.BACK,ze=!0);ze&&m.drawBuffers(Ne)}function pi(te){return K!==te?(m.useProgram(te),K=te,!0):!1}const Ti={[Hl]:m.FUNC_ADD,[cS]:m.FUNC_SUBTRACT,[uS]:m.FUNC_REVERSE_SUBTRACT};Ti[hS]=m.MIN,Ti[dS]=m.MAX;const xi={[fS]:m.ZERO,[pS]:m.ONE,[mS]:m.SRC_COLOR,[Ug]:m.SRC_ALPHA,[bS]:m.SRC_ALPHA_SATURATE,[xS]:m.DST_COLOR,[_S]:m.DST_ALPHA,[gS]:m.ONE_MINUS_SRC_COLOR,[Vg]:m.ONE_MINUS_SRC_ALPHA,[vS]:m.ONE_MINUS_DST_COLOR,[yS]:m.ONE_MINUS_DST_ALPHA,[wS]:m.CONSTANT_COLOR,[TS]:m.ONE_MINUS_CONSTANT_COLOR,[SS]:m.CONSTANT_ALPHA,[MS]:m.ONE_MINUS_CONSTANT_ALPHA};function ci(te,Ce,Ne,ze,oe,Ve,lt,vt,It,Ct){if(te===io){J===!0&&(Dt(m.BLEND),J=!1);return}if(J===!1&&(mt(m.BLEND),J=!0),te!==lS){if(te!==N||Ct!==re){if((W!==Hl||ve!==Hl)&&(m.blendEquation(m.FUNC_ADD),W=Hl,ve=Hl),Ct)switch(te){case Xl:m.blendFuncSeparate(m.ONE,m.ONE_MINUS_SRC_ALPHA,m.ONE,m.ONE_MINUS_SRC_ALPHA);break;case A0:m.blendFunc(m.ONE,m.ONE);break;case C0:m.blendFuncSeparate(m.ZERO,m.ONE_MINUS_SRC_COLOR,m.ZERO,m.ONE);break;case P0:m.blendFuncSeparate(m.DST_COLOR,m.ONE_MINUS_SRC_ALPHA,m.ZERO,m.ONE);break;default:hi("WebGLState: Invalid blending: ",te);break}else switch(te){case Xl:m.blendFuncSeparate(m.SRC_ALPHA,m.ONE_MINUS_SRC_ALPHA,m.ONE,m.ONE_MINUS_SRC_ALPHA);break;case A0:m.blendFuncSeparate(m.SRC_ALPHA,m.ONE,m.ONE,m.ONE);break;case C0:hi("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case P0:hi("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:hi("WebGLState: Invalid blending: ",te);break}ge=null,de=null,Me=null,De=null,Ie.set(0,0,0),$e=0,N=te,re=Ct}return}oe=oe||Ce,Ve=Ve||Ne,lt=lt||ze,(Ce!==W||oe!==ve)&&(m.blendEquationSeparate(Ti[Ce],Ti[oe]),W=Ce,ve=oe),(Ne!==ge||ze!==de||Ve!==Me||lt!==De)&&(m.blendFuncSeparate(xi[Ne],xi[ze],xi[Ve],xi[lt]),ge=Ne,de=ze,Me=Ve,De=lt),(vt.equals(Ie)===!1||It!==$e)&&(m.blendColor(vt.r,vt.g,vt.b,It),Ie.copy(vt),$e=It),N=te,re=!1}function vi(te,Ce){te.side===As?Dt(m.CULL_FACE):mt(m.CULL_FACE);let Ne=te.side===Qr;Ce&&(Ne=!Ne),ri(Ne),te.blending===Xl&&te.transparent===!1?ci(io):ci(te.blending,te.blendEquation,te.blendSrc,te.blendDst,te.blendEquationAlpha,te.blendSrcAlpha,te.blendDstAlpha,te.blendColor,te.blendAlpha,te.premultipliedAlpha),_.setFunc(te.depthFunc),_.setTest(te.depthTest),_.setMask(te.depthWrite),v.setMask(te.colorWrite);const ze=te.stencilWrite;o.setTest(ze),ze&&(o.setMask(te.stencilWriteMask),o.setFunc(te.stencilFunc,te.stencilRef,te.stencilFuncMask),o.setOp(te.stencilFail,te.stencilZFail,te.stencilZPass)),Ji(te.polygonOffset,te.polygonOffsetFactor,te.polygonOffsetUnits),te.alphaToCoverage===!0?mt(m.SAMPLE_ALPHA_TO_COVERAGE):Dt(m.SAMPLE_ALPHA_TO_COVERAGE)}function ri(te){fe!==te&&(te?m.frontFace(m.CW):m.frontFace(m.CCW),fe=te)}function ui(te){te!==sS?(mt(m.CULL_FACE),te!==Oe&&(te===E0?m.cullFace(m.BACK):te===aS?m.cullFace(m.FRONT):m.cullFace(m.FRONT_AND_BACK))):Dt(m.CULL_FACE),Oe=te}function Le(te){te!==tt&&(nt&&m.lineWidth(te),tt=te)}function Ji(te,Ce,Ne){te?(mt(m.POLYGON_OFFSET_FILL),(Qe!==Ce||pt!==Ne)&&(m.polygonOffset(Ce,Ne),Qe=Ce,pt=Ne)):Dt(m.POLYGON_OFFSET_FILL)}function Si(te){te?mt(m.SCISSOR_TEST):Dt(m.SCISSOR_TEST)}function Ri(te){te===void 0&&(te=m.TEXTURE0+ct-1),xt!==te&&(m.activeTexture(te),xt=te)}function Vt(te,Ce,Ne){Ne===void 0&&(xt===null?Ne=m.TEXTURE0+ct-1:Ne=xt);let ze=At[Ne];ze===void 0&&(ze={type:void 0,texture:void 0},At[Ne]=ze),(ze.type!==te||ze.texture!==Ce)&&(xt!==Ne&&(m.activeTexture(Ne),xt=Ne),m.bindTexture(te,Ce||ot[te]),ze.type=te,ze.texture=Ce)}function xe(){const te=At[xt];te!==void 0&&te.type!==void 0&&(m.bindTexture(te.type,null),te.type=void 0,te.texture=void 0)}function Q(){try{m.compressedTexImage2D(...arguments)}catch(te){hi("WebGLState:",te)}}function ke(){try{m.compressedTexImage3D(...arguments)}catch(te){hi("WebGLState:",te)}}function ht(){try{m.texSubImage2D(...arguments)}catch(te){hi("WebGLState:",te)}}function yt(){try{m.texSubImage3D(...arguments)}catch(te){hi("WebGLState:",te)}}function st(){try{m.compressedTexSubImage2D(...arguments)}catch(te){hi("WebGLState:",te)}}function jt(){try{m.compressedTexSubImage3D(...arguments)}catch(te){hi("WebGLState:",te)}}function Et(){try{m.texStorage2D(...arguments)}catch(te){hi("WebGLState:",te)}}function be(){try{m.texStorage3D(...arguments)}catch(te){hi("WebGLState:",te)}}function H(){try{m.texImage2D(...arguments)}catch(te){hi("WebGLState:",te)}}function U(){try{m.texImage3D(...arguments)}catch(te){hi("WebGLState:",te)}}function Z(te){ti.equals(te)===!1&&(m.scissor(te.x,te.y,te.z,te.w),ti.copy(te))}function ae(te){Ii.equals(te)===!1&&(m.viewport(te.x,te.y,te.z,te.w),Ii.copy(te))}function pe(te,Ce){let Ne=C.get(Ce);Ne===void 0&&(Ne=new WeakMap,C.set(Ce,Ne));let ze=Ne.get(te);ze===void 0&&(ze=m.getUniformBlockIndex(Ce,te.name),Ne.set(te,ze))}function Se(te,Ce){const ze=C.get(Ce).get(te);M.get(Ce)!==ze&&(m.uniformBlockBinding(Ce,ze,te.__bindingPointIndex),M.set(Ce,ze))}function Fe(){m.disable(m.BLEND),m.disable(m.CULL_FACE),m.disable(m.DEPTH_TEST),m.disable(m.POLYGON_OFFSET_FILL),m.disable(m.SCISSOR_TEST),m.disable(m.STENCIL_TEST),m.disable(m.SAMPLE_ALPHA_TO_COVERAGE),m.blendEquation(m.FUNC_ADD),m.blendFunc(m.ONE,m.ZERO),m.blendFuncSeparate(m.ONE,m.ZERO,m.ONE,m.ZERO),m.blendColor(0,0,0,0),m.colorMask(!0,!0,!0,!0),m.clearColor(0,0,0,0),m.depthMask(!0),m.depthFunc(m.LESS),_.setReversed(!1),m.clearDepth(1),m.stencilMask(4294967295),m.stencilFunc(m.ALWAYS,0,4294967295),m.stencilOp(m.KEEP,m.KEEP,m.KEEP),m.clearStencil(0),m.cullFace(m.BACK),m.frontFace(m.CCW),m.polygonOffset(0,0),m.activeTexture(m.TEXTURE0),m.bindFramebuffer(m.FRAMEBUFFER,null),m.bindFramebuffer(m.DRAW_FRAMEBUFFER,null),m.bindFramebuffer(m.READ_FRAMEBUFFER,null),m.useProgram(null),m.lineWidth(1),m.scissor(0,0,m.canvas.width,m.canvas.height),m.viewport(0,0,m.canvas.width,m.canvas.height),D={},xt=null,At={},F={},O=new WeakMap,j=[],K=null,J=!1,N=null,W=null,ge=null,de=null,ve=null,Me=null,De=null,Ie=new bi(0,0,0),$e=0,re=!1,fe=null,Oe=null,tt=null,Qe=null,pt=null,ti.set(0,0,m.canvas.width,m.canvas.height),Ii.set(0,0,m.canvas.width,m.canvas.height),v.reset(),_.reset(),o.reset()}return{buffers:{color:v,depth:_,stencil:o},enable:mt,disable:Dt,bindFramebuffer:ni,drawBuffers:Gt,useProgram:pi,setBlending:ci,setMaterial:vi,setFlipSided:ri,setCullFace:ui,setLineWidth:Le,setPolygonOffset:Ji,setScissorTest:Si,activeTexture:Ri,bindTexture:Vt,unbindTexture:xe,compressedTexImage2D:Q,compressedTexImage3D:ke,texImage2D:H,texImage3D:U,updateUBOMapping:pe,uniformBlockBinding:Se,texStorage2D:Et,texStorage3D:be,texSubImage2D:ht,texSubImage3D:yt,compressedTexSubImage2D:st,compressedTexSubImage3D:jt,scissor:Z,viewport:ae,reset:Fe}}function nI(m,i,s,c,f,v,_){const o=i.has("WEBGL_multisampled_render_to_texture")?i.get("WEBGL_multisampled_render_to_texture"):null,M=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),C=new Bi,D=new WeakMap;let F;const O=new WeakMap;let j=!1;try{j=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function K(xe,Q){return j?new OffscreenCanvas(xe,Q):ad("canvas")}function J(xe,Q,ke){let ht=1;const yt=Vt(xe);if((yt.width>ke||yt.height>ke)&&(ht=ke/Math.max(yt.width,yt.height)),ht<1)if(typeof HTMLImageElement<"u"&&xe instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&xe instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&xe instanceof ImageBitmap||typeof VideoFrame<"u"&&xe instanceof VideoFrame){const st=Math.floor(ht*yt.width),jt=Math.floor(ht*yt.height);F===void 0&&(F=K(st,jt));const Et=Q?K(st,jt):F;return Et.width=st,Et.height=jt,Et.getContext("2d").drawImage(xe,0,0,st,jt),ei("WebGLRenderer: Texture has been resized from ("+yt.width+"x"+yt.height+") to ("+st+"x"+jt+")."),Et}else return"data"in xe&&ei("WebGLRenderer: Image in DataTexture is too big ("+yt.width+"x"+yt.height+")."),xe;return xe}function N(xe){return xe.generateMipmaps}function W(xe){m.generateMipmap(xe)}function ge(xe){return xe.isWebGLCubeRenderTarget?m.TEXTURE_CUBE_MAP:xe.isWebGL3DRenderTarget?m.TEXTURE_3D:xe.isWebGLArrayRenderTarget||xe.isCompressedArrayTexture?m.TEXTURE_2D_ARRAY:m.TEXTURE_2D}function de(xe,Q,ke,ht,yt=!1){if(xe!==null){if(m[xe]!==void 0)return m[xe];ei("WebGLRenderer: Attempt to use non-existing WebGL internal format '"+xe+"'")}let st=Q;if(Q===m.RED&&(ke===m.FLOAT&&(st=m.R32F),ke===m.HALF_FLOAT&&(st=m.R16F),ke===m.UNSIGNED_BYTE&&(st=m.R8)),Q===m.RED_INTEGER&&(ke===m.UNSIGNED_BYTE&&(st=m.R8UI),ke===m.UNSIGNED_SHORT&&(st=m.R16UI),ke===m.UNSIGNED_INT&&(st=m.R32UI),ke===m.BYTE&&(st=m.R8I),ke===m.SHORT&&(st=m.R16I),ke===m.INT&&(st=m.R32I)),Q===m.RG&&(ke===m.FLOAT&&(st=m.RG32F),ke===m.HALF_FLOAT&&(st=m.RG16F),ke===m.UNSIGNED_BYTE&&(st=m.RG8)),Q===m.RG_INTEGER&&(ke===m.UNSIGNED_BYTE&&(st=m.RG8UI),ke===m.UNSIGNED_SHORT&&(st=m.RG16UI),ke===m.UNSIGNED_INT&&(st=m.RG32UI),ke===m.BYTE&&(st=m.RG8I),ke===m.SHORT&&(st=m.RG16I),ke===m.INT&&(st=m.RG32I)),Q===m.RGB_INTEGER&&(ke===m.UNSIGNED_BYTE&&(st=m.RGB8UI),ke===m.UNSIGNED_SHORT&&(st=m.RGB16UI),ke===m.UNSIGNED_INT&&(st=m.RGB32UI),ke===m.BYTE&&(st=m.RGB8I),ke===m.SHORT&&(st=m.RGB16I),ke===m.INT&&(st=m.RGB32I)),Q===m.RGBA_INTEGER&&(ke===m.UNSIGNED_BYTE&&(st=m.RGBA8UI),ke===m.UNSIGNED_SHORT&&(st=m.RGBA16UI),ke===m.UNSIGNED_INT&&(st=m.RGBA32UI),ke===m.BYTE&&(st=m.RGBA8I),ke===m.SHORT&&(st=m.RGBA16I),ke===m.INT&&(st=m.RGBA32I)),Q===m.RGB&&(ke===m.UNSIGNED_INT_5_9_9_9_REV&&(st=m.RGB9_E5),ke===m.UNSIGNED_INT_10F_11F_11F_REV&&(st=m.R11F_G11F_B10F)),Q===m.RGBA){const jt=yt?gp:Ni.getTransfer(ht);ke===m.FLOAT&&(st=m.RGBA32F),ke===m.HALF_FLOAT&&(st=m.RGBA16F),ke===m.UNSIGNED_BYTE&&(st=jt===en?m.SRGB8_ALPHA8:m.RGBA8),ke===m.UNSIGNED_SHORT_4_4_4_4&&(st=m.RGBA4),ke===m.UNSIGNED_SHORT_5_5_5_1&&(st=m.RGB5_A1)}return(st===m.R16F||st===m.R32F||st===m.RG16F||st===m.RG32F||st===m.RGBA16F||st===m.RGBA32F)&&i.get("EXT_color_buffer_float"),st}function ve(xe,Q){let ke;return xe?Q===null||Q===ga||Q===nd?ke=m.DEPTH24_STENCIL8:Q===Cs?ke=m.DEPTH32F_STENCIL8:Q===id&&(ke=m.DEPTH24_STENCIL8,ei("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):Q===null||Q===ga||Q===nd?ke=m.DEPTH_COMPONENT24:Q===Cs?ke=m.DEPTH_COMPONENT32F:Q===id&&(ke=m.DEPTH_COMPONENT16),ke}function Me(xe,Q){return N(xe)===!0||xe.isFramebufferTexture&&xe.minFilter!==ir&&xe.minFilter!==nr?Math.log2(Math.max(Q.width,Q.height))+1:xe.mipmaps!==void 0&&xe.mipmaps.length>0?xe.mipmaps.length:xe.isCompressedTexture&&Array.isArray(xe.image)?Q.mipmaps.length:1}function De(xe){const Q=xe.target;Q.removeEventListener("dispose",De),$e(Q),Q.isVideoTexture&&D.delete(Q)}function Ie(xe){const Q=xe.target;Q.removeEventListener("dispose",Ie),fe(Q)}function $e(xe){const Q=c.get(xe);if(Q.__webglInit===void 0)return;const ke=xe.source,ht=O.get(ke);if(ht){const yt=ht[Q.__cacheKey];yt.usedTimes--,yt.usedTimes===0&&re(xe),Object.keys(ht).length===0&&O.delete(ke)}c.remove(xe)}function re(xe){const Q=c.get(xe);m.deleteTexture(Q.__webglTexture);const ke=xe.source,ht=O.get(ke);delete ht[Q.__cacheKey],_.memory.textures--}function fe(xe){const Q=c.get(xe);if(xe.depthTexture&&(xe.depthTexture.dispose(),c.remove(xe.depthTexture)),xe.isWebGLCubeRenderTarget)for(let ht=0;ht<6;ht++){if(Array.isArray(Q.__webglFramebuffer[ht]))for(let yt=0;yt<Q.__webglFramebuffer[ht].length;yt++)m.deleteFramebuffer(Q.__webglFramebuffer[ht][yt]);else m.deleteFramebuffer(Q.__webglFramebuffer[ht]);Q.__webglDepthbuffer&&m.deleteRenderbuffer(Q.__webglDepthbuffer[ht])}else{if(Array.isArray(Q.__webglFramebuffer))for(let ht=0;ht<Q.__webglFramebuffer.length;ht++)m.deleteFramebuffer(Q.__webglFramebuffer[ht]);else m.deleteFramebuffer(Q.__webglFramebuffer);if(Q.__webglDepthbuffer&&m.deleteRenderbuffer(Q.__webglDepthbuffer),Q.__webglMultisampledFramebuffer&&m.deleteFramebuffer(Q.__webglMultisampledFramebuffer),Q.__webglColorRenderbuffer)for(let ht=0;ht<Q.__webglColorRenderbuffer.length;ht++)Q.__webglColorRenderbuffer[ht]&&m.deleteRenderbuffer(Q.__webglColorRenderbuffer[ht]);Q.__webglDepthRenderbuffer&&m.deleteRenderbuffer(Q.__webglDepthRenderbuffer)}const ke=xe.textures;for(let ht=0,yt=ke.length;ht<yt;ht++){const st=c.get(ke[ht]);st.__webglTexture&&(m.deleteTexture(st.__webglTexture),_.memory.textures--),c.remove(ke[ht])}c.remove(xe)}let Oe=0;function tt(){Oe=0}function Qe(){const xe=Oe;return xe>=f.maxTextures&&ei("WebGLTextures: Trying to use "+xe+" texture units while this GPU supports only "+f.maxTextures),Oe+=1,xe}function pt(xe){const Q=[];return Q.push(xe.wrapS),Q.push(xe.wrapT),Q.push(xe.wrapR||0),Q.push(xe.magFilter),Q.push(xe.minFilter),Q.push(xe.anisotropy),Q.push(xe.internalFormat),Q.push(xe.format),Q.push(xe.type),Q.push(xe.generateMipmaps),Q.push(xe.premultiplyAlpha),Q.push(xe.flipY),Q.push(xe.unpackAlignment),Q.push(xe.colorSpace),Q.join()}function ct(xe,Q){const ke=c.get(xe);if(xe.isVideoTexture&&Si(xe),xe.isRenderTargetTexture===!1&&xe.isExternalTexture!==!0&&xe.version>0&&ke.__version!==xe.version){const ht=xe.image;if(ht===null)ei("WebGLRenderer: Texture marked for update but no image data found.");else if(ht.complete===!1)ei("WebGLRenderer: Texture marked for update but image is incomplete");else{ot(ke,xe,Q);return}}else xe.isExternalTexture&&(ke.__webglTexture=xe.sourceTexture?xe.sourceTexture:null);s.bindTexture(m.TEXTURE_2D,ke.__webglTexture,m.TEXTURE0+Q)}function nt(xe,Q){const ke=c.get(xe);if(xe.isRenderTargetTexture===!1&&xe.version>0&&ke.__version!==xe.version){ot(ke,xe,Q);return}else xe.isExternalTexture&&(ke.__webglTexture=xe.sourceTexture?xe.sourceTexture:null);s.bindTexture(m.TEXTURE_2D_ARRAY,ke.__webglTexture,m.TEXTURE0+Q)}function Je(xe,Q){const ke=c.get(xe);if(xe.isRenderTargetTexture===!1&&xe.version>0&&ke.__version!==xe.version){ot(ke,xe,Q);return}s.bindTexture(m.TEXTURE_3D,ke.__webglTexture,m.TEXTURE0+Q)}function ut(xe,Q){const ke=c.get(xe);if(xe.isCubeDepthTexture!==!0&&xe.version>0&&ke.__version!==xe.version){mt(ke,xe,Q);return}s.bindTexture(m.TEXTURE_CUBE_MAP,ke.__webglTexture,m.TEXTURE0+Q)}const xt={[_u]:m.REPEAT,[ha]:m.CLAMP_TO_EDGE,[mp]:m.MIRRORED_REPEAT},At={[ir]:m.NEAREST,[bb]:m.NEAREST_MIPMAP_NEAREST,[Yh]:m.NEAREST_MIPMAP_LINEAR,[nr]:m.LINEAR,[cp]:m.LINEAR_MIPMAP_NEAREST,[Qa]:m.LINEAR_MIPMAP_LINEAR},Rt={[LS]:m.NEVER,[BS]:m.ALWAYS,[FS]:m.LESS,[K_]:m.LEQUAL,[zS]:m.EQUAL,[J_]:m.GEQUAL,[OS]:m.GREATER,[NS]:m.NOTEQUAL};function oi(xe,Q){if(Q.type===Cs&&i.has("OES_texture_float_linear")===!1&&(Q.magFilter===nr||Q.magFilter===cp||Q.magFilter===Yh||Q.magFilter===Qa||Q.minFilter===nr||Q.minFilter===cp||Q.minFilter===Yh||Q.minFilter===Qa)&&ei("WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),m.texParameteri(xe,m.TEXTURE_WRAP_S,xt[Q.wrapS]),m.texParameteri(xe,m.TEXTURE_WRAP_T,xt[Q.wrapT]),(xe===m.TEXTURE_3D||xe===m.TEXTURE_2D_ARRAY)&&m.texParameteri(xe,m.TEXTURE_WRAP_R,xt[Q.wrapR]),m.texParameteri(xe,m.TEXTURE_MAG_FILTER,At[Q.magFilter]),m.texParameteri(xe,m.TEXTURE_MIN_FILTER,At[Q.minFilter]),Q.compareFunction&&(m.texParameteri(xe,m.TEXTURE_COMPARE_MODE,m.COMPARE_REF_TO_TEXTURE),m.texParameteri(xe,m.TEXTURE_COMPARE_FUNC,Rt[Q.compareFunction])),i.has("EXT_texture_filter_anisotropic")===!0){if(Q.magFilter===ir||Q.minFilter!==Yh&&Q.minFilter!==Qa||Q.type===Cs&&i.has("OES_texture_float_linear")===!1)return;if(Q.anisotropy>1||c.get(Q).__currentAnisotropy){const ke=i.get("EXT_texture_filter_anisotropic");m.texParameterf(xe,ke.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Q.anisotropy,f.getMaxAnisotropy())),c.get(Q).__currentAnisotropy=Q.anisotropy}}}function ti(xe,Q){let ke=!1;xe.__webglInit===void 0&&(xe.__webglInit=!0,Q.addEventListener("dispose",De));const ht=Q.source;let yt=O.get(ht);yt===void 0&&(yt={},O.set(ht,yt));const st=pt(Q);if(st!==xe.__cacheKey){yt[st]===void 0&&(yt[st]={texture:m.createTexture(),usedTimes:0},_.memory.textures++,ke=!0),yt[st].usedTimes++;const jt=yt[xe.__cacheKey];jt!==void 0&&(yt[xe.__cacheKey].usedTimes--,jt.usedTimes===0&&re(Q)),xe.__cacheKey=st,xe.__webglTexture=yt[st].texture}return ke}function Ii(xe,Q,ke){return Math.floor(Math.floor(xe/ke)/Q)}function yi(xe,Q,ke,ht){const st=xe.updateRanges;if(st.length===0)s.texSubImage2D(m.TEXTURE_2D,0,0,0,Q.width,Q.height,ke,ht,Q.data);else{st.sort((U,Z)=>U.start-Z.start);let jt=0;for(let U=1;U<st.length;U++){const Z=st[jt],ae=st[U],pe=Z.start+Z.count,Se=Ii(ae.start,Q.width,4),Fe=Ii(Z.start,Q.width,4);ae.start<=pe+1&&Se===Fe&&Ii(ae.start+ae.count-1,Q.width,4)===Se?Z.count=Math.max(Z.count,ae.start+ae.count-Z.start):(++jt,st[jt]=ae)}st.length=jt+1;const Et=m.getParameter(m.UNPACK_ROW_LENGTH),be=m.getParameter(m.UNPACK_SKIP_PIXELS),H=m.getParameter(m.UNPACK_SKIP_ROWS);m.pixelStorei(m.UNPACK_ROW_LENGTH,Q.width);for(let U=0,Z=st.length;U<Z;U++){const ae=st[U],pe=Math.floor(ae.start/4),Se=Math.ceil(ae.count/4),Fe=pe%Q.width,te=Math.floor(pe/Q.width),Ce=Se,Ne=1;m.pixelStorei(m.UNPACK_SKIP_PIXELS,Fe),m.pixelStorei(m.UNPACK_SKIP_ROWS,te),s.texSubImage2D(m.TEXTURE_2D,0,Fe,te,Ce,Ne,ke,ht,Q.data)}xe.clearUpdateRanges(),m.pixelStorei(m.UNPACK_ROW_LENGTH,Et),m.pixelStorei(m.UNPACK_SKIP_PIXELS,be),m.pixelStorei(m.UNPACK_SKIP_ROWS,H)}}function ot(xe,Q,ke){let ht=m.TEXTURE_2D;(Q.isDataArrayTexture||Q.isCompressedArrayTexture)&&(ht=m.TEXTURE_2D_ARRAY),Q.isData3DTexture&&(ht=m.TEXTURE_3D);const yt=ti(xe,Q),st=Q.source;s.bindTexture(ht,xe.__webglTexture,m.TEXTURE0+ke);const jt=c.get(st);if(st.version!==jt.__version||yt===!0){s.activeTexture(m.TEXTURE0+ke);const Et=Ni.getPrimaries(Ni.workingColorSpace),be=Q.colorSpace===Xo?null:Ni.getPrimaries(Q.colorSpace),H=Q.colorSpace===Xo||Et===be?m.NONE:m.BROWSER_DEFAULT_WEBGL;m.pixelStorei(m.UNPACK_FLIP_Y_WEBGL,Q.flipY),m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Q.premultiplyAlpha),m.pixelStorei(m.UNPACK_ALIGNMENT,Q.unpackAlignment),m.pixelStorei(m.UNPACK_COLORSPACE_CONVERSION_WEBGL,H);let U=J(Q.image,!1,f.maxTextureSize);U=Ri(Q,U);const Z=v.convert(Q.format,Q.colorSpace),ae=v.convert(Q.type);let pe=de(Q.internalFormat,Z,ae,Q.colorSpace,Q.isVideoTexture);oi(ht,Q);let Se;const Fe=Q.mipmaps,te=Q.isVideoTexture!==!0,Ce=jt.__version===void 0||yt===!0,Ne=st.dataReady,ze=Me(Q,U);if(Q.isDepthTexture)pe=ve(Q.format===Wl,Q.type),Ce&&(te?s.texStorage2D(m.TEXTURE_2D,1,pe,U.width,U.height):s.texImage2D(m.TEXTURE_2D,0,pe,U.width,U.height,0,Z,ae,null));else if(Q.isDataTexture)if(Fe.length>0){te&&Ce&&s.texStorage2D(m.TEXTURE_2D,ze,pe,Fe[0].width,Fe[0].height);for(let oe=0,Ve=Fe.length;oe<Ve;oe++)Se=Fe[oe],te?Ne&&s.texSubImage2D(m.TEXTURE_2D,oe,0,0,Se.width,Se.height,Z,ae,Se.data):s.texImage2D(m.TEXTURE_2D,oe,pe,Se.width,Se.height,0,Z,ae,Se.data);Q.generateMipmaps=!1}else te?(Ce&&s.texStorage2D(m.TEXTURE_2D,ze,pe,U.width,U.height),Ne&&yi(Q,U,Z,ae)):s.texImage2D(m.TEXTURE_2D,0,pe,U.width,U.height,0,Z,ae,U.data);else if(Q.isCompressedTexture)if(Q.isCompressedArrayTexture){te&&Ce&&s.texStorage3D(m.TEXTURE_2D_ARRAY,ze,pe,Fe[0].width,Fe[0].height,U.depth);for(let oe=0,Ve=Fe.length;oe<Ve;oe++)if(Se=Fe[oe],Q.format!==Ps)if(Z!==null)if(te){if(Ne)if(Q.layerUpdates.size>0){const lt=_v(Se.width,Se.height,Q.format,Q.type);for(const vt of Q.layerUpdates){const It=Se.data.subarray(vt*lt/Se.data.BYTES_PER_ELEMENT,(vt+1)*lt/Se.data.BYTES_PER_ELEMENT);s.compressedTexSubImage3D(m.TEXTURE_2D_ARRAY,oe,0,0,vt,Se.width,Se.height,1,Z,It)}Q.clearLayerUpdates()}else s.compressedTexSubImage3D(m.TEXTURE_2D_ARRAY,oe,0,0,0,Se.width,Se.height,U.depth,Z,Se.data)}else s.compressedTexImage3D(m.TEXTURE_2D_ARRAY,oe,pe,Se.width,Se.height,U.depth,0,Se.data,0,0);else ei("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else te?Ne&&s.texSubImage3D(m.TEXTURE_2D_ARRAY,oe,0,0,0,Se.width,Se.height,U.depth,Z,ae,Se.data):s.texImage3D(m.TEXTURE_2D_ARRAY,oe,pe,Se.width,Se.height,U.depth,0,Z,ae,Se.data)}else{te&&Ce&&s.texStorage2D(m.TEXTURE_2D,ze,pe,Fe[0].width,Fe[0].height);for(let oe=0,Ve=Fe.length;oe<Ve;oe++)Se=Fe[oe],Q.format!==Ps?Z!==null?te?Ne&&s.compressedTexSubImage2D(m.TEXTURE_2D,oe,0,0,Se.width,Se.height,Z,Se.data):s.compressedTexImage2D(m.TEXTURE_2D,oe,pe,Se.width,Se.height,0,Se.data):ei("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):te?Ne&&s.texSubImage2D(m.TEXTURE_2D,oe,0,0,Se.width,Se.height,Z,ae,Se.data):s.texImage2D(m.TEXTURE_2D,oe,pe,Se.width,Se.height,0,Z,ae,Se.data)}else if(Q.isDataArrayTexture)if(te){if(Ce&&s.texStorage3D(m.TEXTURE_2D_ARRAY,ze,pe,U.width,U.height,U.depth),Ne)if(Q.layerUpdates.size>0){const oe=_v(U.width,U.height,Q.format,Q.type);for(const Ve of Q.layerUpdates){const lt=U.data.subarray(Ve*oe/U.data.BYTES_PER_ELEMENT,(Ve+1)*oe/U.data.BYTES_PER_ELEMENT);s.texSubImage3D(m.TEXTURE_2D_ARRAY,0,0,0,Ve,U.width,U.height,1,Z,ae,lt)}Q.clearLayerUpdates()}else s.texSubImage3D(m.TEXTURE_2D_ARRAY,0,0,0,0,U.width,U.height,U.depth,Z,ae,U.data)}else s.texImage3D(m.TEXTURE_2D_ARRAY,0,pe,U.width,U.height,U.depth,0,Z,ae,U.data);else if(Q.isData3DTexture)te?(Ce&&s.texStorage3D(m.TEXTURE_3D,ze,pe,U.width,U.height,U.depth),Ne&&s.texSubImage3D(m.TEXTURE_3D,0,0,0,0,U.width,U.height,U.depth,Z,ae,U.data)):s.texImage3D(m.TEXTURE_3D,0,pe,U.width,U.height,U.depth,0,Z,ae,U.data);else if(Q.isFramebufferTexture){if(Ce)if(te)s.texStorage2D(m.TEXTURE_2D,ze,pe,U.width,U.height);else{let oe=U.width,Ve=U.height;for(let lt=0;lt<ze;lt++)s.texImage2D(m.TEXTURE_2D,lt,pe,oe,Ve,0,Z,ae,null),oe>>=1,Ve>>=1}}else if(Fe.length>0){if(te&&Ce){const oe=Vt(Fe[0]);s.texStorage2D(m.TEXTURE_2D,ze,pe,oe.width,oe.height)}for(let oe=0,Ve=Fe.length;oe<Ve;oe++)Se=Fe[oe],te?Ne&&s.texSubImage2D(m.TEXTURE_2D,oe,0,0,Z,ae,Se):s.texImage2D(m.TEXTURE_2D,oe,pe,Z,ae,Se);Q.generateMipmaps=!1}else if(te){if(Ce){const oe=Vt(U);s.texStorage2D(m.TEXTURE_2D,ze,pe,oe.width,oe.height)}Ne&&s.texSubImage2D(m.TEXTURE_2D,0,0,0,Z,ae,U)}else s.texImage2D(m.TEXTURE_2D,0,pe,Z,ae,U);N(Q)&&W(ht),jt.__version=st.version,Q.onUpdate&&Q.onUpdate(Q)}xe.__version=Q.version}function mt(xe,Q,ke){if(Q.image.length!==6)return;const ht=ti(xe,Q),yt=Q.source;s.bindTexture(m.TEXTURE_CUBE_MAP,xe.__webglTexture,m.TEXTURE0+ke);const st=c.get(yt);if(yt.version!==st.__version||ht===!0){s.activeTexture(m.TEXTURE0+ke);const jt=Ni.getPrimaries(Ni.workingColorSpace),Et=Q.colorSpace===Xo?null:Ni.getPrimaries(Q.colorSpace),be=Q.colorSpace===Xo||jt===Et?m.NONE:m.BROWSER_DEFAULT_WEBGL;m.pixelStorei(m.UNPACK_FLIP_Y_WEBGL,Q.flipY),m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Q.premultiplyAlpha),m.pixelStorei(m.UNPACK_ALIGNMENT,Q.unpackAlignment),m.pixelStorei(m.UNPACK_COLORSPACE_CONVERSION_WEBGL,be);const H=Q.isCompressedTexture||Q.image[0].isCompressedTexture,U=Q.image[0]&&Q.image[0].isDataTexture,Z=[];for(let Ve=0;Ve<6;Ve++)!H&&!U?Z[Ve]=J(Q.image[Ve],!0,f.maxCubemapSize):Z[Ve]=U?Q.image[Ve].image:Q.image[Ve],Z[Ve]=Ri(Q,Z[Ve]);const ae=Z[0],pe=v.convert(Q.format,Q.colorSpace),Se=v.convert(Q.type),Fe=de(Q.internalFormat,pe,Se,Q.colorSpace),te=Q.isVideoTexture!==!0,Ce=st.__version===void 0||ht===!0,Ne=yt.dataReady;let ze=Me(Q,ae);oi(m.TEXTURE_CUBE_MAP,Q);let oe;if(H){te&&Ce&&s.texStorage2D(m.TEXTURE_CUBE_MAP,ze,Fe,ae.width,ae.height);for(let Ve=0;Ve<6;Ve++){oe=Z[Ve].mipmaps;for(let lt=0;lt<oe.length;lt++){const vt=oe[lt];Q.format!==Ps?pe!==null?te?Ne&&s.compressedTexSubImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+Ve,lt,0,0,vt.width,vt.height,pe,vt.data):s.compressedTexImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+Ve,lt,Fe,vt.width,vt.height,0,vt.data):ei("WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):te?Ne&&s.texSubImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+Ve,lt,0,0,vt.width,vt.height,pe,Se,vt.data):s.texImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+Ve,lt,Fe,vt.width,vt.height,0,pe,Se,vt.data)}}}else{if(oe=Q.mipmaps,te&&Ce){oe.length>0&&ze++;const Ve=Vt(Z[0]);s.texStorage2D(m.TEXTURE_CUBE_MAP,ze,Fe,Ve.width,Ve.height)}for(let Ve=0;Ve<6;Ve++)if(U){te?Ne&&s.texSubImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+Ve,0,0,0,Z[Ve].width,Z[Ve].height,pe,Se,Z[Ve].data):s.texImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+Ve,0,Fe,Z[Ve].width,Z[Ve].height,0,pe,Se,Z[Ve].data);for(let lt=0;lt<oe.length;lt++){const It=oe[lt].image[Ve].image;te?Ne&&s.texSubImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+Ve,lt+1,0,0,It.width,It.height,pe,Se,It.data):s.texImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+Ve,lt+1,Fe,It.width,It.height,0,pe,Se,It.data)}}else{te?Ne&&s.texSubImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+Ve,0,0,0,pe,Se,Z[Ve]):s.texImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+Ve,0,Fe,pe,Se,Z[Ve]);for(let lt=0;lt<oe.length;lt++){const vt=oe[lt];te?Ne&&s.texSubImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+Ve,lt+1,0,0,pe,Se,vt.image[Ve]):s.texImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+Ve,lt+1,Fe,pe,Se,vt.image[Ve])}}}N(Q)&&W(m.TEXTURE_CUBE_MAP),st.__version=yt.version,Q.onUpdate&&Q.onUpdate(Q)}xe.__version=Q.version}function Dt(xe,Q,ke,ht,yt,st){const jt=v.convert(ke.format,ke.colorSpace),Et=v.convert(ke.type),be=de(ke.internalFormat,jt,Et,ke.colorSpace),H=c.get(Q),U=c.get(ke);if(U.__renderTarget=Q,!H.__hasExternalTextures){const Z=Math.max(1,Q.width>>st),ae=Math.max(1,Q.height>>st);yt===m.TEXTURE_3D||yt===m.TEXTURE_2D_ARRAY?s.texImage3D(yt,st,be,Z,ae,Q.depth,0,jt,Et,null):s.texImage2D(yt,st,be,Z,ae,0,jt,Et,null)}s.bindFramebuffer(m.FRAMEBUFFER,xe),Ji(Q)?o.framebufferTexture2DMultisampleEXT(m.FRAMEBUFFER,ht,yt,U.__webglTexture,0,Le(Q)):(yt===m.TEXTURE_2D||yt>=m.TEXTURE_CUBE_MAP_POSITIVE_X&&yt<=m.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&m.framebufferTexture2D(m.FRAMEBUFFER,ht,yt,U.__webglTexture,st),s.bindFramebuffer(m.FRAMEBUFFER,null)}function ni(xe,Q,ke){if(m.bindRenderbuffer(m.RENDERBUFFER,xe),Q.depthBuffer){const ht=Q.depthTexture,yt=ht&&ht.isDepthTexture?ht.type:null,st=ve(Q.stencilBuffer,yt),jt=Q.stencilBuffer?m.DEPTH_STENCIL_ATTACHMENT:m.DEPTH_ATTACHMENT;Ji(Q)?o.renderbufferStorageMultisampleEXT(m.RENDERBUFFER,Le(Q),st,Q.width,Q.height):ke?m.renderbufferStorageMultisample(m.RENDERBUFFER,Le(Q),st,Q.width,Q.height):m.renderbufferStorage(m.RENDERBUFFER,st,Q.width,Q.height),m.framebufferRenderbuffer(m.FRAMEBUFFER,jt,m.RENDERBUFFER,xe)}else{const ht=Q.textures;for(let yt=0;yt<ht.length;yt++){const st=ht[yt],jt=v.convert(st.format,st.colorSpace),Et=v.convert(st.type),be=de(st.internalFormat,jt,Et,st.colorSpace);Ji(Q)?o.renderbufferStorageMultisampleEXT(m.RENDERBUFFER,Le(Q),be,Q.width,Q.height):ke?m.renderbufferStorageMultisample(m.RENDERBUFFER,Le(Q),be,Q.width,Q.height):m.renderbufferStorage(m.RENDERBUFFER,be,Q.width,Q.height)}}m.bindRenderbuffer(m.RENDERBUFFER,null)}function Gt(xe,Q,ke){const ht=Q.isWebGLCubeRenderTarget===!0;if(s.bindFramebuffer(m.FRAMEBUFFER,xe),!(Q.depthTexture&&Q.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const yt=c.get(Q.depthTexture);if(yt.__renderTarget=Q,(!yt.__webglTexture||Q.depthTexture.image.width!==Q.width||Q.depthTexture.image.height!==Q.height)&&(Q.depthTexture.image.width=Q.width,Q.depthTexture.image.height=Q.height,Q.depthTexture.needsUpdate=!0),ht){if(yt.__webglInit===void 0&&(yt.__webglInit=!0,Q.depthTexture.addEventListener("dispose",De)),yt.__webglTexture===void 0){yt.__webglTexture=m.createTexture(),s.bindTexture(m.TEXTURE_CUBE_MAP,yt.__webglTexture),oi(m.TEXTURE_CUBE_MAP,Q.depthTexture);const H=v.convert(Q.depthTexture.format),U=v.convert(Q.depthTexture.type);let Z;Q.depthTexture.format===ao?Z=m.DEPTH_COMPONENT24:Q.depthTexture.format===Wl&&(Z=m.DEPTH24_STENCIL8);for(let ae=0;ae<6;ae++)m.texImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+ae,0,Z,Q.width,Q.height,0,H,U,null)}}else ct(Q.depthTexture,0);const st=yt.__webglTexture,jt=Le(Q),Et=ht?m.TEXTURE_CUBE_MAP_POSITIVE_X+ke:m.TEXTURE_2D,be=Q.depthTexture.format===Wl?m.DEPTH_STENCIL_ATTACHMENT:m.DEPTH_ATTACHMENT;if(Q.depthTexture.format===ao)Ji(Q)?o.framebufferTexture2DMultisampleEXT(m.FRAMEBUFFER,be,Et,st,0,jt):m.framebufferTexture2D(m.FRAMEBUFFER,be,Et,st,0);else if(Q.depthTexture.format===Wl)Ji(Q)?o.framebufferTexture2DMultisampleEXT(m.FRAMEBUFFER,be,Et,st,0,jt):m.framebufferTexture2D(m.FRAMEBUFFER,be,Et,st,0);else throw new Error("Unknown depthTexture format")}function pi(xe){const Q=c.get(xe),ke=xe.isWebGLCubeRenderTarget===!0;if(Q.__boundDepthTexture!==xe.depthTexture){const ht=xe.depthTexture;if(Q.__depthDisposeCallback&&Q.__depthDisposeCallback(),ht){const yt=()=>{delete Q.__boundDepthTexture,delete Q.__depthDisposeCallback,ht.removeEventListener("dispose",yt)};ht.addEventListener("dispose",yt),Q.__depthDisposeCallback=yt}Q.__boundDepthTexture=ht}if(xe.depthTexture&&!Q.__autoAllocateDepthBuffer)if(ke)for(let ht=0;ht<6;ht++)Gt(Q.__webglFramebuffer[ht],xe,ht);else{const ht=xe.texture.mipmaps;ht&&ht.length>0?Gt(Q.__webglFramebuffer[0],xe,0):Gt(Q.__webglFramebuffer,xe,0)}else if(ke){Q.__webglDepthbuffer=[];for(let ht=0;ht<6;ht++)if(s.bindFramebuffer(m.FRAMEBUFFER,Q.__webglFramebuffer[ht]),Q.__webglDepthbuffer[ht]===void 0)Q.__webglDepthbuffer[ht]=m.createRenderbuffer(),ni(Q.__webglDepthbuffer[ht],xe,!1);else{const yt=xe.stencilBuffer?m.DEPTH_STENCIL_ATTACHMENT:m.DEPTH_ATTACHMENT,st=Q.__webglDepthbuffer[ht];m.bindRenderbuffer(m.RENDERBUFFER,st),m.framebufferRenderbuffer(m.FRAMEBUFFER,yt,m.RENDERBUFFER,st)}}else{const ht=xe.texture.mipmaps;if(ht&&ht.length>0?s.bindFramebuffer(m.FRAMEBUFFER,Q.__webglFramebuffer[0]):s.bindFramebuffer(m.FRAMEBUFFER,Q.__webglFramebuffer),Q.__webglDepthbuffer===void 0)Q.__webglDepthbuffer=m.createRenderbuffer(),ni(Q.__webglDepthbuffer,xe,!1);else{const yt=xe.stencilBuffer?m.DEPTH_STENCIL_ATTACHMENT:m.DEPTH_ATTACHMENT,st=Q.__webglDepthbuffer;m.bindRenderbuffer(m.RENDERBUFFER,st),m.framebufferRenderbuffer(m.FRAMEBUFFER,yt,m.RENDERBUFFER,st)}}s.bindFramebuffer(m.FRAMEBUFFER,null)}function Ti(xe,Q,ke){const ht=c.get(xe);Q!==void 0&&Dt(ht.__webglFramebuffer,xe,xe.texture,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,0),ke!==void 0&&pi(xe)}function xi(xe){const Q=xe.texture,ke=c.get(xe),ht=c.get(Q);xe.addEventListener("dispose",Ie);const yt=xe.textures,st=xe.isWebGLCubeRenderTarget===!0,jt=yt.length>1;if(jt||(ht.__webglTexture===void 0&&(ht.__webglTexture=m.createTexture()),ht.__version=Q.version,_.memory.textures++),st){ke.__webglFramebuffer=[];for(let Et=0;Et<6;Et++)if(Q.mipmaps&&Q.mipmaps.length>0){ke.__webglFramebuffer[Et]=[];for(let be=0;be<Q.mipmaps.length;be++)ke.__webglFramebuffer[Et][be]=m.createFramebuffer()}else ke.__webglFramebuffer[Et]=m.createFramebuffer()}else{if(Q.mipmaps&&Q.mipmaps.length>0){ke.__webglFramebuffer=[];for(let Et=0;Et<Q.mipmaps.length;Et++)ke.__webglFramebuffer[Et]=m.createFramebuffer()}else ke.__webglFramebuffer=m.createFramebuffer();if(jt)for(let Et=0,be=yt.length;Et<be;Et++){const H=c.get(yt[Et]);H.__webglTexture===void 0&&(H.__webglTexture=m.createTexture(),_.memory.textures++)}if(xe.samples>0&&Ji(xe)===!1){ke.__webglMultisampledFramebuffer=m.createFramebuffer(),ke.__webglColorRenderbuffer=[],s.bindFramebuffer(m.FRAMEBUFFER,ke.__webglMultisampledFramebuffer);for(let Et=0;Et<yt.length;Et++){const be=yt[Et];ke.__webglColorRenderbuffer[Et]=m.createRenderbuffer(),m.bindRenderbuffer(m.RENDERBUFFER,ke.__webglColorRenderbuffer[Et]);const H=v.convert(be.format,be.colorSpace),U=v.convert(be.type),Z=de(be.internalFormat,H,U,be.colorSpace,xe.isXRRenderTarget===!0),ae=Le(xe);m.renderbufferStorageMultisample(m.RENDERBUFFER,ae,Z,xe.width,xe.height),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0+Et,m.RENDERBUFFER,ke.__webglColorRenderbuffer[Et])}m.bindRenderbuffer(m.RENDERBUFFER,null),xe.depthBuffer&&(ke.__webglDepthRenderbuffer=m.createRenderbuffer(),ni(ke.__webglDepthRenderbuffer,xe,!0)),s.bindFramebuffer(m.FRAMEBUFFER,null)}}if(st){s.bindTexture(m.TEXTURE_CUBE_MAP,ht.__webglTexture),oi(m.TEXTURE_CUBE_MAP,Q);for(let Et=0;Et<6;Et++)if(Q.mipmaps&&Q.mipmaps.length>0)for(let be=0;be<Q.mipmaps.length;be++)Dt(ke.__webglFramebuffer[Et][be],xe,Q,m.COLOR_ATTACHMENT0,m.TEXTURE_CUBE_MAP_POSITIVE_X+Et,be);else Dt(ke.__webglFramebuffer[Et],xe,Q,m.COLOR_ATTACHMENT0,m.TEXTURE_CUBE_MAP_POSITIVE_X+Et,0);N(Q)&&W(m.TEXTURE_CUBE_MAP),s.unbindTexture()}else if(jt){for(let Et=0,be=yt.length;Et<be;Et++){const H=yt[Et],U=c.get(H);let Z=m.TEXTURE_2D;(xe.isWebGL3DRenderTarget||xe.isWebGLArrayRenderTarget)&&(Z=xe.isWebGL3DRenderTarget?m.TEXTURE_3D:m.TEXTURE_2D_ARRAY),s.bindTexture(Z,U.__webglTexture),oi(Z,H),Dt(ke.__webglFramebuffer,xe,H,m.COLOR_ATTACHMENT0+Et,Z,0),N(H)&&W(Z)}s.unbindTexture()}else{let Et=m.TEXTURE_2D;if((xe.isWebGL3DRenderTarget||xe.isWebGLArrayRenderTarget)&&(Et=xe.isWebGL3DRenderTarget?m.TEXTURE_3D:m.TEXTURE_2D_ARRAY),s.bindTexture(Et,ht.__webglTexture),oi(Et,Q),Q.mipmaps&&Q.mipmaps.length>0)for(let be=0;be<Q.mipmaps.length;be++)Dt(ke.__webglFramebuffer[be],xe,Q,m.COLOR_ATTACHMENT0,Et,be);else Dt(ke.__webglFramebuffer,xe,Q,m.COLOR_ATTACHMENT0,Et,0);N(Q)&&W(Et),s.unbindTexture()}xe.depthBuffer&&pi(xe)}function ci(xe){const Q=xe.textures;for(let ke=0,ht=Q.length;ke<ht;ke++){const yt=Q[ke];if(N(yt)){const st=ge(xe),jt=c.get(yt).__webglTexture;s.bindTexture(st,jt),W(st),s.unbindTexture()}}}const vi=[],ri=[];function ui(xe){if(xe.samples>0){if(Ji(xe)===!1){const Q=xe.textures,ke=xe.width,ht=xe.height;let yt=m.COLOR_BUFFER_BIT;const st=xe.stencilBuffer?m.DEPTH_STENCIL_ATTACHMENT:m.DEPTH_ATTACHMENT,jt=c.get(xe),Et=Q.length>1;if(Et)for(let H=0;H<Q.length;H++)s.bindFramebuffer(m.FRAMEBUFFER,jt.__webglMultisampledFramebuffer),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0+H,m.RENDERBUFFER,null),s.bindFramebuffer(m.FRAMEBUFFER,jt.__webglFramebuffer),m.framebufferTexture2D(m.DRAW_FRAMEBUFFER,m.COLOR_ATTACHMENT0+H,m.TEXTURE_2D,null,0);s.bindFramebuffer(m.READ_FRAMEBUFFER,jt.__webglMultisampledFramebuffer);const be=xe.texture.mipmaps;be&&be.length>0?s.bindFramebuffer(m.DRAW_FRAMEBUFFER,jt.__webglFramebuffer[0]):s.bindFramebuffer(m.DRAW_FRAMEBUFFER,jt.__webglFramebuffer);for(let H=0;H<Q.length;H++){if(xe.resolveDepthBuffer&&(xe.depthBuffer&&(yt|=m.DEPTH_BUFFER_BIT),xe.stencilBuffer&&xe.resolveStencilBuffer&&(yt|=m.STENCIL_BUFFER_BIT)),Et){m.framebufferRenderbuffer(m.READ_FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.RENDERBUFFER,jt.__webglColorRenderbuffer[H]);const U=c.get(Q[H]).__webglTexture;m.framebufferTexture2D(m.DRAW_FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,U,0)}m.blitFramebuffer(0,0,ke,ht,0,0,ke,ht,yt,m.NEAREST),M===!0&&(vi.length=0,ri.length=0,vi.push(m.COLOR_ATTACHMENT0+H),xe.depthBuffer&&xe.resolveDepthBuffer===!1&&(vi.push(st),ri.push(st),m.invalidateFramebuffer(m.DRAW_FRAMEBUFFER,ri)),m.invalidateFramebuffer(m.READ_FRAMEBUFFER,vi))}if(s.bindFramebuffer(m.READ_FRAMEBUFFER,null),s.bindFramebuffer(m.DRAW_FRAMEBUFFER,null),Et)for(let H=0;H<Q.length;H++){s.bindFramebuffer(m.FRAMEBUFFER,jt.__webglMultisampledFramebuffer),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0+H,m.RENDERBUFFER,jt.__webglColorRenderbuffer[H]);const U=c.get(Q[H]).__webglTexture;s.bindFramebuffer(m.FRAMEBUFFER,jt.__webglFramebuffer),m.framebufferTexture2D(m.DRAW_FRAMEBUFFER,m.COLOR_ATTACHMENT0+H,m.TEXTURE_2D,U,0)}s.bindFramebuffer(m.DRAW_FRAMEBUFFER,jt.__webglMultisampledFramebuffer)}else if(xe.depthBuffer&&xe.resolveDepthBuffer===!1&&M){const Q=xe.stencilBuffer?m.DEPTH_STENCIL_ATTACHMENT:m.DEPTH_ATTACHMENT;m.invalidateFramebuffer(m.DRAW_FRAMEBUFFER,[Q])}}}function Le(xe){return Math.min(f.maxSamples,xe.samples)}function Ji(xe){const Q=c.get(xe);return xe.samples>0&&i.has("WEBGL_multisampled_render_to_texture")===!0&&Q.__useRenderToTexture!==!1}function Si(xe){const Q=_.render.frame;D.get(xe)!==Q&&(D.set(xe,Q),xe.update())}function Ri(xe,Q){const ke=xe.colorSpace,ht=xe.format,yt=xe.type;return xe.isCompressedTexture===!0||xe.isVideoTexture===!0||ke!==Vr&&ke!==Xo&&(Ni.getTransfer(ke)===en?(ht!==Ps||yt!==gs)&&ei("WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):hi("WebGLTextures: Unsupported texture color space:",ke)),Q}function Vt(xe){return typeof HTMLImageElement<"u"&&xe instanceof HTMLImageElement?(C.width=xe.naturalWidth||xe.width,C.height=xe.naturalHeight||xe.height):typeof VideoFrame<"u"&&xe instanceof VideoFrame?(C.width=xe.displayWidth,C.height=xe.displayHeight):(C.width=xe.width,C.height=xe.height),C}this.allocateTextureUnit=Qe,this.resetTextureUnits=tt,this.setTexture2D=ct,this.setTexture2DArray=nt,this.setTexture3D=Je,this.setTextureCube=ut,this.rebindTextures=Ti,this.setupRenderTarget=xi,this.updateRenderTargetMipmap=ci,this.updateMultisampleRenderTarget=ui,this.setupDepthRenderbuffer=pi,this.setupFrameBufferTexture=Dt,this.useMultisampledRTT=Ji,this.isReversedDepthBuffer=function(){return s.buffers.depth.getReversed()}}function rI(m,i){function s(c,f=Xo){let v;const _=Ni.getTransfer(f);if(c===gs)return m.UNSIGNED_BYTE;if(c===W_)return m.UNSIGNED_SHORT_4_4_4_4;if(c===q_)return m.UNSIGNED_SHORT_5_5_5_1;if(c===Sb)return m.UNSIGNED_INT_5_9_9_9_REV;if(c===Mb)return m.UNSIGNED_INT_10F_11F_11F_REV;if(c===wb)return m.BYTE;if(c===Tb)return m.SHORT;if(c===id)return m.UNSIGNED_SHORT;if(c===j_)return m.INT;if(c===ga)return m.UNSIGNED_INT;if(c===Cs)return m.FLOAT;if(c===so)return m.HALF_FLOAT;if(c===Eb)return m.ALPHA;if(c===Ab)return m.RGB;if(c===Ps)return m.RGBA;if(c===ao)return m.DEPTH_COMPONENT;if(c===Wl)return m.DEPTH_STENCIL;if(c===X_)return m.RED;if(c===Z_)return m.RED_INTEGER;if(c===yu)return m.RG;if(c===$_)return m.RG_INTEGER;if(c===Y_)return m.RGBA_INTEGER;if(c===up||c===hp||c===dp||c===fp)if(_===en)if(v=i.get("WEBGL_compressed_texture_s3tc_srgb"),v!==null){if(c===up)return v.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(c===hp)return v.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(c===dp)return v.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(c===fp)return v.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(v=i.get("WEBGL_compressed_texture_s3tc"),v!==null){if(c===up)return v.COMPRESSED_RGB_S3TC_DXT1_EXT;if(c===hp)return v.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(c===dp)return v.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(c===fp)return v.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(c===Kg||c===Jg||c===Qg||c===e_)if(v=i.get("WEBGL_compressed_texture_pvrtc"),v!==null){if(c===Kg)return v.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(c===Jg)return v.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(c===Qg)return v.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(c===e_)return v.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(c===t_||c===i_||c===n_||c===r_||c===s_||c===a_||c===o_)if(v=i.get("WEBGL_compressed_texture_etc"),v!==null){if(c===t_||c===i_)return _===en?v.COMPRESSED_SRGB8_ETC2:v.COMPRESSED_RGB8_ETC2;if(c===n_)return _===en?v.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:v.COMPRESSED_RGBA8_ETC2_EAC;if(c===r_)return v.COMPRESSED_R11_EAC;if(c===s_)return v.COMPRESSED_SIGNED_R11_EAC;if(c===a_)return v.COMPRESSED_RG11_EAC;if(c===o_)return v.COMPRESSED_SIGNED_RG11_EAC}else return null;if(c===l_||c===c_||c===u_||c===h_||c===d_||c===f_||c===p_||c===m_||c===g_||c===__||c===y_||c===x_||c===v_||c===b_)if(v=i.get("WEBGL_compressed_texture_astc"),v!==null){if(c===l_)return _===en?v.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:v.COMPRESSED_RGBA_ASTC_4x4_KHR;if(c===c_)return _===en?v.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:v.COMPRESSED_RGBA_ASTC_5x4_KHR;if(c===u_)return _===en?v.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:v.COMPRESSED_RGBA_ASTC_5x5_KHR;if(c===h_)return _===en?v.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:v.COMPRESSED_RGBA_ASTC_6x5_KHR;if(c===d_)return _===en?v.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:v.COMPRESSED_RGBA_ASTC_6x6_KHR;if(c===f_)return _===en?v.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:v.COMPRESSED_RGBA_ASTC_8x5_KHR;if(c===p_)return _===en?v.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:v.COMPRESSED_RGBA_ASTC_8x6_KHR;if(c===m_)return _===en?v.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:v.COMPRESSED_RGBA_ASTC_8x8_KHR;if(c===g_)return _===en?v.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:v.COMPRESSED_RGBA_ASTC_10x5_KHR;if(c===__)return _===en?v.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:v.COMPRESSED_RGBA_ASTC_10x6_KHR;if(c===y_)return _===en?v.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:v.COMPRESSED_RGBA_ASTC_10x8_KHR;if(c===x_)return _===en?v.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:v.COMPRESSED_RGBA_ASTC_10x10_KHR;if(c===v_)return _===en?v.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:v.COMPRESSED_RGBA_ASTC_12x10_KHR;if(c===b_)return _===en?v.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:v.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(c===w_||c===T_||c===S_)if(v=i.get("EXT_texture_compression_bptc"),v!==null){if(c===w_)return _===en?v.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:v.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(c===T_)return v.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(c===S_)return v.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(c===M_||c===E_||c===A_||c===C_)if(v=i.get("EXT_texture_compression_rgtc"),v!==null){if(c===M_)return v.COMPRESSED_RED_RGTC1_EXT;if(c===E_)return v.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(c===A_)return v.COMPRESSED_RED_GREEN_RGTC2_EXT;if(c===C_)return v.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return c===nd?m.UNSIGNED_INT_24_8:m[c]!==void 0?m[c]:null}return{convert:s}}const sI=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,aI=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class oI{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(i,s){if(this.texture===null){const c=new Gb(i.texture);(i.depthNear!==s.depthNear||i.depthFar!==s.depthFar)&&(this.depthNear=i.depthNear,this.depthFar=i.depthFar),this.texture=c}}getMesh(i){if(this.texture!==null&&this.mesh===null){const s=i.cameras[0].viewport,c=new ya({vertexShader:sI,fragmentShader:aI,uniforms:{depthColor:{value:this.texture},depthWidth:{value:s.z},depthHeight:{value:s.w}}});this.mesh=new Gr(new Sp(20,20),c)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class lI extends Su{constructor(i,s){super();const c=this;let f=null,v=1,_=null,o="local-floor",M=1,C=null,D=null,F=null,O=null,j=null,K=null;const J=typeof XRWebGLBinding<"u",N=new oI,W={},ge=s.getContextAttributes();let de=null,ve=null;const Me=[],De=[],Ie=new Bi;let $e=null;const re=new Jr;re.viewport=new wn;const fe=new Jr;fe.viewport=new wn;const Oe=[re,fe],tt=new cE;let Qe=null,pt=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(ot){let mt=Me[ot];return mt===void 0&&(mt=new vg,Me[ot]=mt),mt.getTargetRaySpace()},this.getControllerGrip=function(ot){let mt=Me[ot];return mt===void 0&&(mt=new vg,Me[ot]=mt),mt.getGripSpace()},this.getHand=function(ot){let mt=Me[ot];return mt===void 0&&(mt=new vg,Me[ot]=mt),mt.getHandSpace()};function ct(ot){const mt=De.indexOf(ot.inputSource);if(mt===-1)return;const Dt=Me[mt];Dt!==void 0&&(Dt.update(ot.inputSource,ot.frame,C||_),Dt.dispatchEvent({type:ot.type,data:ot.inputSource}))}function nt(){f.removeEventListener("select",ct),f.removeEventListener("selectstart",ct),f.removeEventListener("selectend",ct),f.removeEventListener("squeeze",ct),f.removeEventListener("squeezestart",ct),f.removeEventListener("squeezeend",ct),f.removeEventListener("end",nt),f.removeEventListener("inputsourceschange",Je);for(let ot=0;ot<Me.length;ot++){const mt=De[ot];mt!==null&&(De[ot]=null,Me[ot].disconnect(mt))}Qe=null,pt=null,N.reset();for(const ot in W)delete W[ot];i.setRenderTarget(de),j=null,O=null,F=null,f=null,ve=null,yi.stop(),c.isPresenting=!1,i.setPixelRatio($e),i.setSize(Ie.width,Ie.height,!1),c.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(ot){v=ot,c.isPresenting===!0&&ei("WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(ot){o=ot,c.isPresenting===!0&&ei("WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return C||_},this.setReferenceSpace=function(ot){C=ot},this.getBaseLayer=function(){return O!==null?O:j},this.getBinding=function(){return F===null&&J&&(F=new XRWebGLBinding(f,s)),F},this.getFrame=function(){return K},this.getSession=function(){return f},this.setSession=async function(ot){if(f=ot,f!==null){if(de=i.getRenderTarget(),f.addEventListener("select",ct),f.addEventListener("selectstart",ct),f.addEventListener("selectend",ct),f.addEventListener("squeeze",ct),f.addEventListener("squeezestart",ct),f.addEventListener("squeezeend",ct),f.addEventListener("end",nt),f.addEventListener("inputsourceschange",Je),ge.xrCompatible!==!0&&await s.makeXRCompatible(),$e=i.getPixelRatio(),i.getSize(Ie),J&&"createProjectionLayer"in XRWebGLBinding.prototype){let Dt=null,ni=null,Gt=null;ge.depth&&(Gt=ge.stencil?s.DEPTH24_STENCIL8:s.DEPTH_COMPONENT24,Dt=ge.stencil?Wl:ao,ni=ge.stencil?nd:ga);const pi={colorFormat:s.RGBA8,depthFormat:Gt,scaleFactor:v};F=this.getBinding(),O=F.createProjectionLayer(pi),f.updateRenderState({layers:[O]}),i.setPixelRatio(1),i.setSize(O.textureWidth,O.textureHeight,!1),ve=new pa(O.textureWidth,O.textureHeight,{format:Ps,type:gs,depthTexture:new ld(O.textureWidth,O.textureHeight,ni,void 0,void 0,void 0,void 0,void 0,void 0,Dt),stencilBuffer:ge.stencil,colorSpace:i.outputColorSpace,samples:ge.antialias?4:0,resolveDepthBuffer:O.ignoreDepthValues===!1,resolveStencilBuffer:O.ignoreDepthValues===!1})}else{const Dt={antialias:ge.antialias,alpha:!0,depth:ge.depth,stencil:ge.stencil,framebufferScaleFactor:v};j=new XRWebGLLayer(f,s,Dt),f.updateRenderState({baseLayer:j}),i.setPixelRatio(1),i.setSize(j.framebufferWidth,j.framebufferHeight,!1),ve=new pa(j.framebufferWidth,j.framebufferHeight,{format:Ps,type:gs,colorSpace:i.outputColorSpace,stencilBuffer:ge.stencil,resolveDepthBuffer:j.ignoreDepthValues===!1,resolveStencilBuffer:j.ignoreDepthValues===!1})}ve.isXRRenderTarget=!0,this.setFoveation(M),C=null,_=await f.requestReferenceSpace(o),yi.setContext(f),yi.start(),c.isPresenting=!0,c.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(f!==null)return f.environmentBlendMode},this.getDepthTexture=function(){return N.getDepthTexture()};function Je(ot){for(let mt=0;mt<ot.removed.length;mt++){const Dt=ot.removed[mt],ni=De.indexOf(Dt);ni>=0&&(De[ni]=null,Me[ni].disconnect(Dt))}for(let mt=0;mt<ot.added.length;mt++){const Dt=ot.added[mt];let ni=De.indexOf(Dt);if(ni===-1){for(let pi=0;pi<Me.length;pi++)if(pi>=De.length){De.push(Dt),ni=pi;break}else if(De[pi]===null){De[pi]=Dt,ni=pi;break}if(ni===-1)break}const Gt=Me[ni];Gt&&Gt.connect(Dt)}}const ut=new We,xt=new We;function At(ot,mt,Dt){ut.setFromMatrixPosition(mt.matrixWorld),xt.setFromMatrixPosition(Dt.matrixWorld);const ni=ut.distanceTo(xt),Gt=mt.projectionMatrix.elements,pi=Dt.projectionMatrix.elements,Ti=Gt[14]/(Gt[10]-1),xi=Gt[14]/(Gt[10]+1),ci=(Gt[9]+1)/Gt[5],vi=(Gt[9]-1)/Gt[5],ri=(Gt[8]-1)/Gt[0],ui=(pi[8]+1)/pi[0],Le=Ti*ri,Ji=Ti*ui,Si=ni/(-ri+ui),Ri=Si*-ri;if(mt.matrixWorld.decompose(ot.position,ot.quaternion,ot.scale),ot.translateX(Ri),ot.translateZ(Si),ot.matrixWorld.compose(ot.position,ot.quaternion,ot.scale),ot.matrixWorldInverse.copy(ot.matrixWorld).invert(),Gt[10]===-1)ot.projectionMatrix.copy(mt.projectionMatrix),ot.projectionMatrixInverse.copy(mt.projectionMatrixInverse);else{const Vt=Ti+Si,xe=xi+Si,Q=Le-Ri,ke=Ji+(ni-Ri),ht=ci*xi/xe*Vt,yt=vi*xi/xe*Vt;ot.projectionMatrix.makePerspective(Q,ke,ht,yt,Vt,xe),ot.projectionMatrixInverse.copy(ot.projectionMatrix).invert()}}function Rt(ot,mt){mt===null?ot.matrixWorld.copy(ot.matrix):ot.matrixWorld.multiplyMatrices(mt.matrixWorld,ot.matrix),ot.matrixWorldInverse.copy(ot.matrixWorld).invert()}this.updateCamera=function(ot){if(f===null)return;let mt=ot.near,Dt=ot.far;N.texture!==null&&(N.depthNear>0&&(mt=N.depthNear),N.depthFar>0&&(Dt=N.depthFar)),tt.near=fe.near=re.near=mt,tt.far=fe.far=re.far=Dt,(Qe!==tt.near||pt!==tt.far)&&(f.updateRenderState({depthNear:tt.near,depthFar:tt.far}),Qe=tt.near,pt=tt.far),tt.layers.mask=ot.layers.mask|6,re.layers.mask=tt.layers.mask&3,fe.layers.mask=tt.layers.mask&5;const ni=ot.parent,Gt=tt.cameras;Rt(tt,ni);for(let pi=0;pi<Gt.length;pi++)Rt(Gt[pi],ni);Gt.length===2?At(tt,re,fe):tt.projectionMatrix.copy(re.projectionMatrix),oi(ot,tt,ni)};function oi(ot,mt,Dt){Dt===null?ot.matrix.copy(mt.matrixWorld):(ot.matrix.copy(Dt.matrixWorld),ot.matrix.invert(),ot.matrix.multiply(mt.matrixWorld)),ot.matrix.decompose(ot.position,ot.quaternion,ot.scale),ot.updateMatrixWorld(!0),ot.projectionMatrix.copy(mt.projectionMatrix),ot.projectionMatrixInverse.copy(mt.projectionMatrixInverse),ot.isPerspectiveCamera&&(ot.fov=xu*2*Math.atan(1/ot.projectionMatrix.elements[5]),ot.zoom=1)}this.getCamera=function(){return tt},this.getFoveation=function(){if(!(O===null&&j===null))return M},this.setFoveation=function(ot){M=ot,O!==null&&(O.fixedFoveation=ot),j!==null&&j.fixedFoveation!==void 0&&(j.fixedFoveation=ot)},this.hasDepthSensing=function(){return N.texture!==null},this.getDepthSensingMesh=function(){return N.getMesh(tt)},this.getCameraTexture=function(ot){return W[ot]};let ti=null;function Ii(ot,mt){if(D=mt.getViewerPose(C||_),K=mt,D!==null){const Dt=D.views;j!==null&&(i.setRenderTargetFramebuffer(ve,j.framebuffer),i.setRenderTarget(ve));let ni=!1;Dt.length!==tt.cameras.length&&(tt.cameras.length=0,ni=!0);for(let xi=0;xi<Dt.length;xi++){const ci=Dt[xi];let vi=null;if(j!==null)vi=j.getViewport(ci);else{const ui=F.getViewSubImage(O,ci);vi=ui.viewport,xi===0&&(i.setRenderTargetTextures(ve,ui.colorTexture,ui.depthStencilTexture),i.setRenderTarget(ve))}let ri=Oe[xi];ri===void 0&&(ri=new Jr,ri.layers.enable(xi),ri.viewport=new wn,Oe[xi]=ri),ri.matrix.fromArray(ci.transform.matrix),ri.matrix.decompose(ri.position,ri.quaternion,ri.scale),ri.projectionMatrix.fromArray(ci.projectionMatrix),ri.projectionMatrixInverse.copy(ri.projectionMatrix).invert(),ri.viewport.set(vi.x,vi.y,vi.width,vi.height),xi===0&&(tt.matrix.copy(ri.matrix),tt.matrix.decompose(tt.position,tt.quaternion,tt.scale)),ni===!0&&tt.cameras.push(ri)}const Gt=f.enabledFeatures;if(Gt&&Gt.includes("depth-sensing")&&f.depthUsage=="gpu-optimized"&&J){F=c.getBinding();const xi=F.getDepthInformation(Dt[0]);xi&&xi.isValid&&xi.texture&&N.init(xi,f.renderState)}if(Gt&&Gt.includes("camera-access")&&J){i.state.unbindTexture(),F=c.getBinding();for(let xi=0;xi<Dt.length;xi++){const ci=Dt[xi].camera;if(ci){let vi=W[ci];vi||(vi=new Gb,W[ci]=vi);const ri=F.getCameraImage(ci);vi.sourceTexture=ri}}}}for(let Dt=0;Dt<Me.length;Dt++){const ni=De[Dt],Gt=Me[Dt];ni!==null&&Gt!==void 0&&Gt.update(ni,mt,C||_)}ti&&ti(ot,mt),mt.detectedPlanes&&c.dispatchEvent({type:"planesdetected",data:mt}),K=null}const yi=new Xb;yi.setAnimationLoop(Ii),this.setAnimationLoop=function(ot){ti=ot},this.dispose=function(){}}}const Ul=new _a,cI=new gi;function uI(m,i){function s(N,W){N.matrixAutoUpdate===!0&&N.updateMatrix(),W.value.copy(N.matrix)}function c(N,W){W.color.getRGB(N.fogColor.value,Ob(m)),W.isFog?(N.fogNear.value=W.near,N.fogFar.value=W.far):W.isFogExp2&&(N.fogDensity.value=W.density)}function f(N,W,ge,de,ve){W.isMeshBasicMaterial||W.isMeshLambertMaterial?v(N,W):W.isMeshToonMaterial?(v(N,W),F(N,W)):W.isMeshPhongMaterial?(v(N,W),D(N,W)):W.isMeshStandardMaterial?(v(N,W),O(N,W),W.isMeshPhysicalMaterial&&j(N,W,ve)):W.isMeshMatcapMaterial?(v(N,W),K(N,W)):W.isMeshDepthMaterial?v(N,W):W.isMeshDistanceMaterial?(v(N,W),J(N,W)):W.isMeshNormalMaterial?v(N,W):W.isLineBasicMaterial?(_(N,W),W.isLineDashedMaterial&&o(N,W)):W.isPointsMaterial?M(N,W,ge,de):W.isSpriteMaterial?C(N,W):W.isShadowMaterial?(N.color.value.copy(W.color),N.opacity.value=W.opacity):W.isShaderMaterial&&(W.uniformsNeedUpdate=!1)}function v(N,W){N.opacity.value=W.opacity,W.color&&N.diffuse.value.copy(W.color),W.emissive&&N.emissive.value.copy(W.emissive).multiplyScalar(W.emissiveIntensity),W.map&&(N.map.value=W.map,s(W.map,N.mapTransform)),W.alphaMap&&(N.alphaMap.value=W.alphaMap,s(W.alphaMap,N.alphaMapTransform)),W.bumpMap&&(N.bumpMap.value=W.bumpMap,s(W.bumpMap,N.bumpMapTransform),N.bumpScale.value=W.bumpScale,W.side===Qr&&(N.bumpScale.value*=-1)),W.normalMap&&(N.normalMap.value=W.normalMap,s(W.normalMap,N.normalMapTransform),N.normalScale.value.copy(W.normalScale),W.side===Qr&&N.normalScale.value.negate()),W.displacementMap&&(N.displacementMap.value=W.displacementMap,s(W.displacementMap,N.displacementMapTransform),N.displacementScale.value=W.displacementScale,N.displacementBias.value=W.displacementBias),W.emissiveMap&&(N.emissiveMap.value=W.emissiveMap,s(W.emissiveMap,N.emissiveMapTransform)),W.specularMap&&(N.specularMap.value=W.specularMap,s(W.specularMap,N.specularMapTransform)),W.alphaTest>0&&(N.alphaTest.value=W.alphaTest);const ge=i.get(W),de=ge.envMap,ve=ge.envMapRotation;de&&(N.envMap.value=de,Ul.copy(ve),Ul.x*=-1,Ul.y*=-1,Ul.z*=-1,de.isCubeTexture&&de.isRenderTargetTexture===!1&&(Ul.y*=-1,Ul.z*=-1),N.envMapRotation.value.setFromMatrix4(cI.makeRotationFromEuler(Ul)),N.flipEnvMap.value=de.isCubeTexture&&de.isRenderTargetTexture===!1?-1:1,N.reflectivity.value=W.reflectivity,N.ior.value=W.ior,N.refractionRatio.value=W.refractionRatio),W.lightMap&&(N.lightMap.value=W.lightMap,N.lightMapIntensity.value=W.lightMapIntensity,s(W.lightMap,N.lightMapTransform)),W.aoMap&&(N.aoMap.value=W.aoMap,N.aoMapIntensity.value=W.aoMapIntensity,s(W.aoMap,N.aoMapTransform))}function _(N,W){N.diffuse.value.copy(W.color),N.opacity.value=W.opacity,W.map&&(N.map.value=W.map,s(W.map,N.mapTransform))}function o(N,W){N.dashSize.value=W.dashSize,N.totalSize.value=W.dashSize+W.gapSize,N.scale.value=W.scale}function M(N,W,ge,de){N.diffuse.value.copy(W.color),N.opacity.value=W.opacity,N.size.value=W.size*ge,N.scale.value=de*.5,W.map&&(N.map.value=W.map,s(W.map,N.uvTransform)),W.alphaMap&&(N.alphaMap.value=W.alphaMap,s(W.alphaMap,N.alphaMapTransform)),W.alphaTest>0&&(N.alphaTest.value=W.alphaTest)}function C(N,W){N.diffuse.value.copy(W.color),N.opacity.value=W.opacity,N.rotation.value=W.rotation,W.map&&(N.map.value=W.map,s(W.map,N.mapTransform)),W.alphaMap&&(N.alphaMap.value=W.alphaMap,s(W.alphaMap,N.alphaMapTransform)),W.alphaTest>0&&(N.alphaTest.value=W.alphaTest)}function D(N,W){N.specular.value.copy(W.specular),N.shininess.value=Math.max(W.shininess,1e-4)}function F(N,W){W.gradientMap&&(N.gradientMap.value=W.gradientMap)}function O(N,W){N.metalness.value=W.metalness,W.metalnessMap&&(N.metalnessMap.value=W.metalnessMap,s(W.metalnessMap,N.metalnessMapTransform)),N.roughness.value=W.roughness,W.roughnessMap&&(N.roughnessMap.value=W.roughnessMap,s(W.roughnessMap,N.roughnessMapTransform)),W.envMap&&(N.envMapIntensity.value=W.envMapIntensity)}function j(N,W,ge){N.ior.value=W.ior,W.sheen>0&&(N.sheenColor.value.copy(W.sheenColor).multiplyScalar(W.sheen),N.sheenRoughness.value=W.sheenRoughness,W.sheenColorMap&&(N.sheenColorMap.value=W.sheenColorMap,s(W.sheenColorMap,N.sheenColorMapTransform)),W.sheenRoughnessMap&&(N.sheenRoughnessMap.value=W.sheenRoughnessMap,s(W.sheenRoughnessMap,N.sheenRoughnessMapTransform))),W.clearcoat>0&&(N.clearcoat.value=W.clearcoat,N.clearcoatRoughness.value=W.clearcoatRoughness,W.clearcoatMap&&(N.clearcoatMap.value=W.clearcoatMap,s(W.clearcoatMap,N.clearcoatMapTransform)),W.clearcoatRoughnessMap&&(N.clearcoatRoughnessMap.value=W.clearcoatRoughnessMap,s(W.clearcoatRoughnessMap,N.clearcoatRoughnessMapTransform)),W.clearcoatNormalMap&&(N.clearcoatNormalMap.value=W.clearcoatNormalMap,s(W.clearcoatNormalMap,N.clearcoatNormalMapTransform),N.clearcoatNormalScale.value.copy(W.clearcoatNormalScale),W.side===Qr&&N.clearcoatNormalScale.value.negate())),W.dispersion>0&&(N.dispersion.value=W.dispersion),W.iridescence>0&&(N.iridescence.value=W.iridescence,N.iridescenceIOR.value=W.iridescenceIOR,N.iridescenceThicknessMinimum.value=W.iridescenceThicknessRange[0],N.iridescenceThicknessMaximum.value=W.iridescenceThicknessRange[1],W.iridescenceMap&&(N.iridescenceMap.value=W.iridescenceMap,s(W.iridescenceMap,N.iridescenceMapTransform)),W.iridescenceThicknessMap&&(N.iridescenceThicknessMap.value=W.iridescenceThicknessMap,s(W.iridescenceThicknessMap,N.iridescenceThicknessMapTransform))),W.transmission>0&&(N.transmission.value=W.transmission,N.transmissionSamplerMap.value=ge.texture,N.transmissionSamplerSize.value.set(ge.width,ge.height),W.transmissionMap&&(N.transmissionMap.value=W.transmissionMap,s(W.transmissionMap,N.transmissionMapTransform)),N.thickness.value=W.thickness,W.thicknessMap&&(N.thicknessMap.value=W.thicknessMap,s(W.thicknessMap,N.thicknessMapTransform)),N.attenuationDistance.value=W.attenuationDistance,N.attenuationColor.value.copy(W.attenuationColor)),W.anisotropy>0&&(N.anisotropyVector.value.set(W.anisotropy*Math.cos(W.anisotropyRotation),W.anisotropy*Math.sin(W.anisotropyRotation)),W.anisotropyMap&&(N.anisotropyMap.value=W.anisotropyMap,s(W.anisotropyMap,N.anisotropyMapTransform))),N.specularIntensity.value=W.specularIntensity,N.specularColor.value.copy(W.specularColor),W.specularColorMap&&(N.specularColorMap.value=W.specularColorMap,s(W.specularColorMap,N.specularColorMapTransform)),W.specularIntensityMap&&(N.specularIntensityMap.value=W.specularIntensityMap,s(W.specularIntensityMap,N.specularIntensityMapTransform))}function K(N,W){W.matcap&&(N.matcap.value=W.matcap)}function J(N,W){const ge=i.get(W).light;N.referencePosition.value.setFromMatrixPosition(ge.matrixWorld),N.nearDistance.value=ge.shadow.camera.near,N.farDistance.value=ge.shadow.camera.far}return{refreshFogUniforms:c,refreshMaterialUniforms:f}}function hI(m,i,s,c){let f={},v={},_=[];const o=m.getParameter(m.MAX_UNIFORM_BUFFER_BINDINGS);function M(ge,de){const ve=de.program;c.uniformBlockBinding(ge,ve)}function C(ge,de){let ve=f[ge.id];ve===void 0&&(K(ge),ve=D(ge),f[ge.id]=ve,ge.addEventListener("dispose",N));const Me=de.program;c.updateUBOMapping(ge,Me);const De=i.render.frame;v[ge.id]!==De&&(O(ge),v[ge.id]=De)}function D(ge){const de=F();ge.__bindingPointIndex=de;const ve=m.createBuffer(),Me=ge.__size,De=ge.usage;return m.bindBuffer(m.UNIFORM_BUFFER,ve),m.bufferData(m.UNIFORM_BUFFER,Me,De),m.bindBuffer(m.UNIFORM_BUFFER,null),m.bindBufferBase(m.UNIFORM_BUFFER,de,ve),ve}function F(){for(let ge=0;ge<o;ge++)if(_.indexOf(ge)===-1)return _.push(ge),ge;return hi("WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function O(ge){const de=f[ge.id],ve=ge.uniforms,Me=ge.__cache;m.bindBuffer(m.UNIFORM_BUFFER,de);for(let De=0,Ie=ve.length;De<Ie;De++){const $e=Array.isArray(ve[De])?ve[De]:[ve[De]];for(let re=0,fe=$e.length;re<fe;re++){const Oe=$e[re];if(j(Oe,De,re,Me)===!0){const tt=Oe.__offset,Qe=Array.isArray(Oe.value)?Oe.value:[Oe.value];let pt=0;for(let ct=0;ct<Qe.length;ct++){const nt=Qe[ct],Je=J(nt);typeof nt=="number"||typeof nt=="boolean"?(Oe.__data[0]=nt,m.bufferSubData(m.UNIFORM_BUFFER,tt+pt,Oe.__data)):nt.isMatrix3?(Oe.__data[0]=nt.elements[0],Oe.__data[1]=nt.elements[1],Oe.__data[2]=nt.elements[2],Oe.__data[3]=0,Oe.__data[4]=nt.elements[3],Oe.__data[5]=nt.elements[4],Oe.__data[6]=nt.elements[5],Oe.__data[7]=0,Oe.__data[8]=nt.elements[6],Oe.__data[9]=nt.elements[7],Oe.__data[10]=nt.elements[8],Oe.__data[11]=0):(nt.toArray(Oe.__data,pt),pt+=Je.storage/Float32Array.BYTES_PER_ELEMENT)}m.bufferSubData(m.UNIFORM_BUFFER,tt,Oe.__data)}}}m.bindBuffer(m.UNIFORM_BUFFER,null)}function j(ge,de,ve,Me){const De=ge.value,Ie=de+"_"+ve;if(Me[Ie]===void 0)return typeof De=="number"||typeof De=="boolean"?Me[Ie]=De:Me[Ie]=De.clone(),!0;{const $e=Me[Ie];if(typeof De=="number"||typeof De=="boolean"){if($e!==De)return Me[Ie]=De,!0}else if($e.equals(De)===!1)return $e.copy(De),!0}return!1}function K(ge){const de=ge.uniforms;let ve=0;const Me=16;for(let Ie=0,$e=de.length;Ie<$e;Ie++){const re=Array.isArray(de[Ie])?de[Ie]:[de[Ie]];for(let fe=0,Oe=re.length;fe<Oe;fe++){const tt=re[fe],Qe=Array.isArray(tt.value)?tt.value:[tt.value];for(let pt=0,ct=Qe.length;pt<ct;pt++){const nt=Qe[pt],Je=J(nt),ut=ve%Me,xt=ut%Je.boundary,At=ut+xt;ve+=xt,At!==0&&Me-At<Je.storage&&(ve+=Me-At),tt.__data=new Float32Array(Je.storage/Float32Array.BYTES_PER_ELEMENT),tt.__offset=ve,ve+=Je.storage}}}const De=ve%Me;return De>0&&(ve+=Me-De),ge.__size=ve,ge.__cache={},this}function J(ge){const de={boundary:0,storage:0};return typeof ge=="number"||typeof ge=="boolean"?(de.boundary=4,de.storage=4):ge.isVector2?(de.boundary=8,de.storage=8):ge.isVector3||ge.isColor?(de.boundary=16,de.storage=12):ge.isVector4?(de.boundary=16,de.storage=16):ge.isMatrix3?(de.boundary=48,de.storage=48):ge.isMatrix4?(de.boundary=64,de.storage=64):ge.isTexture?ei("WebGLRenderer: Texture samplers can not be part of an uniforms group."):ei("WebGLRenderer: Unsupported uniform value type.",ge),de}function N(ge){const de=ge.target;de.removeEventListener("dispose",N);const ve=_.indexOf(de.__bindingPointIndex);_.splice(ve,1),m.deleteBuffer(f[de.id]),delete f[de.id],delete v[de.id]}function W(){for(const ge in f)m.deleteBuffer(f[ge]);_=[],f={},v={}}return{bind:M,update:C,dispose:W}}const dI=new Uint16Array([12469,15057,12620,14925,13266,14620,13807,14376,14323,13990,14545,13625,14713,13328,14840,12882,14931,12528,14996,12233,15039,11829,15066,11525,15080,11295,15085,10976,15082,10705,15073,10495,13880,14564,13898,14542,13977,14430,14158,14124,14393,13732,14556,13410,14702,12996,14814,12596,14891,12291,14937,11834,14957,11489,14958,11194,14943,10803,14921,10506,14893,10278,14858,9960,14484,14039,14487,14025,14499,13941,14524,13740,14574,13468,14654,13106,14743,12678,14818,12344,14867,11893,14889,11509,14893,11180,14881,10751,14852,10428,14812,10128,14765,9754,14712,9466,14764,13480,14764,13475,14766,13440,14766,13347,14769,13070,14786,12713,14816,12387,14844,11957,14860,11549,14868,11215,14855,10751,14825,10403,14782,10044,14729,9651,14666,9352,14599,9029,14967,12835,14966,12831,14963,12804,14954,12723,14936,12564,14917,12347,14900,11958,14886,11569,14878,11247,14859,10765,14828,10401,14784,10011,14727,9600,14660,9289,14586,8893,14508,8533,15111,12234,15110,12234,15104,12216,15092,12156,15067,12010,15028,11776,14981,11500,14942,11205,14902,10752,14861,10393,14812,9991,14752,9570,14682,9252,14603,8808,14519,8445,14431,8145,15209,11449,15208,11451,15202,11451,15190,11438,15163,11384,15117,11274,15055,10979,14994,10648,14932,10343,14871,9936,14803,9532,14729,9218,14645,8742,14556,8381,14461,8020,14365,7603,15273,10603,15272,10607,15267,10619,15256,10631,15231,10614,15182,10535,15118,10389,15042,10167,14963,9787,14883,9447,14800,9115,14710,8665,14615,8318,14514,7911,14411,7507,14279,7198,15314,9675,15313,9683,15309,9712,15298,9759,15277,9797,15229,9773,15166,9668,15084,9487,14995,9274,14898,8910,14800,8539,14697,8234,14590,7790,14479,7409,14367,7067,14178,6621,15337,8619,15337,8631,15333,8677,15325,8769,15305,8871,15264,8940,15202,8909,15119,8775,15022,8565,14916,8328,14804,8009,14688,7614,14569,7287,14448,6888,14321,6483,14088,6171,15350,7402,15350,7419,15347,7480,15340,7613,15322,7804,15287,7973,15229,8057,15148,8012,15046,7846,14933,7611,14810,7357,14682,7069,14552,6656,14421,6316,14251,5948,14007,5528,15356,5942,15356,5977,15353,6119,15348,6294,15332,6551,15302,6824,15249,7044,15171,7122,15070,7050,14949,6861,14818,6611,14679,6349,14538,6067,14398,5651,14189,5311,13935,4958,15359,4123,15359,4153,15356,4296,15353,4646,15338,5160,15311,5508,15263,5829,15188,6042,15088,6094,14966,6001,14826,5796,14678,5543,14527,5287,14377,4985,14133,4586,13869,4257,15360,1563,15360,1642,15358,2076,15354,2636,15341,3350,15317,4019,15273,4429,15203,4732,15105,4911,14981,4932,14836,4818,14679,4621,14517,4386,14359,4156,14083,3795,13808,3437,15360,122,15360,137,15358,285,15355,636,15344,1274,15322,2177,15281,2765,15215,3223,15120,3451,14995,3569,14846,3567,14681,3466,14511,3305,14344,3121,14037,2800,13753,2467,15360,0,15360,1,15359,21,15355,89,15346,253,15325,479,15287,796,15225,1148,15133,1492,15008,1749,14856,1882,14685,1886,14506,1783,14324,1608,13996,1398,13702,1183]);let la=null;function fI(){return la===null&&(la=new ny(dI,16,16,yu,so),la.name="DFG_LUT",la.minFilter=nr,la.magFilter=nr,la.wrapS=ha,la.wrapT=ha,la.generateMipmaps=!1,la.needsUpdate=!0),la}class pI{constructor(i={}){const{canvas:s=US(),context:c=null,depth:f=!0,stencil:v=!1,alpha:_=!1,antialias:o=!1,premultipliedAlpha:M=!0,preserveDrawingBuffer:C=!1,powerPreference:D="default",failIfMajorPerformanceCaveat:F=!1,reversedDepthBuffer:O=!1,outputBufferType:j=gs}=i;this.isWebGLRenderer=!0;let K;if(c!==null){if(typeof WebGLRenderingContext<"u"&&c instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");K=c.getContextAttributes().alpha}else K=_;const J=j,N=new Set([Y_,$_,Z_]),W=new Set([gs,ga,id,nd,W_,q_]),ge=new Uint32Array(4),de=new Int32Array(4);let ve=null,Me=null;const De=[],Ie=[];let $e=null;this.domElement=s,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=fa,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const re=this;let fe=!1;this._outputColorSpace=Sr;let Oe=0,tt=0,Qe=null,pt=-1,ct=null;const nt=new wn,Je=new wn;let ut=null;const xt=new bi(0);let At=0,Rt=s.width,oi=s.height,ti=1,Ii=null,yi=null;const ot=new wn(0,0,Rt,oi),mt=new wn(0,0,Rt,oi);let Dt=!1;const ni=new sy;let Gt=!1,pi=!1;const Ti=new gi,xi=new We,ci=new wn,vi={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let ri=!1;function ui(){return Qe===null?ti:1}let Le=c;function Ji(se,Ue){return s.getContext(se,Ue)}try{const se={alpha:!0,depth:f,stencil:v,antialias:o,premultipliedAlpha:M,preserveDrawingBuffer:C,powerPreference:D,failIfMajorPerformanceCaveat:F};if("setAttribute"in s&&s.setAttribute("data-engine",`three.js r${H_}`),s.addEventListener("webglcontextlost",vt,!1),s.addEventListener("webglcontextrestored",It,!1),s.addEventListener("webglcontextcreationerror",Ct,!1),Le===null){const Ue="webgl2";if(Le=Ji(Ue,se),Le===null)throw Ji(Ue)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(se){throw hi("WebGLRenderer: "+se.message),se}let Si,Ri,Vt,xe,Q,ke,ht,yt,st,jt,Et,be,H,U,Z,ae,pe,Se,Fe,te,Ce,Ne,ze,oe;function Ve(){Si=new fC(Le),Si.init(),Ne=new rI(Le,Si),Ri=new rC(Le,Si,i,Ne),Vt=new iI(Le,Si),Ri.reversedDepthBuffer&&O&&Vt.buffers.depth.setReversed(!0),xe=new gC(Le),Q=new VP,ke=new nI(Le,Si,Vt,Q,Ri,Ne,xe),ht=new aC(re),yt=new dC(re),st=new vE(Le),ze=new iC(Le,st),jt=new pC(Le,st,xe,ze),Et=new yC(Le,jt,st,xe),Fe=new _C(Le,Ri,ke),ae=new sC(Q),be=new UP(re,ht,yt,Si,Ri,ze,ae),H=new uI(re,Q),U=new HP,Z=new $P(Si),Se=new tC(re,ht,yt,Vt,Et,K,M),pe=new eI(re,Et,Ri),oe=new hI(Le,xe,Ri,Vt),te=new nC(Le,Si,xe),Ce=new mC(Le,Si,xe),xe.programs=be.programs,re.capabilities=Ri,re.extensions=Si,re.properties=Q,re.renderLists=U,re.shadowMap=pe,re.state=Vt,re.info=xe}Ve(),J!==gs&&($e=new vC(J,s.width,s.height,f,v));const lt=new lI(re,Le);this.xr=lt,this.getContext=function(){return Le},this.getContextAttributes=function(){return Le.getContextAttributes()},this.forceContextLoss=function(){const se=Si.get("WEBGL_lose_context");se&&se.loseContext()},this.forceContextRestore=function(){const se=Si.get("WEBGL_lose_context");se&&se.restoreContext()},this.getPixelRatio=function(){return ti},this.setPixelRatio=function(se){se!==void 0&&(ti=se,this.setSize(Rt,oi,!1))},this.getSize=function(se){return se.set(Rt,oi)},this.setSize=function(se,Ue,Ke=!0){if(lt.isPresenting){ei("WebGLRenderer: Can't change size while VR device is presenting.");return}Rt=se,oi=Ue,s.width=Math.floor(se*ti),s.height=Math.floor(Ue*ti),Ke===!0&&(s.style.width=se+"px",s.style.height=Ue+"px"),$e!==null&&$e.setSize(s.width,s.height),this.setViewport(0,0,se,Ue)},this.getDrawingBufferSize=function(se){return se.set(Rt*ti,oi*ti).floor()},this.setDrawingBufferSize=function(se,Ue,Ke){Rt=se,oi=Ue,ti=Ke,s.width=Math.floor(se*Ke),s.height=Math.floor(Ue*Ke),this.setViewport(0,0,se,Ue)},this.setEffects=function(se){if(J===gs){console.error("THREE.WebGLRenderer: setEffects() requires outputBufferType set to HalfFloatType or FloatType.");return}if(se){for(let Ue=0;Ue<se.length;Ue++)if(se[Ue].isOutputPass===!0){console.warn("THREE.WebGLRenderer: OutputPass is not needed in setEffects(). Tone mapping and color space conversion are applied automatically.");break}}$e.setEffects(se||[])},this.getCurrentViewport=function(se){return se.copy(nt)},this.getViewport=function(se){return se.copy(ot)},this.setViewport=function(se,Ue,Ke,Ge){se.isVector4?ot.set(se.x,se.y,se.z,se.w):ot.set(se,Ue,Ke,Ge),Vt.viewport(nt.copy(ot).multiplyScalar(ti).round())},this.getScissor=function(se){return se.copy(mt)},this.setScissor=function(se,Ue,Ke,Ge){se.isVector4?mt.set(se.x,se.y,se.z,se.w):mt.set(se,Ue,Ke,Ge),Vt.scissor(Je.copy(mt).multiplyScalar(ti).round())},this.getScissorTest=function(){return Dt},this.setScissorTest=function(se){Vt.setScissorTest(Dt=se)},this.setOpaqueSort=function(se){Ii=se},this.setTransparentSort=function(se){yi=se},this.getClearColor=function(se){return se.copy(Se.getClearColor())},this.setClearColor=function(){Se.setClearColor(...arguments)},this.getClearAlpha=function(){return Se.getClearAlpha()},this.setClearAlpha=function(){Se.setClearAlpha(...arguments)},this.clear=function(se=!0,Ue=!0,Ke=!0){let Ge=0;if(se){let qe=!1;if(Qe!==null){const Pt=Qe.texture.format;qe=N.has(Pt)}if(qe){const Pt=Qe.texture.type,kt=W.has(Pt),Lt=Se.getClearColor(),Ot=Se.getClearAlpha(),Xt=Lt.r,Jt=Lt.g,Kt=Lt.b;kt?(ge[0]=Xt,ge[1]=Jt,ge[2]=Kt,ge[3]=Ot,Le.clearBufferuiv(Le.COLOR,0,ge)):(de[0]=Xt,de[1]=Jt,de[2]=Kt,de[3]=Ot,Le.clearBufferiv(Le.COLOR,0,de))}else Ge|=Le.COLOR_BUFFER_BIT}Ue&&(Ge|=Le.DEPTH_BUFFER_BIT),Ke&&(Ge|=Le.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Le.clear(Ge)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){s.removeEventListener("webglcontextlost",vt,!1),s.removeEventListener("webglcontextrestored",It,!1),s.removeEventListener("webglcontextcreationerror",Ct,!1),Se.dispose(),U.dispose(),Z.dispose(),Q.dispose(),ht.dispose(),yt.dispose(),Et.dispose(),ze.dispose(),oe.dispose(),be.dispose(),lt.dispose(),lt.removeEventListener("sessionstart",gt),lt.removeEventListener("sessionend",Ci),zi.stop()};function vt(se){se.preventDefault(),yp("WebGLRenderer: Context Lost."),fe=!0}function It(){yp("WebGLRenderer: Context Restored."),fe=!1;const se=xe.autoReset,Ue=pe.enabled,Ke=pe.autoUpdate,Ge=pe.needsUpdate,qe=pe.type;Ve(),xe.autoReset=se,pe.enabled=Ue,pe.autoUpdate=Ke,pe.needsUpdate=Ge,pe.type=qe}function Ct(se){hi("WebGLRenderer: A WebGL context could not be created. Reason: ",se.statusMessage)}function $t(se){const Ue=se.target;Ue.removeEventListener("dispose",$t),Di(Ue)}function Di(se){fn(se),Q.remove(se)}function fn(se){const Ue=Q.get(se).programs;Ue!==void 0&&(Ue.forEach(function(Ke){be.releaseProgram(Ke)}),se.isShaderMaterial&&be.releaseShaderCache(se))}this.renderBufferDirect=function(se,Ue,Ke,Ge,qe,Pt){Ue===null&&(Ue=vi);const kt=qe.isMesh&&qe.matrixWorld.determinant()<0,Lt=li(se,Ue,Ke,Ge,qe);Vt.setMaterial(Ge,kt);let Ot=Ke.index,Xt=1;if(Ge.wireframe===!0){if(Ot=jt.getWireframeAttribute(Ke),Ot===void 0)return;Xt=2}const Jt=Ke.drawRange,Kt=Ke.attributes.position;let Wt=Jt.start*Xt,Ui=(Jt.start+Jt.count)*Xt;Pt!==null&&(Wt=Math.max(Wt,Pt.start*Xt),Ui=Math.min(Ui,(Pt.start+Pt.count)*Xt)),Ot!==null?(Wt=Math.max(Wt,0),Ui=Math.min(Ui,Ot.count)):Kt!=null&&(Wt=Math.max(Wt,0),Ui=Math.min(Ui,Kt.count));const ln=Ui-Wt;if(ln<0||ln===1/0)return;ze.setup(qe,Ge,Lt,Ke,Ot);let Wi,Gi=te;if(Ot!==null&&(Wi=st.get(Ot),Gi=Ce,Gi.setIndex(Wi)),qe.isMesh)Ge.wireframe===!0?(Vt.setLineWidth(Ge.wireframeLinewidth*ui()),Gi.setMode(Le.LINES)):Gi.setMode(Le.TRIANGLES);else if(qe.isLine){let Qt=Ge.linewidth;Qt===void 0&&(Qt=1),Vt.setLineWidth(Qt*ui()),qe.isLineSegments?Gi.setMode(Le.LINES):qe.isLineLoop?Gi.setMode(Le.LINE_LOOP):Gi.setMode(Le.LINE_STRIP)}else qe.isPoints?Gi.setMode(Le.POINTS):qe.isSprite&&Gi.setMode(Le.TRIANGLES);if(qe.isBatchedMesh)if(qe._multiDrawInstances!==null)od("WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),Gi.renderMultiDrawInstances(qe._multiDrawStarts,qe._multiDrawCounts,qe._multiDrawCount,qe._multiDrawInstances);else if(Si.get("WEBGL_multi_draw"))Gi.renderMultiDraw(qe._multiDrawStarts,qe._multiDrawCounts,qe._multiDrawCount);else{const Qt=qe._multiDrawStarts,ki=qe._multiDrawCounts,Ei=qe._multiDrawCount,Yn=Ot?st.get(Ot).bytesPerElement:1,_s=Q.get(Ge).currentProgram.getUniforms();for(let Kn=0;Kn<Ei;Kn++)_s.setValue(Le,"_gl_DrawID",Kn),Gi.render(Qt[Kn]/Yn,ki[Kn])}else if(qe.isInstancedMesh)Gi.renderInstances(Wt,ln,qe.count);else if(Ke.isInstancedBufferGeometry){const Qt=Ke._maxInstanceCount!==void 0?Ke._maxInstanceCount:1/0,ki=Math.min(Ke.instanceCount,Qt);Gi.renderInstances(Wt,ln,ki)}else Gi.render(Wt,ln)};function rn(se,Ue,Ke){se.transparent===!0&&se.side===As&&se.forceSinglePass===!1?(se.side=Qr,se.needsUpdate=!0,Vn(se,Ue,Ke),se.side=ro,se.needsUpdate=!0,Vn(se,Ue,Ke),se.side=As):Vn(se,Ue,Ke)}this.compile=function(se,Ue,Ke=null){Ke===null&&(Ke=se),Me=Z.get(Ke),Me.init(Ue),Ie.push(Me),Ke.traverseVisible(function(qe){qe.isLight&&qe.layers.test(Ue.layers)&&(Me.pushLight(qe),qe.castShadow&&Me.pushShadow(qe))}),se!==Ke&&se.traverseVisible(function(qe){qe.isLight&&qe.layers.test(Ue.layers)&&(Me.pushLight(qe),qe.castShadow&&Me.pushShadow(qe))}),Me.setupLights();const Ge=new Set;return se.traverse(function(qe){if(!(qe.isMesh||qe.isPoints||qe.isLine||qe.isSprite))return;const Pt=qe.material;if(Pt)if(Array.isArray(Pt))for(let kt=0;kt<Pt.length;kt++){const Lt=Pt[kt];rn(Lt,Ke,qe),Ge.add(Lt)}else rn(Pt,Ke,qe),Ge.add(Pt)}),Me=Ie.pop(),Ge},this.compileAsync=function(se,Ue,Ke=null){const Ge=this.compile(se,Ue,Ke);return new Promise(qe=>{function Pt(){if(Ge.forEach(function(kt){Q.get(kt).currentProgram.isReady()&&Ge.delete(kt)}),Ge.size===0){qe(se);return}setTimeout(Pt,10)}Si.get("KHR_parallel_shader_compile")!==null?Pt():setTimeout(Pt,10)})};let Ln=null;function on(se){Ln&&Ln(se)}function gt(){zi.stop()}function Ci(){zi.start()}const zi=new Xb;zi.setAnimationLoop(on),typeof self<"u"&&zi.setContext(self),this.setAnimationLoop=function(se){Ln=se,lt.setAnimationLoop(se),se===null?zi.stop():zi.start()},lt.addEventListener("sessionstart",gt),lt.addEventListener("sessionend",Ci),this.render=function(se,Ue){if(Ue!==void 0&&Ue.isCamera!==!0){hi("WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(fe===!0)return;const Ke=lt.enabled===!0&&lt.isPresenting===!0,Ge=$e!==null&&(Qe===null||Ke)&&$e.begin(re,Qe);if(se.matrixWorldAutoUpdate===!0&&se.updateMatrixWorld(),Ue.parent===null&&Ue.matrixWorldAutoUpdate===!0&&Ue.updateMatrixWorld(),lt.enabled===!0&&lt.isPresenting===!0&&($e===null||$e.isCompositing()===!1)&&(lt.cameraAutoUpdate===!0&&lt.updateCamera(Ue),Ue=lt.getCamera()),se.isScene===!0&&se.onBeforeRender(re,se,Ue,Qe),Me=Z.get(se,Ie.length),Me.init(Ue),Ie.push(Me),Ti.multiplyMatrices(Ue.projectionMatrix,Ue.matrixWorldInverse),ni.setFromProjectionMatrix(Ti,da,Ue.reversedDepth),pi=this.localClippingEnabled,Gt=ae.init(this.clippingPlanes,pi),ve=U.get(se,De.length),ve.init(),De.push(ve),lt.enabled===!0&&lt.isPresenting===!0){const kt=re.xr.getDepthSensingMesh();kt!==null&&is(kt,Ue,-1/0,re.sortObjects)}is(se,Ue,0,re.sortObjects),ve.finish(),re.sortObjects===!0&&ve.sort(Ii,yi),ri=lt.enabled===!1||lt.isPresenting===!1||lt.hasDepthSensing()===!1,ri&&Se.addToRenderList(ve,se),this.info.render.frame++,Gt===!0&&ae.beginShadows();const qe=Me.state.shadowsArray;if(pe.render(qe,se,Ue),Gt===!0&&ae.endShadows(),this.info.autoReset===!0&&this.info.reset(),(Ge&&$e.hasRenderPass())===!1){const kt=ve.opaque,Lt=ve.transmissive;if(Me.setupLights(),Ue.isArrayCamera){const Ot=Ue.cameras;if(Lt.length>0)for(let Xt=0,Jt=Ot.length;Xt<Jt;Xt++){const Kt=Ot[Xt];Tt(kt,Lt,se,Kt)}ri&&Se.render(se);for(let Xt=0,Jt=Ot.length;Xt<Jt;Xt++){const Kt=Ot[Xt];Un(ve,se,Kt,Kt.viewport)}}else Lt.length>0&&Tt(kt,Lt,se,Ue),ri&&Se.render(se),Un(ve,se,Ue)}Qe!==null&&tt===0&&(ke.updateMultisampleRenderTarget(Qe),ke.updateRenderTargetMipmap(Qe)),Ge&&$e.end(re),se.isScene===!0&&se.onAfterRender(re,se,Ue),ze.resetDefaultState(),pt=-1,ct=null,Ie.pop(),Ie.length>0?(Me=Ie[Ie.length-1],Gt===!0&&ae.setGlobalState(re.clippingPlanes,Me.state.camera)):Me=null,De.pop(),De.length>0?ve=De[De.length-1]:ve=null};function is(se,Ue,Ke,Ge){if(se.visible===!1)return;if(se.layers.test(Ue.layers)){if(se.isGroup)Ke=se.renderOrder;else if(se.isLOD)se.autoUpdate===!0&&se.update(Ue);else if(se.isLight)Me.pushLight(se),se.castShadow&&Me.pushShadow(se);else if(se.isSprite){if(!se.frustumCulled||ni.intersectsSprite(se)){Ge&&ci.setFromMatrixPosition(se.matrixWorld).applyMatrix4(Ti);const kt=Et.update(se),Lt=se.material;Lt.visible&&ve.push(se,kt,Lt,Ke,ci.z,null)}}else if((se.isMesh||se.isLine||se.isPoints)&&(!se.frustumCulled||ni.intersectsObject(se))){const kt=Et.update(se),Lt=se.material;if(Ge&&(se.boundingSphere!==void 0?(se.boundingSphere===null&&se.computeBoundingSphere(),ci.copy(se.boundingSphere.center)):(kt.boundingSphere===null&&kt.computeBoundingSphere(),ci.copy(kt.boundingSphere.center)),ci.applyMatrix4(se.matrixWorld).applyMatrix4(Ti)),Array.isArray(Lt)){const Ot=kt.groups;for(let Xt=0,Jt=Ot.length;Xt<Jt;Xt++){const Kt=Ot[Xt],Wt=Lt[Kt.materialIndex];Wt&&Wt.visible&&ve.push(se,kt,Wt,Ke,ci.z,Kt)}}else Lt.visible&&ve.push(se,kt,Lt,Ke,ci.z,null)}}const Pt=se.children;for(let kt=0,Lt=Pt.length;kt<Lt;kt++)is(Pt[kt],Ue,Ke,Ge)}function Un(se,Ue,Ke,Ge){const{opaque:qe,transmissive:Pt,transparent:kt}=se;Me.setupLightsView(Ke),Gt===!0&&ae.setGlobalState(re.clippingPlanes,Ke),Ge&&Vt.viewport(nt.copy(Ge)),qe.length>0&&Yt(qe,Ue,Ke),Pt.length>0&&Yt(Pt,Ue,Ke),kt.length>0&&Yt(kt,Ue,Ke),Vt.buffers.depth.setTest(!0),Vt.buffers.depth.setMask(!0),Vt.buffers.color.setMask(!0),Vt.setPolygonOffset(!1)}function Tt(se,Ue,Ke,Ge){if((Ke.isScene===!0?Ke.overrideMaterial:null)!==null)return;if(Me.state.transmissionRenderTarget[Ge.id]===void 0){const Wt=Si.has("EXT_color_buffer_half_float")||Si.has("EXT_color_buffer_float");Me.state.transmissionRenderTarget[Ge.id]=new pa(1,1,{generateMipmaps:!0,type:Wt?so:gs,minFilter:Qa,samples:Ri.samples,stencilBuffer:v,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Ni.workingColorSpace})}const Pt=Me.state.transmissionRenderTarget[Ge.id],kt=Ge.viewport||nt;Pt.setSize(kt.z*re.transmissionResolutionScale,kt.w*re.transmissionResolutionScale);const Lt=re.getRenderTarget(),Ot=re.getActiveCubeFace(),Xt=re.getActiveMipmapLevel();re.setRenderTarget(Pt),re.getClearColor(xt),At=re.getClearAlpha(),At<1&&re.setClearColor(16777215,.5),re.clear(),ri&&Se.render(Ke);const Jt=re.toneMapping;re.toneMapping=fa;const Kt=Ge.viewport;if(Ge.viewport!==void 0&&(Ge.viewport=void 0),Me.setupLightsView(Ge),Gt===!0&&ae.setGlobalState(re.clippingPlanes,Ge),Yt(se,Ke,Ge),ke.updateMultisampleRenderTarget(Pt),ke.updateRenderTargetMipmap(Pt),Si.has("WEBGL_multisampled_render_to_texture")===!1){let Wt=!1;for(let Ui=0,ln=Ue.length;Ui<ln;Ui++){const Wi=Ue[Ui],{object:Gi,geometry:Qt,material:ki,group:Ei}=Wi;if(ki.side===As&&Gi.layers.test(Ge.layers)){const Yn=ki.side;ki.side=Qr,ki.needsUpdate=!0,si(Gi,Ke,Ge,Qt,ki,Ei),ki.side=Yn,ki.needsUpdate=!0,Wt=!0}}Wt===!0&&(ke.updateMultisampleRenderTarget(Pt),ke.updateRenderTargetMipmap(Pt))}re.setRenderTarget(Lt,Ot,Xt),re.setClearColor(xt,At),Kt!==void 0&&(Ge.viewport=Kt),re.toneMapping=Jt}function Yt(se,Ue,Ke){const Ge=Ue.isScene===!0?Ue.overrideMaterial:null;for(let qe=0,Pt=se.length;qe<Pt;qe++){const kt=se[qe],{object:Lt,geometry:Ot,group:Xt}=kt;let Jt=kt.material;Jt.allowOverride===!0&&Ge!==null&&(Jt=Ge),Lt.layers.test(Ke.layers)&&si(Lt,Ue,Ke,Ot,Jt,Xt)}}function si(se,Ue,Ke,Ge,qe,Pt){se.onBeforeRender(re,Ue,Ke,Ge,qe,Pt),se.modelViewMatrix.multiplyMatrices(Ke.matrixWorldInverse,se.matrixWorld),se.normalMatrix.getNormalMatrix(se.modelViewMatrix),qe.onBeforeRender(re,Ue,Ke,Ge,se,Pt),qe.transparent===!0&&qe.side===As&&qe.forceSinglePass===!1?(qe.side=Qr,qe.needsUpdate=!0,re.renderBufferDirect(Ke,Ue,Ge,qe,se,Pt),qe.side=ro,qe.needsUpdate=!0,re.renderBufferDirect(Ke,Ue,Ge,qe,se,Pt),qe.side=As):re.renderBufferDirect(Ke,Ue,Ge,qe,se,Pt),se.onAfterRender(re,Ue,Ke,Ge,qe,Pt)}function Vn(se,Ue,Ke){Ue.isScene!==!0&&(Ue=vi);const Ge=Q.get(se),qe=Me.state.lights,Pt=Me.state.shadowsArray,kt=qe.state.version,Lt=be.getParameters(se,qe.state,Pt,Ue,Ke),Ot=be.getProgramCacheKey(Lt);let Xt=Ge.programs;Ge.environment=se.isMeshStandardMaterial?Ue.environment:null,Ge.fog=Ue.fog,Ge.envMap=(se.isMeshStandardMaterial?yt:ht).get(se.envMap||Ge.environment),Ge.envMapRotation=Ge.environment!==null&&se.envMap===null?Ue.environmentRotation:se.envMapRotation,Xt===void 0&&(se.addEventListener("dispose",$t),Xt=new Map,Ge.programs=Xt);let Jt=Xt.get(Ot);if(Jt!==void 0){if(Ge.currentProgram===Jt&&Ge.lightsStateVersion===kt)return Hr(se,Lt),Jt}else Lt.uniforms=be.getUniforms(se),se.onBeforeCompile(Lt,re),Jt=be.acquireProgram(Lt,Ot),Xt.set(Ot,Jt),Ge.uniforms=Lt.uniforms;const Kt=Ge.uniforms;return(!se.isShaderMaterial&&!se.isRawShaderMaterial||se.clipping===!0)&&(Kt.clippingPlanes=ae.uniform),Hr(se,Lt),Ge.needsLights=Ta(se),Ge.lightsStateVersion=kt,Ge.needsLights&&(Kt.ambientLightColor.value=qe.state.ambient,Kt.lightProbe.value=qe.state.probe,Kt.directionalLights.value=qe.state.directional,Kt.directionalLightShadows.value=qe.state.directionalShadow,Kt.spotLights.value=qe.state.spot,Kt.spotLightShadows.value=qe.state.spotShadow,Kt.rectAreaLights.value=qe.state.rectArea,Kt.ltc_1.value=qe.state.rectAreaLTC1,Kt.ltc_2.value=qe.state.rectAreaLTC2,Kt.pointLights.value=qe.state.point,Kt.pointLightShadows.value=qe.state.pointShadow,Kt.hemisphereLights.value=qe.state.hemi,Kt.directionalShadowMap.value=qe.state.directionalShadowMap,Kt.directionalShadowMatrix.value=qe.state.directionalShadowMatrix,Kt.spotShadowMap.value=qe.state.spotShadowMap,Kt.spotLightMatrix.value=qe.state.spotLightMatrix,Kt.spotLightMap.value=qe.state.spotLightMap,Kt.pointShadowMap.value=qe.state.pointShadowMap,Kt.pointShadowMatrix.value=qe.state.pointShadowMatrix),Ge.currentProgram=Jt,Ge.uniformsList=null,Jt}function ba(se){if(se.uniformsList===null){const Ue=se.currentProgram.getUniforms();se.uniformsList=pp.seqWithValue(Ue.seq,se.uniforms)}return se.uniformsList}function Hr(se,Ue){const Ke=Q.get(se);Ke.outputColorSpace=Ue.outputColorSpace,Ke.batching=Ue.batching,Ke.batchingColor=Ue.batchingColor,Ke.instancing=Ue.instancing,Ke.instancingColor=Ue.instancingColor,Ke.instancingMorph=Ue.instancingMorph,Ke.skinning=Ue.skinning,Ke.morphTargets=Ue.morphTargets,Ke.morphNormals=Ue.morphNormals,Ke.morphColors=Ue.morphColors,Ke.morphTargetsCount=Ue.morphTargetsCount,Ke.numClippingPlanes=Ue.numClippingPlanes,Ke.numIntersection=Ue.numClipIntersection,Ke.vertexAlphas=Ue.vertexAlphas,Ke.vertexTangents=Ue.vertexTangents,Ke.toneMapping=Ue.toneMapping}function li(se,Ue,Ke,Ge,qe){Ue.isScene!==!0&&(Ue=vi),ke.resetTextureUnits();const Pt=Ue.fog,kt=Ge.isMeshStandardMaterial?Ue.environment:null,Lt=Qe===null?re.outputColorSpace:Qe.isXRRenderTarget===!0?Qe.texture.colorSpace:Vr,Ot=(Ge.isMeshStandardMaterial?yt:ht).get(Ge.envMap||kt),Xt=Ge.vertexColors===!0&&!!Ke.attributes.color&&Ke.attributes.color.itemSize===4,Jt=!!Ke.attributes.tangent&&(!!Ge.normalMap||Ge.anisotropy>0),Kt=!!Ke.morphAttributes.position,Wt=!!Ke.morphAttributes.normal,Ui=!!Ke.morphAttributes.color;let ln=fa;Ge.toneMapped&&(Qe===null||Qe.isXRRenderTarget===!0)&&(ln=re.toneMapping);const Wi=Ke.morphAttributes.position||Ke.morphAttributes.normal||Ke.morphAttributes.color,Gi=Wi!==void 0?Wi.length:0,Qt=Q.get(Ge),ki=Me.state.lights;if(Gt===!0&&(pi===!0||se!==ct)){const Gn=se===ct&&Ge.id===pt;ae.setState(Ge,se,Gn)}let Ei=!1;Ge.version===Qt.__version?(Qt.needsLights&&Qt.lightsStateVersion!==ki.state.version||Qt.outputColorSpace!==Lt||qe.isBatchedMesh&&Qt.batching===!1||!qe.isBatchedMesh&&Qt.batching===!0||qe.isBatchedMesh&&Qt.batchingColor===!0&&qe.colorTexture===null||qe.isBatchedMesh&&Qt.batchingColor===!1&&qe.colorTexture!==null||qe.isInstancedMesh&&Qt.instancing===!1||!qe.isInstancedMesh&&Qt.instancing===!0||qe.isSkinnedMesh&&Qt.skinning===!1||!qe.isSkinnedMesh&&Qt.skinning===!0||qe.isInstancedMesh&&Qt.instancingColor===!0&&qe.instanceColor===null||qe.isInstancedMesh&&Qt.instancingColor===!1&&qe.instanceColor!==null||qe.isInstancedMesh&&Qt.instancingMorph===!0&&qe.morphTexture===null||qe.isInstancedMesh&&Qt.instancingMorph===!1&&qe.morphTexture!==null||Qt.envMap!==Ot||Ge.fog===!0&&Qt.fog!==Pt||Qt.numClippingPlanes!==void 0&&(Qt.numClippingPlanes!==ae.numPlanes||Qt.numIntersection!==ae.numIntersection)||Qt.vertexAlphas!==Xt||Qt.vertexTangents!==Jt||Qt.morphTargets!==Kt||Qt.morphNormals!==Wt||Qt.morphColors!==Ui||Qt.toneMapping!==ln||Qt.morphTargetsCount!==Gi)&&(Ei=!0):(Ei=!0,Qt.__version=Ge.version);let Yn=Qt.currentProgram;Ei===!0&&(Yn=Vn(Ge,Ue,qe));let _s=!1,Kn=!1,Is=!1;const qi=Yn.getUniforms(),Fn=Qt.uniforms;if(Vt.useProgram(Yn.program)&&(_s=!0,Kn=!0,Is=!0),Ge.id!==pt&&(pt=Ge.id,Kn=!0),_s||ct!==se){Vt.buffers.depth.getReversed()&&se.reversedDepth!==!0&&(se._reversedDepth=!0,se.updateProjectionMatrix()),qi.setValue(Le,"projectionMatrix",se.projectionMatrix),qi.setValue(Le,"viewMatrix",se.matrixWorldInverse);const Pn=qi.map.cameraPosition;Pn!==void 0&&Pn.setValue(Le,xi.setFromMatrixPosition(se.matrixWorld)),Ri.logarithmicDepthBuffer&&qi.setValue(Le,"logDepthBufFC",2/(Math.log(se.far+1)/Math.LN2)),(Ge.isMeshPhongMaterial||Ge.isMeshToonMaterial||Ge.isMeshLambertMaterial||Ge.isMeshBasicMaterial||Ge.isMeshStandardMaterial||Ge.isShaderMaterial)&&qi.setValue(Le,"isOrthographic",se.isOrthographicCamera===!0),ct!==se&&(ct=se,Kn=!0,Is=!0)}if(Qt.needsLights&&(ki.state.directionalShadowMap.length>0&&qi.setValue(Le,"directionalShadowMap",ki.state.directionalShadowMap,ke),ki.state.spotShadowMap.length>0&&qi.setValue(Le,"spotShadowMap",ki.state.spotShadowMap,ke),ki.state.pointShadowMap.length>0&&qi.setValue(Le,"pointShadowMap",ki.state.pointShadowMap,ke)),qe.isSkinnedMesh){qi.setOptional(Le,qe,"bindMatrix"),qi.setOptional(Le,qe,"bindMatrixInverse");const Gn=qe.skeleton;Gn&&(Gn.boneTexture===null&&Gn.computeBoneTexture(),qi.setValue(Le,"boneTexture",Gn.boneTexture,ke))}qe.isBatchedMesh&&(qi.setOptional(Le,qe,"batchingTexture"),qi.setValue(Le,"batchingTexture",qe._matricesTexture,ke),qi.setOptional(Le,qe,"batchingIdTexture"),qi.setValue(Le,"batchingIdTexture",qe._indirectTexture,ke),qi.setOptional(Le,qe,"batchingColorTexture"),qe._colorsTexture!==null&&qi.setValue(Le,"batchingColorTexture",qe._colorsTexture,ke));const Jn=Ke.morphAttributes;if((Jn.position!==void 0||Jn.normal!==void 0||Jn.color!==void 0)&&Fe.update(qe,Ke,Yn),(Kn||Qt.receiveShadow!==qe.receiveShadow)&&(Qt.receiveShadow=qe.receiveShadow,qi.setValue(Le,"receiveShadow",qe.receiveShadow)),Ge.isMeshGouraudMaterial&&Ge.envMap!==null&&(Fn.envMap.value=Ot,Fn.flipEnvMap.value=Ot.isCubeTexture&&Ot.isRenderTargetTexture===!1?-1:1),Ge.isMeshStandardMaterial&&Ge.envMap===null&&Ue.environment!==null&&(Fn.envMapIntensity.value=Ue.environmentIntensity),Fn.dfgLUT!==void 0&&(Fn.dfgLUT.value=fI()),Kn&&(qi.setValue(Le,"toneMappingExposure",re.toneMappingExposure),Qt.needsLights&&wa(Fn,Is),Pt&&Ge.fog===!0&&H.refreshFogUniforms(Fn,Pt),H.refreshMaterialUniforms(Fn,Ge,ti,oi,Me.state.transmissionRenderTarget[se.id]),pp.upload(Le,ba(Qt),Fn,ke)),Ge.isShaderMaterial&&Ge.uniformsNeedUpdate===!0&&(pp.upload(Le,ba(Qt),Fn,ke),Ge.uniformsNeedUpdate=!1),Ge.isSpriteMaterial&&qi.setValue(Le,"center",qe.center),qi.setValue(Le,"modelViewMatrix",qe.modelViewMatrix),qi.setValue(Le,"normalMatrix",qe.normalMatrix),qi.setValue(Le,"modelMatrix",qe.matrixWorld),Ge.isShaderMaterial||Ge.isRawShaderMaterial){const Gn=Ge.uniformsGroups;for(let Pn=0,Ma=Gn.length;Pn<Ma;Pn++){const Lr=Gn[Pn];oe.update(Lr,Yn),oe.bind(Lr,Yn)}}return Yn}function wa(se,Ue){se.ambientLightColor.needsUpdate=Ue,se.lightProbe.needsUpdate=Ue,se.directionalLights.needsUpdate=Ue,se.directionalLightShadows.needsUpdate=Ue,se.pointLights.needsUpdate=Ue,se.pointLightShadows.needsUpdate=Ue,se.spotLights.needsUpdate=Ue,se.spotLightShadows.needsUpdate=Ue,se.rectAreaLights.needsUpdate=Ue,se.hemisphereLights.needsUpdate=Ue}function Ta(se){return se.isMeshLambertMaterial||se.isMeshToonMaterial||se.isMeshPhongMaterial||se.isMeshStandardMaterial||se.isShadowMaterial||se.isShaderMaterial&&se.lights===!0}this.getActiveCubeFace=function(){return Oe},this.getActiveMipmapLevel=function(){return tt},this.getRenderTarget=function(){return Qe},this.setRenderTargetTextures=function(se,Ue,Ke){const Ge=Q.get(se);Ge.__autoAllocateDepthBuffer=se.resolveDepthBuffer===!1,Ge.__autoAllocateDepthBuffer===!1&&(Ge.__useRenderToTexture=!1),Q.get(se.texture).__webglTexture=Ue,Q.get(se.depthTexture).__webglTexture=Ge.__autoAllocateDepthBuffer?void 0:Ke,Ge.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(se,Ue){const Ke=Q.get(se);Ke.__webglFramebuffer=Ue,Ke.__useDefaultFramebuffer=Ue===void 0};const lo=Le.createFramebuffer();this.setRenderTarget=function(se,Ue=0,Ke=0){Qe=se,Oe=Ue,tt=Ke;let Ge=null,qe=!1,Pt=!1;if(se){const Lt=Q.get(se);if(Lt.__useDefaultFramebuffer!==void 0){Vt.bindFramebuffer(Le.FRAMEBUFFER,Lt.__webglFramebuffer),nt.copy(se.viewport),Je.copy(se.scissor),ut=se.scissorTest,Vt.viewport(nt),Vt.scissor(Je),Vt.setScissorTest(ut),pt=-1;return}else if(Lt.__webglFramebuffer===void 0)ke.setupRenderTarget(se);else if(Lt.__hasExternalTextures)ke.rebindTextures(se,Q.get(se.texture).__webglTexture,Q.get(se.depthTexture).__webglTexture);else if(se.depthBuffer){const Jt=se.depthTexture;if(Lt.__boundDepthTexture!==Jt){if(Jt!==null&&Q.has(Jt)&&(se.width!==Jt.image.width||se.height!==Jt.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");ke.setupDepthRenderbuffer(se)}}const Ot=se.texture;(Ot.isData3DTexture||Ot.isDataArrayTexture||Ot.isCompressedArrayTexture)&&(Pt=!0);const Xt=Q.get(se).__webglFramebuffer;se.isWebGLCubeRenderTarget?(Array.isArray(Xt[Ue])?Ge=Xt[Ue][Ke]:Ge=Xt[Ue],qe=!0):se.samples>0&&ke.useMultisampledRTT(se)===!1?Ge=Q.get(se).__webglMultisampledFramebuffer:Array.isArray(Xt)?Ge=Xt[Ke]:Ge=Xt,nt.copy(se.viewport),Je.copy(se.scissor),ut=se.scissorTest}else nt.copy(ot).multiplyScalar(ti).floor(),Je.copy(mt).multiplyScalar(ti).floor(),ut=Dt;if(Ke!==0&&(Ge=lo),Vt.bindFramebuffer(Le.FRAMEBUFFER,Ge)&&Vt.drawBuffers(se,Ge),Vt.viewport(nt),Vt.scissor(Je),Vt.setScissorTest(ut),qe){const Lt=Q.get(se.texture);Le.framebufferTexture2D(Le.FRAMEBUFFER,Le.COLOR_ATTACHMENT0,Le.TEXTURE_CUBE_MAP_POSITIVE_X+Ue,Lt.__webglTexture,Ke)}else if(Pt){const Lt=Ue;for(let Ot=0;Ot<se.textures.length;Ot++){const Xt=Q.get(se.textures[Ot]);Le.framebufferTextureLayer(Le.FRAMEBUFFER,Le.COLOR_ATTACHMENT0+Ot,Xt.__webglTexture,Ke,Lt)}}else if(se!==null&&Ke!==0){const Lt=Q.get(se.texture);Le.framebufferTexture2D(Le.FRAMEBUFFER,Le.COLOR_ATTACHMENT0,Le.TEXTURE_2D,Lt.__webglTexture,Ke)}pt=-1},this.readRenderTargetPixels=function(se,Ue,Ke,Ge,qe,Pt,kt,Lt=0){if(!(se&&se.isWebGLRenderTarget)){hi("WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Ot=Q.get(se).__webglFramebuffer;if(se.isWebGLCubeRenderTarget&&kt!==void 0&&(Ot=Ot[kt]),Ot){Vt.bindFramebuffer(Le.FRAMEBUFFER,Ot);try{const Xt=se.textures[Lt],Jt=Xt.format,Kt=Xt.type;if(!Ri.textureFormatReadable(Jt)){hi("WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Ri.textureTypeReadable(Kt)){hi("WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Ue>=0&&Ue<=se.width-Ge&&Ke>=0&&Ke<=se.height-qe&&(se.textures.length>1&&Le.readBuffer(Le.COLOR_ATTACHMENT0+Lt),Le.readPixels(Ue,Ke,Ge,qe,Ne.convert(Jt),Ne.convert(Kt),Pt))}finally{const Xt=Qe!==null?Q.get(Qe).__webglFramebuffer:null;Vt.bindFramebuffer(Le.FRAMEBUFFER,Xt)}}},this.readRenderTargetPixelsAsync=async function(se,Ue,Ke,Ge,qe,Pt,kt,Lt=0){if(!(se&&se.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Ot=Q.get(se).__webglFramebuffer;if(se.isWebGLCubeRenderTarget&&kt!==void 0&&(Ot=Ot[kt]),Ot)if(Ue>=0&&Ue<=se.width-Ge&&Ke>=0&&Ke<=se.height-qe){Vt.bindFramebuffer(Le.FRAMEBUFFER,Ot);const Xt=se.textures[Lt],Jt=Xt.format,Kt=Xt.type;if(!Ri.textureFormatReadable(Jt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Ri.textureTypeReadable(Kt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const Wt=Le.createBuffer();Le.bindBuffer(Le.PIXEL_PACK_BUFFER,Wt),Le.bufferData(Le.PIXEL_PACK_BUFFER,Pt.byteLength,Le.STREAM_READ),se.textures.length>1&&Le.readBuffer(Le.COLOR_ATTACHMENT0+Lt),Le.readPixels(Ue,Ke,Ge,qe,Ne.convert(Jt),Ne.convert(Kt),0);const Ui=Qe!==null?Q.get(Qe).__webglFramebuffer:null;Vt.bindFramebuffer(Le.FRAMEBUFFER,Ui);const ln=Le.fenceSync(Le.SYNC_GPU_COMMANDS_COMPLETE,0);return Le.flush(),await VS(Le,ln,4),Le.bindBuffer(Le.PIXEL_PACK_BUFFER,Wt),Le.getBufferSubData(Le.PIXEL_PACK_BUFFER,0,Pt),Le.deleteBuffer(Wt),Le.deleteSync(ln),Pt}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(se,Ue=null,Ke=0){const Ge=Math.pow(2,-Ke),qe=Math.floor(se.image.width*Ge),Pt=Math.floor(se.image.height*Ge),kt=Ue!==null?Ue.x:0,Lt=Ue!==null?Ue.y:0;ke.setTexture2D(se,0),Le.copyTexSubImage2D(Le.TEXTURE_2D,Ke,0,0,kt,Lt,qe,Pt),Vt.unbindTexture()};const Xs=Le.createFramebuffer(),Sa=Le.createFramebuffer();this.copyTextureToTexture=function(se,Ue,Ke=null,Ge=null,qe=0,Pt=null){Pt===null&&(qe!==0?(od("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),Pt=qe,qe=0):Pt=0);let kt,Lt,Ot,Xt,Jt,Kt,Wt,Ui,ln;const Wi=se.isCompressedTexture?se.mipmaps[Pt]:se.image;if(Ke!==null)kt=Ke.max.x-Ke.min.x,Lt=Ke.max.y-Ke.min.y,Ot=Ke.isBox3?Ke.max.z-Ke.min.z:1,Xt=Ke.min.x,Jt=Ke.min.y,Kt=Ke.isBox3?Ke.min.z:0;else{const Jn=Math.pow(2,-qe);kt=Math.floor(Wi.width*Jn),Lt=Math.floor(Wi.height*Jn),se.isDataArrayTexture?Ot=Wi.depth:se.isData3DTexture?Ot=Math.floor(Wi.depth*Jn):Ot=1,Xt=0,Jt=0,Kt=0}Ge!==null?(Wt=Ge.x,Ui=Ge.y,ln=Ge.z):(Wt=0,Ui=0,ln=0);const Gi=Ne.convert(Ue.format),Qt=Ne.convert(Ue.type);let ki;Ue.isData3DTexture?(ke.setTexture3D(Ue,0),ki=Le.TEXTURE_3D):Ue.isDataArrayTexture||Ue.isCompressedArrayTexture?(ke.setTexture2DArray(Ue,0),ki=Le.TEXTURE_2D_ARRAY):(ke.setTexture2D(Ue,0),ki=Le.TEXTURE_2D),Le.pixelStorei(Le.UNPACK_FLIP_Y_WEBGL,Ue.flipY),Le.pixelStorei(Le.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ue.premultiplyAlpha),Le.pixelStorei(Le.UNPACK_ALIGNMENT,Ue.unpackAlignment);const Ei=Le.getParameter(Le.UNPACK_ROW_LENGTH),Yn=Le.getParameter(Le.UNPACK_IMAGE_HEIGHT),_s=Le.getParameter(Le.UNPACK_SKIP_PIXELS),Kn=Le.getParameter(Le.UNPACK_SKIP_ROWS),Is=Le.getParameter(Le.UNPACK_SKIP_IMAGES);Le.pixelStorei(Le.UNPACK_ROW_LENGTH,Wi.width),Le.pixelStorei(Le.UNPACK_IMAGE_HEIGHT,Wi.height),Le.pixelStorei(Le.UNPACK_SKIP_PIXELS,Xt),Le.pixelStorei(Le.UNPACK_SKIP_ROWS,Jt),Le.pixelStorei(Le.UNPACK_SKIP_IMAGES,Kt);const qi=se.isDataArrayTexture||se.isData3DTexture,Fn=Ue.isDataArrayTexture||Ue.isData3DTexture;if(se.isDepthTexture){const Jn=Q.get(se),Gn=Q.get(Ue),Pn=Q.get(Jn.__renderTarget),Ma=Q.get(Gn.__renderTarget);Vt.bindFramebuffer(Le.READ_FRAMEBUFFER,Pn.__webglFramebuffer),Vt.bindFramebuffer(Le.DRAW_FRAMEBUFFER,Ma.__webglFramebuffer);for(let Lr=0;Lr<Ot;Lr++)qi&&(Le.framebufferTextureLayer(Le.READ_FRAMEBUFFER,Le.COLOR_ATTACHMENT0,Q.get(se).__webglTexture,qe,Kt+Lr),Le.framebufferTextureLayer(Le.DRAW_FRAMEBUFFER,Le.COLOR_ATTACHMENT0,Q.get(Ue).__webglTexture,Pt,ln+Lr)),Le.blitFramebuffer(Xt,Jt,kt,Lt,Wt,Ui,kt,Lt,Le.DEPTH_BUFFER_BIT,Le.NEAREST);Vt.bindFramebuffer(Le.READ_FRAMEBUFFER,null),Vt.bindFramebuffer(Le.DRAW_FRAMEBUFFER,null)}else if(qe!==0||se.isRenderTargetTexture||Q.has(se)){const Jn=Q.get(se),Gn=Q.get(Ue);Vt.bindFramebuffer(Le.READ_FRAMEBUFFER,Xs),Vt.bindFramebuffer(Le.DRAW_FRAMEBUFFER,Sa);for(let Pn=0;Pn<Ot;Pn++)qi?Le.framebufferTextureLayer(Le.READ_FRAMEBUFFER,Le.COLOR_ATTACHMENT0,Jn.__webglTexture,qe,Kt+Pn):Le.framebufferTexture2D(Le.READ_FRAMEBUFFER,Le.COLOR_ATTACHMENT0,Le.TEXTURE_2D,Jn.__webglTexture,qe),Fn?Le.framebufferTextureLayer(Le.DRAW_FRAMEBUFFER,Le.COLOR_ATTACHMENT0,Gn.__webglTexture,Pt,ln+Pn):Le.framebufferTexture2D(Le.DRAW_FRAMEBUFFER,Le.COLOR_ATTACHMENT0,Le.TEXTURE_2D,Gn.__webglTexture,Pt),qe!==0?Le.blitFramebuffer(Xt,Jt,kt,Lt,Wt,Ui,kt,Lt,Le.COLOR_BUFFER_BIT,Le.NEAREST):Fn?Le.copyTexSubImage3D(ki,Pt,Wt,Ui,ln+Pn,Xt,Jt,kt,Lt):Le.copyTexSubImage2D(ki,Pt,Wt,Ui,Xt,Jt,kt,Lt);Vt.bindFramebuffer(Le.READ_FRAMEBUFFER,null),Vt.bindFramebuffer(Le.DRAW_FRAMEBUFFER,null)}else Fn?se.isDataTexture||se.isData3DTexture?Le.texSubImage3D(ki,Pt,Wt,Ui,ln,kt,Lt,Ot,Gi,Qt,Wi.data):Ue.isCompressedArrayTexture?Le.compressedTexSubImage3D(ki,Pt,Wt,Ui,ln,kt,Lt,Ot,Gi,Wi.data):Le.texSubImage3D(ki,Pt,Wt,Ui,ln,kt,Lt,Ot,Gi,Qt,Wi):se.isDataTexture?Le.texSubImage2D(Le.TEXTURE_2D,Pt,Wt,Ui,kt,Lt,Gi,Qt,Wi.data):se.isCompressedTexture?Le.compressedTexSubImage2D(Le.TEXTURE_2D,Pt,Wt,Ui,Wi.width,Wi.height,Gi,Wi.data):Le.texSubImage2D(Le.TEXTURE_2D,Pt,Wt,Ui,kt,Lt,Gi,Qt,Wi);Le.pixelStorei(Le.UNPACK_ROW_LENGTH,Ei),Le.pixelStorei(Le.UNPACK_IMAGE_HEIGHT,Yn),Le.pixelStorei(Le.UNPACK_SKIP_PIXELS,_s),Le.pixelStorei(Le.UNPACK_SKIP_ROWS,Kn),Le.pixelStorei(Le.UNPACK_SKIP_IMAGES,Is),Pt===0&&Ue.generateMipmaps&&Le.generateMipmap(ki),Vt.unbindTexture()},this.initRenderTarget=function(se){Q.get(se).__webglFramebuffer===void 0&&ke.setupRenderTarget(se)},this.initTexture=function(se){se.isCubeTexture?ke.setTextureCube(se,0):se.isData3DTexture?ke.setTexture3D(se,0):se.isDataArrayTexture||se.isCompressedArrayTexture?ke.setTexture2DArray(se,0):ke.setTexture2D(se,0),Vt.unbindTexture()},this.resetState=function(){Oe=0,tt=0,Qe=null,Vt.reset(),ze.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return da}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(i){this._outputColorSpace=i;const s=this.getContext();s.drawingBufferColorSpace=Ni._getDrawingBufferColorSpace(i),s.unpackColorSpace=Ni._getUnpackColorSpace()}}function Vv(m,i){if(i===IS)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),m;if(i===P_||i===Cb){let s=m.getIndex();if(s===null){const _=[],o=m.getAttribute("position");if(o!==void 0){for(let M=0;M<o.count;M++)_.push(M);m.setIndex(_),s=m.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),m}const c=s.count-2,f=[];if(i===P_)for(let _=1;_<=c;_++)f.push(s.getX(0)),f.push(s.getX(_)),f.push(s.getX(_+1));else for(let _=0;_<c;_++)_%2===0?(f.push(s.getX(_)),f.push(s.getX(_+1)),f.push(s.getX(_+2))):(f.push(s.getX(_+2)),f.push(s.getX(_+1)),f.push(s.getX(_)));f.length/3!==c&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const v=m.clone();return v.setIndex(f),v.clearGroups(),v}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",i),m}class mI extends Au{constructor(i){super(i),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(s){return new vI(s)}),this.register(function(s){return new bI(s)}),this.register(function(s){return new II(s)}),this.register(function(s){return new RI(s)}),this.register(function(s){return new DI(s)}),this.register(function(s){return new TI(s)}),this.register(function(s){return new SI(s)}),this.register(function(s){return new MI(s)}),this.register(function(s){return new EI(s)}),this.register(function(s){return new xI(s)}),this.register(function(s){return new AI(s)}),this.register(function(s){return new wI(s)}),this.register(function(s){return new PI(s)}),this.register(function(s){return new CI(s)}),this.register(function(s){return new _I(s)}),this.register(function(s){return new LI(s)}),this.register(function(s){return new FI(s)})}load(i,s,c,f){const v=this;let _;if(this.resourcePath!=="")_=this.resourcePath;else if(this.path!==""){const C=td.extractUrlBase(i);_=td.resolveURL(C,this.path)}else _=td.extractUrlBase(i);this.manager.itemStart(i);const o=function(C){f?f(C):console.error(C),v.manager.itemError(i),v.manager.itemEnd(i)},M=new Wb(this.manager);M.setPath(this.path),M.setResponseType("arraybuffer"),M.setRequestHeader(this.requestHeader),M.setWithCredentials(this.withCredentials),M.load(i,function(C){try{v.parse(C,_,function(D){s(D),v.manager.itemEnd(i)},o)}catch(D){o(D)}},c,o)}setDRACOLoader(i){return this.dracoLoader=i,this}setKTX2Loader(i){return this.ktx2Loader=i,this}setMeshoptDecoder(i){return this.meshoptDecoder=i,this}register(i){return this.pluginCallbacks.indexOf(i)===-1&&this.pluginCallbacks.push(i),this}unregister(i){return this.pluginCallbacks.indexOf(i)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(i),1),this}parse(i,s,c,f){let v;const _={},o={},M=new TextDecoder;if(typeof i=="string")v=JSON.parse(i);else if(i instanceof ArrayBuffer)if(M.decode(new Uint8Array(i,0,4))===Jb){try{_[Fi.KHR_BINARY_GLTF]=new zI(i)}catch(F){f&&f(F);return}v=JSON.parse(_[Fi.KHR_BINARY_GLTF].content)}else v=JSON.parse(M.decode(i));else v=i;if(v.asset===void 0||v.asset.version[0]<2){f&&f(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const C=new ZI(v,{path:s||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});C.fileLoader.setRequestHeader(this.requestHeader);for(let D=0;D<this.pluginCallbacks.length;D++){const F=this.pluginCallbacks[D](C);F.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[F.name]=F,_[F.name]=!0}if(v.extensionsUsed)for(let D=0;D<v.extensionsUsed.length;++D){const F=v.extensionsUsed[D],O=v.extensionsRequired||[];switch(F){case Fi.KHR_MATERIALS_UNLIT:_[F]=new yI;break;case Fi.KHR_DRACO_MESH_COMPRESSION:_[F]=new OI(v,this.dracoLoader);break;case Fi.KHR_TEXTURE_TRANSFORM:_[F]=new NI;break;case Fi.KHR_MESH_QUANTIZATION:_[F]=new BI;break;default:O.indexOf(F)>=0&&o[F]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+F+'".')}}C.setExtensions(_),C.setPlugins(o),C.parse(c,f)}parseAsync(i,s){const c=this;return new Promise(function(f,v){c.parse(i,s,f,v)})}}function gI(){let m={};return{get:function(i){return m[i]},add:function(i,s){m[i]=s},remove:function(i){delete m[i]},removeAll:function(){m={}}}}const Fi={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class _I{constructor(i){this.parser=i,this.name=Fi.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const i=this.parser,s=this.parser.json.nodes||[];for(let c=0,f=s.length;c<f;c++){const v=s[c];v.extensions&&v.extensions[this.name]&&v.extensions[this.name].light!==void 0&&i._addNodeRef(this.cache,v.extensions[this.name].light)}}_loadLight(i){const s=this.parser,c="light:"+i;let f=s.cache.get(c);if(f)return f;const v=s.json,M=((v.extensions&&v.extensions[this.name]||{}).lights||[])[i];let C;const D=new bi(16777215);M.color!==void 0&&D.setRGB(M.color[0],M.color[1],M.color[2],Vr);const F=M.range!==void 0?M.range:0;switch(M.type){case"directional":C=new L_(D),C.target.position.set(0,0,-1),C.add(C.target);break;case"point":C=new aE(D),C.distance=F;break;case"spot":C=new rE(D),C.distance=F,M.spot=M.spot||{},M.spot.innerConeAngle=M.spot.innerConeAngle!==void 0?M.spot.innerConeAngle:0,M.spot.outerConeAngle=M.spot.outerConeAngle!==void 0?M.spot.outerConeAngle:Math.PI/4,C.angle=M.spot.outerConeAngle,C.penumbra=1-M.spot.innerConeAngle/M.spot.outerConeAngle,C.target.position.set(0,0,-1),C.add(C.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+M.type)}return C.position.set(0,0,0),ca(C,M),M.intensity!==void 0&&(C.intensity=M.intensity),C.name=s.createUniqueName(M.name||"light_"+i),f=Promise.resolve(C),s.cache.add(c,f),f}getDependency(i,s){if(i==="light")return this._loadLight(s)}createNodeAttachment(i){const s=this,c=this.parser,v=c.json.nodes[i],o=(v.extensions&&v.extensions[this.name]||{}).light;return o===void 0?null:this._loadLight(o).then(function(M){return c._getNodeRef(s.cache,o,M)})}}class yI{constructor(){this.name=Fi.KHR_MATERIALS_UNLIT}getMaterialType(){return eo}extendParams(i,s,c){const f=[];i.color=new bi(1,1,1),i.opacity=1;const v=s.pbrMetallicRoughness;if(v){if(Array.isArray(v.baseColorFactor)){const _=v.baseColorFactor;i.color.setRGB(_[0],_[1],_[2],Vr),i.opacity=_[3]}v.baseColorTexture!==void 0&&f.push(c.assignTexture(i,"map",v.baseColorTexture,Sr))}return Promise.all(f)}}class xI{constructor(i){this.parser=i,this.name=Fi.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(i,s){const f=this.parser.json.materials[i];if(!f.extensions||!f.extensions[this.name])return Promise.resolve();const v=f.extensions[this.name].emissiveStrength;return v!==void 0&&(s.emissiveIntensity=v),Promise.resolve()}}class vI{constructor(i){this.parser=i,this.name=Fi.KHR_MATERIALS_CLEARCOAT}getMaterialType(i){const c=this.parser.json.materials[i];return!c.extensions||!c.extensions[this.name]?null:va}extendMaterialParams(i,s){const c=this.parser,f=c.json.materials[i];if(!f.extensions||!f.extensions[this.name])return Promise.resolve();const v=[],_=f.extensions[this.name];if(_.clearcoatFactor!==void 0&&(s.clearcoat=_.clearcoatFactor),_.clearcoatTexture!==void 0&&v.push(c.assignTexture(s,"clearcoatMap",_.clearcoatTexture)),_.clearcoatRoughnessFactor!==void 0&&(s.clearcoatRoughness=_.clearcoatRoughnessFactor),_.clearcoatRoughnessTexture!==void 0&&v.push(c.assignTexture(s,"clearcoatRoughnessMap",_.clearcoatRoughnessTexture)),_.clearcoatNormalTexture!==void 0&&(v.push(c.assignTexture(s,"clearcoatNormalMap",_.clearcoatNormalTexture)),_.clearcoatNormalTexture.scale!==void 0)){const o=_.clearcoatNormalTexture.scale;s.clearcoatNormalScale=new Bi(o,o)}return Promise.all(v)}}class bI{constructor(i){this.parser=i,this.name=Fi.KHR_MATERIALS_DISPERSION}getMaterialType(i){const c=this.parser.json.materials[i];return!c.extensions||!c.extensions[this.name]?null:va}extendMaterialParams(i,s){const f=this.parser.json.materials[i];if(!f.extensions||!f.extensions[this.name])return Promise.resolve();const v=f.extensions[this.name];return s.dispersion=v.dispersion!==void 0?v.dispersion:0,Promise.resolve()}}class wI{constructor(i){this.parser=i,this.name=Fi.KHR_MATERIALS_IRIDESCENCE}getMaterialType(i){const c=this.parser.json.materials[i];return!c.extensions||!c.extensions[this.name]?null:va}extendMaterialParams(i,s){const c=this.parser,f=c.json.materials[i];if(!f.extensions||!f.extensions[this.name])return Promise.resolve();const v=[],_=f.extensions[this.name];return _.iridescenceFactor!==void 0&&(s.iridescence=_.iridescenceFactor),_.iridescenceTexture!==void 0&&v.push(c.assignTexture(s,"iridescenceMap",_.iridescenceTexture)),_.iridescenceIor!==void 0&&(s.iridescenceIOR=_.iridescenceIor),s.iridescenceThicknessRange===void 0&&(s.iridescenceThicknessRange=[100,400]),_.iridescenceThicknessMinimum!==void 0&&(s.iridescenceThicknessRange[0]=_.iridescenceThicknessMinimum),_.iridescenceThicknessMaximum!==void 0&&(s.iridescenceThicknessRange[1]=_.iridescenceThicknessMaximum),_.iridescenceThicknessTexture!==void 0&&v.push(c.assignTexture(s,"iridescenceThicknessMap",_.iridescenceThicknessTexture)),Promise.all(v)}}class TI{constructor(i){this.parser=i,this.name=Fi.KHR_MATERIALS_SHEEN}getMaterialType(i){const c=this.parser.json.materials[i];return!c.extensions||!c.extensions[this.name]?null:va}extendMaterialParams(i,s){const c=this.parser,f=c.json.materials[i];if(!f.extensions||!f.extensions[this.name])return Promise.resolve();const v=[];s.sheenColor=new bi(0,0,0),s.sheenRoughness=0,s.sheen=1;const _=f.extensions[this.name];if(_.sheenColorFactor!==void 0){const o=_.sheenColorFactor;s.sheenColor.setRGB(o[0],o[1],o[2],Vr)}return _.sheenRoughnessFactor!==void 0&&(s.sheenRoughness=_.sheenRoughnessFactor),_.sheenColorTexture!==void 0&&v.push(c.assignTexture(s,"sheenColorMap",_.sheenColorTexture,Sr)),_.sheenRoughnessTexture!==void 0&&v.push(c.assignTexture(s,"sheenRoughnessMap",_.sheenRoughnessTexture)),Promise.all(v)}}class SI{constructor(i){this.parser=i,this.name=Fi.KHR_MATERIALS_TRANSMISSION}getMaterialType(i){const c=this.parser.json.materials[i];return!c.extensions||!c.extensions[this.name]?null:va}extendMaterialParams(i,s){const c=this.parser,f=c.json.materials[i];if(!f.extensions||!f.extensions[this.name])return Promise.resolve();const v=[],_=f.extensions[this.name];return _.transmissionFactor!==void 0&&(s.transmission=_.transmissionFactor),_.transmissionTexture!==void 0&&v.push(c.assignTexture(s,"transmissionMap",_.transmissionTexture)),Promise.all(v)}}class MI{constructor(i){this.parser=i,this.name=Fi.KHR_MATERIALS_VOLUME}getMaterialType(i){const c=this.parser.json.materials[i];return!c.extensions||!c.extensions[this.name]?null:va}extendMaterialParams(i,s){const c=this.parser,f=c.json.materials[i];if(!f.extensions||!f.extensions[this.name])return Promise.resolve();const v=[],_=f.extensions[this.name];s.thickness=_.thicknessFactor!==void 0?_.thicknessFactor:0,_.thicknessTexture!==void 0&&v.push(c.assignTexture(s,"thicknessMap",_.thicknessTexture)),s.attenuationDistance=_.attenuationDistance||1/0;const o=_.attenuationColor||[1,1,1];return s.attenuationColor=new bi().setRGB(o[0],o[1],o[2],Vr),Promise.all(v)}}class EI{constructor(i){this.parser=i,this.name=Fi.KHR_MATERIALS_IOR}getMaterialType(i){const c=this.parser.json.materials[i];return!c.extensions||!c.extensions[this.name]?null:va}extendMaterialParams(i,s){const f=this.parser.json.materials[i];if(!f.extensions||!f.extensions[this.name])return Promise.resolve();const v=f.extensions[this.name];return s.ior=v.ior!==void 0?v.ior:1.5,Promise.resolve()}}class AI{constructor(i){this.parser=i,this.name=Fi.KHR_MATERIALS_SPECULAR}getMaterialType(i){const c=this.parser.json.materials[i];return!c.extensions||!c.extensions[this.name]?null:va}extendMaterialParams(i,s){const c=this.parser,f=c.json.materials[i];if(!f.extensions||!f.extensions[this.name])return Promise.resolve();const v=[],_=f.extensions[this.name];s.specularIntensity=_.specularFactor!==void 0?_.specularFactor:1,_.specularTexture!==void 0&&v.push(c.assignTexture(s,"specularIntensityMap",_.specularTexture));const o=_.specularColorFactor||[1,1,1];return s.specularColor=new bi().setRGB(o[0],o[1],o[2],Vr),_.specularColorTexture!==void 0&&v.push(c.assignTexture(s,"specularColorMap",_.specularColorTexture,Sr)),Promise.all(v)}}class CI{constructor(i){this.parser=i,this.name=Fi.EXT_MATERIALS_BUMP}getMaterialType(i){const c=this.parser.json.materials[i];return!c.extensions||!c.extensions[this.name]?null:va}extendMaterialParams(i,s){const c=this.parser,f=c.json.materials[i];if(!f.extensions||!f.extensions[this.name])return Promise.resolve();const v=[],_=f.extensions[this.name];return s.bumpScale=_.bumpFactor!==void 0?_.bumpFactor:1,_.bumpTexture!==void 0&&v.push(c.assignTexture(s,"bumpMap",_.bumpTexture)),Promise.all(v)}}class PI{constructor(i){this.parser=i,this.name=Fi.KHR_MATERIALS_ANISOTROPY}getMaterialType(i){const c=this.parser.json.materials[i];return!c.extensions||!c.extensions[this.name]?null:va}extendMaterialParams(i,s){const c=this.parser,f=c.json.materials[i];if(!f.extensions||!f.extensions[this.name])return Promise.resolve();const v=[],_=f.extensions[this.name];return _.anisotropyStrength!==void 0&&(s.anisotropy=_.anisotropyStrength),_.anisotropyRotation!==void 0&&(s.anisotropyRotation=_.anisotropyRotation),_.anisotropyTexture!==void 0&&v.push(c.assignTexture(s,"anisotropyMap",_.anisotropyTexture)),Promise.all(v)}}class II{constructor(i){this.parser=i,this.name=Fi.KHR_TEXTURE_BASISU}loadTexture(i){const s=this.parser,c=s.json,f=c.textures[i];if(!f.extensions||!f.extensions[this.name])return null;const v=f.extensions[this.name],_=s.options.ktx2Loader;if(!_){if(c.extensionsRequired&&c.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return s.loadTextureImage(i,v.source,_)}}class RI{constructor(i){this.parser=i,this.name=Fi.EXT_TEXTURE_WEBP}loadTexture(i){const s=this.name,c=this.parser,f=c.json,v=f.textures[i];if(!v.extensions||!v.extensions[s])return null;const _=v.extensions[s],o=f.images[_.source];let M=c.textureLoader;if(o.uri){const C=c.options.manager.getHandler(o.uri);C!==null&&(M=C)}return c.loadTextureImage(i,_.source,M)}}class DI{constructor(i){this.parser=i,this.name=Fi.EXT_TEXTURE_AVIF}loadTexture(i){const s=this.name,c=this.parser,f=c.json,v=f.textures[i];if(!v.extensions||!v.extensions[s])return null;const _=v.extensions[s],o=f.images[_.source];let M=c.textureLoader;if(o.uri){const C=c.options.manager.getHandler(o.uri);C!==null&&(M=C)}return c.loadTextureImage(i,_.source,M)}}class LI{constructor(i){this.name=Fi.EXT_MESHOPT_COMPRESSION,this.parser=i}loadBufferView(i){const s=this.parser.json,c=s.bufferViews[i];if(c.extensions&&c.extensions[this.name]){const f=c.extensions[this.name],v=this.parser.getDependency("buffer",f.buffer),_=this.parser.options.meshoptDecoder;if(!_||!_.supported){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return v.then(function(o){const M=f.byteOffset||0,C=f.byteLength||0,D=f.count,F=f.byteStride,O=new Uint8Array(o,M,C);return _.decodeGltfBufferAsync?_.decodeGltfBufferAsync(D,F,O,f.mode,f.filter).then(function(j){return j.buffer}):_.ready.then(function(){const j=new ArrayBuffer(D*F);return _.decodeGltfBuffer(new Uint8Array(j),D,F,O,f.mode,f.filter),j})})}else return null}}class FI{constructor(i){this.name=Fi.EXT_MESH_GPU_INSTANCING,this.parser=i}createNodeMesh(i){const s=this.parser.json,c=s.nodes[i];if(!c.extensions||!c.extensions[this.name]||c.mesh===void 0)return null;const f=s.meshes[c.mesh];for(const C of f.primitives)if(C.mode!==Es.TRIANGLES&&C.mode!==Es.TRIANGLE_STRIP&&C.mode!==Es.TRIANGLE_FAN&&C.mode!==void 0)return null;const _=c.extensions[this.name].attributes,o=[],M={};for(const C in _)o.push(this.parser.getDependency("accessor",_[C]).then(D=>(M[C]=D,M[C])));return o.length<1?null:(o.push(this.parser.createNodeMesh(i)),Promise.all(o).then(C=>{const D=C.pop(),F=D.isGroup?D.children:[D],O=C[0].count,j=[];for(const K of F){const J=new gi,N=new We,W=new $o,ge=new We(1,1,1),de=new FM(K.geometry,K.material,O);for(let ve=0;ve<O;ve++)M.TRANSLATION&&N.fromBufferAttribute(M.TRANSLATION,ve),M.ROTATION&&W.fromBufferAttribute(M.ROTATION,ve),M.SCALE&&ge.fromBufferAttribute(M.SCALE,ve),de.setMatrixAt(ve,J.compose(N,W,ge));for(const ve in M)if(ve==="_COLOR_0"){const Me=M[ve];de.instanceColor=new R_(Me.array,Me.itemSize,Me.normalized)}else ve!=="TRANSLATION"&&ve!=="ROTATION"&&ve!=="SCALE"&&K.geometry.setAttribute(ve,M[ve]);Dn.prototype.copy.call(de,K),this.parser.assignFinalMaterial(de),j.push(de)}return D.isGroup?(D.clear(),D.add(...j),D):j[0]}))}}const Jb="glTF",Zh=12,Gv={JSON:1313821514,BIN:5130562};class zI{constructor(i){this.name=Fi.KHR_BINARY_GLTF,this.content=null,this.body=null;const s=new DataView(i,0,Zh),c=new TextDecoder;if(this.header={magic:c.decode(new Uint8Array(i.slice(0,4))),version:s.getUint32(4,!0),length:s.getUint32(8,!0)},this.header.magic!==Jb)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const f=this.header.length-Zh,v=new DataView(i,Zh);let _=0;for(;_<f;){const o=v.getUint32(_,!0);_+=4;const M=v.getUint32(_,!0);if(_+=4,M===Gv.JSON){const C=new Uint8Array(i,Zh+_,o);this.content=c.decode(C)}else if(M===Gv.BIN){const C=Zh+_;this.body=i.slice(C,C+o)}_+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class OI{constructor(i,s){if(!s)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Fi.KHR_DRACO_MESH_COMPRESSION,this.json=i,this.dracoLoader=s,this.dracoLoader.preload()}decodePrimitive(i,s){const c=this.json,f=this.dracoLoader,v=i.extensions[this.name].bufferView,_=i.extensions[this.name].attributes,o={},M={},C={};for(const D in _){const F=O_[D]||D.toLowerCase();o[F]=_[D]}for(const D in i.attributes){const F=O_[D]||D.toLowerCase();if(_[D]!==void 0){const O=c.accessors[i.attributes[D]],j=pu[O.componentType];C[F]=j.name,M[F]=O.normalized===!0}}return s.getDependency("bufferView",v).then(function(D){return new Promise(function(F,O){f.decodeDracoFile(D,function(j){for(const K in j.attributes){const J=j.attributes[K],N=M[K];N!==void 0&&(J.normalized=N)}F(j)},o,C,Vr,O)})})}}class NI{constructor(){this.name=Fi.KHR_TEXTURE_TRANSFORM}extendTexture(i,s){return(s.texCoord===void 0||s.texCoord===i.channel)&&s.offset===void 0&&s.rotation===void 0&&s.scale===void 0||(i=i.clone(),s.texCoord!==void 0&&(i.channel=s.texCoord),s.offset!==void 0&&i.offset.fromArray(s.offset),s.rotation!==void 0&&(i.rotation=s.rotation),s.scale!==void 0&&i.repeat.fromArray(s.scale),i.needsUpdate=!0),i}}class BI{constructor(){this.name=Fi.KHR_MESH_QUANTIZATION}}class Qb extends hd{constructor(i,s,c,f){super(i,s,c,f)}copySampleValue_(i){const s=this.resultBuffer,c=this.sampleValues,f=this.valueSize,v=i*f*3+f;for(let _=0;_!==f;_++)s[_]=c[v+_];return s}interpolate_(i,s,c,f){const v=this.resultBuffer,_=this.sampleValues,o=this.valueSize,M=o*2,C=o*3,D=f-s,F=(c-s)/D,O=F*F,j=O*F,K=i*C,J=K-C,N=-2*j+3*O,W=j-O,ge=1-N,de=W-O+F;for(let ve=0;ve!==o;ve++){const Me=_[J+ve+o],De=_[J+ve+M]*D,Ie=_[K+ve+o],$e=_[K+ve]*D;v[ve]=ge*Me+de*De+N*Ie+W*$e}return v}}const kI=new $o;class UI extends Qb{interpolate_(i,s,c,f){const v=super.interpolate_(i,s,c,f);return kI.fromArray(v).normalize().toArray(v),v}}const Es={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},pu={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Hv={9728:ir,9729:nr,9984:bb,9985:cp,9986:Yh,9987:Qa},jv={33071:ha,33648:mp,10497:_u},Lg={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},O_={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},qo={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},VI={CUBICSPLINE:void 0,LINEAR:sd,STEP:rd},Fg={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function GI(m){return m.DefaultMaterial===void 0&&(m.DefaultMaterial=new ly({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:ro})),m.DefaultMaterial}function Vl(m,i,s){for(const c in s.extensions)m[c]===void 0&&(i.userData.gltfExtensions=i.userData.gltfExtensions||{},i.userData.gltfExtensions[c]=s.extensions[c])}function ca(m,i){i.extras!==void 0&&(typeof i.extras=="object"?Object.assign(m.userData,i.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+i.extras))}function HI(m,i,s){let c=!1,f=!1,v=!1;for(let C=0,D=i.length;C<D;C++){const F=i[C];if(F.POSITION!==void 0&&(c=!0),F.NORMAL!==void 0&&(f=!0),F.COLOR_0!==void 0&&(v=!0),c&&f&&v)break}if(!c&&!f&&!v)return Promise.resolve(m);const _=[],o=[],M=[];for(let C=0,D=i.length;C<D;C++){const F=i[C];if(c){const O=F.POSITION!==void 0?s.getDependency("accessor",F.POSITION):m.attributes.position;_.push(O)}if(f){const O=F.NORMAL!==void 0?s.getDependency("accessor",F.NORMAL):m.attributes.normal;o.push(O)}if(v){const O=F.COLOR_0!==void 0?s.getDependency("accessor",F.COLOR_0):m.attributes.color;M.push(O)}}return Promise.all([Promise.all(_),Promise.all(o),Promise.all(M)]).then(function(C){const D=C[0],F=C[1],O=C[2];return c&&(m.morphAttributes.position=D),f&&(m.morphAttributes.normal=F),v&&(m.morphAttributes.color=O),m.morphTargetsRelative=!0,m})}function jI(m,i){if(m.updateMorphTargets(),i.weights!==void 0)for(let s=0,c=i.weights.length;s<c;s++)m.morphTargetInfluences[s]=i.weights[s];if(i.extras&&Array.isArray(i.extras.targetNames)){const s=i.extras.targetNames;if(m.morphTargetInfluences.length===s.length){m.morphTargetDictionary={};for(let c=0,f=s.length;c<f;c++)m.morphTargetDictionary[s[c]]=c}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function WI(m){let i;const s=m.extensions&&m.extensions[Fi.KHR_DRACO_MESH_COMPRESSION];if(s?i="draco:"+s.bufferView+":"+s.indices+":"+zg(s.attributes):i=m.indices+":"+zg(m.attributes)+":"+m.mode,m.targets!==void 0)for(let c=0,f=m.targets.length;c<f;c++)i+=":"+zg(m.targets[c]);return i}function zg(m){let i="";const s=Object.keys(m).sort();for(let c=0,f=s.length;c<f;c++)i+=s[c]+":"+m[s[c]]+";";return i}function N_(m){switch(m){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function qI(m){return m.search(/\.jpe?g($|\?)/i)>0||m.search(/^data\:image\/jpeg/)===0?"image/jpeg":m.search(/\.webp($|\?)/i)>0||m.search(/^data\:image\/webp/)===0?"image/webp":m.search(/\.ktx2($|\?)/i)>0||m.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const XI=new gi;class ZI{constructor(i={},s={}){this.json=i,this.extensions={},this.plugins={},this.options=s,this.cache=new gI,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let c=!1,f=-1,v=!1,_=-1;if(typeof navigator<"u"){const o=navigator.userAgent;c=/^((?!chrome|android).)*safari/i.test(o)===!0;const M=o.match(/Version\/(\d+)/);f=c&&M?parseInt(M[1],10):-1,v=o.indexOf("Firefox")>-1,_=v?o.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||c&&f<17||v&&_<98?this.textureLoader=new qb(this.options.manager):this.textureLoader=new lE(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Wb(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(i){this.extensions=i}setPlugins(i){this.plugins=i}parse(i,s){const c=this,f=this.json,v=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(_){return _._markDefs&&_._markDefs()}),Promise.all(this._invokeAll(function(_){return _.beforeRoot&&_.beforeRoot()})).then(function(){return Promise.all([c.getDependencies("scene"),c.getDependencies("animation"),c.getDependencies("camera")])}).then(function(_){const o={scene:_[0][f.scene||0],scenes:_[0],animations:_[1],cameras:_[2],asset:f.asset,parser:c,userData:{}};return Vl(v,o,f),ca(o,f),Promise.all(c._invokeAll(function(M){return M.afterRoot&&M.afterRoot(o)})).then(function(){for(const M of o.scenes)M.updateMatrixWorld();i(o)})}).catch(s)}_markDefs(){const i=this.json.nodes||[],s=this.json.skins||[],c=this.json.meshes||[];for(let f=0,v=s.length;f<v;f++){const _=s[f].joints;for(let o=0,M=_.length;o<M;o++)i[_[o]].isBone=!0}for(let f=0,v=i.length;f<v;f++){const _=i[f];_.mesh!==void 0&&(this._addNodeRef(this.meshCache,_.mesh),_.skin!==void 0&&(c[_.mesh].isSkinnedMesh=!0)),_.camera!==void 0&&this._addNodeRef(this.cameraCache,_.camera)}}_addNodeRef(i,s){s!==void 0&&(i.refs[s]===void 0&&(i.refs[s]=i.uses[s]=0),i.refs[s]++)}_getNodeRef(i,s,c){if(i.refs[s]<=1)return c;const f=c.clone(),v=(_,o)=>{const M=this.associations.get(_);M!=null&&this.associations.set(o,M);for(const[C,D]of _.children.entries())v(D,o.children[C])};return v(c,f),f.name+="_instance_"+i.uses[s]++,f}_invokeOne(i){const s=Object.values(this.plugins);s.push(this);for(let c=0;c<s.length;c++){const f=i(s[c]);if(f)return f}return null}_invokeAll(i){const s=Object.values(this.plugins);s.unshift(this);const c=[];for(let f=0;f<s.length;f++){const v=i(s[f]);v&&c.push(v)}return c}getDependency(i,s){const c=i+":"+s;let f=this.cache.get(c);if(!f){switch(i){case"scene":f=this.loadScene(s);break;case"node":f=this._invokeOne(function(v){return v.loadNode&&v.loadNode(s)});break;case"mesh":f=this._invokeOne(function(v){return v.loadMesh&&v.loadMesh(s)});break;case"accessor":f=this.loadAccessor(s);break;case"bufferView":f=this._invokeOne(function(v){return v.loadBufferView&&v.loadBufferView(s)});break;case"buffer":f=this.loadBuffer(s);break;case"material":f=this._invokeOne(function(v){return v.loadMaterial&&v.loadMaterial(s)});break;case"texture":f=this._invokeOne(function(v){return v.loadTexture&&v.loadTexture(s)});break;case"skin":f=this.loadSkin(s);break;case"animation":f=this._invokeOne(function(v){return v.loadAnimation&&v.loadAnimation(s)});break;case"camera":f=this.loadCamera(s);break;default:if(f=this._invokeOne(function(v){return v!=this&&v.getDependency&&v.getDependency(i,s)}),!f)throw new Error("Unknown type: "+i);break}this.cache.add(c,f)}return f}getDependencies(i){let s=this.cache.get(i);if(!s){const c=this,f=this.json[i+(i==="mesh"?"es":"s")]||[];s=Promise.all(f.map(function(v,_){return c.getDependency(i,_)})),this.cache.add(i,s)}return s}loadBuffer(i){const s=this.json.buffers[i],c=this.fileLoader;if(s.type&&s.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+s.type+" buffer type is not supported.");if(s.uri===void 0&&i===0)return Promise.resolve(this.extensions[Fi.KHR_BINARY_GLTF].body);const f=this.options;return new Promise(function(v,_){c.load(td.resolveURL(s.uri,f.path),v,void 0,function(){_(new Error('THREE.GLTFLoader: Failed to load buffer "'+s.uri+'".'))})})}loadBufferView(i){const s=this.json.bufferViews[i];return this.getDependency("buffer",s.buffer).then(function(c){const f=s.byteLength||0,v=s.byteOffset||0;return c.slice(v,v+f)})}loadAccessor(i){const s=this,c=this.json,f=this.json.accessors[i];if(f.bufferView===void 0&&f.sparse===void 0){const _=Lg[f.type],o=pu[f.componentType],M=f.normalized===!0,C=new o(f.count*_);return Promise.resolve(new mr(C,_,M))}const v=[];return f.bufferView!==void 0?v.push(this.getDependency("bufferView",f.bufferView)):v.push(null),f.sparse!==void 0&&(v.push(this.getDependency("bufferView",f.sparse.indices.bufferView)),v.push(this.getDependency("bufferView",f.sparse.values.bufferView))),Promise.all(v).then(function(_){const o=_[0],M=Lg[f.type],C=pu[f.componentType],D=C.BYTES_PER_ELEMENT,F=D*M,O=f.byteOffset||0,j=f.bufferView!==void 0?c.bufferViews[f.bufferView].byteStride:void 0,K=f.normalized===!0;let J,N;if(j&&j!==F){const W=Math.floor(O/j),ge="InterleavedBuffer:"+f.bufferView+":"+f.componentType+":"+W+":"+f.count;let de=s.cache.get(ge);de||(J=new C(o,W*j,f.count*j/D),de=new PM(J,j/D),s.cache.add(ge,de)),N=new iy(de,M,O%j/D,K)}else o===null?J=new C(f.count*M):J=new C(o,O,f.count*M),N=new mr(J,M,K);if(f.sparse!==void 0){const W=Lg.SCALAR,ge=pu[f.sparse.indices.componentType],de=f.sparse.indices.byteOffset||0,ve=f.sparse.values.byteOffset||0,Me=new ge(_[1],de,f.sparse.count*W),De=new C(_[2],ve,f.sparse.count*M);o!==null&&(N=new mr(N.array.slice(),N.itemSize,N.normalized)),N.normalized=!1;for(let Ie=0,$e=Me.length;Ie<$e;Ie++){const re=Me[Ie];if(N.setX(re,De[Ie*M]),M>=2&&N.setY(re,De[Ie*M+1]),M>=3&&N.setZ(re,De[Ie*M+2]),M>=4&&N.setW(re,De[Ie*M+3]),M>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}N.normalized=K}return N})}loadTexture(i){const s=this.json,c=this.options,v=s.textures[i].source,_=s.images[v];let o=this.textureLoader;if(_.uri){const M=c.manager.getHandler(_.uri);M!==null&&(o=M)}return this.loadTextureImage(i,v,o)}loadTextureImage(i,s,c){const f=this,v=this.json,_=v.textures[i],o=v.images[s],M=(o.uri||o.bufferView)+":"+_.sampler;if(this.textureCache[M])return this.textureCache[M];const C=this.loadImageSource(s,c).then(function(D){D.flipY=!1,D.name=_.name||o.name||"",D.name===""&&typeof o.uri=="string"&&o.uri.startsWith("data:image/")===!1&&(D.name=o.uri);const O=(v.samplers||{})[_.sampler]||{};return D.magFilter=Hv[O.magFilter]||nr,D.minFilter=Hv[O.minFilter]||Qa,D.wrapS=jv[O.wrapS]||_u,D.wrapT=jv[O.wrapT]||_u,D.generateMipmaps=!D.isCompressedTexture&&D.minFilter!==ir&&D.minFilter!==nr,f.associations.set(D,{textures:i}),D}).catch(function(){return null});return this.textureCache[M]=C,C}loadImageSource(i,s){const c=this,f=this.json,v=this.options;if(this.sourceCache[i]!==void 0)return this.sourceCache[i].then(F=>F.clone());const _=f.images[i],o=self.URL||self.webkitURL;let M=_.uri||"",C=!1;if(_.bufferView!==void 0)M=c.getDependency("bufferView",_.bufferView).then(function(F){C=!0;const O=new Blob([F],{type:_.mimeType});return M=o.createObjectURL(O),M});else if(_.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+i+" is missing URI and bufferView");const D=Promise.resolve(M).then(function(F){return new Promise(function(O,j){let K=O;s.isImageBitmapLoader===!0&&(K=function(J){const N=new pr(J);N.needsUpdate=!0,O(N)}),s.load(td.resolveURL(F,v.path),K,void 0,j)})}).then(function(F){return C===!0&&o.revokeObjectURL(M),ca(F,_),F.userData.mimeType=_.mimeType||qI(_.uri),F}).catch(function(F){throw console.error("THREE.GLTFLoader: Couldn't load texture",M),F});return this.sourceCache[i]=D,D}assignTexture(i,s,c,f){const v=this;return this.getDependency("texture",c.index).then(function(_){if(!_)return null;if(c.texCoord!==void 0&&c.texCoord>0&&(_=_.clone(),_.channel=c.texCoord),v.extensions[Fi.KHR_TEXTURE_TRANSFORM]){const o=c.extensions!==void 0?c.extensions[Fi.KHR_TEXTURE_TRANSFORM]:void 0;if(o){const M=v.associations.get(_);_=v.extensions[Fi.KHR_TEXTURE_TRANSFORM].extendTexture(_,o),v.associations.set(_,M)}}return f!==void 0&&(_.colorSpace=f),i[s]=_,_})}assignFinalMaterial(i){const s=i.geometry;let c=i.material;const f=s.attributes.tangent===void 0,v=s.attributes.color!==void 0,_=s.attributes.normal===void 0;if(i.isPoints){const o="PointsMaterial:"+c.uuid;let M=this.cache.get(o);M||(M=new Vb,ma.prototype.copy.call(M,c),M.color.copy(c.color),M.map=c.map,M.sizeAttenuation=!1,this.cache.add(o,M)),c=M}else if(i.isLine){const o="LineBasicMaterial:"+c.uuid;let M=this.cache.get(o);M||(M=new Ub,ma.prototype.copy.call(M,c),M.color.copy(c.color),M.map=c.map,this.cache.add(o,M)),c=M}if(f||v||_){let o="ClonedMaterial:"+c.uuid+":";f&&(o+="derivative-tangents:"),v&&(o+="vertex-colors:"),_&&(o+="flat-shading:");let M=this.cache.get(o);M||(M=c.clone(),v&&(M.vertexColors=!0),_&&(M.flatShading=!0),f&&(M.normalScale&&(M.normalScale.y*=-1),M.clearcoatNormalScale&&(M.clearcoatNormalScale.y*=-1)),this.cache.add(o,M),this.associations.set(M,this.associations.get(c))),c=M}i.material=c}getMaterialType(){return ly}loadMaterial(i){const s=this,c=this.json,f=this.extensions,v=c.materials[i];let _;const o={},M=v.extensions||{},C=[];if(M[Fi.KHR_MATERIALS_UNLIT]){const F=f[Fi.KHR_MATERIALS_UNLIT];_=F.getMaterialType(),C.push(F.extendParams(o,v,s))}else{const F=v.pbrMetallicRoughness||{};if(o.color=new bi(1,1,1),o.opacity=1,Array.isArray(F.baseColorFactor)){const O=F.baseColorFactor;o.color.setRGB(O[0],O[1],O[2],Vr),o.opacity=O[3]}F.baseColorTexture!==void 0&&C.push(s.assignTexture(o,"map",F.baseColorTexture,Sr)),o.metalness=F.metallicFactor!==void 0?F.metallicFactor:1,o.roughness=F.roughnessFactor!==void 0?F.roughnessFactor:1,F.metallicRoughnessTexture!==void 0&&(C.push(s.assignTexture(o,"metalnessMap",F.metallicRoughnessTexture)),C.push(s.assignTexture(o,"roughnessMap",F.metallicRoughnessTexture))),_=this._invokeOne(function(O){return O.getMaterialType&&O.getMaterialType(i)}),C.push(Promise.all(this._invokeAll(function(O){return O.extendMaterialParams&&O.extendMaterialParams(i,o)})))}v.doubleSided===!0&&(o.side=As);const D=v.alphaMode||Fg.OPAQUE;if(D===Fg.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,D===Fg.MASK&&(o.alphaTest=v.alphaCutoff!==void 0?v.alphaCutoff:.5)),v.normalTexture!==void 0&&_!==eo&&(C.push(s.assignTexture(o,"normalMap",v.normalTexture)),o.normalScale=new Bi(1,1),v.normalTexture.scale!==void 0)){const F=v.normalTexture.scale;o.normalScale.set(F,F)}if(v.occlusionTexture!==void 0&&_!==eo&&(C.push(s.assignTexture(o,"aoMap",v.occlusionTexture)),v.occlusionTexture.strength!==void 0&&(o.aoMapIntensity=v.occlusionTexture.strength)),v.emissiveFactor!==void 0&&_!==eo){const F=v.emissiveFactor;o.emissive=new bi().setRGB(F[0],F[1],F[2],Vr)}return v.emissiveTexture!==void 0&&_!==eo&&C.push(s.assignTexture(o,"emissiveMap",v.emissiveTexture,Sr)),Promise.all(C).then(function(){const F=new _(o);return v.name&&(F.name=v.name),ca(F,v),s.associations.set(F,{materials:i}),v.extensions&&Vl(f,F,v),F})}createUniqueName(i){const s=nn.sanitizeNodeName(i||"");return s in this.nodeNamesUsed?s+"_"+ ++this.nodeNamesUsed[s]:(this.nodeNamesUsed[s]=0,s)}loadGeometries(i){const s=this,c=this.extensions,f=this.primitiveCache;function v(o){return c[Fi.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(o,s).then(function(M){return Wv(M,o,s)})}const _=[];for(let o=0,M=i.length;o<M;o++){const C=i[o],D=WI(C),F=f[D];if(F)_.push(F.promise);else{let O;C.extensions&&C.extensions[Fi.KHR_DRACO_MESH_COMPRESSION]?O=v(C):O=Wv(new ts,C,s),f[D]={primitive:C,promise:O},_.push(O)}}return Promise.all(_)}loadMesh(i){const s=this,c=this.json,f=this.extensions,v=c.meshes[i],_=v.primitives,o=[];for(let M=0,C=_.length;M<C;M++){const D=_[M].material===void 0?GI(this.cache):this.getDependency("material",_[M].material);o.push(D)}return o.push(s.loadGeometries(_)),Promise.all(o).then(function(M){const C=M.slice(0,M.length-1),D=M[M.length-1],F=[];for(let j=0,K=D.length;j<K;j++){const J=D[j],N=_[j];let W;const ge=C[j];if(N.mode===Es.TRIANGLES||N.mode===Es.TRIANGLE_STRIP||N.mode===Es.TRIANGLE_FAN||N.mode===void 0)W=v.isSkinnedMesh===!0?new RM(J,ge):new Gr(J,ge),W.isSkinnedMesh===!0&&W.normalizeSkinWeights(),N.mode===Es.TRIANGLE_STRIP?W.geometry=Vv(W.geometry,Cb):N.mode===Es.TRIANGLE_FAN&&(W.geometry=Vv(W.geometry,P_));else if(N.mode===Es.LINES)W=new BM(J,ge);else if(N.mode===Es.LINE_STRIP)W=new ay(J,ge);else if(N.mode===Es.LINE_LOOP)W=new kM(J,ge);else if(N.mode===Es.POINTS)W=new UM(J,ge);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+N.mode);Object.keys(W.geometry.morphAttributes).length>0&&jI(W,v),W.name=s.createUniqueName(v.name||"mesh_"+i),ca(W,v),N.extensions&&Vl(f,W,N),s.assignFinalMaterial(W),F.push(W)}for(let j=0,K=F.length;j<K;j++)s.associations.set(F[j],{meshes:i,primitives:j});if(F.length===1)return v.extensions&&Vl(f,F[0],v),F[0];const O=new ql;v.extensions&&Vl(f,O,v),s.associations.set(O,{meshes:i});for(let j=0,K=F.length;j<K;j++)O.add(F[j]);return O})}loadCamera(i){let s;const c=this.json.cameras[i],f=c[c.type];if(!f){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return c.type==="perspective"?s=new Jr(rM.radToDeg(f.yfov),f.aspectRatio||1,f.znear||1,f.zfar||2e6):c.type==="orthographic"&&(s=new Mp(-f.xmag,f.xmag,f.ymag,-f.ymag,f.znear,f.zfar)),c.name&&(s.name=this.createUniqueName(c.name)),ca(s,c),Promise.resolve(s)}loadSkin(i){const s=this.json.skins[i],c=[];for(let f=0,v=s.joints.length;f<v;f++)c.push(this._loadNodeShallow(s.joints[f]));return s.inverseBindMatrices!==void 0?c.push(this.getDependency("accessor",s.inverseBindMatrices)):c.push(null),Promise.all(c).then(function(f){const v=f.pop(),_=f,o=[],M=[];for(let C=0,D=_.length;C<D;C++){const F=_[C];if(F){o.push(F);const O=new gi;v!==null&&O.fromArray(v.array,C*16),M.push(O)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',s.joints[C])}return new ry(o,M)})}loadAnimation(i){const s=this.json,c=this,f=s.animations[i],v=f.name?f.name:"animation_"+i,_=[],o=[],M=[],C=[],D=[];for(let F=0,O=f.channels.length;F<O;F++){const j=f.channels[F],K=f.samplers[j.sampler],J=j.target,N=J.node,W=f.parameters!==void 0?f.parameters[K.input]:K.input,ge=f.parameters!==void 0?f.parameters[K.output]:K.output;J.node!==void 0&&(_.push(this.getDependency("node",N)),o.push(this.getDependency("accessor",W)),M.push(this.getDependency("accessor",ge)),C.push(K),D.push(J))}return Promise.all([Promise.all(_),Promise.all(o),Promise.all(M),Promise.all(C),Promise.all(D)]).then(function(F){const O=F[0],j=F[1],K=F[2],J=F[3],N=F[4],W=[];for(let de=0,ve=O.length;de<ve;de++){const Me=O[de],De=j[de],Ie=K[de],$e=J[de],re=N[de];if(Me===void 0)continue;Me.updateMatrix&&Me.updateMatrix();const fe=c._createAnimationTracks(Me,De,Ie,$e,re);if(fe)for(let Oe=0;Oe<fe.length;Oe++)W.push(fe[Oe])}const ge=new YM(v,void 0,W);return ca(ge,f),ge})}createNodeMesh(i){const s=this.json,c=this,f=s.nodes[i];return f.mesh===void 0?null:c.getDependency("mesh",f.mesh).then(function(v){const _=c._getNodeRef(c.meshCache,f.mesh,v);return f.weights!==void 0&&_.traverse(function(o){if(o.isMesh)for(let M=0,C=f.weights.length;M<C;M++)o.morphTargetInfluences[M]=f.weights[M]}),_})}loadNode(i){const s=this.json,c=this,f=s.nodes[i],v=c._loadNodeShallow(i),_=[],o=f.children||[];for(let C=0,D=o.length;C<D;C++)_.push(c.getDependency("node",o[C]));const M=f.skin===void 0?Promise.resolve(null):c.getDependency("skin",f.skin);return Promise.all([v,Promise.all(_),M]).then(function(C){const D=C[0],F=C[1],O=C[2];O!==null&&D.traverse(function(j){j.isSkinnedMesh&&j.bind(O,XI)});for(let j=0,K=F.length;j<K;j++)D.add(F[j]);return D})}_loadNodeShallow(i){const s=this.json,c=this.extensions,f=this;if(this.nodeCache[i]!==void 0)return this.nodeCache[i];const v=s.nodes[i],_=v.name?f.createUniqueName(v.name):"",o=[],M=f._invokeOne(function(C){return C.createNodeMesh&&C.createNodeMesh(i)});return M&&o.push(M),v.camera!==void 0&&o.push(f.getDependency("camera",v.camera).then(function(C){return f._getNodeRef(f.cameraCache,v.camera,C)})),f._invokeAll(function(C){return C.createNodeAttachment&&C.createNodeAttachment(i)}).forEach(function(C){o.push(C)}),this.nodeCache[i]=Promise.all(o).then(function(C){let D;if(v.isBone===!0?D=new kb:C.length>1?D=new ql:C.length===1?D=C[0]:D=new Dn,D!==C[0])for(let F=0,O=C.length;F<O;F++)D.add(C[F]);if(v.name&&(D.userData.name=v.name,D.name=_),ca(D,v),v.extensions&&Vl(c,D,v),v.matrix!==void 0){const F=new gi;F.fromArray(v.matrix),D.applyMatrix4(F)}else v.translation!==void 0&&D.position.fromArray(v.translation),v.rotation!==void 0&&D.quaternion.fromArray(v.rotation),v.scale!==void 0&&D.scale.fromArray(v.scale);if(!f.associations.has(D))f.associations.set(D,{});else if(v.mesh!==void 0&&f.meshCache.refs[v.mesh]>1){const F=f.associations.get(D);f.associations.set(D,{...F})}return f.associations.get(D).nodes=i,D}),this.nodeCache[i]}loadScene(i){const s=this.extensions,c=this.json.scenes[i],f=this,v=new ql;c.name&&(v.name=f.createUniqueName(c.name)),ca(v,c),c.extensions&&Vl(s,v,c);const _=c.nodes||[],o=[];for(let M=0,C=_.length;M<C;M++)o.push(f.getDependency("node",_[M]));return Promise.all(o).then(function(M){for(let D=0,F=M.length;D<F;D++)v.add(M[D]);const C=D=>{const F=new Map;for(const[O,j]of f.associations)(O instanceof ma||O instanceof pr)&&F.set(O,j);return D.traverse(O=>{const j=f.associations.get(O);j!=null&&F.set(O,j)}),F};return f.associations=C(v),v})}_createAnimationTracks(i,s,c,f,v){const _=[],o=i.name?i.name:i.uuid,M=[];qo[v.path]===qo.weights?i.traverse(function(O){O.morphTargetInfluences&&M.push(O.name?O.name:O.uuid)}):M.push(o);let C;switch(qo[v.path]){case qo.weights:C=bu;break;case qo.rotation:C=wu;break;case qo.translation:case qo.scale:C=Tu;break;default:c.itemSize===1?C=bu:C=Tu;break}const D=f.interpolation!==void 0?VI[f.interpolation]:sd,F=this._getArrayFromAccessor(c);for(let O=0,j=M.length;O<j;O++){const K=new C(M[O]+"."+qo[v.path],s.array,F,D);f.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(K),_.push(K)}return _}_getArrayFromAccessor(i){let s=i.array;if(i.normalized){const c=N_(s.constructor),f=new Float32Array(s.length);for(let v=0,_=s.length;v<_;v++)f[v]=s[v]*c;s=f}return s}_createCubicSplineTrackInterpolant(i){i.createInterpolant=function(c){const f=this instanceof wu?UI:Qb;return new f(this.times,this.values,this.getValueSize()/3,c)},i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function $I(m,i,s){const c=i.attributes,f=new oo;if(c.POSITION!==void 0){const o=s.json.accessors[c.POSITION],M=o.min,C=o.max;if(M!==void 0&&C!==void 0){if(f.set(new We(M[0],M[1],M[2]),new We(C[0],C[1],C[2])),o.normalized){const D=N_(pu[o.componentType]);f.min.multiplyScalar(D),f.max.multiplyScalar(D)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const v=i.targets;if(v!==void 0){const o=new We,M=new We;for(let C=0,D=v.length;C<D;C++){const F=v[C];if(F.POSITION!==void 0){const O=s.json.accessors[F.POSITION],j=O.min,K=O.max;if(j!==void 0&&K!==void 0){if(M.setX(Math.max(Math.abs(j[0]),Math.abs(K[0]))),M.setY(Math.max(Math.abs(j[1]),Math.abs(K[1]))),M.setZ(Math.max(Math.abs(j[2]),Math.abs(K[2]))),O.normalized){const J=N_(pu[O.componentType]);M.multiplyScalar(J)}o.max(M)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}f.expandByVector(o)}m.boundingBox=f;const _=new xa;f.getCenter(_.center),_.radius=f.min.distanceTo(f.max)/2,m.boundingSphere=_}function Wv(m,i,s){const c=i.attributes,f=[];function v(_,o){return s.getDependency("accessor",_).then(function(M){m.setAttribute(o,M)})}for(const _ in c){const o=O_[_]||_.toLowerCase();o in m.attributes||f.push(v(c[_],o))}if(i.indices!==void 0&&!m.index){const _=s.getDependency("accessor",i.indices).then(function(o){m.setIndex(o)});f.push(_)}return Ni.workingColorSpace!==Vr&&"COLOR_0"in c&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${Ni.workingColorSpace}" not supported.`),ca(m,i),$I(m,i,s),Promise.all(f).then(function(){return i.targets!==void 0?HI(m,i.targets,s):m})}const YI=()=>{const _=new ts,o=new Float32Array([-.25,-.25,0,.25,-.25,0,.25,.25,0,-.25,.25,0,-1.5,-1.5,5,1.5,-1.5,5,1.5,1.5,5,-1.5,1.5,5]),M=new Uint16Array([0,1,5,0,5,4,1,2,6,1,6,5,2,3,7,2,7,6,3,0,4,3,4,7]),C=new Float32Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0]);_.setIndex(new mr(M,1)),_.setAttribute("position",new mr(o,3)),_.setAttribute("color",new mr(C,4));const D=new eo({vertexColors:!0,transparent:!0,opacity:1,depthWrite:!1,depthTest:!0,blending:Xl,side:As});return new Gr(_,D)},KI=()=>{const i=new qb().load("/map-view-v2//img/avatar.jpeg"),s=new oy(.9,32),c=new eo({map:i,side:As});return new Gr(s,c)},JI=async(m,i)=>new Promise((s,c)=>{m.load(i,f=>{s(f.scene)},()=>{},f=>c(f))});class QI{scene;camera;renderer;constructor(i,s){this.scene=new CM,this.camera=new ty,this.renderer=new pI({canvas:i.getCanvas(),context:s,antialias:!0}),this.renderer.autoClear=!1}add(...i){return this.scene.add(...i)}draw(){this.renderer.resetState(),this.renderer.render(this.scene,this.camera)}}const Og=({location:m,altitude:i=0,modelRotate:s=[0,0,0],scaleFactor:c=1,translationFactorX:f=1,translationFactorY:v=1,translationFactorZ:_=1})=>{const o=Ng.MercatorCoordinate.fromLngLat(m,i),M=o.meterInMercatorCoordinateUnits(),C={translateX:o.x+f*M,translateY:o.y+v*M,translateZ:o.z+_*M,rotateX:s[0],rotateY:s[1],rotateZ:s[2],scale:o.meterInMercatorCoordinateUnits()*c},D=new gi().makeRotationAxis(new We(1,0,0),C.rotateX),F=new gi().makeRotationAxis(new We(0,1,0),C.rotateY),O=new gi().makeRotationAxis(new We(0,0,1),C.rotateZ);return new gi().makeTranslation(C.translateX,C.translateY,C.translateZ).scale(new We(C.scale,-C.scale,C.scale)).multiply(D).multiply(F).multiply(O)};class eR{id;type="custom";renderingMode="3d";freyaScene=null;waypointCoords=[0,0];gltfLoader=new mI;objectIndex={};constructor({id:i="cemetery-layer",waypointCoords:s}){this.id=i,this.waypointCoords=s}async onAdd(i,s){this.freyaScene=new QI(i,s);const c=new L_(16777215);c.position.set(0,-70,100).normalize(),this.freyaScene.add(c);const f=new L_(16777215);f.position.set(0,70,100).normalize(),this.freyaScene.add(f);const v=YI(),_=Og({location:this.waypointCoords,modelRotate:[0,0,Math.PI/2],scaleFactor:3,translationFactorX:.7,translationFactorY:.7,translationFactorZ:.3});this.objectIndex[0]={object:v,matrix:_};try{const C=await JI(this.gltfLoader,"/map-view-v2//models/location_pin.glb"),D=Og({location:this.waypointCoords,modelRotate:[0,Math.PI/2,Math.PI/2],translationFactorX:.7,translationFactorY:.7,translationFactorZ:15,scaleFactor:4});this.objectIndex[2]={matrix:D,object:C}}catch(C){console.error(C)}const o=KI(),M=Og({location:this.waypointCoords,modelRotate:[Math.PI/2,0,0],translationFactorX:.7,translationFactorY:.8,translationFactorZ:15,scaleFactor:4});this.objectIndex[4]={matrix:M,object:o};for(const C in this.objectIndex){const{object:D}=this.objectIndex[C];D.matrixAutoUpdate=!1,this.freyaScene.add(D)}}render(i,s){const c=new gi().fromArray(s.defaultProjectionData.mainMatrix);for(const f in this.objectIndex){const{object:v,matrix:_}=this.objectIndex[f];v.matrix=c.clone().multiply(_)}this.freyaScene?.draw()}}const{map:qv}=rS({center:[30.5107,50.4174],style:"https://drsrvsyvyuem5.cloudfront.net/freya_map_fake_s3.json",zoom:20,pitch:60,bearing:0});qv.on("load",()=>{const m=new eR({waypointCoords:[30.5107,50.4174]});qv.addLayer(m)});
